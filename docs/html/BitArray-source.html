<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: base/BitArray Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>base/BitArray</h1><a href="BitArray.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// A one-dimensional array of bits, similar to STL bitset.</span>
00002 <span class="comment">//</span>
00003 <span class="comment">// Copyright 2000 Andrew Kirmse.  All rights reserved.</span>
00004 <span class="comment">//</span>
00005 <span class="comment">// Permission is granted to use this code for any purpose, as long as this</span>
00006 <span class="comment">// copyright message remains intact.</span>
00007 
00008 <span class="preprocessor">#ifndef _BASE_BITARRAY_</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define _BASE_BITARRAY_</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#include &lt;memory&gt;</span>
00012 
00013 <span class="keyword">namespace </span><a class="code" href="base_2Jamfile_8ft.html#a0">base</a> {
00014 
<a name="l00015"></a><a class="code" href="classbase_1_1BitArray.html">00015</a> <span class="keyword">class </span><a class="code" href="classbase_1_1BitArray.html">BitArray</a>
00016 {
00017 <span class="keyword">public</span>:
00018 
00019    <span class="comment">//</span>
00020    <span class="comment">// Constructors and destructor</span>
00021    <span class="comment">//</span>
00022    
<a name="l00023"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">00023</a>    <span class="keyword">explicit</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(<span class="keywordtype">unsigned</span> size)
00024    {
00025       Init(size);
00026 
00027       <span class="comment">// Clear last bits</span>
00028       Trim();
00029    }
00030    
<a name="l00031"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya1">00031</a>    <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)
00032    {
00033       mpStore = 0;
00034       *<span class="keyword">this</span> = that;
00035    }
00036    
<a name="l00037"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya2">00037</a>    <span class="keyword">virtual</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya2">~BitArray</a>()
00038    {
00039       <span class="keywordflow">if</span> (mLength &gt; 1)
00040          <span class="keyword">delete</span>[] mpStore;
00041    }
00042 
00043    <span class="comment">//</span>
00044    <span class="comment">// Operators</span>
00045    <span class="comment">//</span>
00046 
00047    <span class="keyword">class </span>BitProxy;
00048    
<a name="l00049"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya3">00049</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya3">operator=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)
00050    {
00051       <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;that)
00052       {
00053          <span class="keywordflow">if</span> (mLength &gt; 1)
00054             <span class="keyword">delete</span>[] mpStore;
00055 
00056          Init(that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr3">mNumBits</a>);
00057          
00058          memcpy(mpStore, that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr0">mpStore</a>, mLength * <span class="keyword">sizeof</span>(store_type));
00059       }
00060       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00061    }
00062 
<a name="l00063"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya4">00063</a>    <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya4">operator[]</a>(<span class="keywordtype">unsigned</span> pos)
00064    {
00065       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00066       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn0">BitProxy</a>(*<span class="keyword">this</span>, pos);
00067    }
00068 
<a name="l00069"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya5">00069</a>    <span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya4">operator[]</a>(<span class="keywordtype">unsigned</span> pos)<span class="keyword"> const</span>
00070 <span class="keyword">   </span>{
00071       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00072       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn0">BitProxy</a>(const_cast&lt;BitArray &amp;&gt;(*<span class="keyword">this</span>), pos);
00073    }
00074    
<a name="l00075"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya6">00075</a>    <span class="keywordtype">bool</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya6">operator==</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)<span class="keyword"> const</span>
00076 <span class="keyword">   </span>{
00077       <span class="keywordflow">if</span> (mNumBits != that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr3">mNumBits</a>)
00078          <span class="keywordflow">return</span> <span class="keyword">false</span>;
00079       
00080       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; mLength; i++)
00081          <span class="keywordflow">if</span> (mpStore[i] != that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr0">mpStore</a>[i])
00082             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00083       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00084    }
00085 
<a name="l00086"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya7">00086</a>    <span class="keywordtype">bool</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya7">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)<span class="keyword"> const</span>
00087 <span class="keyword">   </span>{
00088       <span class="keywordflow">return</span> !(*<span class="keyword">this</span> == that);
00089    }
00090 
<a name="l00091"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya8">00091</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya8">operator&amp;=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)
00092    {
00093       <a class="code" href="base.html#a19">Assert</a>(mNumBits == that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr3">mNumBits</a>);
00094       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; mLength; i++)
00095          mpStore[i] &amp;= that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr0">mpStore</a>[i];
00096       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00097    }
00098 
<a name="l00099"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya9">00099</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya9">operator|=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)
00100    {
00101       <a class="code" href="base.html#a19">Assert</a>(mNumBits == that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr3">mNumBits</a>);
00102       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; mLength; i++)
00103          mpStore[i] |= that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr0">mpStore</a>[i];
00104       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00105    }
00106 
<a name="l00107"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya10">00107</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya10">operator^=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;that)
00108    {
00109       <a class="code" href="base.html#a19">Assert</a>(mNumBits == that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr3">mNumBits</a>);
00110       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; mLength; i++)
00111          mpStore[i] ^= that.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayr0">mpStore</a>[i];
00112       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00113    }
00114 
<a name="l00115"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya11">00115</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya11">operator~</a>()<span class="keyword"> const</span>
00116 <span class="keyword">   </span>{
00117       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(*this).FlipAllBits();
00118    }
00119 
<a name="l00120"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn1">00120</a>    <span class="keyword">friend</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn1">operator&amp;</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a1, <span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a2)
00121    {
00122       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(a1) &amp;= a2;
00123    }
00124 
<a name="l00125"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn2">00125</a>    <span class="keyword">friend</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn2">operator|</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a1, <span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a2)
00126    {
00127       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(a1) |= a2;
00128    }
00129 
<a name="l00130"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn3">00130</a>    <span class="keyword">friend</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn3">operator^</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a1, <span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;a2)
00131    {
00132       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya0">BitArray</a>(a1) ^= a2;
00133    }
00134 
00135    <span class="comment">//</span>
00136    <span class="comment">// Plain English interface</span>
00137    <span class="comment">//</span>
00138    
00139    <span class="comment">// Set all bits to false.</span>
<a name="l00140"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya12">00140</a>    <span class="keywordtype">void</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya12">Clear</a>()
00141    {
00142       memset(mpStore, 0, mLength * <span class="keyword">sizeof</span>(store_type));
00143    }
00144    
00145    <span class="comment">// Set the bit at position pos to true.</span>
<a name="l00146"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya13">00146</a>    <span class="keywordtype">void</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya13">SetBit</a>(<span class="keywordtype">unsigned</span> pos)
00147    {
00148       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00149       mpStore[GetIndex(pos)] |= 1 &lt;&lt; GetOffset(pos); 
00150    }
00151 
00152    <span class="comment">// Set the bit at position pos to false.</span>
<a name="l00153"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya14">00153</a>    <span class="keywordtype">void</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya14">ClearBit</a>(<span class="keywordtype">unsigned</span> pos)
00154    { 
00155       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00156       mpStore[GetIndex(pos)] &amp;= ~(1 &lt;&lt; GetOffset(pos)); 
00157    }
00158 
00159    <span class="comment">// Toggle the bit at position pos.</span>
<a name="l00160"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya15">00160</a>    <span class="keywordtype">void</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya15">FlipBit</a>(<span class="keywordtype">unsigned</span> pos) 
00161    { 
00162       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00163       mpStore[GetIndex(pos)] ^= 1 &lt;&lt; GetOffset(pos); 
00164    }
00165 
00166    <span class="comment">// Set the bit at position pos to the given value.</span>
<a name="l00167"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya16">00167</a>    <span class="keywordtype">void</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya16">Set</a>(<span class="keywordtype">unsigned</span> pos, <span class="keywordtype">bool</span> val)
00168    { 
00169       val ? <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya13">SetBit</a>(pos) : <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya14">ClearBit</a>(pos);
00170    }
00171 
00172    <span class="comment">// Returns true iff the bit at position pos is true.</span>
<a name="l00173"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya17">00173</a>    <span class="keywordtype">bool</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya17">IsBitSet</a>(<span class="keywordtype">unsigned</span> pos)<span class="keyword"> const</span>
00174 <span class="keyword">   </span>{
00175       <a class="code" href="base.html#a19">Assert</a>(pos &lt; mNumBits);
00176       <span class="keywordflow">return</span> (mpStore[GetIndex(pos)] &amp; (1 &lt;&lt; GetOffset(pos))) != 0;
00177    }
00178 
00179    <span class="comment">// Returns true iff all bits are false.</span>
<a name="l00180"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya18">00180</a>    <span class="keywordtype">bool</span> <a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya18">AllBitsFalse</a>()<span class="keyword"> const</span>
00181 <span class="keyword">   </span>{
00182       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; mLength; i++)
00183          <span class="keywordflow">if</span> (mpStore[i] != 0)
00184             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00185       <span class="keywordflow">return</span> <span class="keyword">true</span>;
00186    }
00187 
00188    <span class="comment">// Change value of all bits</span>
<a name="l00189"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya19">00189</a>    <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya19">FlipAllBits</a>()
00190    {
00191       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i &lt; mLength; i++)
00192          mpStore[i] = ~mpStore[i];
00193 
00194       Trim();
00195       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00196    }
00197 
00198    <span class="comment">//</span>
00199    <span class="comment">// Bit proxy (for operator[])</span>
00200    <span class="comment">//</span>
00201    
<a name="l00202"></a><a class="code" href="classbase_1_1BitArray.html#base_1_1BitArrayn0">00202</a>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a>;
00203    
<a name="l00204"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">00204</a>    <span class="keyword">class </span><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a>
00205    {
00206    <span class="keyword">public</span>:
<a name="l00207"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya0">00207</a>       <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya0">BitProxy</a>(<a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;<a class="code" href="classbase_1_1array.html">array</a>, <span class="keywordtype">unsigned</span> pos):
00208             mArray(array), mPos(pos)
00209       {}
00210 
<a name="l00211"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya1">00211</a>       <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a> &amp;<a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya1">operator=</a>(<span class="keywordtype">bool</span> value)
00212       {
00213          mArray.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya16">Set</a>(mPos, value);
00214          <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00215       }
00216 
<a name="l00217"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya2">00217</a>       <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a> &amp;<a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya1">operator=</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html">BitProxy</a> &amp;that)
00218       {
00219          mArray.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya16">Set</a>(mPos, that.<a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxyr0">mArray</a>.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya17">IsBitSet</a>(that.<a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxyr1">mPos</a>));
00220          <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00221       }
00222 
<a name="l00223"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya3">00223</a>       <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya3">operator bool</a>()<span class="keyword"> const</span>
00224 <span class="keyword">      </span>{
00225          <span class="keywordflow">return</span> mArray.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya17">IsBitSet</a>(mPos);
00226       }
00227 
<a name="l00228"></a><a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya4">00228</a>       <span class="keywordtype">bool</span> <a class="code" href="classbase_1_1BitArray_1_1BitProxy.html#base_1_1BitArray_1_1BitProxya4">Flip</a>()
00229       {
00230          mArray.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya15">FlipBit</a>(mPos);
00231          <span class="keywordflow">return</span> mArray.<a class="code" href="classbase_1_1BitArray.html#base_1_1BitArraya17">IsBitSet</a>(mPos);
00232       }
00233 
00234    <span class="keyword">private</span>:
00235       <a class="code" href="classbase_1_1BitArray.html">BitArray</a> &amp;mArray;
00236       <span class="keywordtype">unsigned</span>  mPos;
00237    };
00238    
00239 <span class="keyword">private</span>:
00240    
00241    <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> store_type;
00242    <span class="keyword">enum</span>
00243    {
00244       bits_per_byte = 8,
00245       cell_size     = <span class="keyword">sizeof</span>(store_type) * bits_per_byte
00246    };
00247 
00248    store_type        *mpStore;  
00249    store_type         mSingleWord; <span class="comment">// Use this buffer when mLength is 1</span>
00250    <span class="keywordtype">unsigned</span>           mLength;     <span class="comment">// Length of mpStore in units of store_type</span>
00251    <span class="keywordtype">unsigned</span>           mNumBits;
00252 
00253    <span class="comment">// Get the index and bit offset for a given bit number.</span>
00254    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> GetIndex(<span class="keywordtype">unsigned</span> bit_num)
00255    {
00256       <span class="keywordflow">return</span> bit_num / cell_size;
00257    }
00258 
00259    <span class="keyword">static</span> <span class="keywordtype">unsigned</span> GetOffset(<span class="keywordtype">unsigned</span> bit_num)
00260    {
00261       <span class="keywordflow">return</span> bit_num % cell_size;
00262    }
00263 
00264    <span class="keywordtype">void</span> Init(<span class="keywordtype">unsigned</span> size)
00265    {
00266       mNumBits = size;
00267       
00268       <span class="keywordflow">if</span> (size == 0)
00269          mLength = 0;
00270       <span class="keywordflow">else</span>
00271          mLength = 1 + GetIndex(size - 1);
00272 
00273       <span class="comment">// Avoid allocation if length is 1 (common case)</span>
00274       <span class="keywordflow">if</span> (mLength &lt;= 1)
00275          mpStore = &amp;mSingleWord;      
00276       <span class="keywordflow">else</span>
00277          mpStore = <span class="keyword">new</span> store_type[mLength];
00278    }
00279    
00280    <span class="comment">// Force overhang bits at the end to 0</span>
00281    <span class="keyword">inline</span> <span class="keywordtype">void</span> Trim()
00282    {
00283       <span class="keywordtype">unsigned</span> extra_bits = mNumBits % cell_size;
00284       <span class="keywordflow">if</span> (mLength &gt; 0 &amp;&amp; extra_bits != 0)
00285          mpStore[mLength - 1] &amp;= ~((~(store_type) 0) &lt;&lt; extra_bits);
00286    }
00287 };
00288 
00289 } <span class="comment">// base</span>
00290 
00291 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:04 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
