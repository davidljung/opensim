<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/sim/SimulatedRobot.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/sim/SimulatedRobot.cpp</h1><a href="SimulatedRobot_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)2002 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: SimulatedRobot.cpp 1033 2004-02-11 20:47:52Z jungd $</span>
00019 <span class="comment">  $Revision: 1.23 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:47:52 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="SimulatedRobot.html">robot/sim/SimulatedRobot</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;sstream&gt;</span>
00028 
00029 <span class="preprocessor">#include &lt;<a class="code" href="SimpleXMLSerializer.html">base/SimpleXMLSerializer</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="Externalizer.html">base/Externalizer</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="Orient.html">base/Orient</a>&gt;</span>
00032 
00033 <span class="preprocessor">#include &lt;<a class="code" href="Box.html">physics/Box</a>&gt;</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="Solid.html">physics/Solid</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;<a class="code" href="ConstraintGroup.html">physics/ConstraintGroup</a>&gt;</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="FixedConstraint.html">physics/FixedConstraint</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="CollisionCuller.html">physics/CollisionCuller</a>&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="CollisionDetector.html">physics/CollisionDetector</a>&gt;</span>
00039 
00040 <span class="preprocessor">#include &lt;<a class="code" href="SimulatedPlatform.html">robot/sim/SimulatedPlatform</a>&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="SimulatedSerialManipulator.html">robot/sim/SimulatedSerialManipulator</a>&gt;</span>
00042 
00043 <span class="keyword">using</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html">robot::sim::SimulatedRobot</a>;
00044 
00045 <span class="keyword">using</span> <a class="code" href="classbase_1_1array.html">base::array</a>;
00046 <span class="keyword">using</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>;
00047 <span class="keyword">using</span> <a class="code" href="classbase_1_1VFile.html">base::VFile</a>;
00048 <span class="keyword">using</span> <a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>;
00049 <span class="keyword">using</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>;
00050 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Box.html">physics::Box</a>;
00051 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Solid.html">physics::Solid</a>;
00052 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Spatial.html">physics::Spatial</a>;
00053 <span class="keyword">using</span> <a class="code" href="classphysics_1_1SpatialGroup.html">physics::SpatialGroup</a>;
00054 <span class="keyword">using</span> <a class="code" href="classphysics_1_1ConstraintGroup.html">physics::ConstraintGroup</a>;
00055 <span class="keyword">using</span> <a class="code" href="classphysics_1_1FixedConstraint.html">physics::FixedConstraint</a>;
00056 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Collidable.html">physics::Collidable</a>;
00057 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollidableGroup.html">physics::CollidableGroup</a>;
00058 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollisionCuller.html">physics::CollisionCuller</a>;
00059 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollisionDetector.html">physics::CollisionDetector</a>;
00060 <span class="keyword">using</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html">robot::sim::SimulatedPlatform</a>;
00061 <span class="keyword">using</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedSerialManipulator.html">robot::sim::SimulatedSerialManipulator</a>;
00062  
00063 
00064 
00065  
00066 <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota0">SimulatedRobot::SimulatedRobot</a>(ref&lt;base::VFile&gt; robotSpecification,
00067                                <span class="keyword">const</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>&amp; initialPosition, <span class="keyword">const</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>&amp; initialOrientation,
00068                                ref&lt;physics::SolidSystem&gt; solidSystem, <span class="keywordtype">bool</span> dynamic)
00069   : solidSystem(solidSystem), dynamic(dynamic) 
00070 {
00071   <a class="code" href="base.html#a19">Assert</a>(solidSystem!=0);
00072 
00073   <span class="comment">// read in supported formats</span>
00074   <span class="keywordflow">if</span> (robotSpecification-&gt;extension() == <span class="stringliteral">"xml"</span>) {
00075 
00076     <span class="comment">// read in parameters </span>
00077     <span class="keywordflow">try</span> {
00078       <a class="code" href="classbase_1_1Externalizer.html">Externalizer</a> e(Externalizable::Input, robotSpecification);
00079       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota23">externalize</a>(e,<span class="stringliteral">"xml"</span>,1.0);
00080     } <span class="keywordflow">catch</span> (std::exception&amp;) {
00081       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"not a valid robot .xml file."</span>));
00082     }
00083 
00084   }
00085   <span class="keywordflow">else</span>
00086     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"file format unsupported."</span>));
00087 
00088   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotb0">construct</a>(initialPosition, initialOrientation);
00089 }
00090 
00091 
00092 <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota0">SimulatedRobot::SimulatedRobot</a>(ref&lt;const robot::RobotDescription&gt; robotDescription,
00093                                <span class="keyword">const</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>&amp; initialPosition, <span class="keyword">const</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>&amp; initialOrientation,
00094                                ref&lt;physics::SolidSystem&gt; solidSystem, <span class="keywordtype">bool</span> dynamic)
00095   : solidSystem(solidSystem), dynamic(dynamic) 
00096 {
00097   <a class="code" href="base.html#a19">Assert</a>(solidSystem!=0);
00098 
00099   <a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobotb2">setRobotDescription</a>( robotDescription );
00100 
00101   platform = ref&lt;SimulatedPlatform&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SimulatedPlatform(robotDescription-&gt;platform(), solidSystem, dynamic));
00102   
00103   <span class="keyword">const</span> array&lt;ref&lt;const ManipulatorDescription&gt; &gt; manips(robotDescription-&gt;manipulators());
00104   <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;manips.size(); i++) {
00105     ref&lt;SimulatedSerialManipulator&gt; m(NewObj <a class="code" href="classrobot_1_1sim_1_1SimulatedSerialManipulator.html">SimulatedSerialManipulator</a>(manips[i], solidSystem, dynamic));
00106     manipulators.push_back(m);
00107   }
00108 
00109   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotb0">construct</a>(initialPosition, initialOrientation);
00110 }
00111 
00112 
00113 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota5">SimulatedRobot::setDynamic</a>(<span class="keywordtype">bool</span> enabled)
00114 {
00115   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;setDynamic(<span class="keyword">false</span>);
00116   
00117   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> m = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.begin();
00118   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> end = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.end();
00119   <span class="keywordflow">while</span> (m != end) {
00120     (*m)-&gt;setDynamic(enabled);
00121     ++m;
00122   }
00123 }
00124 
00125 
00126 
00127 array&lt;std::pair&lt;String,String&gt; &gt; <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota7">SimulatedRobot::controlInterfaces</a>()<span class="keyword"> const </span>
00128 <span class="keyword"></span>{
00129   array&lt;std::pair&lt;String,String&gt; &gt; a;
00130   <span class="keywordflow">if</span> (dynamic) {
00131     a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"platform"</span>,<span class="stringliteral">"PlatformControl"</span>));
00132     a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"platformVelocity"</span>,<span class="stringliteral">"PlatformVelocityControl"</span>));
00133   }
00134   <span class="keywordflow">else</span>
00135     a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"platformPosition"</span>,<span class="stringliteral">"PlatformPositionControl"</span>));
00136   
00137   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> m=0; m&lt;<a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobota14">getRobotDescription</a>()-&gt;manipulators().size();m++) {
00138     ref&lt;const ManipulatorDescription&gt; md( <a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobota14">getRobotDescription</a>()-&gt;<a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>()[m] );
00139     ref&lt;const SimulatedManipulatorDescription&gt; smd;
00140     <span class="keywordflow">if</span> (<a class="code" href="base.html#a25">instanceof</a>(*md, <span class="keyword">const</span> SimulatedManipulatorDescription))
00141       smd = narrow_ref&lt;const SimulatedManipulatorDescription&gt;(md);
00142     <span class="keywordflow">else</span>
00143       smd = ref&lt;SimulatedManipulatorDescription&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SimulatedManipulatorDescription(*md));
00144     
00145     <a class="code" href="namespacebase.html#a4">String</a> n(base::intToString(m+1));
00146     <span class="keywordflow">if</span> (dynamic) {
00147       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"manipulator"</span>+n,<span class="stringliteral">"JointForceControl"</span>));
00148       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"manipulatorVelocity"</span>+n,<span class="stringliteral">"JointVelocityControl"</span>));
00149       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"tool"</span>+n,<span class="stringliteral">"JointForceControl"</span>));
00150       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"toolVelocity"</span>+n,<span class="stringliteral">"JointVelocityControl"</span>));
00151     }
00152     <span class="keywordflow">else</span> {
00153       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"manipulatorPosition"</span>+n,<span class="stringliteral">"JointPositionControl"</span>));
00154       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"toolPosition"</span>+n,<span class="stringliteral">"JointPositionControl"</span>));
00155     }
00156     <span class="keywordflow">if</span> (smd-&gt;hasLinkProximitySensors())
00157       a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"manipulatorProximity"</span>+n,<span class="stringliteral">"LinkProximitySensors"</span>));
00158     a.push_back(std::make_pair&lt;String,String&gt;(<span class="stringliteral">"manipulatorToolGrip"</span>+n,<span class="stringliteral">"ToolGripControl"</span>));
00159   }
00160   <span class="keywordflow">return</span> a; 
00161 }
00162 
00163 
00164 
00165 
00166 
00167 <span class="comment">// Spatial</span>
00168 
00169 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota11">SimulatedRobot::setPosition</a>(<span class="keyword">const</span> Point3&amp; pos)       
00170 { 
00171   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00172   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;setPosition(pos); 
00173 }
00174 
00175 <a class="code" href="namespacebase.html#a26">Point3</a> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota12">SimulatedRobot::getPosition</a>()<span class="keyword"> const                  </span>
00176 <span class="keyword"></span>{ 
00177   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00178   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;getPosition(); 
00179 }
00180 
00181 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota13">SimulatedRobot::setOrientation</a>(<span class="keyword">const</span> Orient&amp; orient) 
00182 { 
00183   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00184   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;setOrientation(orient); 
00185 }
00186 
00187 Orient <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota14">SimulatedRobot::getOrientation</a>()<span class="keyword"> const               </span>
00188 <span class="keyword"></span>{ 
00189   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00190   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;getOrientation(); 
00191 }
00192 
00193 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota15">SimulatedRobot::setConfiguration</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1Transform.html">base::Transform</a>&amp; configuration) 
00194 { 
00195   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00196   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;setConfiguration(configuration); 
00197 }
00198 
00199 <a class="code" href="classbase_1_1Transform.html">base::Transform</a> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota16">SimulatedRobot::getConfiguration</a>()<span class="keyword"> const    </span>
00200 <span class="keyword"></span>{ 
00201   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;updateGroupConfiguration( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getConfiguration() );
00202   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;getConfiguration(); 
00203 }
00204 
00205 
00206 
00207 
00208 
00209 
00210 <span class="keywordtype">bool</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota22">SimulatedRobot::formatSupported</a>(String format, Real version, ExternalizationType type)<span class="keyword"> const</span>
00211 <span class="keyword"></span>{
00212   <span class="keywordflow">return</span> ( ((format==<span class="stringliteral">"dh"</span>) || (format==<span class="stringliteral">"xml"</span>)) &amp;&amp; (version==1.0) &amp;&amp; (type==<a class="code" href="classbase_1_1Externalizable.html#gfx_1_1VisualPathw3gfx_1_1VisualPathw0">Input</a>) );
00213 }
00214 
00215 
00216 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota23">SimulatedRobot::externalize</a>(<a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>&amp; e, String format, Real version)
00217 {
00218   <span class="keywordflow">if</span> (format==<span class="stringliteral">""</span>) format = <a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"xml"</span>);
00219 
00220   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota22">formatSupported</a>(format,version,e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera6">ioType</a>()))
00221     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"format "</span>)+format+<span class="stringliteral">" "</span>+base::realToString(version)+<span class="stringliteral">" unsupported"</span>));
00222 
00223   <span class="keywordflow">if</span> (format == <span class="stringliteral">"dh"</span>) {
00224 
00225     <span class="keywordflow">if</span> (e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera5">isInput</a>()) {
00226 
00227       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a> = ref&lt;SpatialGroup&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> <a class="code" href="classphysics_1_1SpatialGroup.html">SpatialGroup</a>());
00228 
00229       <span class="comment">// dh format doesn't specify anything about the platform, just instantiate the default</span>
00230       ref&lt;PlatformDescription&gt; pd(NewObj PlatformDescription(<span class="stringliteral">"platform"</span>,<a class="code" href="classbase_1_1Vector3.html">base::Dimension3</a>(1,1,0.1), <a class="code" href="classbase_1_1Vector3.html">base::Vector3</a>(0,0,0.05), <span class="keyword">false</span>));
00231       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a> = ref&lt;SimulatedPlatform&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SimulatedPlatform(pd));
00232       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(platform);
00233       
00234       <span class="comment">// externalize SimulatedSerialManipulator</span>
00235       <span class="comment">//  (dh format only specifies a single manipulator)</span>
00236       ref&lt;SimulatedSerialManipulator&gt; m(NewObj <a class="code" href="classrobot_1_1sim_1_1SimulatedSerialManipulator.html">SimulatedSerialManipulator</a>(solidSystem));
00237       m-&gt;externalize(e,format,version);
00238       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.push_back(m);
00239       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(m);
00240 
00241       <span class="comment">// dh format doesn't specify the manipulator offset from the platform either</span>
00242       array&lt;Vector3&gt; offsets(1);
00243       offsets[0] = Vector3(); <span class="comment">// default to 0</span>
00244 
00245       <span class="comment">// construct RobotDescription</span>
00246       array&lt;ref&lt;const ManipulatorDescription&gt; &gt; manipulatorDescrs(1);
00247       manipulatorDescrs[0] = m-&gt;getManipulatorDescription();
00248 
00249       <a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobotb2">setRobotDescription</a>( ref&lt;RobotDescription&gt;(NewObj RobotDescription(<span class="stringliteral">"robot"</span>,pd,manipulatorDescrs,offsets)) );
00250       
00251     }
00252 
00253   }
00254   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <span class="stringliteral">"xml"</span>) {
00255     
00256     <span class="keywordflow">if</span> (e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera5">isInput</a>()) {
00257       <span class="comment">// let the RobotDescription read the xml first,</span>
00258       <span class="comment">//  then look for simulation specific information</span>
00259       
00260       ref&lt;RobotDescription&gt; rd(NewObj RobotDescription());
00261       rd-&gt;externalize(e, format, version);
00262   
00263       <a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobotb2">setRobotDescription</a>( rd );
00264       
00265       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a> = ref&lt;SpatialGroup&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SpatialGroup());
00266   
00267       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a> = ref&lt;SimulatedPlatform&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SimulatedPlatform(rd-&gt;platform()));
00268       <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(platform);
00269   
00270       <span class="keyword">const</span> array&lt;ref&lt;const ManipulatorDescription&gt; &gt;&amp; manips(rd-&gt;manipulators());
00271       <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;manips.size(); i++) {
00272         ref&lt;SimulatedSerialManipulator&gt; m(NewObj <a class="code" href="classrobot_1_1sim_1_1SimulatedSerialManipulator.html">SimulatedSerialManipulator</a>(manips[i], solidSystem));
00273         <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.push_back(m);
00274         <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(m);
00275       }
00276       
00277     } <span class="comment">// end input</span>
00278 
00279   }
00280 
00281 }
00282 
00283 
00284 
00285 
00286 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotb0">SimulatedRobot::construct</a>(<span class="keyword">const</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>&amp; initialPosition, <span class="keyword">const</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>&amp; initialOrientation)
00287 {
00288   <a class="code" href="base.html#a19">Assert</a>(solidSystem);
00289   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a> = ref&lt;SpatialGroup&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> SpatialGroup());
00290   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;setPositionOrientation(initialPosition, initialOrientation);
00291 
00292   <span class="comment">// construct the platform</span>
00293   <a class="code" href="base.html#a19">Assert</a>(platform);
00294   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;setSolidSystem(solidSystem);
00295   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;construct(initialPosition, initialOrientation);
00296   <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(platform);
00297 
00298   ref&lt;const RobotDescription&gt; rd(<a class="code" href="classrobot_1_1Robot.html#robot_1_1TestRobota14">getRobotDescription</a>());
00299   ref&lt;ConstraintGroup&gt; cgroup(solidSystem-&gt;createConstraintGroup());
00300 
00301   <a class="code" href="namespacebase.html#a2">Int</a> manipulatorIndex=0;
00302   <span class="comment">// for each manipulator, construct it and attach it to the platform</span>
00303   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> m = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.begin();
00304   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> end = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.end();
00305   <span class="keywordflow">while</span> (m != end) {
00306     ref&lt;SimulatedSerialManipulator&gt; sm(*m);
00307 
00308     <span class="comment">// construct (initial position of the manipulator is the position of the platform/robot + manip offset translation)</span>
00309     Matrix4 offsetTransform; offsetTransform.setToTranslation(rd-&gt;manipulatorOffsets()[manipulatorIndex]);
00310     Matrix4 platformTransform(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta28">getRotationMatrix3</a>()); platformTransform.setTranslationComponent(initialPosition);
00311     Matrix4 manipTransform(platformTransform * offsetTransform);
00312     Vector3 manipPosition = manipTransform.column(4).toVector3();
00313     Orient  manipOrient = Matrix3(manipTransform);
00314 
00315     sm-&gt;setSolidSystem(solidSystem);
00316     sm-&gt;construct(manipPosition, manipOrient);
00317     <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp3">spatialGroup</a>-&gt;add(sm);
00318 
00319     <span class="comment">// fix the manipulator base link to the platform</span>
00320     ref&lt;FixedConstraint&gt; fixed(solidSystem-&gt;createFixedConstraint());
00321     cgroup-&gt;addConstraint(fixed);
00322     fixed-&gt;attach(<a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;getPlatformSolid(), sm-&gt;getBaseSolid());
00323 
00324     ++m; ++manipulatorIndex;
00325   }
00326 
00327   <span class="keywordflow">if</span> (manipulatorIndex &gt; 0)
00328     solidSystem-&gt;addConstraintGroup(cgroup);
00329   
00330 }
00331 
00332 
00333 
00334 <span class="keywordtype">bool</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota17">SimulatedRobot::checkProximity</a>(ref&lt;SimulatedTool&gt; tool)
00335 {
00336   <span class="comment">// ask each manipulator to check</span>
00337   <span class="keywordtype">bool</span> anyInProximity = <span class="keyword">false</span>;
00338   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> m = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.begin();
00339   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> end = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.end();
00340   <span class="keywordflow">while</span> (m != end) {
00341     ref&lt;SimulatedSerialManipulator&gt; sm(*m);
00342     <span class="keywordflow">if</span> (sm-&gt;checkProximity(tool))
00343       anyInProximity=<span class="keyword">true</span>;
00344     ++m;
00345   }  
00346   <span class="keywordflow">return</span> anyInProximity;
00347 }
00348 
00349 
00350 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota18">SimulatedRobot::placeToolInProximity</a>(ref&lt;SimulatedTool&gt; tool, Int manipIndex)
00351 {
00352   ref&lt;SimulatedSerialManipulator&gt; sm( base::elementAt(manipulators, manipIndex) );
00353 
00354   <span class="comment">// new tool pos/orient</span>
00355   tool-&gt;setPositionOrientation( sm-&gt;getEEPosition(), sm-&gt;getEEOrientation() );
00356   sm-&gt;setToolInProximity(tool);
00357 }
00358 
00359 
00360 <span class="keywordtype">bool</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota19">SimulatedRobot::graspTool</a>(Int manipIndex)
00361 {
00362   ref&lt;SimulatedSerialManipulator&gt; sm( base::elementAt(manipulators, manipIndex) );
00363   <span class="keywordflow">return</span> sm-&gt;graspTool();
00364 }
00365 
00366 
00367 <span class="keywordtype">void</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota20">SimulatedRobot::releaseGrasp</a>(Int manipIndex)
00368 {
00369   ref&lt;SimulatedSerialManipulator&gt; sm( base::elementAt(manipulators, manipIndex) );
00370   sm-&gt;releaseGrasp();
00371 }
00372 
00373 
00374 ref&lt;physics::Collidable&gt; <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota21">SimulatedRobot::createCollidable</a>(CollidableFlags flags)
00375 {
00376   ref&lt;CollisionCuller&gt; cc(solidSystem-&gt;getCollisionCuller());
00377 
00378   ref&lt;CollidableGroup&gt; collidableGroup = cc-&gt;createCollidableGroup();
00379   ref&lt;Collidable&gt; platformCollidable( <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>-&gt;createCollidable(flags) );
00380   collidableGroup-&gt;addCollidable(platformCollidable);
00381   ref&lt;Collidable&gt; <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp0">platform</a>( platformCollidable-&gt;findNamed(<span class="stringliteral">"platformBody"</span>) );
00382   
00383   <span class="comment">// for each manipulator, create a collidable</span>
00384   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> m = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.begin();
00385   reflist&lt;SimulatedSerialManipulator&gt;<a class="code" href="classstd_1_1iterator.html">::iterator</a> end = <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobotp1">manipulators</a>.end();
00386   <span class="keywordflow">while</span> (m != end) {
00387     ref&lt;SimulatedSerialManipulator&gt; sm(*m);
00388     ref&lt;Collidable&gt; smCollidable( sm-&gt;createCollidable(flags) );
00389     collidableGroup-&gt;addCollidable( smCollidable );
00390 
00391     <span class="comment">// disable collision detection between platform and base link (&amp; its proximity sensor Collidable)</span>
00392     ref&lt;Collidable&gt; <a class="code" href="base_2Jamfile_8ft.html#a0">base</a>( smCollidable-&gt;findNamed(<span class="stringliteral">"baseLink"</span>) );
00393     <span class="keywordflow">if</span> (platform &amp;&amp; <a class="code" href="base_2Jamfile_8ft.html#a0">base</a>)
00394       cc-&gt;collisionEnable(<span class="keyword">false</span>,platform,base);
00395     ref&lt;Collidable&gt; baseSensor( smCollidable-&gt;findNamed(<span class="stringliteral">"baseLink Sensor"</span>) );
00396     <span class="keywordflow">if</span> (platform &amp;&amp; baseSensor)
00397       cc-&gt;collisionEnable(<span class="keyword">false</span>,platform,baseSensor);
00398     
00399     ++m;
00400   }
00401   
00402   <span class="keywordflow">return</span> collidableGroup;
00403 }
00404 
00405 
00406 
00407 
00408 
00409 
00410 
00411 ref&lt;robot::ControlInterface&gt; <a class="code" href="classrobot_1_1sim_1_1SimulatedRobot.html#robot_1_1sim_1_1SimulatedRobota8">SimulatedRobot::getControlInterface</a>(String interfaceName) <span class="keywordflow">throw</span>(std::invalid_argument)
00412 {
00413   <span class="keywordflow">if</span> (interfaceName == <span class="stringliteral">""</span>) interfaceName = <span class="stringliteral">"platform"</span>;
00414 
00415   <span class="comment">// these if's test the name string prefix, so don't forget to put the longer names before shorter ones</span>
00416   <span class="comment">//  with a common prefix.</span>
00417   
00418   <span class="comment">//  if (interfaceName.substr(0,20) == "manipulatorProximity")</span>
00419   <span class="comment">//    return proximitySensorControlInterface;</span>
00420 
00421 
00422   ref&lt;SimulatedRobot&gt; self(<span class="keyword">this</span>);
00423   <span class="keywordflow">if</span> (interfaceName == <span class="stringliteral">"platformVelocity"</span>)
00424     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> PlatformControlInterface(interfaceName, <span class="stringliteral">"PlatformVelocityControl"</span>, self, platform, VelControl));
00425   
00426   <span class="keywordflow">if</span> (interfaceName == <span class="stringliteral">"platformPosition"</span>)
00427     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> PlatformControlInterface(interfaceName, <span class="stringliteral">"PlatformPositionControl"</span>, self, platform, PosControl));
00428 
00429   <span class="keywordflow">if</span> (interfaceName == <span class="stringliteral">"platform"</span>) 
00430     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> PlatformControlInterface(interfaceName, <span class="stringliteral">"PlatformControl"</span>, self, platform, ForceControl));
00431 
00432 
00433   <span class="keywordflow">if</span> (interfaceName.substr(0,19) == <span class="stringliteral">"manipulatorVelocity"</span>) {
00434     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(19));
00435     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00436       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00437     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00438     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ManipulatorControlInterface(interfaceName,<span class="stringliteral">"JointVelocityControl"</span>,manip,VelControl));
00439   }
00440 
00441   <span class="keywordflow">if</span> (interfaceName.substr(0,19) == <span class="stringliteral">"manipulatorPosition"</span>) {
00442     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(19));
00443     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00444       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00445     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00446     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ManipulatorControlInterface(interfaceName,<span class="stringliteral">"JointPositionControl"</span>,manip,PosControl));
00447   }
00448 
00449   
00450   <span class="keywordflow">if</span> (interfaceName.substr(0,19) == <span class="stringliteral">"manipulatorToolGrip"</span>) {
00451     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(19));
00452     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00453       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00454     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00455     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ToolControlInterface(interfaceName,<span class="stringliteral">"ToolGripControl"</span>, manip, <span class="keyword">true</span>));
00456   }
00457 
00458   <span class="keywordflow">if</span> (interfaceName.substr(0,20) == <span class="stringliteral">"manipulatorProximity"</span>) {
00459     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(20));
00460     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00461       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00462     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00463     <span class="keywordflow">if</span> (manip-&gt;getManipulatorDescription()-&gt;hasLinkProximitySensors()) {
00464       <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ProximitySensorInterface(interfaceName, <span class="stringliteral">"LinkProximitySensors"</span>, manip));
00465     }
00466     <span class="keywordflow">else</span>
00467       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"manipulator has no proximity sensors; invalid interface "</span>)+interfaceName));
00468   }
00469   
00470   <span class="keywordflow">if</span> (interfaceName.substr(0,11) == <span class="stringliteral">"manipulator"</span>) {
00471     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(11));
00472     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00473       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"manipulator index "</span>)+base::intToString(n)+<span class="stringliteral">" out of range"</span>));
00474     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00475     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ManipulatorControlInterface(interfaceName,<span class="stringliteral">"JointForceControl"</span>,manip));
00476   }
00477 
00478   
00479   <span class="keywordflow">if</span> (interfaceName.substr(0,12) == <span class="stringliteral">"toolVelocity"</span>) {
00480     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(12));
00481     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00482       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00483     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00484     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ToolControlInterface(interfaceName,<span class="stringliteral">"JointVelocityControl"</span>, manip, <span class="keyword">false</span>, VelControl));
00485   }
00486   
00487   <span class="keywordflow">if</span> (interfaceName.substr(0,12) == <span class="stringliteral">"toolPosition"</span>) {
00488     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(12));
00489     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00490       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00491     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00492     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ToolControlInterface(interfaceName,<span class="stringliteral">"JointPositionControl"</span>, manip, <span class="keyword">false</span>, PosControl));
00493   }
00494 
00495   <span class="keywordflow">if</span> (interfaceName.substr(0,4) == <span class="stringliteral">"tool"</span>) {
00496     <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="namespacebase.html#a52">base::stringToInt</a>(interfaceName.substr(4));
00497     <span class="keywordflow">if</span> ((n&lt;1) || (n &gt; manipulators.size())) 
00498       <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"manipulator index out of range"</span>));
00499     ref&lt;SimulatedSerialManipulator&gt; manip( base::elementAt(manipulators,n-1) );
00500     <span class="keywordflow">return</span> ref&lt;robot::ControlInterface&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ToolControlInterface(interfaceName,<span class="stringliteral">"JointForceControl"</span>, manip, <span class="keyword">false</span>, ForceControl));
00501   }
00502 
00503   
00504   <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"unknown interface "</span>)+interfaceName));
00505 }
00506 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:41 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
