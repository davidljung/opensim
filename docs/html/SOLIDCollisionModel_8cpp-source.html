<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: physics/SOLIDCollisionModel.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>physics/SOLIDCollisionModel.cpp</h1><a href="SOLIDCollisionModel_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: SOLIDCollisionModel.cpp 1031 2004-02-11 20:46:36Z jungd $</span>
00019 <span class="comment">  $Revision: 1.2 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:46:36 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="SOLIDCollisionModel.html">physics/SOLIDCollisionModel</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;<a class="code" href="Box.html">physics/Box</a>&gt;</span>
00028 <span class="preprocessor">#include &lt;<a class="code" href="Shape.html">physics/Shape</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="Color4.html">gfx/Color4</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="Triangle3.html">gfx/Triangle3</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="TriangleContainer.html">gfx/TriangleContainer</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="TriangleIterator.html">gfx/TriangleIterator</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="VisualTriangles.html">gfx/VisualTriangles</a>&gt;</span>
00034 
00035 <span class="preprocessor">#include &lt;osg/Node&gt;</span>
00036 <span class="preprocessor">#include &lt;osg/Group&gt;</span>
00037 <span class="preprocessor">#include &lt;osg/Transform&gt;</span>
00038 <span class="preprocessor">#include &lt;osg/StateSet&gt;</span>
00039 <span class="preprocessor">#include &lt;osg/Material&gt;</span>
00040 <span class="preprocessor">#include &lt;osg/Vec4&gt;</span>
00041 <span class="preprocessor">#include &lt;osg/PolygonMode&gt;</span>
00042 
00043 
00044 <span class="keyword">using</span> <a class="code" href="classphysics_1_1SOLIDCollisionModel.html">physics::SOLIDCollisionModel</a>;
00045 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Shape.html">physics::Shape</a>;
00046 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Box.html">physics::Box</a>;
00047 
00048 <span class="keyword">using</span> <a class="code" href="classgfx_1_1Triangle3.html">gfx::Triangle3</a>;
00049 <span class="keyword">using</span> <a class="code" href="classgfx_1_1Color4.html">gfx::Color4</a>;
00050 <span class="keyword">using</span> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>;
00051 <span class="keyword">using</span> <a class="code" href="classgfx_1_1TriangleIterator.html">gfx::TriangleIterator</a>;
00052 <span class="keyword">using</span> <a class="code" href="classgfx_1_1VisualTriangles.html">gfx::VisualTriangles</a>;
00053 
00054 <span class="keyword">using</span> <a class="code" href="classbase_1_1Matrix3.html">base::Matrix3</a>;
00055 <span class="keyword">using</span> base::transpose;
00056 <span class="keyword">using</span> base::cross;
00057 <span class="keyword">using</span> <a class="code" href="classbase_1_1array.html">base::array</a>;
00058 
00059 <span class="keyword">using</span> osg::Vec4;
00060 <span class="keyword">using</span> osg::StateSet;
00061 
00062 
00063 SOLIDCollisionModel::SOLIDCollisionModel(<span class="keyword">const</span> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>&amp; triangles)
00064   : shapeRefOwner(true)
00065 {
00066   <a class="code" href="classphysics_1_1SOLIDCollisionModel.html#physics_1_1SOLIDCollisionModelb0">buildModel</a>(triangles);
00067 }
00068 
00069 SOLIDCollisionModel::SOLIDCollisionModel(ref&lt;const Shape&gt; shape)
00070   : shapeRefOwner(true)
00071 {
00072   <a class="code" href="classphysics_1_1SOLIDCollisionModel.html#physics_1_1SOLIDCollisionModelb0">buildModel</a>(shape);
00073 }
00074 
00075 SOLIDCollisionModel::SOLIDCollisionModel(<span class="keyword">const</span> SOLIDCollisionModel&amp; cm)
00076   : shapeRef(cm.shapeRef), shapeRefOwner(false)
00077 {
00078 }
00079 
00080 SOLIDCollisionModel::~SOLIDCollisionModel()
00081 {
00082   dtDeleteShape(shapeRef);
00083 }
00084 
00085 
00086 <span class="keywordtype">void</span> SOLIDCollisionModel::buildModel(<span class="keyword">const</span> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>&amp; triangles)
00087 {
00088   <span class="comment">// Load all the triangles into the SOLID shape</span>
00089   <span class="comment">//  NB: This would be more efficient if it indexed the existing vertex data</span>
00090   <span class="comment">//  rather than copying it. !!</span>
00091 
00092   <a class="code" href="classphysics_1_1SOLIDCollisionModel.html#physics_1_1SOLIDCollisionModelp0">shapeRef</a> = dtNewComplexShape();
00093 
00094   TriangleContainer::const_iterator t = triangles.<a class="code" href="classgfx_1_1TriangleContainer.html#gfx_1_1VisualTrianglesa5">begin</a>();
00095   TriangleContainer::const_iterator end = triangles.<a class="code" href="classgfx_1_1TriangleContainer.html#gfx_1_1VisualTrianglesa6">end</a>();
00096   <span class="keywordflow">while</span> (t != end) {
00097     <span class="keyword">const</span> Triangle3&amp; tri(*t);
00098     dtBegin(DT_SIMPLEX);
00099     dtVertex(tri[1].x, tri[1].y, tri[1].z);
00100     dtVertex(tri[2].x, tri[2].y, tri[2].z);
00101     dtVertex(tri[3].x, tri[3].y, tri[3].z);
00102     dtEnd();
00103     ++t;
00104   }  
00105 
00106   dtEndComplexShape();
00107 }
00108 
00109 
00110 <span class="keywordtype">void</span> SOLIDCollisionModel::buildModel(ref&lt;const Shape&gt; shape)
00111 {
00112   <span class="comment">// Just use the Shape's triangles for now.</span>
00113   <span class="comment">//  A better approach is to create a specific SOLID primitice corresponding</span>
00114   <span class="comment">//  to the specific shape. !!</span>
00115   ref&lt;const Shape&gt; s(shape);
00116   <a class="code" href="classphysics_1_1SOLIDCollisionModel.html#physics_1_1SOLIDCollisionModelb0">buildModel</a>(VisualTriangles(*s));
00117 }
00118 
00119 
00120 
00121 
00122 osg::Node* SOLIDCollisionModel::createOSGVisual(Visual::Attributes visualAttributes)<span class="keyword"> const</span>
00123 <span class="keyword"></span>{
00124   <span class="keywordflow">if</span> (!(visualAttributes &amp; <a class="code" href="classgfx_1_1Visual.html#gfx_1_1VisualPathw14gfx_1_1VisualPathw9">ShowCollisionModel</a>)
00125       <span class="comment">/*|| tris.empty()*/</span> ) 
00126     <span class="keywordflow">return</span> <span class="keyword">new</span> osg::Node();
00127   
00128   osg::Node* node = <span class="keyword">new</span> osg::Node();<span class="comment">//createOBBVisualRecurse(b[0], 0);</span>
00129   node-&gt;setName(<span class="stringliteral">"debug"</span>);
00130 
00131   <span class="comment">// Set state to be transparent, random colour</span>
00132   StateSet* state = <span class="keyword">new</span> osg::StateSet();
00133   osg::Material* mat = <span class="keyword">new</span> osg::Material();
00134   Vec4 col( base::random(), base::random(), base::random(), 1.0);
00135   mat-&gt;setEmission( osg::Material::FRONT_AND_BACK, Vec4(0,0,0,0) );
00136   mat-&gt;setAmbient( osg::Material::FRONT_AND_BACK, col );
00137   mat-&gt;setDiffuse( osg::Material::FRONT_AND_BACK, col );
00138   mat-&gt;setSpecular( osg::Material::FRONT_AND_BACK, Vec4(1,1,1,0) );
00139   mat-&gt;setShininess( osg::Material::FRONT_AND_BACK, 0.3);
00140   state-&gt;setAttribute( mat );
00141   state-&gt;setMode(GL_CULL_FACE,osg::StateAttribute::OFF);
00142 
00143   osg::PolygonMode* polyMode = <span class="keyword">new</span> osg::PolygonMode;
00144   polyMode-&gt;setMode( osg::PolygonMode::FRONT_AND_BACK, osg::PolygonMode::LINE );
00145   state-&gt;setAttributeAndModes(polyMode,osg::StateAttribute::ON);
00146 
00147   node-&gt;setStateSet(state);
00148   
00149   <span class="keywordflow">return</span> node;
00150 }
00151 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:29 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
