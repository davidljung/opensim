<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/control/oldikor/IKOR/criteria.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/control/oldikor/IKOR/criteria.c</h1><a href="criteria_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ________________________________________________________</span>
00002 <span class="comment">  |                                                        |</span>
00003 <span class="comment">  | Program Name:   criteria.c                             |</span>
00004 <span class="comment">  |________________________________________________________|</span>
00005 <span class="comment">  |                                                        |</span>
00006 <span class="comment">  | description: This file contains the declarations for   |</span>
00007 <span class="comment">  |    different criteria, such as Least Norm, Force,      |</span>
00008 <span class="comment">  |    Torque, or strength optimization.                   |</span>
00009 <span class="comment">  |                                                        |</span>
00010 <span class="comment">  | Procedures:                                            |</span>
00011 <span class="comment">  |    Least_Norm() : H is ZERO, and B is identity.        |</span>
00012 <span class="comment">  |    Least_Flow() : H is ZERO, and B is governing matrix |</span>
00013 <span class="comment">  |________________________________________________________| */</span>
00014 
00015 
00016 <span class="preprocessor">#include &lt;<a class="code" href="general_8h.html">IKOR/general.h</a>&gt;</span>       <span class="comment">/* Header File to link all others */</span>
00017 
00018 <span class="comment">/* ________________________________________________________</span>
00019 <span class="comment">  | name:    Least_Norm()                                  |</span>
00020 <span class="comment">  | description:  Form Least Norm Motion, the reference    |</span>
00021 <span class="comment">  |     vector Zr is zero and therefore H is zero.  The B  |</span>
00022 <span class="comment">  |     vector is also zero.                               |</span>
00023 <span class="comment">  |                                                        |</span>
00024 <span class="comment">  | inputs:  none                                          |</span>
00025 <span class="comment">  | outputs: H is the zero vector, B is the identity matrix|</span>
00026 <span class="comment">  |________________________________________________________|</span>
00027 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00028 <span class="comment">  | c hacker      3/95    Created                          |</span>
00029 <span class="comment">  |________________________________________________________| */</span>
00030 
<a name="l00031"></a><a class="code" href="headers_8h.html#a32">00031</a> <span class="keywordtype">int</span> <a class="code" href="headers_8h.html#a32">Least_Norm</a> (<a class="code" href="structMATRIX.html">MATRIX</a> *B, <a class="code" href="structMATRIX.html">MATRIX</a> *H, FILE *datafp)
00032 {
00033   <span class="keywordtype">int</span> i, j=0;
00034   
00035   
00036   <span class="keywordflow">for</span> (i=0; i&lt;H-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)   H-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;  <span class="comment">/* this is Zr reference */</span>
00037   <span class="keywordflow">for</span> (j=0; j&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; j++)
00038     <span class="keywordflow">for</span> (i=0; i&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)
00039       <span class="keywordflow">if</span> (i==j)
00040         B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = 1.0;
00041       <span class="keywordflow">else</span>
00042         B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = <a class="code" href="general_8h.html#a15">ZERO</a>;
00043 
00044   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00045     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Least Norm B"</span>, B);
00046     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Least Norm H"</span>, H);
00047   }
00048 }
00049 
00050 <span class="comment">/* ________________________________________________________</span>
00051 <span class="comment">  | name:    Least_FLOW()                                  |</span>
00052 <span class="comment">  | description:  Form Least Flow Motion, the reference    |</span>
00053 <span class="comment">  |     vector Zr is zero and therefore H is zero.  The B  |</span>
00054 <span class="comment">  |     vector is a matrix built upon the flows of the     |</span>
00055 <span class="comment">  |     hydrolic pumps (currently on AIARM is implemented) |</span>
00056 <span class="comment">  |                                                        |</span>
00057 <span class="comment">  | inputs:  Previous Joint Angles and Previous dq         |</span>
00058 <span class="comment">  | outputs: H is the zero vector, B is the govrning matrix|</span>
00059 <span class="comment">  |________________________________________________________|</span>
00060 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00061 <span class="comment">  | c hacker     12/95       Created                       |</span>
00062 <span class="comment">  |________________________________________________________| */</span>
00063 
<a name="l00064"></a><a class="code" href="headers_8h.html#a33">00064</a> <span class="keywordtype">int</span> <a class="code" href="headers_8h.html#a33">Least_Flow</a> (<a class="code" href="structMATRIX.html">MATRIX</a> *B, <a class="code" href="structMATRIX.html">MATRIX</a> *H, <a class="code" href="structMATRIX.html">MATRIX</a> *Qarray, FILE* datafp)
00065 {
00066   <span class="keywordtype">int</span> i, j;
00067 
00068   <span class="keywordflow">for</span> (i=0; i&lt;H-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)   H-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;  <span class="comment">/* this is Zr reference */</span>
00069   <span class="keywordflow">for</span> (j=0; j&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; j++)
00070     <span class="keywordflow">for</span> (i=0; i&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)
00071       <span class="comment">/* The 1.0 for dq really means don't modifiy the equations, while */</span>
00072       <span class="comment">/* the negative distance means don't generate output to datafile  */</span>
00073       <span class="keywordflow">if</span> (i==j) B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][i] = <a class="code" href="headers_8h.html#a34">calc_flow</a>(i, Qarray-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0], 1.0, -1.0, 
00074                                                         (<a class="code" href="structMATRIX.html">MATRIX</a> *) 0);
00075       <span class="keywordflow">else</span>      B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = <a class="code" href="general_8h.html#a15">ZERO</a>;
00076 
00077 
00078   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00079     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Least FLOW B"</span>, B);
00080     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Least FLOW H"</span>, H);
00081   }
00082 }
00083 
00084 <span class="comment">/* FLOW equations for AIRARM's Hydraulic Motors */</span>
<a name="l00085"></a><a class="code" href="headers_8h.html#a34">00085</a> <span class="keywordtype">float</span> <a class="code" href="headers_8h.html#a34">calc_flow</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">float</span> Q, <span class="keywordtype">float</span> dq, <span class="keywordtype">float</span> distance, <a class="code" href="structMATRIX.html">MATRIX</a> *old)
00086 {
00087   <span class="keyword">static</span> <span class="keywordtype">float</span> FLOW=<a class="code" href="general_8h.html#a15">ZERO</a>, totaltime = <a class="code" href="general_8h.html#a15">ZERO</a>;
00088   <span class="keywordtype">float</span>  numerator, denominator, dFLOW, time;
00089 
00090   dq = fabs(dq);
00091   <span class="keywordflow">switch</span> (index) {
00092         <span class="keywordflow">case</span> 0 :
00093             Q           = 1.5479 - Q;
00094             numerator   = 0.386 * sin(Q);
00095             denominator = sqrt( 1.29 - .769 * cos(Q) );
00096             dFLOW       = numerator / denominator;
00097               <span class="keywordflow">if</span> (dq&lt;<a class="code" href="general_8h.html#a15">ZERO</a>)  dFLOW *= dq * 4.28;                 <span class="comment">/*push*/</span>
00098               <span class="keywordflow">else</span>          dFLOW *= dq * 2.60;                 <span class="comment">/*pull*/</span>
00099             <span class="keywordflow">break</span>;
00100         <span class="keywordflow">case</span> 1 :
00101             Q           = 1.360 - (Q - <a class="code" href="general_8h.html#a16">PI</a>/2);
00102             numerator   = 0.574 * sin(Q);
00103             denominator = sqrt( 2.05 - 1.15 * cos(Q) );
00104             dFLOW       = numerator / denominator;
00105               <span class="keywordflow">if</span> (dq&lt;<a class="code" href="general_8h.html#a15">ZERO</a>)  dFLOW *= dq * 4.82;                 <span class="comment">/*push*/</span>
00106               <span class="keywordflow">else</span>          dFLOW *= dq * 2.68;                 <span class="comment">/*pull*/</span>
00107             <span class="keywordflow">break</span>;
00108         <span class="keywordflow">case</span> 2 :
00109               <span class="keywordflow">if</span> (dq&gt;<a class="code" href="general_8h.html#a15">ZERO</a>)  dFLOW = dq * .838;          <span class="comment">/*push*/</span>
00110               <span class="keywordflow">else</span>          dFLOW = dq * .429;          <span class="comment">/*pull*/</span>
00111             <span class="keywordflow">break</span>;
00112         <span class="keywordflow">case</span> 3 :
00113             Q           = 0.546 - (Q); dq = -dq;
00114             numerator   = 0.190 * sin(Q);  
00115             denominator = sqrt( 0.82 - 0.38 * cos(Q) );
00116             dFLOW       = numerator / denominator;
00117               <span class="keywordflow">if</span> (dq&lt;<a class="code" href="general_8h.html#a15">ZERO</a>)  dFLOW *= dq * 2.10;
00118               <span class="keywordflow">else</span>          dFLOW *= dq * 1.73;
00119             <span class="keywordflow">break</span>;
00120         <span class="keywordflow">case</span> 4 :
00121             dFLOW = .05500 * dq;
00122             <span class="keywordflow">break</span>;
00123         <span class="keywordflow">case</span> 5 :
00124             dFLOW = .00688 * dq;
00125             <span class="keywordflow">break</span>;
00126   }
00127 
00128   <span class="comment">/* if the B Matrix is not being Calculated */</span>
00129   <span class="keywordflow">if</span> (distance &gt;= <a class="code" href="general_8h.html#a15">ZERO</a>) {  
00130     time  = distance/(60*<a class="code" href="general_8h.html#a10">SPEED</a>);  <span class="comment">/* SPEED is (.3m/s) defined in general.h */</span>
00131  <span class="comment">/*   FLOW += (fabs(dFLOW)/time);        /* Uncomment for flow comparisons */</span>
00132     FLOW += <a class="code" href="general_8h.html#a3">SQUARE</a>(fabs(dFLOW)/time);  <span class="comment">/* Uncomment for norm comparisons */</span>
00133 
00134     <span class="keywordflow">if</span> (index==0) fprintf(<a class="code" href="general_8h.html#a35">FLWfile</a>, <span class="stringliteral">"%7.5f"</span>, totaltime);
00135 
00136     fprintf(<a class="code" href="general_8h.html#a35">FLWfile</a>, <span class="stringliteral">" %11.8f"</span>,       (time)?(fabs(dFLOW)/time):<a class="code" href="general_8h.html#a15">ZERO</a>);
00137     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00138       fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"dFLOW[%d]: %10.4f dF/dt: %13.8f\n"</span>, index, fabs(dFLOW), 
00139                         fabs(dFLOW)/time);
00140       <span class="keywordflow">if</span> (index == 5) 
00141         fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"FLOW: %f  TIME: %f  DISTANCE: %f\nFLOWRATE: %f\n"</span>,
00142                          FLOW, time, distance, (time)?FLOW/time:0.0);
00143     }
00144     <span class="keywordflow">if</span> (index==5){
00145         fprintf(<a class="code" href="general_8h.html#a35">FLWfile</a>, <span class="stringliteral">" %11.6f\n"</span>, (time)?FLOW:ZERO); 
00146         fprintf(<a class="code" href="general_8h.html#a37">distfp</a>, <span class="stringliteral">"%f \n"</span>, distance);
00147         FLOW = 0.0;
00148         totaltime += time;
00149     }
00150   }
00151 
00152   <span class="keywordflow">return</span> (fabs(dFLOW));
00153 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:35 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
