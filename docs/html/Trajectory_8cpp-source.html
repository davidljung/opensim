<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: base/Trajectory.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>base/Trajectory.cpp</h1><a href="Trajectory_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)2002 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: Trajectory.cpp 1047 2004-02-27 19:21:35Z jungd $</span>
00019 <span class="comment">  $Revision: 1.7 $</span>
00020 <span class="comment">  $Date: 2004-02-27 14:21:35 -0500 (Fri, 27 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="Trajectory.html">base/Trajectory</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;sstream&gt;</span>
00028 
00029 <span class="preprocessor">#include &lt;<a class="code" href="TrajectoryTimeRep.html">base/TrajectoryTimeRep</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="Externalizer.html">base/Externalizer</a>&gt;</span>
00031 <span class="preprocessor">#include &lt;<a class="code" href="externalization__error.html">base/externalization_error</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="Application.html">base/Application</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="VFile.html">base/VFile</a>&gt;</span>
00034 
00035 <span class="comment">// concrete representations</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="LineSegTrajectoryRep.html">base/LineSegTrajectoryRep</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="WaypointTrajectoryRep.html">base/WaypointTrajectoryRep</a>&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="ParametricTrajectoryRep.html">base/ParametricTrajectoryRep</a>&gt;</span>
00039 
00040 
00041 <span class="keyword">using</span> <a class="code" href="classbase_1_1Trajectory.html">base::Trajectory</a>;
00042 
00043 <span class="keyword">using</span> <a class="code" href="classbase_1_1LineSegTrajectoryRep.html">base::LineSegTrajectoryRep</a>;
00044 <span class="keyword">using</span> <a class="code" href="classbase_1_1WaypointTrajectoryRep.html">base::WaypointTrajectoryRep</a>;
00045 <span class="keyword">using</span> <a class="code" href="classbase_1_1ParametricTrajectoryRep.html">base::ParametricTrajectoryRep</a>;
00046 
00047 <span class="keyword">using</span> <a class="code" href="classbase_1_1externalization__error.html">base::externalization_error</a>;
00048 <span class="keyword">using</span> <a class="code" href="classbase_1_1Application.html">base::Application</a>;
00049 <span class="keyword">using</span> <a class="code" href="classbase_1_1VFile.html">base::VFile</a>;
00050 <span class="keyword">using</span> <a class="code" href="classbase_1_1PathName.html">base::PathName</a>;
00051 
00052 <span class="keyword">using</span> base::dom::DOMNode;
00053 <span class="keyword">using</span> base::dom::DOMElement;
00054 
00055 
00056 
00057 Trajectory::Trajectory()
00058 {
00059   create();
00060 }
00061 
00062 
00063 Trajectory::Trajectory(<span class="keyword">const</span> Trajectory&amp; t)
00064 {
00065   create(t);
00066 }
00067 
00068 Trajectory::Trajectory(<span class="keyword">const</span> Path&amp; p, Int samples)
00069 {
00070   <span class="comment">// extract the path in a general way if possible</span>
00071   <span class="keywordflow">if</span> (p.numDistinguishedValues() &gt; 2) {
00072 
00073     array&lt;Point3&gt; points(p.numDistinguishedValues());
00074     array&lt;Orient&gt; orients(p.numDistinguishedValues());
00075     array&lt;Time&gt;   times(p.numDistinguishedValues());
00076 
00077     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;p.numDistinguishedValues(); i++) {
00078       <a class="code" href="namespacebase.html#a5">Real</a> s = p.distinguishedValue(i);
00079       points[i] = p.position(s);
00080       orients[i] = p.orientation(s);
00081       times[i] = s;
00082     }
00083 
00084     create(points, orients, times, <span class="keyword">false</span>);
00085   }
00086   <span class="keywordflow">else</span> {
00087 
00088     array&lt;Point3&gt; points(samples);
00089     array&lt;Orient&gt; orients(samples);
00090     array&lt;Time&gt;   times(samples);
00091 
00092     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;samples; i++) {
00093       <a class="code" href="namespacebase.html#a5">Real</a> s = <a class="code" href="namespacebase.html#a5">Real</a>(i)/<a class="code" href="namespacebase.html#a5">Real</a>(samples-1);
00094       points[i] = p.position(s);
00095       orients[i] = p.orientation(s);
00096       times[i] = s;
00097     }
00098 
00099     create(points, orients, times, <span class="keyword">false</span>);
00100     
00101   }
00102 }
00103 
00104 
00105 Trajectory::Trajectory(<span class="keyword">const</span> Point3&amp; sp, <span class="keyword">const</span> Orient&amp; so, <span class="keyword">const</span> Time&amp; st, 
00106                        <span class="keyword">const</span> Point3&amp; ep, <span class="keyword">const</span> Orient&amp; eo, <span class="keyword">const</span> Time&amp; et)
00107 {
00108   create(sp,so,st,ep,eo,et);
00109 }
00110 
00111 
00112 Trajectory::Trajectory(<span class="keyword">const</span> array&lt;Point3&gt;&amp; points, <span class="keyword">const</span> array&lt;Orient&gt;&amp; orients, <span class="keyword">const</span> array&lt;Time&gt;&amp; times, <span class="keywordtype">bool</span> deltas)
00113 {
00114   create(points, orients, times, deltas);
00115 }
00116 
00117 
00118 Trajectory::Trajectory(<span class="keyword">const</span> array&lt;Vector&gt;&amp; points, <span class="keywordtype">bool</span> deltas)
00119 {
00120   create(points,deltas);
00121 }
00122 
00123 
00124 Trajectory::Trajectory(<span class="keyword">const</span> ExpressionVector&amp; p)
00125 {
00126   create(p);
00127 }
00128 
00129 
00130 
00131 <span class="keywordtype">void</span> Trajectory::init(<span class="keyword">const</span> array&lt;Point3&gt;&amp; points, <span class="keyword">const</span> array&lt;Orient&gt;&amp; orients, <span class="keyword">const</span> array&lt;Time&gt;&amp; times, <span class="keywordtype">bool</span> deltas)
00132 {
00133   ref&lt;WaypointTrajectoryRep&gt; wrep;
00134 
00135   <span class="keywordflow">if</span> (!deltas)
00136     wrep = ref&lt;WaypointTrajectoryRep&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> WaypointTrajectoryRep(points, orients, times));
00137   <span class="keywordflow">else</span> {
00138     array&lt;Point3&gt; apoints(points.size()+1);
00139     apoints[0] = <a class="code" href="namespacebase.html#a26">Point3</a>(0,0,0);
00140     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;points.size(); i++)
00141       apoints[i+1] = apoints[i]+points[i];
00142 
00143     array&lt;Orient&gt; aorients(orients.size()+1);
00144     aorients[0] = Orient();
00145     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;orients.size(); i++) {
00146       Quat4 q1(aorients[i].getQuat4());
00147       Quat4 q2(orients[i].getQuat4());
00148       aorients[i+1] = Orient(q2*q1);
00149     }
00150 
00151     array&lt;Time&gt; atimes(times.size()+1);
00152     atimes[0] = 0;
00153     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;times.size(); i++)
00154       atimes[i+1] = atimes[i]+times[i];
00155 
00156     wrep = ref&lt;WaypointTrajectoryRep&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> WaypointTrajectoryRep(apoints, aorients, atimes));
00157   }
00158 
00159   rep = wrep;
00160   trep = wrep;
00161 }
00162 
00163 
00164 
00165 <span class="keywordtype">void</span> Trajectory::create()
00166 {
00167   <span class="comment">// default traj (degenerate traj - create as line segment with both ends the same time)</span>
00168   ref&lt;LineSegTrajectoryRep&gt; lrep(NewObj <a class="code" href="classbase_1_1LineSegTrajectoryRep.html">LineSegTrajectoryRep</a>());
00169   rep = lrep;
00170   trep = lrep;
00171 }
00172 
00173 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> Trajectory&amp; t)
00174 {
00175   ref&lt;Referenced&gt; c( &amp;base::clone( *t.trep ) );
00176 
00177   rep = narrow_ref&lt;PathRep&gt;(c);
00178   trep = narrow_ref&lt;TrajectoryTimeRep&gt;(c);
00179 }
00180 
00181 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> Point3&amp; sp, <span class="keyword">const</span> Orient&amp; so, <span class="keyword">const</span> Point3&amp; ep, <span class="keyword">const</span> Orient&amp; eo)
00182 {
00183   ref&lt;LineSegTrajectoryRep&gt; lrep(NewObj <a class="code" href="classbase_1_1LineSegTrajectoryRep.html">LineSegTrajectoryRep</a>(sp, so, 0, ep, eo, 1));
00184   rep = lrep;
00185   trep = lrep;
00186 }
00187 
00188 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> Point3&amp; sp, <span class="keyword">const</span> Orient&amp; so, <span class="keyword">const</span> Time&amp; st,
00189                         <span class="keyword">const</span> Point3&amp; ep, <span class="keyword">const</span> Orient&amp; eo, <span class="keyword">const</span> Time&amp; et)
00190 {
00191   ref&lt;LineSegTrajectoryRep&gt; lrep(NewObj <a class="code" href="classbase_1_1LineSegTrajectoryRep.html">LineSegTrajectoryRep</a>(sp, so, st, ep, eo, et));
00192   rep = lrep;
00193   trep = lrep;
00194 }
00195 
00196 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> array&lt;Point3&gt;&amp; points, <span class="keyword">const</span> array&lt;Orient&gt;&amp; orients, <span class="keywordtype">bool</span> deltas)
00197 {
00198   <span class="comment">// init default times to range over [0..1]</span>
00199   array&lt;Time&gt; times(points.size());
00200   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;times.size(); i++)
00201     times[i] = Time( i/times.size() );
00202 
00203   init(points,orients,times,<span class="keyword">false</span>);
00204 }
00205 
00206 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> array&lt;Point3&gt;&amp; points, <span class="keyword">const</span> array&lt;Orient&gt;&amp; orients, <span class="keyword">const</span> array&lt;Time&gt;&amp; times, <span class="keywordtype">bool</span> deltas)
00207 {
00208   init(points,orients,times,deltas);
00209 }
00210 
00211 <span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> array&lt;Vector&gt;&amp; points, <span class="keywordtype">bool</span> deltas)
00212 {
00213   <span class="comment">// convert points to arrays of Point3, Orients &amp; Times</span>
00214   <a class="code" href="base.html#a19">Assert</a>(points.size() &gt; 0);
00215   <a class="code" href="base.html#a19">Assert</a>(points[0].size() &gt;= 4);
00216 
00217   array&lt;Point3&gt; pos(points.size());
00218   array&lt;Time&gt;   time(points.size());
00219   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;points.size(); i++) {
00220     <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; v(points[i]);
00221     pos[i] = <a class="code" href="namespacebase.html#a26">Point3</a>(v[0],v[1],v[2]);
00222     time[i] = Time(v[3]);
00223   }
00224   
00225   array&lt;Orient&gt; orient(points.size());
00226   <span class="keywordflow">if</span> (points[0].size() == 7) { <span class="comment">// assuming EulerRPY</span>
00227     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;points.size(); i++) {
00228       <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; v(points[i]);
00229       orient[i] = Orient(v[3],v[4],v[5]);
00230       time[i] = Time(v[6]);
00231     }
00232   }
00233   <span class="keywordflow">else</span>
00234     <span class="keywordflow">if</span> (points[0].size() == 8) { <span class="comment">// assuming quat</span>
00235       <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;points.size(); i++) {
00236         <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; v(points[i]);
00237         orient[i] = Orient(Quat4(v[3],v[4],v[5],v[6]));
00238         time[i] = Time(v[7]);
00239       }
00240     }
00241 
00242   init(pos,orient,time,deltas);
00243 }
00244 
00245 <span class="comment"></span>
00246 <span class="comment">/// \todo implement</span>
00247 <span class="comment"></span><span class="keywordtype">void</span> Trajectory::create(<span class="keyword">const</span> ExpressionVector&amp; p)
00248 {
00249   <a class="code" href="debugtools.html#a12">Unimplemented</a>;
00250 }
00251 
00252 
00253 
00254 <a class="code" href="classbase_1_1Path.html">base::Path</a> Trajectory::toPath()<span class="keyword"> const</span>
00255 <span class="keyword"></span>{
00256   <span class="keywordflow">return</span> Path(*<span class="keyword">this</span>);
00257 }
00258 
00259 
00260 <span class="keywordtype">void</span> Trajectory::resample(Int samples)
00261 {
00262   array&lt;Point3&gt; points(samples);
00263   array&lt;Orient&gt; orients(samples);
00264   array&lt;Time&gt;   times(samples);
00265 
00266   Time start = time(0);
00267   Time end = time(1);
00268   Time duration = end-start;
00269 
00270   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;samples; i++) {
00271     <a class="code" href="namespacebase.html#a5">Real</a> s = <a class="code" href="namespacebase.html#a5">Real</a>(i)/<a class="code" href="namespacebase.html#a5">Real</a>(samples-1);
00272     points[i] =  Path::position(s);
00273     orients[i] = Path::orientation(s);
00274     times[i] = start + duration*s;
00275   }
00276 
00277   init(points, orients, times, <span class="keyword">false</span>);
00278    
00279 }
00280 
00281 
00282 <span class="keywordtype">void</span> Trajectory::resample(<span class="keyword">const</span> Real dxmax)
00283 {
00284   <a class="code" href="base.html#a19">Assert</a>(dxmax &gt; 0);
00285   
00286   array&lt;Point3&gt; points;
00287   array&lt;Orient&gt; orients;
00288   array&lt;Time&gt;   times;
00289   
00290   <span class="comment">// start with first distinguished value</span>
00291   Time t = time( distinguishedValue(0) );
00292   <a class="code" href="namespacebase.html#a26">Point3</a> pos( position(t) );
00293   Orient orient( orientation(t) );
00294   points.push_back( pos );
00295   orients.push_back( orient );
00296   times.push_back( t );
00297 
00298   Time lasttime( t );
00299   <a class="code" href="namespacebase.html#a26">Point3</a> lastpos( pos );
00300   <a class="code" href="namespacebase.html#a2">Int</a> i = 1; <span class="comment">// current distinguished value index</span>
00301   <span class="keywordflow">while</span> (i &lt; numDistinguishedValues()) {
00302 
00303     <span class="comment">// get next distinguished value</span>
00304     t = time(distinguishedValue(i) );
00305     pos = position(t);
00306     orient = orientation(t);
00307     
00308     <span class="comment">// calc dx = this pos - last pos</span>
00309     Vector3 dx = pos - lastpos;
00310     <span class="keywordflow">if</span> (dx.length() &gt; dxmax) { <span class="comment">// dist was too big, set current pos to a distance of maxdx from last pos</span>
00311       <a class="code" href="namespacebase.html#a5">Real</a> scale = dxmax/dx.length();
00312       t = lasttime + scale*(t-lasttime);
00313       pos = position(t);
00314       orient = orientation(t);
00315     }
00316     <span class="keywordflow">else</span>
00317       ++i;
00318     
00319     points.push_back( pos );
00320     orients.push_back( orient );
00321     times.push_back( t );
00322 
00323     lasttime = t;
00324     lastpos = pos;
00325   }
00326   
00327   init(points, orients, times, <span class="keyword">false</span>);
00328   
00329 }
00330 
00331   
00332   
00333 
00334 <span class="keywordtype">void</span> Trajectory::serialize(Serializer&amp; s)
00335 {
00336   <span class="comment">// register instantiators for all the TrajectoryRep classes for dynamic instantiation upon deserialization</span>
00337   Serializable::registerSerializableInstantiator&lt;TrajectoryTimeRep,LineSegTrajectoryRep&gt;(lineSegTrajectoryRepInstantiator);
00338   Serializable::registerSerializableInstantiator&lt;TrajectoryTimeRep,WaypointTrajectoryRep&gt;(waypointTrajectoryRepInstantiator);
00339   
00340   s.baseRef(trep,<span class="stringliteral">"TrajectoryTimeRep"</span>);
00341 }
00342 
00343 
00344 <span class="keywordtype">bool</span> Trajectory::formatSupported(String format, Real version, ExternalizationType type)<span class="keyword"> const</span>
00345 <span class="keyword"></span>{
00346   <span class="keywordflow">return</span>    ((format == <span class="stringliteral">"txt"</span>) &amp;&amp; (version==1.0))
00347          || ((format == <span class="stringliteral">"xml"</span>) &amp;&amp; (version==1.0));
00348 }
00349 
00350 
00351 <span class="keywordtype">void</span> Trajectory::externalize(Externalizer&amp; e, String format, Real version)
00352 {
00353   <span class="keywordflow">if</span> (format==<span class="stringliteral">""</span>) format = <a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"xml"</span>);
00354 
00355   <span class="keywordflow">if</span> (!formatSupported(format,version,e.ioType()))
00356     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"format "</span>)+format+<span class="stringliteral">" "</span>+base::realToString(version)+<span class="stringliteral">" unsupported"</span>));
00357 
00358   <span class="keywordflow">if</span> (format == <span class="stringliteral">"txt"</span>) {
00359 
00360     <span class="keywordflow">if</span> (e.isInput()) {
00361       
00362       array&lt;Point3&gt; points;
00363       array&lt;Orient&gt; orients;
00364       array&lt;Time&gt; times;
00365       
00366       <span class="keywordflow">while</span> (e.moreInput()) {
00367         
00368         <a class="code" href="namespacebase.html#a4">String</a> line(e.readLine());
00369         <span class="keywordflow">if</span> (line.empty()) <span class="keywordflow">break</span>; <span class="comment">// empty line or eof indicates end of list</span>
00370         <span class="keywordflow">while</span> (line[0] == <span class="charliteral">'#'</span>) line = e.readLine(); <span class="comment">// skip comment lines</span>
00371         
00372         <span class="comment">// count separating spaces to determine if there are 7 or 8</span>
00373         <span class="comment">// numbers present</span>
00374         <a class="code" href="namespacebase.html#a2">Int</a> spaces=0;
00375         <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;line.size(); i++) 
00376           <span class="keywordflow">if</span> (line[i]==<span class="charliteral">' '</span>) { 
00377             spaces++;
00378             <span class="keywordflow">while</span> ( (i&lt;line.size()-1) &amp;&amp; (line[i]==<span class="charliteral">' '</span>)) i++;
00379           }
00380         <span class="keywordflow">if</span> (line[0]==<span class="charliteral">' '</span>) spaces--; <span class="comment">// don't count leading space(s)</span>
00381         
00382         <a class="code" href="base.html#a19">Assert</a>(spaces &gt;= 6);
00383         <span class="keywordtype">bool</span> quat = (spaces&gt;6);
00384         std::istringstream iss(line);
00385         iss.setf(std::ios_base::skipws | std::ios_base::dec);
00386         
00387         <a class="code" href="namespacebase.html#a26">Point3</a> p;
00388         iss &gt;&gt; p.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o0">x</a> &gt;&gt; p.y &gt;&gt; p.z;
00389         <a class="code" href="classdemeter_1_1Vector.html">Vector</a> v(quat?4:3);
00390         iss &gt;&gt; v[0] &gt;&gt; v[1] &gt;&gt; v[2];
00391         <span class="keywordflow">if</span> (quat) iss &gt;&gt; v[3];
00392         <a class="code" href="namespacebase.html#a5">Real</a> t;
00393         iss &gt;&gt; t;
00394         
00395         points.push_back(p);
00396         
00397         orients.push_back(Orient(v, quat? Orient::Quat : Orient::EulerRPY));
00398         
00399         times.push_back(Time(t));
00400       }
00401       
00402       init(points,orients,times,<span class="keyword">false</span>);
00403       
00404     }
00405     <span class="keywordflow">else</span> { <span class="comment">// output</span>
00406       std::ostringstream out;
00407       
00408       <span class="comment">// comment header</span>
00409       out &lt;&lt; <span class="stringliteral">"# waypoint trajectory (positions, orientations &amp; times)"</span> &lt;&lt; std::endl;
00410       out &lt;&lt; <span class="stringliteral">"#           x             y             z "</span>;
00411       <span class="keywordflow">if</span> (orientation(distinguishedValue(0)).representation() == Orient::EulerRPY)
00412         out &lt;&lt; <span class="stringliteral">"            R             P             Y"</span> &lt;&lt; std::endl;
00413       <span class="keywordflow">else</span>
00414         out &lt;&lt; <span class="stringliteral">"           qx            qy            qz            qw            t"</span> &lt;&lt; std::endl;
00415       
00416       std::ostream::fmtflags savedFlags = out.setf(std::ios_base::dec | std::ios_base::right);
00417       <a class="code" href="namespacebase.html#a2">Int</a> savedPrec = out.precision(10);
00418       <a class="code" href="namespacebase.html#a2">Int</a> savedWidth = out.width(13);
00419       
00420       <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;numDistinguishedValues(); i++) {
00421         <a class="code" href="namespacebase.html#a26">Point3</a> p(position(distinguishedValue(i)));
00422         Orient o(orientation(distinguishedValue(i)));
00423         Time t(time(distinguishedValue(i)));
00424         
00425         <span class="comment">// this is a hack, as under gcc the flags don't appear to stay set after an output op (!?)</span>
00426 <span class="preprocessor">#define setflags \</span>
00427 <span class="preprocessor">      out.setf(std::ios_base::dec | std::ios_base::right); \</span>
00428 <span class="preprocessor">      out.precision(10); \</span>
00429 <span class="preprocessor">      out.width(13); </span>
00430 <span class="preprocessor"></span>        
00431         out &lt;&lt; p.x &lt;&lt; <span class="stringliteral">" "</span>; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00432         out &lt;&lt; p.y &lt;&lt; <span class="stringliteral">" "</span>; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00433         out &lt;&lt; p.z &lt;&lt; <span class="stringliteral">" "</span>; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00434         <span class="keywordflow">if</span> ( (o.representation() != Orient::Quat) &amp;&amp; (o.representation() != Orient::EulerRPY) )
00435           o.changeRepresentation(Orient::Quat);
00436         
00437         <a class="code" href="classdemeter_1_1Vector.html">Vector</a> v(o);
00438         out &lt;&lt; v[0] &lt;&lt; <span class="stringliteral">" "</span>; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00439         out &lt;&lt; v[1] &lt;&lt; <span class="stringliteral">" "</span>; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00440         out &lt;&lt; v[2]; <a class="code" href="Path_8cpp.html#a0">setflags</a>
00441         <span class="keywordflow">if</span> (v.size() &gt; 3 ) out &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; v[3];
00442         out &lt;&lt; t.seconds(); <a class="code" href="Path_8cpp.html#a0">setflags</a>;
00443         out &lt;&lt; std::endl;
00444         
00445       }
00446 
00447       out.setf(savedFlags);
00448       out.precision(savedPrec);
00449       out.width(savedWidth);
00450       
00451       e.writeString(out.str());
00452     }
00453   } 
00454   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (format == <span class="stringliteral">"xml"</span>) {
00455 
00456     <span class="keywordflow">if</span> (e.isOutput()) {
00457 
00458       DOMElement* trajElem = e.createElement(<span class="stringliteral">"trajectory"</span>);
00459 
00460       <span class="keywordtype">bool</span> parametric = <a class="code" href="base.html#a25">instanceof</a>(*rep, ParametricTrajectoryRep);
00461       
00462       <span class="keywordflow">if</span> (parametric) { <span class="comment">// special case for parametric representation to retain symbolic expressions</span>
00463        
00464         <span class="comment">// dig into the parametric representation and output the actual Expression strings</span>
00465         ref&lt;ParametricTrajectoryRep&gt; trep(narrow_ref&lt;ParametricTrajectoryRep&gt;(rep));
00466         <a class="code" href="namespacebase.html#a17">ExpressionVector</a> v(trep-&gt;v);
00467         Expression times(trep-&gt;times);
00468         <span class="keywordtype">bool</span> hasorient = (v.size() &gt; 3);
00469         <span class="keywordtype">bool</span> quatrep = <span class="keyword">false</span>;
00470         <span class="keywordflow">if</span> (hasorient &amp;&amp; v.size() &gt; 6) quatrep = <span class="keyword">true</span>;
00471         
00472         <span class="keywordflow">if</span> (!hasorient) {
00473           e.setElementAttribute(trajElem,<span class="stringliteral">"representation"</span>, <span class="stringliteral">"x(s) y(s) z(s) t(s)"</span>);
00474           e.appendComment(trajElem, <span class="stringliteral">"position functions x(s),y(s),z(s) and time t(s) [one per line]"</span>);
00475         }
00476         <span class="keywordflow">else</span> {
00477           <span class="keywordflow">if</span> (quatrep) {
00478             e.setElementAttribute(trajElem,<span class="stringliteral">"representation"</span>, <span class="stringliteral">"x(s) y(s) z(s) qx(s) qy(s) qz(s) qw(s) t(s)"</span>);
00479             e.appendComment(trajElem,<span class="stringliteral">"position functions x(s),y(s),z(s) orientation quaternion element functions (qx, qy, qz, qw) and time(s) (secs) [one per line; w is scalar]"</span>);
00480           }
00481           <span class="keywordflow">else</span> {
00482             e.setElementAttribute(trajElem,<span class="stringliteral">"representation"</span>, <span class="stringliteral">"x(s) y(s) z(s) r(s) p(s) y(s) t(s)"</span>);
00483             e.appendComment(trajElem,<span class="stringliteral">"position functions x(s),y(s),z(s) orientation Euler angle functions (roll, pitch yaw) and time(s) (secs) [one per line]"</span>);
00484           }
00485         }
00486         
00487         
00488         <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;v.size(); i++) {
00489           e.appendText( trajElem, v[i].<a class="code" href="namespacebase.html#a54">toString</a>() );
00490           e.appendBreak( trajElem);
00491         }
00492         e.appendText( trajElem, times.toString() );
00493         e.appendBreak( trajElem);
00494         
00495       }
00496       <span class="keywordflow">else</span> { <span class="comment">// output distinguished points as waypoints</span>
00497         Orient::Representation rep = orientation(distinguishedValue(0)).representation();
00498         <span class="keywordflow">if</span> ((rep != Orient::Quat) &amp;&amp; (rep != Orient::EulerRPY) )
00499           rep = Orient::Quat;
00500   
00501         <span class="keywordflow">if</span> (rep==Orient::Quat) {
00502           e.setElementAttribute(trajElem,<span class="stringliteral">"representation"</span>, <span class="stringliteral">"x y z qx qy qz qw t"</span> );
00503           e.appendComment(trajElem, <span class="stringliteral">"position (x,y,z) orientation quaternion (qx,qy,qz,qw) [w is scalar component] time (secs)"</span>);
00504         } <span class="keywordflow">else</span> {
00505           e.setElementAttribute(trajElem,<span class="stringliteral">"representation"</span>, <span class="stringliteral">"x y z r p y t"</span> );
00506           e.appendComment(trajElem,<span class="stringliteral">"position (x,y,z) orientation Euler angles (roll, pitch yaw) time (secs)"</span>);
00507         }
00508   
00509         e.setElementAttribute(trajElem,<span class="stringliteral">"pointtype"</span>, <span class="stringliteral">"absolute"</span>);
00510         <span class="keywordflow">if</span> (frame!=<span class="stringliteral">""</span>)
00511           e.setElementAttribute(trajElem,<span class="stringliteral">"frame"</span>, frame);
00512         <span class="keywordflow">if</span> (units!=<span class="stringliteral">""</span>)
00513           e.setElementAttribute(trajElem,<span class="stringliteral">"units"</span>, units);
00514   
00515         <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;numDistinguishedValues(); i++) {
00516           <a class="code" href="namespacebase.html#a26">Point3</a> p(position(distinguishedValue(i)));
00517           Orient o(orientation(distinguishedValue(i)));
00518           Time t(time(distinguishedValue(i)));
00519   
00520           o.changeRepresentation(rep);
00521           <a class="code" href="classdemeter_1_1Vector.html">Vector</a> vo(o);
00522           <a class="code" href="classdemeter_1_1Vector.html">Vector</a> v(3+vo.size()+1);
00523           v[0] = p.<a class="code" href="classdemeter_1_1Vector.html#demeter_1_1Vectoro0">x</a>; v[1] = p.<a class="code" href="classdemeter_1_1Vector.html#demeter_1_1Vectoro1">y</a>; v[2] = p.<a class="code" href="classdemeter_1_1Vector.html#demeter_1_1Vectoro2">z</a>;
00524           <span class="keywordflow">if</span> (vo.size() == 3) { <span class="comment">// rpy</span>
00525             v[3] = vo[0]; v[4] = vo[1]; v[5] = vo[2];
00526             v[6] = t.seconds();
00527           }
00528           <span class="keywordflow">else</span> { <span class="comment">// quat</span>
00529             v[3] = vo[0]; v[4] = vo[1]; v[5] = vo[2]; v[6] = vo[3];
00530             v[7] = t.seconds();
00531           }
00532   
00533           e.appendText( trajElem, e.toString(v) );
00534           e.appendBreak( trajElem );
00535   
00536         }
00537       }
00538       
00539       e.appendElement(trajElem);    
00540 
00541     }
00542     <span class="keywordflow">else</span> { <span class="comment">// input</span>
00543       DOMNode* context = e.context();
00544       
00545       <span class="comment">// will accept either &lt;trajectory&gt; or &lt;path&gt;</span>
00546 
00547       DOMElement* trajElem = e.getFirstElement(context, <span class="stringliteral">"trajectory"</span>, <span class="keyword">false</span>);
00548 
00549       <span class="keywordflow">if</span> (trajElem) { <span class="comment">// &lt;trajectory&gt;</span>
00550 
00551         <span class="comment">// handle link</span>
00552         <a class="code" href="namespacebase.html#a4">String</a> link = e.getElementAttribute(trajElem,<span class="stringliteral">"link"</span>,<span class="keyword">false</span>);
00553         <span class="keywordflow">if</span> (link != <span class="stringliteral">""</span>) {
00554           
00555           ref&lt;VFile&gt; linkFile = Application::getInstance()-&gt;universe()-&gt;cache()-&gt;findFile(link,e.getArchivePath());
00556           load(linkFile,format,version);
00557         }
00558         <span class="keywordflow">else</span> {
00559 
00560           <a class="code" href="namespacebase.html#a4">String</a> repText = e.getElementAttribute(trajElem, <span class="stringliteral">"representation"</span>);
00561         
00562           <span class="keywordtype">bool</span> absolute = ( e.getDefaultedElementAttribute(trajElem, <span class="stringliteral">"pointtype"</span>, <span class="stringliteral">"absolute"</span>) == <span class="stringliteral">"absolute"</span> );
00563           frame = e.getDefaultedElementAttribute(trajElem, <span class="stringliteral">"frame"</span>, <span class="stringliteral">""</span>);
00564           units = e.getDefaultedElementAttribute(trajElem, <span class="stringliteral">"units"</span>, <span class="stringliteral">""</span>);
00565         
00566           Orient::Representation rep;
00567           <span class="keywordtype">bool</span> hasorient = <span class="keyword">true</span>;
00568           <span class="keywordtype">bool</span> parametric = <span class="keyword">false</span>;
00569           <span class="keywordtype">bool</span> scalarFirst=<span class="keyword">false</span>;
00570           
00571           <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x y z t"</span>) {
00572             hasorient=<span class="keyword">false</span>;
00573           }
00574           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x y z qx qy qz qw t"</span>) {
00575             rep = Orient::Quat;
00576           }
00577           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x y z qw qx qy qz t"</span>) {
00578             rep = Orient::Quat;
00579             scalarFirst=<span class="keyword">true</span>;
00580           }
00581           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x y z r p y t"</span>) {
00582             rep = Orient::EulerRPY;
00583           }
00584           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x(s) y(s) z(s) t(s)"</span>) {
00585             hasorient = <span class="keyword">false</span>;
00586             parametric = <span class="keyword">true</span>;
00587           }
00588           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x(s) y(s) z(s) qx(s) qy(s) qz(s) qw(s) t(s)"</span>) {
00589             parametric = <span class="keyword">true</span>;
00590             rep = Orient::Quat;
00591           }
00592           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x(s) y(s) z(s) qw(s) qx(s) qy(s) qz(s) t(s)"</span>) {
00593             parametric = <span class="keyword">true</span>;
00594             rep = Orient::Quat;
00595             scalarFirst=<span class="keyword">true</span>;
00596           }
00597           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (repText == <span class="stringliteral">"x(s) y(s) z(s) r(s) p(s) y(s) t(s)"</span>) {
00598             parametric = <span class="keyword">true</span>;
00599             rep = Orient::EulerRPY;
00600           }
00601           <span class="keywordflow">else</span>            
00602             <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unknown or unsupported trajectory representation"</span>));
00603           
00604           <a class="code" href="namespacebase.html#a4">String</a> trajText = e.getContainedText(trajElem,<span class="keyword">true</span>);
00605           array&lt;String&gt; trajLines = e.splitIntoLines(trajText);
00606 
00607           <span class="keywordflow">if</span> (!parametric) {
00608             array&lt;Point3&gt; points;
00609             array&lt;Orient&gt; orients;
00610             array&lt;Time&gt; times;
00611             
00612             <span class="keywordflow">if</span> (trajLines.size() &lt; 2)
00613               <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"trajectory must contain at least two points"</span>));
00614           
00615             <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;trajLines.size(); i++) {
00616               array&lt;String&gt; elts = e.splitAtDelimiter(trajLines[i], <span class="charliteral">' '</span>);
00617               <span class="keywordflow">if</span> (    ((rep==Orient::Quat) &amp;&amp; (elts.size() != 8))
00618                    || ((rep==Orient::EulerRPY) &amp;&amp; (elts.size() != 7)) )
00619                 <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"trajectory point with wrong number of elements encountered"</span>));
00620               <a class="code" href="classdemeter_1_1Vector.html">Vector</a> v( e.stringsToReals(elts) );
00621               points.push_back( <a class="code" href="namespacebase.html#a26">Point3</a>(v[0],v[1],v[2]) );
00622               <span class="keywordflow">if</span> (hasorient) {
00623                 <span class="keywordflow">if</span> (rep==Orient::Quat) {
00624                   <span class="keywordflow">if</span> (!scalarFirst)
00625                     orients.push_back( Orient(Quat4(v[3],v[4],v[5],v[6])) );
00626                   <span class="keywordflow">else</span>
00627                     orients.push_back( Orient(Quat4(v[6],v[3],v[4],v[5])) );
00628                 }
00629                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rep==Orient::EulerRPY) {
00630                   orients.push_back( Orient(v[3],v[4],v[5]) );
00631                 }
00632               }
00633               <span class="keywordflow">else</span>
00634                 orients.push_back( Orient() );
00635               
00636               times.push_back( Time(v[v.size()-1]) );
00637             }
00638   
00639             init(points,orients,times,!absolute);
00640           }
00641           <span class="keywordflow">else</span> { <span class="comment">// parametric</span>
00642             
00643             <span class="keywordflow">if</span> (!absolute)
00644               <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"pointtype of 'relative' doesn't make sense for parametric expression trajectories"</span>));
00645             
00646             <a class="code" href="namespacebase.html#a17">ExpressionVector</a> v(4);
00647   
00648             <span class="keywordflow">try</span> {
00649             
00650               <span class="keywordflow">if</span> (!hasorient) {
00651                 <span class="keywordflow">if</span> (trajLines.size() != 4)
00652                   <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"trajectory should have one line for each parametric expression x(s), y(s), z(s) and t(s)"</span>));
00653                 v[0] = Expression(trajLines[0]);
00654                 v[1] = Expression(trajLines[1]);
00655                 v[2] = Expression(trajLines[2]);
00656                 v[3] = Expression(trajLines[3]);
00657               }
00658               <span class="keywordflow">else</span> { <span class="comment">// hasorient</span>
00659                 <span class="keywordflow">if</span> (rep == Orient::Quat) {
00660                   <span class="keywordflow">if</span> (trajLines.size() != 8)
00661                     <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"trajectory should have one line for each parametric expression x(s), y(s), z(s), qx(s), qy(s), qz(s),qw(s) and t(s)"</span>));
00662                   v.resize(8);
00663                   v[0] = Expression(trajLines[0]);
00664                   v[1] = Expression(trajLines[1]);
00665                   v[2] = Expression(trajLines[2]);
00666                   <span class="keywordflow">if</span> (!scalarFirst) {
00667                     v[3] = Expression(trajLines[3]);
00668                     v[4] = Expression(trajLines[4]);
00669                     v[5] = Expression(trajLines[5]);
00670                     v[6] = Expression(trajLines[6]);
00671                   }
00672                   <span class="keywordflow">else</span> {
00673                     v[3] = Expression(trajLines[6]);
00674                     v[4] = Expression(trajLines[3]);
00675                     v[5] = Expression(trajLines[4]);
00676                     v[6] = Expression(trajLines[5]);
00677                   }
00678                   v[7] = Expression(trajLines[7]);
00679                 }
00680                 <span class="keywordflow">else</span> {
00681                   <span class="keywordflow">if</span> (trajLines.size() != 7)
00682                     <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"trajectory should have one line for each parametric expression x(s), y(s), z(s), R(s), P(s), Y(s) and t(s)"</span>));
00683                   v.resize(7);
00684                   v[0] = Expression(trajLines[0]);
00685                   v[1] = Expression(trajLines[1]);
00686                   v[2] = Expression(trajLines[2]);
00687                   v[3] = Expression(trajLines[3]);
00688                   v[4] = Expression(trajLines[4]);
00689                   v[5] = Expression(trajLines[5]);
00690                   v[6] = Expression(trajLines[6]);
00691                 }
00692               }
00693             } <span class="keywordflow">catch</span> (std::exception&amp; e) {
00694               <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"error parsing parametric trajectory component expression:"</span>+<a class="code" href="namespacebase.html#a4">String</a>(e.what())));
00695             }
00696 
00697             ref&lt;ParametricTrajectoryRep&gt; prep;
00698             <span class="keywordflow">try</span> {
00699               prep = ref&lt;ParametricTrajectoryRep&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ParametricTrajectoryRep(v));
00700             } <span class="keywordflow">catch</span> (std::exception&amp; e) {
00701               <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"error creating parametric trajectory:"</span>+<a class="code" href="namespacebase.html#a4">String</a>(e.what())));
00702             }
00703             this-&gt;rep = prep;
00704             this-&gt;trep = prep;
00705 
00706           } <span class="comment">// else parametric</span>
00707           
00708         }
00709 
00710         e.removeElement(trajElem);
00711 
00712       }
00713       <span class="keywordflow">else</span> { <span class="comment">// !trajElem </span>
00714 
00715         DOMElement* pathElem = e.getFirstElement(context, <span class="stringliteral">"path"</span>, <span class="keyword">false</span>);
00716 
00717         <span class="keywordflow">if</span> (pathElem) {
00718 
00719           <span class="comment">// In general, to use a Path as a Trajectory without knowing its representation,</span>
00720           <span class="comment">//  we just sample the path and use the sample points while adding a default</span>
00721           <span class="comment">//  time interval of [0..1]</span>
00722           <span class="comment">// However, we handle some special cases of known representations explicitly</span>
00723           
00724           <span class="comment">// First, load the Path</span>
00725           Path path;
00726           path.externalize(e, format, version);
00727 
00728           frame = path.getCoordFrame();
00729           units = path.getUnits();
00730 
00731           <span class="comment">// check for parametric representation</span>
00732           <span class="keywordflow">if</span> (<a class="code" href="base.html#a25">instanceof</a>(*path.rep, ParametricPathRep)) { <span class="comment">// use the PathRep directly</span>
00733             
00734             ref&lt;ParametricPathRep&gt; ppathrep( narrow_ref&lt;ParametricPathRep&gt;(path.rep) );
00735             
00736             <a class="code" href="namespacebase.html#a17">ExpressionVector</a> v( ppathrep-&gt;v.size()+1 ); <span class="comment">// make room for times Expression and copy other elements over</span>
00737             <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;ppathrep-&gt;v.size(); i++) v[i] = ppathrep-&gt;v[i];
00738             v[v.size()-1] = Expression::p[0]; <span class="comment">// i.e. t = s</span>
00739 
00740             ref&lt;ParametricTrajectoryRep&gt; prep;
00741             <span class="keywordflow">try</span> {
00742               prep = ref&lt;ParametricTrajectoryRep&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ParametricTrajectoryRep(v));
00743             } <span class="keywordflow">catch</span> (std::exception&amp; e) {
00744               <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"error creating parametric trajectory from path:"</span>+<a class="code" href="namespacebase.html#a4">String</a>(e.what())));
00745             }
00746 
00747             this-&gt;rep = prep;
00748             this-&gt;trep = prep;
00749 
00750           }
00751           <span class="keywordflow">else</span> { <span class="comment">// general case, Resample and use Path's distinguished points.</span>
00752 
00753             <span class="comment">// Resample and use it's distinguished points.  Times will default to [0..1]</span>
00754             array&lt;Point3&gt; points;
00755             array&lt;Orient&gt; orients;
00756             array&lt;Time&gt; times;
00757   
00758             <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;path.numDistinguishedValues(); i++) {
00759               <a class="code" href="namespacebase.html#a5">Real</a> s = path.distinguishedValue(i);
00760               points.push_back(path.position(s));
00761               orients.push_back(path.orientation(s));
00762               times.push_back( Time( <a class="code" href="namespacebase.html#a5">Real</a>(i)/<a class="code" href="namespacebase.html#a5">Real</a>(path.numDistinguishedValues()-1) ) );
00763             }
00764   
00765             init(points,orients,times,<span class="keyword">false</span>);
00766           }
00767           
00768         }
00769         <span class="keywordflow">else</span>
00770           <span class="keywordflow">throw</span> externalization_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"either &lt;trajectory&gt; or &lt;path&gt; expected"</span>));
00771 
00772       }
00773 
00774     }
00775 
00776   } <span class="comment">// format xml</span>
00777   
00778 }
00779 
00780 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:15 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
