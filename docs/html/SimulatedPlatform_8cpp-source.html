<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/sim/SimulatedPlatform.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/sim/SimulatedPlatform.cpp</h1><a href="SimulatedPlatform_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)2003 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: SimulatedPlatform.cpp 1033 2004-02-11 20:47:52Z jungd $</span>
00019 <span class="comment">  $Revision: 1.12 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:47:52 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="SimulatedPlatform.html">robot/sim/SimulatedPlatform</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;<a class="code" href="Vector3.html">base/Vector3</a>&gt;</span>
00028 <span class="preprocessor">#include &lt;<a class="code" href="PathName.html">base/PathName</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="Externalizer.html">base/Externalizer</a>&gt;</span>
00030 
00031 <span class="preprocessor">#include &lt;<a class="code" href="Color3.html">gfx/Color3</a>&gt;</span>
00032 <span class="preprocessor">#include &lt;<a class="code" href="Material.html">physics/Material</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="Box.html">physics/Box</a>&gt;</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="Cylinder.html">physics/Cylinder</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;<a class="code" href="Solid.html">physics/Solid</a>&gt;</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="HingeJoint.html">physics/HingeJoint</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;<a class="code" href="DoubleHingeJoint.html">physics/DoubleHingeJoint</a>&gt;</span>
00038 <span class="preprocessor">#include &lt;<a class="code" href="Motor.html">physics/Motor</a>&gt;</span>
00039 <span class="preprocessor">#include &lt;<a class="code" href="CollisionCuller.html">physics/CollisionCuller</a>&gt;</span>
00040 <span class="preprocessor">#include &lt;<a class="code" href="CollisionDetector.html">physics/CollisionDetector</a>&gt;</span>
00041 
00042 
00043 <span class="keyword">using</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html">robot::sim::SimulatedPlatform</a>;
00044 
00045 <span class="keyword">using</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>;
00046 <span class="keyword">using</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>;
00047 <span class="keyword">using</span> <a class="code" href="classbase_1_1PathName.html">base::PathName</a>;
00048 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Box.html">physics::Box</a>;
00049 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Cylinder.html">physics::Cylinder</a>;
00050 <span class="keyword">using</span> <a class="code" href="classphysics_1_1ConstraintGroup.html">physics::ConstraintGroup</a>;
00051 <span class="keyword">using</span> <a class="code" href="classphysics_1_1SpatialGroup.html">physics::SpatialGroup</a>;
00052 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Solid.html">physics::Solid</a>;
00053 <span class="keyword">using</span> <a class="code" href="classphysics_1_1HingeJoint.html">physics::HingeJoint</a>;
00054 <span class="keyword">using</span> <a class="code" href="classphysics_1_1DoubleHingeJoint.html">physics::DoubleHingeJoint</a>;
00055 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Motor.html">physics::Motor</a>;
00056 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Collidable.html">physics::Collidable</a>;
00057 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollidableGroup.html">physics::CollidableGroup</a>;
00058 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollisionCuller.html">physics::CollisionCuller</a>;
00059 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollisionDetector.html">physics::CollisionDetector</a>;
00060 
00061 
00062 
00063 
00064 SimulatedPlatform::SimulatedPlatform(ref&lt;const robot::PlatformDescription&gt; platformDescription, ref&lt;physics::SolidSystem&gt; solidSystem, <span class="keywordtype">bool</span> dynamic)
00065   : solidSystem(solidSystem), platformDescr(platformDescription), dynamic(true)
00066 {
00067   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a> = ref&lt;SpatialGroup&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> <a class="code" href="classphysics_1_1SpatialGroup.html">SpatialGroup</a>()); <span class="comment">// a group to put all the Solids in</span>
00068   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>.resize(1);
00069   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] = ref&lt;Solid&gt;(0);
00070 }
00071 
00072 
00073 SimulatedPlatform::~SimulatedPlatform()
00074 {
00075   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00076     <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) {
00077       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp6">leftDriveHingeJoint</a>-&gt;attachMotor(1,ref&lt;Motor&gt;(0));
00078       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp7">rightDriveHingeJoint</a>-&gt;attachMotor(1,ref&lt;Motor&gt;(0));
00079       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp8">steeringHingeJoint</a>-&gt;attachMotor(1,ref&lt;Motor&gt;(0));
00080       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp6">leftDriveHingeJoint</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp7">rightDriveHingeJoint</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp8">steeringHingeJoint</a> = ref&lt;HingeJoint&gt;(0);
00081       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;clear();
00082     }
00083   }
00084 }
00085 
00086 
00087 
00088 <span class="keywordtype">void</span> SimulatedPlatform::setLeftBackWheelTorque(Real t)
00089 {
00090   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00091   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00092     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setMaxForce(t);
00093     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setTargetVel( (t&gt;0)?10:-10 ); 
00094   }
00095 }
00096 
00097 
00098 <span class="keywordtype">void</span> SimulatedPlatform::setLeftBackWheelVel(Real v, Real maxTorque)
00099 {
00100   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00101   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00102     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setTargetVel(v); 
00103     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setMaxForce(maxTorque);
00104   }
00105 }
00106 
00107 <span class="keywordtype">void</span> SimulatedPlatform::setRightBackWheelTorque(Real t)
00108 {
00109   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00110   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00111     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setMaxForce(t);
00112     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setTargetVel( (t&gt;0)?10:-10 ); 
00113   }
00114 }
00115 
00116 
00117 <span class="keywordtype">void</span> SimulatedPlatform::setRightBackWheelVel(Real v, Real maxTorque)
00118 {
00119   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00120   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00121     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setTargetVel(v); 
00122     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setMaxForce(maxTorque);
00123   }
00124 }
00125 
00126 
00127 <span class="keywordtype">void</span> SimulatedPlatform::setSteeringTorque(Real t)
00128 {
00129   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00130   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00131     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setMaxForce(t);
00132     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setTargetVel( (t&gt;0)?10:-10 ); 
00133   }
00134 }
00135 
00136 
00137 <span class="keywordtype">void</span> SimulatedPlatform::setSteeringVel(Real v, Real maxTorque)
00138 {
00139   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span>;
00140   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00141     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setTargetVel(v); 
00142     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setMaxForce(maxTorque);
00143   }
00144 }
00145 
00146 
00147 <a class="code" href="namespacebase.html#a5">Real</a> SimulatedPlatform::getLeftBackWheelVel()<span class="keyword"> const</span>
00148 <span class="keyword"></span>{
00149   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span> 0;
00150   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00151     <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp6">leftDriveHingeJoint</a>-&gt;getAngleRate();
00152   }
00153   <span class="keywordflow">return</span> 0;
00154 }
00155 
00156 <a class="code" href="namespacebase.html#a5">Real</a> SimulatedPlatform::getRightBackWheelVel()<span class="keyword"> const</span>
00157 <span class="keyword"></span>{
00158   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span> 0;
00159   <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00160     <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp7">rightDriveHingeJoint</a>-&gt;getAngleRate();
00161   }
00162   <span class="keywordflow">return</span> 0;
00163 }
00164 
00165 
00166 <a class="code" href="namespacebase.html#a5">Real</a> SimulatedPlatform::getSteeringAngle()<span class="keyword"> const</span>
00167 <span class="keyword"></span>{  
00168   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) <span class="keywordflow">return</span> 0; <span class="comment">//!!! fix me (or not? this isn't a 'position' control, is it?)</span>
00169 <span class="comment"></span>  <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] &amp;&amp; <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isMobile() &amp;&amp; !<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp1">platformDescr</a>-&gt;isHolonomic()) {
00170     <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp8">steeringHingeJoint</a>-&gt;getAngle();
00171   }
00172   <span class="keywordflow">return</span> 0;
00173 }
00174 
00175 
00176 
00177 
00178 
00179 <span class="comment">// Spatial</span>
00180 
00181 <span class="keywordtype">void</span> SimulatedPlatform::setPosition(<span class="keyword">const</span> Point3&amp; pos)       
00182 { 
00183   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;setPosition(pos); 
00184 }
00185 
00186 <a class="code" href="namespacebase.html#a26">Point3</a> SimulatedPlatform::getPosition()<span class="keyword"> const                  </span>
00187 <span class="keyword"></span>{
00188   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;getPosition(); 
00189 }
00190 
00191 <span class="keywordtype">void</span> SimulatedPlatform::setOrientation(<span class="keyword">const</span> Orient&amp; orient) 
00192 { 
00193   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;setOrientation(orient);
00194 }
00195 
00196 Orient SimulatedPlatform::getOrientation()<span class="keyword"> const               </span>
00197 <span class="keyword"></span>{ 
00198   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;getOrientation(); 
00199 }
00200 
00201 <span class="keywordtype">void</span> SimulatedPlatform::setConfiguration(<span class="keyword">const</span> <a class="code" href="classbase_1_1Transform.html">base::Transform</a>&amp; configuration) 
00202 { 
00203   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;setConfiguration(configuration); 
00204 }
00205 
00206 <a class="code" href="classbase_1_1Transform.html">base::Transform</a> SimulatedPlatform::getConfiguration()<span class="keyword"> const    </span>
00207 <span class="keyword"></span>{ 
00208   <span class="keywordflow">return</span> <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;getConfiguration(); 
00209 }
00210 
00211 
00212 
00213 
00214 
00215 
00216 
00217 
00218 
00219 <span class="keywordtype">void</span> SimulatedPlatform::construct(<span class="keyword">const</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>&amp; initialPosition, <span class="keyword">const</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>&amp; initialOrientation)
00220 {
00221   <a class="code" href="base.html#a19">Assert</a>(solidSystem);
00222   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;clear();
00223   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;setPositionOrientation(initialPosition, initialOrientation);
00224   
00225   ref&lt;const robot::PlatformDescription&gt; pd(platformDescr);
00226   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>.resize(pd-&gt;isMobile()?<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx8">MaxPlatformSolids</a>:1);
00227 
00228   <span class="comment">// make a platform Solid</span>
00229   <a class="code" href="classbase_1_1Vector3.html">base::Dimension3</a> dim(pd-&gt;dimensions());
00230 
00231   ref&lt;Box&gt; pBox(NewObj Box(dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o0">x</a>,dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o1">y</a>,dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o2">z</a>));
00232   ref&lt;physics::Material&gt; pMat(<span class="keyword">new</span> <a class="code" href="classphysics_1_1Material.html">physics::Material</a>());
00233   pMat-&gt;setBaseColor(<a class="code" href="classgfx_1_1Color3.html">gfx::Color3</a>(0.5,0.5,0.8));
00234   <span class="keywordflow">if</span> (!pd-&gt;isMobile())
00235     pMat-&gt;setDensity(6); <span class="comment">// make the platform heavy</span>
00236   <span class="keywordflow">else</span>
00237     pMat-&gt;setDensity(0.25);
00238   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(pBox, pMat)); 
00239   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>]-&gt;setName(pd-&gt;getName());
00240   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[<a class="code" href="structPlatform.html">Platform</a>]);
00241   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>]-&gt;setEnabled(dynamic);
00242 
00243   Quat4 orient(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>());
00244   <a class="code" href="namespacebase.html#a26">Point3</a> spos( initialPosition - orient.rotate(pd-&gt;originOffset()) );
00245   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>]-&gt;setPosition(spos);
00246   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>]-&gt;setOrientation(orient);
00247   <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[<a class="code" href="structPlatform.html">Platform</a>]);
00248 
00249 
00250   <span class="keywordflow">if</span> (pd-&gt;isMobile()) { <span class="comment">// add wheels</span>
00251     
00252     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> wheelWidth = 0.25;
00253     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> wheelRadius = 0.40;
00254     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> wheelOffsetDown = 0.65;
00255     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> wheelPivotOffset = 0.22; <span class="comment">// distance beween wheel origin and the steering pivot point (toward platform)</span>
00256     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> wheelMountLength = 0.4; <span class="comment">// length of the left &amp; right wheel mounts</span>
00257 
00258     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> L = pd-&gt;L(); <span class="comment">// distance of drive axle back from platform origin</span>
00259     <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> W = pd-&gt;W(); <span class="comment">// distance between steering axle and drive axle</span>
00260 
00261 
00262     <span class="keywordflow">if</span> (pd-&gt;isHolonomic()) {
00263 
00264       <span class="keywordflow">throw</span> std::runtime_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"holonomic mobile platform not yet implemented - sorry."</span>));
00265 
00266     } <span class="keywordflow">else</span> { <span class="comment">// non-holonomic</span>
00267 
00268       <span class="comment">// add two drive wheels at the back and two steering wheels at the front</span>
00269       ref&lt;physics::Material&gt; wMat(<span class="keyword">new</span> <a class="code" href="classphysics_1_1Material.html">physics::Material</a>());
00270       wMat-&gt;setBaseColor(<a class="code" href="classgfx_1_1Color3.html">gfx::Color3</a>(0.1,0.1,0.1));<span class="comment">// dark grey</span>
00271       <span class="comment">//wMat-&gt;setSurfaceAppearance(PathName("images/basn2c16.png"));</span>
00272       ref&lt;Cylinder&gt; wCyl(NewObj Cylinder(wheelWidth, wheelRadius));
00273 
00274       <span class="comment">// create solids for each wheel</span>
00275       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx1">LeftFrontWheel</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(wCyl, wMat)); 
00276       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx1">LeftFrontWheel</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":leftFrontWheel"</span>);
00277       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[LeftFrontWheel]);
00278       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx1">LeftFrontWheel</a>]-&gt;setEnabled(dynamic);
00279       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[LeftFrontWheel]);
00280 
00281       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx2">RightFrontWheel</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(wCyl, wMat)); 
00282       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx2">RightFrontWheel</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":rightFrontWheel"</span>);
00283       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[RightFrontWheel]);
00284       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx2">RightFrontWheel</a>]-&gt;setEnabled(dynamic);
00285       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[RightFrontWheel]);
00286       
00287       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx3">LeftBackWheel</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(wCyl, wMat)); 
00288       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx3">LeftBackWheel</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":leftBackWheel"</span>);
00289       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[LeftBackWheel]);
00290       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx3">LeftBackWheel</a>]-&gt;setEnabled(dynamic);
00291       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[LeftBackWheel]);
00292       
00293       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx4">RightBackWheel</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(wCyl, wMat)); 
00294       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx4">RightBackWheel</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":rightBackWheel"</span>);
00295       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[RightBackWheel]);
00296       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx4">RightBackWheel</a>]-&gt;setEnabled(dynamic);
00297       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[RightBackWheel]);
00298       
00299       <span class="comment">// position them relative to the platform</span>
00300       <a class="code" href="namespacebase.html#a26">Point3</a> leftFrontWheelPos(initialPosition);
00301       Quat4 leftFrontWheelOrient(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>());
00302 
00303       <a class="code" href="namespacebase.html#a26">Point3</a> rightFrontWheelPos(initialPosition);
00304       Quat4 rightFrontWheelOrient(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>());
00305 
00306       <a class="code" href="namespacebase.html#a26">Point3</a> leftBackWheelPos(initialPosition);
00307       Quat4 leftBackWheelOrient(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>());
00308 
00309       <a class="code" href="namespacebase.html#a26">Point3</a> rightBackWheelPos(initialPosition);
00310       Quat4 rightBackWheelOrient(initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>());
00311 
00312       <span class="comment">// rotate left wheels upright (Z points out of the side of platform)</span>
00313       leftFrontWheelOrient *= Quat4(Vector3(1,0,0),-consts::Pi/2.0);
00314       leftBackWheelOrient *= Quat4(Vector3(1,0,0),-consts::Pi/2.0);
00315       <span class="comment">// rotate right wheels upright (the other way)</span>
00316       rightFrontWheelOrient *= Quat4(Vector3(1,0,0),consts::Pi/2.0);
00317       rightBackWheelOrient *= Quat4(Vector3(1,0,0),consts::Pi/2.0);
00318 
00319       <span class="comment">// translate to platform sides</span>
00320       <a class="code" href="namespacebase.html#a5">Real</a> yoffset = dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o1">y</a>/2.0;
00321       leftFrontWheelPos += leftFrontWheelOrient.rotate(Vector3(0,0,yoffset));
00322       leftBackWheelPos += leftFrontWheelOrient.rotate(Vector3(0,0,yoffset));
00323       rightFrontWheelPos += rightFrontWheelOrient.rotate(Vector3(0,0,yoffset));
00324       rightBackWheelPos += rightFrontWheelOrient.rotate(Vector3(0,0,yoffset));
00325 
00326       <span class="comment">// translate to front/back of platfom</span>
00327       leftFrontWheelPos += leftFrontWheelOrient.rotate(Vector3(W-L,0,0));
00328       rightFrontWheelPos += rightFrontWheelOrient.rotate(Vector3(W-L,0,0));
00329       leftBackWheelPos += leftFrontWheelOrient.rotate(Vector3(-L,0,0));
00330       rightBackWheelPos += rightFrontWheelOrient.rotate(Vector3(-L,0,0));
00331 
00332       <span class="comment">// translate down</span>
00333       leftFrontWheelPos += leftFrontWheelOrient.rotate(Vector3(0,wheelOffsetDown,0));
00334       leftBackWheelPos += leftFrontWheelOrient.rotate(Vector3(0,wheelOffsetDown,0));
00335       rightFrontWheelPos += rightFrontWheelOrient.rotate(Vector3(0,-wheelOffsetDown,0));
00336       rightBackWheelPos += rightFrontWheelOrient.rotate(Vector3(0,-wheelOffsetDown,0));
00337       
00338 
00339       <span class="comment">// set pos/orient</span>
00340       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx1">LeftFrontWheel</a>]-&gt;setPosition( leftFrontWheelPos );
00341       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx1">LeftFrontWheel</a>]-&gt;setOrientation( leftFrontWheelOrient );
00342       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx2">RightFrontWheel</a>]-&gt;setPosition( rightFrontWheelPos );
00343       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx2">RightFrontWheel</a>]-&gt;setOrientation( rightFrontWheelOrient );
00344       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx3">LeftBackWheel</a>]-&gt;setPosition( leftBackWheelPos );
00345       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx3">LeftBackWheel</a>]-&gt;setOrientation( leftBackWheelOrient );
00346       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx4">RightBackWheel</a>]-&gt;setPosition( rightBackWheelPos );
00347       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx4">RightBackWheel</a>]-&gt;setOrientation( rightBackWheelOrient );
00348 
00349 
00350       <span class="comment">// the front wheels need a crossbar steering system to connect them</span>
00351       <span class="comment">//  and keep them facing the same direction</span>
00352       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createConstraintGroup();
00353 
00354       <span class="comment">// first the wheel mounts</span>
00355       ref&lt;Box&gt; mBox(NewObj Box(wheelMountLength,wheelMountLength/4.0,wheelMountLength/4.0));
00356       ref&lt;physics::Material&gt; mMat(<span class="keyword">new</span> <a class="code" href="classphysics_1_1Material.html">physics::Material</a>());
00357       mMat-&gt;setBaseColor(<a class="code" href="classgfx_1_1Color3.html">gfx::Color3</a>(0.7,0.7,0.7));
00358 
00359       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(mBox, mMat)); 
00360       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":leftFrontWheelMount"</span>);
00361       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[LeftFrontWheelMount]);
00362       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>]-&gt;setEnabled(dynamic);
00363       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[LeftFrontWheelMount]);
00364       
00365       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(mBox, mMat));
00366       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":rightFrontWheelMount"</span>);
00367       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[RightFrontWheelMount]);
00368       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>]-&gt;setEnabled(dynamic);
00369       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[RightFrontWheelMount]);
00370       
00371       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>]-&gt;setPosition( leftFrontWheelPos + leftFrontWheelOrient.rotate(Vector3(0,0,-wheelPivotOffset)) );
00372       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>]-&gt;setPosition( platformSolids[LeftFrontWheelMount]-&gt;<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatforma19">getPosition</a>() + initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>().rotate(Vector3(wheelMountLength/2.0,0,0)) );
00373       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx5">LeftFrontWheelMount</a>]-&gt;setOrientation( initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>() );
00374       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>]-&gt;setPosition( rightFrontWheelPos + rightFrontWheelOrient.rotate(Vector3(0,0,-wheelPivotOffset)) );
00375       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>]-&gt;setOrientation( initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>() );
00376       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx6">RightFrontWheelMount</a>]-&gt;setPosition( platformSolids[RightFrontWheelMount]-&gt;<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatforma19">getPosition</a>() + initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>().rotate(Vector3(wheelMountLength/2.0,0,0)) );
00377 
00378       <span class="comment">// create the steering crossbar to connect the right &amp; left wheel mounts</span>
00379       ref&lt;Box&gt; xBox(NewObj Box(0.1,dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o1">y</a> - 2.0*wheelPivotOffset,0.1));
00380       platformSolids[Crossbar] = ref&lt;Solid&gt;(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createSolid(xBox, mMat)); 
00381       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx7">Crossbar</a>]-&gt;setName(pd-&gt;getName()+<span class="stringliteral">":steeringCrossbar"</span>);
00382       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;addSolid(platformSolids[Crossbar]);
00383       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx7">Crossbar</a>]-&gt;setEnabled(dynamic);
00384       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp4">spatialGroup</a>-&gt;add(platformSolids[Crossbar]);
00385       <span class="comment">// position it</span>
00386       <a class="code" href="namespacebase.html#a26">Point3</a> crossbarPos( leftFrontWheelPos );
00387       Quat4  crossbarOrient( initialOrientation.<a class="code" href="classbase_1_1Orient.html#base_1_1Orienta29">getQuat4</a>() );
00388       crossbarPos += crossbarOrient.rotate(Vector3(0,-dim.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3o1">y</a>/2.0,0));
00389       crossbarPos += crossbarOrient.rotate(Vector3(wheelMountLength,0,0));
00390       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx7">Crossbar</a>]-&gt;setPosition( crossbarPos );
00391       <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9robot_1_1sim_1_1SimulatedPlatformx7">Crossbar</a>]-&gt;setOrientation( crossbarOrient );
00392       
00393       
00394       <span class="comment">// only connect everything up with constraints &amp; motors if we're doing dynamic simulation.</span>
00395       <span class="comment">//  That way, for static simulation the Solids can be explicitly positioned without</span>
00396       <span class="comment">//  worrying about maintaining constraints</span>
00397       <span class="keywordflow">if</span> (<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp2">dynamic</a>) { 
00398       
00399         <span class="comment">// connect the mounts to the wheels</span>
00400         ref&lt;HingeJoint&gt; leftMountHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00401         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(leftMountHinge);
00402         leftMountHinge-&gt;attach(platformSolids[LeftFrontWheelMount], platformSolids[LeftFrontWheel]);
00403         leftMountHinge-&gt;setAxis(Vector3(0,1,0));
00404         leftMountHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(-wheelMountLength/2.0,0,0));
00405         
00406         ref&lt;HingeJoint&gt; rightMountHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00407         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(rightMountHinge);
00408         rightMountHinge-&gt;attach(platformSolids[RightFrontWheelMount], platformSolids[RightFrontWheel]);
00409         rightMountHinge-&gt;setAxis(Vector3(0,1,0));
00410         rightMountHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(-wheelMountLength/2.0,0,0));
00411         
00412         <span class="comment">// connect the mounts to the crossbar</span>
00413         ref&lt;HingeJoint&gt; leftCrossbarHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00414         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(leftCrossbarHinge);
00415         leftCrossbarHinge-&gt;attach(platformSolids[LeftFrontWheelMount], platformSolids[Crossbar]);
00416         leftCrossbarHinge-&gt;setAxis(Vector3(0,0,1));
00417         leftCrossbarHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(wheelMountLength/2.0,0,0));
00418         
00419         ref&lt;HingeJoint&gt; rightCrossbarHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00420         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(rightCrossbarHinge);
00421         rightCrossbarHinge-&gt;attach(platformSolids[RightFrontWheelMount], platformSolids[Crossbar]);
00422         rightCrossbarHinge-&gt;setAxis(Vector3(0,0,1));
00423         rightCrossbarHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(wheelMountLength/2.0,0,0));
00424         
00425         
00426         <span class="comment">// now connect the mounts to the platform</span>
00427         ref&lt;HingeJoint&gt; leftSteeringHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00428         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(leftSteeringHinge);
00429         leftSteeringHinge-&gt;attach(platformSolids[LeftFrontWheelMount], platformSolids[<a class="code" href="structPlatform.html">Platform</a>]);
00430         leftSteeringHinge-&gt;setAxis(Vector3(0,0,-1));
00431         leftSteeringHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(-wheelMountLength/2.0,0,0));
00432         leftSteeringHinge-&gt;setLowStop(-Math::degToRad(35));
00433         leftSteeringHinge-&gt;setHighStop(Math::degToRad(35));
00434         
00435         ref&lt;HingeJoint&gt; rightSteeringHinge = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00436         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(rightSteeringHinge);
00437         rightSteeringHinge-&gt;attach(platformSolids[RightFrontWheelMount], platformSolids[<a class="code" href="structPlatform.html">Platform</a>]);
00438         rightSteeringHinge-&gt;setAxis(Vector3(0,0,-1));
00439         rightSteeringHinge-&gt;setAnchor(<a class="code" href="namespacebase.html#a26">Point3</a>(-wheelMountLength/2.0,0,0));
00440         
00441         
00442         
00443         <span class="comment">// Back wheels with HingeJoints</span>
00444         ref&lt;HingeJoint&gt; hingeLeft = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00445         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(hingeLeft);
00446         hingeLeft-&gt;attach(platformSolids[<a class="code" href="structPlatform.html">Platform</a>], platformSolids[LeftBackWheel]);
00447         hingeLeft-&gt;setAxis(Vector3(0,-1,0));
00448         hingeLeft-&gt;setAnchor( leftBackWheelPos - platformSolids[<a class="code" href="structPlatform.html">Platform</a>]-&gt;<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatforma19">getPosition</a>() );
00449         
00450         ref&lt;HingeJoint&gt; hingeRight = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createHingeJoint();
00451         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp5">wheelConstraintGroup</a>-&gt;addConstraint(hingeRight);
00452         hingeRight-&gt;attach(platformSolids[<a class="code" href="structPlatform.html">Platform</a>], platformSolids[RightBackWheel]);
00453         hingeRight-&gt;setAxis(Vector3(0,-1,0));
00454         hingeRight-&gt;setAnchor( rightBackWheelPos - platformSolids[<a class="code" href="structPlatform.html">Platform</a>]-&gt;<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatforma19">getPosition</a>() );
00455 
00456 
00457         
00458         <span class="comment">// now attach drive motors</span>
00459         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createMotor();
00460         hingeLeft-&gt;attachMotor(1, leftDriveMotor);
00461         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setTargetVel(0);
00462         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp9">leftDriveMotor</a>-&gt;setMaxForce(0);
00463         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp6">leftDriveHingeJoint</a> = hingeLeft;
00464   
00465         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createMotor();
00466         hingeRight-&gt;attachMotor(1, rightDriveMotor);
00467         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setTargetVel(0);
00468         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp10">rightDriveMotor</a>-&gt;setMaxForce(0.005);
00469         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp7">rightDriveHingeJoint</a> = hingeRight;
00470   
00471   
00472         <span class="comment">// and a steering motor on the left</span>
00473         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a> = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createMotor();
00474         leftSteeringHinge-&gt;attachMotor(1, steeringMotor);
00475         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setTargetVel(0);
00476         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp11">steeringMotor</a>-&gt;setMaxForce(0.005);
00477         <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp8">steeringHingeJoint</a> = leftSteeringHinge;
00478   
00479   
00480         <span class="comment">// add some motors to the front wheels, just to provide some</span>
00481         <span class="comment">//  'friction-like' damping.</span>
00482         ref&lt;Motor&gt; leftFrontWheelMotor = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createMotor();
00483         leftMountHinge-&gt;attachMotor(1, leftFrontWheelMotor);
00484         leftFrontWheelMotor-&gt;setTargetVel(0);
00485         leftFrontWheelMotor-&gt;setMaxForce(0.02);
00486   
00487         ref&lt;Motor&gt; rightFrontWheelMotor = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;createMotor();
00488         rightMountHinge-&gt;attachMotor(1, rightFrontWheelMotor);
00489         rightFrontWheelMotor-&gt;setTargetVel(0);
00490         rightFrontWheelMotor-&gt;setMaxForce(0.02);
00491       }
00492 
00493     }
00494 
00495   }
00496 
00497 }
00498 
00499 
00500 
00501 ref&lt;physics::Collidable&gt; SimulatedPlatform::createCollidable(CollidableFlags flags)
00502 {
00503   <a class="code" href="base.html#a19">Assert</a>(solidSystem);
00504   <a class="code" href="base.html#a19">Assert</a>(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>.size() &gt; 0);
00505   
00506   ref&lt;CollisionCuller&gt; cc(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;getCollisionCuller());
00507   ref&lt;const robot::PlatformDescription&gt; pd(platformDescr);
00508 
00509   array&lt;ref&lt;Collidable&gt; &gt; collidables(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>.size());
00510   collidables[<a class="code" href="structPlatform.html">Platform</a>] = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp3">platformSolids</a>[<a class="code" href="structPlatform.html">Platform</a>]-&gt;createCollidable(flags);
00511   collidables[<a class="code" href="structPlatform.html">Platform</a>]-&gt;setName(<span class="stringliteral">"platformBody"</span>);
00512   
00513   <span class="keywordflow">if</span> (pd-&gt;isMobile()) {
00514     ref&lt;CollidableGroup&gt; platformGroup = cc-&gt;createCollidableGroup();
00515 
00516     <span class="comment">// Create a group with the platform and all the rest in a subgroup</span>
00517     platformGroup-&gt;addCollidable( collidables[<a class="code" href="structPlatform.html">Platform</a>] );
00518     
00519     ref&lt;CollidableGroup&gt; partsGroup = cc-&gt;createCollidableGroup();
00520     partsGroup-&gt;setChildIntercollisionEnabled(<span class="keyword">false</span>);
00521     
00522     <span class="keywordflow">for</span>(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9">PlatformSolids</a> p=<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9">PlatformSolids</a>(<a class="code" href="structPlatform.html">Platform</a>+1); p&lt;<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9">PlatformSolids</a>(platformSolids.size()); p = <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformx9">PlatformSolids</a>(p+1)) {
00523       collidables[p] = platformSolids[p]-&gt;createCollidable(flags);
00524       partsGroup-&gt;addCollidable( collidables[p] );
00525     }
00526     
00527     platformGroup-&gt;addCollidable( partsGroup );
00528   
00529     <a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformb1">disableCollisions</a>(collidables);
00530     <span class="keywordflow">return</span> platformGroup;
00531   }
00532   <span class="keywordflow">else</span> {
00533     <span class="keywordflow">return</span> collidables[<a class="code" href="structPlatform.html">Platform</a>];
00534   }
00535   
00536 }
00537 
00538 
00539 
00540 <span class="keywordtype">void</span> SimulatedPlatform::disableCollisions(<span class="keyword">const</span> array&lt;ref&lt;Collidable&gt; &gt;&amp; collidables)
00541 {
00542   ref&lt;const robot::PlatformDescription&gt; pd(platformDescr);
00543   <span class="keywordflow">if</span> (!pd-&gt;isMobile()) <span class="keywordflow">return</span>;
00544 
00545   <span class="comment">// don't collide any of the wheels, mounts or crossbar with the platform</span>
00546   <span class="comment">//  !!! should relax this for the real wheels once the collision model</span>
00547   <span class="comment">//      uses a  cylinder instead of a capped cylinder (??)</span>
00548 
00549   ref&lt;CollisionCuller&gt; cc(<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatformp0">solidSystem</a>-&gt;getCollisionCuller());
00550   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[LeftFrontWheel], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00551   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[RightFrontWheel], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00552   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[LeftFrontWheelMount], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00553   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[LeftFrontWheelMount], collidables[LeftFrontWheel]);
00554   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[LeftFrontWheelMount], collidables[Crossbar]);
00555   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[RightFrontWheelMount], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00556   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[RightFrontWheelMount], collidables[RightFrontWheel]);
00557   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[RightFrontWheelMount], collidables[Crossbar]);
00558   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[LeftBackWheel], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00559   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[RightBackWheel], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00560   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[Crossbar], collidables[<a class="code" href="structPlatform.html">Platform</a>]);
00561   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[Crossbar], collidables[LeftFrontWheel]);
00562   cc-&gt;collisionEnable(<span class="keyword">false</span>,collidables[Crossbar], collidables[RightFrontWheel]);
00563 
00564 }
00565 
00566 
00567 
00568 <span class="keywordtype">bool</span> SimulatedPlatform::formatSupported(String format, Real version, ExternalizationType type)<span class="keyword"> const</span>
00569 <span class="keyword"></span>{
00570   <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// none supported (yet)</span>
00571 }
00572 
00573 <span class="keywordtype">void</span> SimulatedPlatform::externalize(<a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>&amp; e, String format, Real version)
00574 {
00575   <span class="comment">//if (format=="") format = String("dh");</span>
00576 
00577   <span class="keywordflow">if</span> (!<a class="code" href="classrobot_1_1sim_1_1SimulatedPlatform.html#robot_1_1sim_1_1SimulatedPlatforma25">formatSupported</a>(format,version))
00578     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"format "</span>)+format+<span class="stringliteral">" "</span>+base::realToString(version)+<span class="stringliteral">" unsupported"</span>));
00579 
00580 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:41 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
