<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/control/oldikor/IKOR/fsp.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/control/oldikor/IKOR/fsp.c</h1><a href="fsp_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ________________________________________________________</span>
00002 <span class="comment">  |                                                        |</span>
00003 <span class="comment">  | Program Name:   FSPv2.0.c                              |</span>
00004 <span class="comment">  |________________________________________________________|</span>
00005 <span class="comment">  |                                                        |</span>
00006 <span class="comment">  | description:  Given the Jacobian and dx the procedure  |</span>
00007 <span class="comment">  |     finds a a set of g vectors which span the solution |</span>
00008 <span class="comment">  |     space of the equation to the equation J*q=dx, for  |</span>
00009 <span class="comment">  |     all values of the vector q.                        |</span>
00010 <span class="comment">  |                                                        |</span>
00011 <span class="comment">  |                                                        |</span>
00012 <span class="comment">  | Procedures:                                            |</span>
00013 <span class="comment">  |     Solution_generator  :                              |</span>
00014 <span class="comment">  |     RestofSoln          :                              |</span>
00015 <span class="comment">  |     Dependency          :                              |</span>
00016 <span class="comment">  |     BLOCK_COL_FIND_X    :                              |</span>
00017 <span class="comment">  |     ReduceA             :                              |</span>
00018 <span class="comment">  |     CheckB              :                              |</span>
00019 <span class="comment">  |     CheckRange          :                              |</span>
00020 <span class="comment">  |     Rebuild_gs          :                              |</span>
00021 <span class="comment">  |________________________________________________________| */</span>
00022 
00023 <span class="preprocessor">#include &lt;<a class="code" href="general_8h.html">IKOR/general.h</a>&gt;</span>
00024 
<a name="l00025"></a><a class="code" href="fsp_8c.html#a1">00025</a> <span class="keywordtype">int</span>  <a class="code" href="fsp_8c.html#a1">SystemComplete</a>;    <span class="comment">/* marks when all necessary vecs have been found*/</span>
<a name="l00026"></a><a class="code" href="fsp_8c.html#a2">00026</a> <span class="keywordtype">int</span>  <a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a> = <a class="code" href="general_8h.html#a17">TRUE</a>;
<a name="l00027"></a><a class="code" href="fsp_8c.html#a0">00027</a> <span class="preprocessor">#define DEBUG 1</span>
00028 <span class="preprocessor"></span><span class="comment">/* ________________________________________________________</span>
00029 <span class="comment">  | name:    Solution_generator                            |</span>
00030 <span class="comment">  | description:  Main FSP procedure which sets up all     |</span>
00031 <span class="comment">  |    initialization of variables, and starts production  |</span>
00032 <span class="comment">  |    of g vectors.  After calling reduce it checks for   |</span>
00033 <span class="comment">  |    SpecialCase2 then finds the first valid blocking    |</span>
00034 <span class="comment">  |    pattern.  After which it calls RestofSoln and       |</span>
00035 <span class="comment">  |    depending on the outcome it decides which method to |</span>
00036 <span class="comment">  |    determine the solution vector.                      |</span>
00037 <span class="comment">  |                                                        |</span>
00038 <span class="comment">  |                                                        |</span>
00039 <span class="comment">  | inputs:  Aorig, borig, M, N                            |</span>
00040 <span class="comment">  | outputs: Ared, bred, Mred, Nred, Xelim, ColElim,       |</span>
00041 <span class="comment">  |          RowElim, g                                    |</span>
00042 <span class="comment">  |________________________________________________________|</span>
00043 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00044 <span class="comment">  |  g fries     3/95      Created                         |</span>
00045 <span class="comment">  |________________________________________________________| */</span>
00046 
<a name="l00047"></a><a class="code" href="fsp_8c.html#a3">00047</a> <span class="keyword">extern</span> FILE* <a class="code" href="fsp_8c.html#a3">gcheck</a>;     
00048 
<a name="l00049"></a><a class="code" href="headers_8h.html#a14">00049</a> <span class="keywordtype">int</span> <a class="code" href="headers_8h.html#a14">Solution_generator</a>(FSP_data, Aorig, borig, check)
00050 FILE      *check;
00051 <a class="code" href="structMATRIX.html">MATRIX</a>    *Aorig,
00052           *borig;
00053 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;
00054 {
00055 <a class="code" href="structMATRIX.html">MATRIX</a>  *Ared,          <span class="comment">/* reduced A                                    */</span>
00056         *Asub,          <span class="comment">/* submatrix from square submatrix is found     */</span>
00057         *Asqr,          <span class="comment">/* square submatrix                             */</span>
00058         *bred,          <span class="comment">/* reduced b                                    */</span>
00059         *block,         <span class="comment">/* locations of blocked columns for each soln   */</span>
00060         *n,             <span class="comment">/* null space vectors                           */</span>
00061         *Specialg;      <span class="comment">/* null vectors created by SpecialCase1         */</span>
00062 <span class="keywordtype">float</span>   K2,             <span class="comment">/* matrix condition number:  sv_max/sv_min      */</span>
00063         N_BND;          <span class="comment">/* min acceptable value for nonzero nspace comp */</span>
00064 <span class="keywordtype">int</span>     i, j, k, I,     <span class="comment">/* loop counters                                */</span>
00065         bcheck,         <span class="comment">/* check for completely zero bred               */</span>
00066        *ColElim,        <span class="comment">/* marks columns eliminated from original A     */</span>
00067        *RowElim,        <span class="comment">/* which rows are to be eliminated from the A   */</span>
00068         move,           <span class="comment">/* which of four possible blocks is being moved */</span>
00069         NextToFind,     <span class="comment">/* vector number being searched for             */</span>
00070        *Tackon,         <span class="comment">/* columns are indexed for effic, soln finding  */</span>
00071        *FirstOK,        <span class="comment">/* if OK to substitute in for firstsoln column  */</span>
00072         pos,            <span class="comment">/* used with the Ordering[] variable            */</span>
00073         nullity,        <span class="comment">/* dimension of null space                      */</span>
00074         binrange,       <span class="comment">/* marks if b is in the range of the A          */</span>
00075         Exit_Status,    <span class="comment">/* tells calling routine if OK                  */</span>
00076         NumSpg,         <span class="comment">/* number of g vectors created by SpecialCase1  */</span>
00077         Stop;           <span class="comment">/* loop flag to end                             */</span>
00078 
00079   <span class="comment">/* allocate memory space for variables */</span>
00080   Tackon  = ( <span class="keywordtype">int</span> *) malloc ( (M - N) * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span> ) );
00081   FirstOK = ( <span class="keywordtype">int</span> *) malloc (    N    * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span> ) );
00082   ColElim = ( <span class="keywordtype">int</span> *) malloc (    M    * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span> ) );
00083   RowElim = ( <span class="keywordtype">int</span> *) malloc (    N    * <span class="keyword">sizeof</span>( <span class="keywordtype">int</span> ) );
00084   Ared    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(N, M);
00085   bred    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(N, 1);
00086   Specialg= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>((M-1),M);
00087 
00088   <a class="code" href="fsp_8c.html#a3">gcheck</a>=check;
00089   <span class="comment">/* initialize SystemComplete and FirstOK */</span>
00090   <a class="code" href="fsp_8c.html#a1">SystemComplete</a> = <a class="code" href="general_8h.html#a18">FALSE</a>;
00091   <span class="keywordflow">for</span> (i=0; i&lt; N; i++)
00092     FirstOK[i] = <a class="code" href="general_8h.html#a18">FALSE</a>;
00093 
00094   <span class="keywordflow">if</span> ( (bcheck = (<a class="code" href="headers_8h.html#a18">CheckB</a>(borig, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso1">N</a>))) == <a class="code" href="general_8h.html#a15">ZERO</a> )
00095   {
00096     <span class="keywordflow">for</span> (i=0; i&lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso1">N</a>; i++) 
00097       borig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = (i&lt;3) ? 1.0:0.0;
00098     FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a> = <a class="code" href="general_8h.html#a17">TRUE</a>;  
00099   }
00100   <span class="keywordflow">else</span>
00101     FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a> = <a class="code" href="general_8h.html#a18">FALSE</a>;
00102 
00103   <span class="comment">/*check = stderr;             /* uncomment when in trouble    */</span>
00104   <span class="comment">/* Eliminate all the nonredundancies from the A and b */</span>
00105   <a class="code" href="headers_8h.html#a17">ReduceA</a>(FSP_data, Aorig, Ared, borig, bred,ColElim,RowElim,
00106                                                         &amp;NumSpg, Specialg);
00107   <span class="comment">/* Setup and initialization of g vectors */</span>
00108   <a class="code" href="matrix_8h.html#a8">mat_free</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00109   FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a> = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>((FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>+1+NumSpg), M);
00110   <span class="keywordflow">for</span> (i=0; i&lt;(<a class="code" href="general_8h.html#a1">SPAN</a>); i++)
00111     <span class="keywordflow">for</span> (j=0; j&lt;M; j++) FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = 0.0e0;
00112 
00113 
00114 <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00115   fprintf(check,<span class="stringliteral">"\n  ______________________________  \n"</span>);
00116   fprintf(check,<span class="stringliteral">"\n                FSP               \n"</span>);
00117   fprintf(check,  <span class="stringliteral">"  ______________________________  \n\n"</span>);
00118   <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">" Jacobian "</span>, Aorig);
00119   <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">" requested dx "</span>, borig); 
00120   fprintf(check, <span class="stringliteral">" M   : %d, N   : %d\n Mred: %d, Nred: %d"</span>,
00121                    M, N, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00122   fprintf (check, <span class="stringliteral">"\nRowElim: "</span>);
00123   <span class="keywordflow">for</span> (i=0; i&lt; N; i++) fprintf (check,<span class="stringliteral">"%d "</span>, RowElim[i]);
00124   fprintf (check, <span class="stringliteral">"\nColElim: "</span>);
00125   <span class="keywordflow">for</span> (i=0; i&lt; M; i++) fprintf (check,<span class="stringliteral">"%d "</span>, ColElim[i]);
00126   <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">" *** Xelim *** "</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso10">Xelim</a>);
00127   <span class="keywordflow">if</span>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) fprintf(check,<span class="stringliteral">"\nGenerating NullSpace Solutions.\n"</span>);
00128 }
00129 <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00130   <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">" *** A Reduced *** "</span>, Ared);
00131   <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">" *** b Reduced *** "</span>, bred);
00132 
00133 }             <span class="comment">/* if DEBUGGING, include code  (see file info) */</span>
00134 
00135 bcheck=<a class="code" href="headers_8h.html#a18">CheckB</a>(bred, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00136 <span class="keywordflow">if</span> (bcheck == 0)
00137     {
00138     n = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00139     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) fprintf(check, <span class="stringliteral">"GIVEN MATRIX IS COMPLETELY RESTRICTED\n\n"</span>);
00140     Asub = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>);
00141     <span class="keywordflow">for</span> (i=0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; i++)
00142         <span class="keywordflow">for</span> (j=0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; j++)
00143             Asub-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00144     <a class="code" href="matrix_8h.html#a24">mat_null</a>(Asub, &amp;nullity, n, &amp;K2);
00145 
00146     <span class="comment">/* set the solution vectors for a completely restricted system  */</span>
00147     <span class="keywordflow">for</span> (i=0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00148         <span class="keywordflow">for</span> (j=0; j&lt; <a class="code" href="general_8h.html#a2">SPAN2</a> - 1; j++)
00149             FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00150     <span class="keywordflow">for</span> (i=0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00151         FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>][i] = 0.0;
00152     <a class="code" href="fsp_8c.html#a1">SystemComplete</a> = <a class="code" href="general_8h.html#a17">TRUE</a>;
00153 
00154     Exit_Status = <a class="code" href="general_8h.html#a33">RESTRICTED</a>;
00155     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"solutions"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00156 
00157     <a class="code" href="matrix_8h.html#a8">mat_free</a>(Asub);
00158     <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
00159     }
00160 <span class="keywordflow">else</span>
00161     {
00162     n = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00163     <span class="keywordflow">if</span> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a> != N)
00164         {
00165             <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00166               fprintf(check, <span class="stringliteral">"GIVEN MATRIX IS RESTRICTED FOR %d "</span>,
00167                  N-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00168               fprintf(check, <span class="stringliteral">"OUT OF %d VECTOR COMPONENTS\n\n"</span>, N);
00169             }
00170         }
00171 
00172     block= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a2">SPAN2</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00173     Asqr = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);
00174     NextToFind = 0;
00175 
00176     <span class="comment">/* initialize the blocking positions for the first solution vector */</span>
00177     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) 
00178         <span class="keywordflow">for</span> (i=0; i&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>); i++) 
00179              <span class="keywordflow">for</span> (j=0; j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>+1); j++)
00180                 block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = 0;
00181 
00182     <span class="keywordflow">for</span> (i=0; i&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>); i++)
00183         block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = i;
00184     k=0;
00185     <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00186       <span class="keywordflow">if</span> (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][k] == i)
00187          {
00188          <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; j++)
00189             Asqr-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k] = Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
00190          k++;
00191          }
00192     <a class="code" href="matrix_8h.html#a24">mat_null</a>(Asqr, &amp;nullity, n, &amp;K2);
00193 
00194     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00195         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (check, <span class="stringliteral">"block"</span>, block);
00196         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (check, <span class="stringliteral">"Asqr"</span>, Asqr);
00197         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (check, <span class="stringliteral">"n"</span>, n);
00198         fprintf(check,<span class="stringliteral">"nullity = %d, K2 = %f\n"</span>, nullity, K2);
00199     }     <span class="comment">/* if DEBUGGING, include code  (see file info) */</span>
00200 
00201     <span class="comment">/* loop until an acceptable well-conditioned first solution found */</span>
00202     <span class="keywordflow">while</span> ((nullity != 0) &amp;&amp; (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]&lt;N))
00203         {
00204 fprintf(check,<span class="stringliteral">"while:\n"</span>);
00205         pos = FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1;
00206         <span class="keywordflow">while</span> (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][pos] == <a class="code" href="general_8h.html#a2">SPAN2</a> - 1 +pos)
00207             pos--;
00208         block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][pos]++;
00209         move=pos+1;
00210         <span class="keywordflow">while</span> (move&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>)
00211             {
00212             block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][move]=block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][(move-1)]+1;
00213             move++;
00214             }
00215         k=0;
00216         <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00217             <span class="keywordflow">if</span> (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][k] == i)
00218                 {
00219                 <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; j++)
00220                     Asqr-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k] = Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
00221                 k++;
00222                 }
00223         <span class="keywordflow">if</span> (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] &lt;= FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>)
00224             <a class="code" href="matrix_8h.html#a24">mat_null</a>(Asqr, &amp;nullity, n, &amp;K2);
00225         <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00226             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"block"</span>, block);
00227             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"Asqr"</span>, Asqr);
00228             fprintf(check, <span class="stringliteral">"nullity = %d, K2 = %f\n"</span>, nullity, K2);
00229           }
00230         }
00231 
00232     k=0; I=0;
00233     <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00234         <span class="keywordflow">if</span> ((k &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>) &amp;&amp; (block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][k] == i))
00235            k++;
00236         <span class="keywordflow">else</span>
00237             {
00238             Tackon[I]=i;
00239             I++;
00240             }
00241 fprintf(check,<span class="stringliteral">"calling BLOCK_COL_FIND_X\n"</span>);
00242     <a class="code" href="headers_8h.html#a16">BLOCK_COL_FIND_X</a>(Tackon,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind],block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind],
00243                 bred,Ared,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>,check);
00244 
00245     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00246         fprintf(check, <span class="stringliteral">"first solution \n"</span>);
00247         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"block"</span>, block);
00248         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"Asqr"</span>, Asqr);
00249         <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>;i++)
00250           fprintf(check, <span class="stringliteral">"here %d"</span>, Tackon[i]);
00251     }
00252     fprintf(check,<span class="stringliteral">"Nred=%d Mred=%d\n"</span>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>);
00253     <span class="keywordflow">if</span> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>==FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>)
00254         <a class="code" href="fsp_8c.html#a1">SystemComplete</a>=<a class="code" href="general_8h.html#a17">TRUE</a>;
00255     <span class="keywordflow">else</span>
00256         <a class="code" href="headers_8h.html#a15">RestofSoln</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>, NextToFind, block,
00257                    FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>, bred, Ared, Tackon, FirstOK, check);
00258 
00259     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00260       <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"block"</span>, block);
00261       <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"solutions"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00262       }
00263    <a class="code" href="matrix_8h.html#a8">mat_free</a>(block);
00264    <a class="code" href="matrix_8h.html#a8">mat_free</a>(Asqr);
00265    <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
00266    }
00267 
00268 
00269 
00270         <span class="comment">/* check if the eliminated b elements in bred can be    */</span>
00271         <span class="comment">/* produced from the g vectors and the reduced A matrix */</span>
00272         <span class="comment">/* ie check that b is in the range of A                 */</span>
00273    <span class="keywordflow">if</span> (!<a class="code" href="fsp_8c.html#a1">SystemComplete</a>)
00274    {
00275         <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(25,<a class="code" href="general_8h.html#a24">OK</a>,<span class="stringliteral">""</span>);
00276         binrange = 0;
00277    }
00278    <span class="keywordflow">else</span>
00279       binrange = <a class="code" href="headers_8h.html#a19">CheckRange</a>(borig, Aorig, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>, RowElim,
00280                             FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>);
00281 
00282         <span class="comment">/* check that the original b was not all zeros (special case) */</span>
00283    bcheck = <a class="code" href="headers_8h.html#a18">CheckB</a>(borig, M);
00284 
00285         <span class="comment">/* check whether the original A had dependent rows  */</span>
00286    <span class="keywordflow">if</span> ((binrange) &amp;&amp; (bcheck != 0) &amp;&amp; (Exit_Status != <a class="code" href="general_8h.html#a33">RESTRICTED</a>))
00287    {
00288      <a class="code" href="headers_8h.html#a20">Rebuild_gs</a> (FSP_data, ColElim, Specialg, NumSpg);
00289      Exit_Status = <a class="code" href="general_8h.html#a31">COMPLETE</a>;
00290      <span class="keywordflow">for</span> (i=0; (( i &lt; N ) &amp;&amp; (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a> == 0)); i++)
00291      {
00292        <span class="keywordflow">if</span> (RowElim[i] != 2)
00293          i++;
00294        <span class="keywordflow">else</span> {
00295          <span class="comment">/* Code should be inserted here or in ReduceA to determine     */</span>
00296          <span class="comment">/* whether or not the b's are dependent as well, if they are   */</span>
00297          <span class="comment">/* nothing needs to happen, if they aren't... an error mess-   */</span>
00298          <span class="comment">/* should be generated and the system should halt.             */</span>
00299          <span class="comment">/* Currently this will occur since the A matrix in the findt's */</span>
00300          <span class="comment">/* will be the zero matrix and cause a zero division error.    */</span>      
00301        }
00302      }
00303    }
00304    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Exit_Status != <a class="code" href="general_8h.html#a33">RESTRICTED</a>)
00305    {
00306      Exit_Status = <a class="code" href="general_8h.html#a32">NOT_COMPLETE</a>;
00307      <span class="keywordflow">if</span> (bcheck != 0)
00308        fprintf(check, <span class="stringliteral">"\n\nB NOT IN RANGE OF A\n"</span>);
00309      <span class="keywordflow">else</span>
00310        fprintf(check, <span class="stringliteral">"\n\n%s\n%s"</span>, <span class="stringliteral">"SPECIAL CASE\nB IS ZERO VECTOR"</span>,
00311          <span class="stringliteral">"CONSTRAINED OPTIMIZATION MUST BE USED\n"</span>);
00312    }
00313 
00314 <span class="comment">/* free up all variable memory space */</span>
00315 <a class="code" href="matrix_8h.html#a8">mat_free</a>(Ared);
00316 <a class="code" href="matrix_8h.html#a8">mat_free</a>(bred);
00317 <a class="code" href="matrix_8h.html#a8">mat_free</a>(Specialg);
00318 free(Tackon);
00319 free(FirstOK);
00320 free(ColElim);
00321 free(RowElim);
00322 
00323 <span class="keywordflow">return</span> (Exit_Status);
00324 }
00325 
00326 
00327 
00328 <span class="comment">/* ________________________________________________________</span>
00329 <span class="comment">  | name:    RestofSoln                                    |</span>
00330 <span class="comment">  | description:  Finds the remaining solution vectors     |</span>
00331 <span class="comment">  |               after the first has been selected.  It is|</span>
00332 <span class="comment">  |               recursive and thus calls itself when a   |</span>
00333 <span class="comment">  |               valid solution is found, if this solution|</span>
00334 <span class="comment">  |               leads to a dead end, it will pop back to |</span>
00335 <span class="comment">  |               last solution and build from there.  This|</span>
00336 <span class="comment">  |               insures that all possible combinations of|</span>
00337 <span class="comment">  |               blocking patterns are available, given   |</span>
00338 <span class="comment">  |               first one, in pattern which follows the  |</span>
00339 <span class="comment">  |               algoritm presented in the article.       |</span>
00340 <span class="comment">  |                                                        |</span>
00341 <span class="comment">  |                                                        |</span>
00342 <span class="comment">  | inputs:  Mred, Nred, NextToFind, block, g, bred, Ared, |</span>
00343 <span class="comment">  |          Tackon, FirstOK                               |</span>
00344 <span class="comment">  | outputs: block, g                                      |</span>
00345 <span class="comment">  |________________________________________________________|</span>
00346 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00347 <span class="comment">  |  g fries     2/95      Created                         |</span>
00348 <span class="comment">  |  g fries     3/95      Addition of SpecialCase2 case   |</span>
00349 <span class="comment">  |________________________________________________________| */</span>
00350 
<a name="l00351"></a><a class="code" href="headers_8h.html#a15">00351</a> <span class="keywordtype">void</span> <a class="code" href="headers_8h.html#a15">RestofSoln</a> (<span class="keywordtype">int</span> Mred, <span class="keywordtype">int</span> Nred, <span class="keywordtype">int</span> NextToFind, <a class="code" href="structMATRIX.html">MATRIX</a> *block,
00352                  <a class="code" href="structMATRIX.html">MATRIX</a> *g, <a class="code" href="structMATRIX.html">MATRIX</a> *bred, <a class="code" href="structMATRIX.html">MATRIX</a> *Ared, <span class="keywordtype">int</span> *Tackon,
00353                  <span class="keywordtype">int</span> *FirstOK, FILE *check)
00354 {
00355 <span class="keywordtype">int</span>     i, j, k, <span class="comment">/*Loop counters                                      */</span>
00356         X, Y,    <span class="comment">/*Position markers, keeping track of the current     */</span>
00357                  <span class="comment">/*column to be subbed in for and which one to sub in */</span>
00358         nullity, <span class="comment">/*Nullity sent to mat_null for dependent rows        */</span>
00359         Newtack[M-N], <span class="comment">/*Temp array for tackon, sent to the next level of   */</span>
00360                  <span class="comment">/*recursion                                          */</span>
00361        *Changed; <span class="comment">/*Temp array for FirstOK, sent to the next level of  */</span>
00362                  <span class="comment">/*recursion                                          */</span>
00363 <a class="code" href="structMATRIX.html">MATRIX</a>  *n,      <span class="comment">/*null space vectors                                 */</span>
00364         *Asub;   <span class="comment">/*submatrix from square submatrix is found           */</span>
00365 <span class="keywordtype">float</span> K2;
00366 
00367 Changed = (<span class="keywordtype">int</span> *) malloc (  Nred * (<span class="keyword">sizeof</span>( <span class="keywordtype">int</span> )) );
00368  fprintf(check, <span class="stringliteral">"entering RestOfSoln\n"</span>);
00369 <span class="comment">/*Increment NextToFind so looking for next solution */</span>
00370 NextToFind++;
00371 X = NextToFind -1;
00372 
00373 <span class="comment">/*Change FirstOK if a previously 0 value of g for a column in first  */</span>
00374 <span class="comment">/*blocking pattern has become nonzero                                */</span>
00375 <span class="keywordflow">for</span> (i=0; i&lt;Nred; i++)
00376   <span class="keywordflow">if</span> ((!FirstOK[i]) &amp;&amp; 
00377   (fabs(g-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind-1][(<span class="keywordtype">int</span>) block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind-1][i]]) &gt; <a class="code" href="general_8h.html#a13">SMALL</a>))
00378   {
00379      FirstOK[i] = <a class="code" href="general_8h.html#a17">TRUE</a>;
00380   }
00381 
00382 <span class="keywordflow">for</span> (j=0; j&lt;Nred; j++)
00383 {
00384   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00385      <span class="keywordflow">if</span> (j==0) fprintf(check,<span class="stringliteral">"\nFIRST OK:  "</span>);
00386      fprintf(check,<span class="stringliteral">" %d "</span>, FirstOK[j]);
00387      <span class="keywordflow">if</span> (j==Nred-1) fprintf(check,<span class="stringliteral">"\n\n"</span>);
00388   }
00389   Changed[j] = FirstOK[j];
00390 }
00391 
00392 <span class="keywordflow">while</span> ((X&lt;(Mred-Nred))&amp;&amp;(!<a class="code" href="fsp_8c.html#a1">SystemComplete</a>))
00393     {
00394     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) 
00395       fprintf(check,<span class="stringliteral">"\n Next Solution to find is: %d \n"</span>, NextToFind);
00396     
00397 
00398     <span class="comment">/*Set up next asub comparing the next remaining column to be subbed */</span>
00399     <span class="comment">/*in with the blocking pattern for that level of recursion          */</span>
00400     Asub = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(Nred,Nred+1);
00401     <span class="keywordflow">for</span> (i=0; i&lt;Nred; i++)
00402         <span class="keywordflow">for</span> (j=0; j&lt;Nred; j++)
00403             Asub-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][(<span class="keywordtype">int</span>)block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(NextToFind-1)][i]];
00404     <span class="keywordflow">for</span> (j=0; j&lt;Nred; j++)
00405       Asub-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][Nred] = Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][Tackon[X]];
00406     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"Asub"</span>, Asub);
00407 
00408     n = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(Nred+1,1);
00409     <a class="code" href="matrix_8h.html#a24">mat_null</a>(Asub, &amp;nullity, n, &amp;K2);
00410     <a class="code" href="matrix_8h.html#a8">mat_free</a>(Asub);
00411     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"n"</span>, n);
00412     Y=0;
00413 
00414     <span class="comment">/*Loop which compares column to be subbed in with current blocking */</span>
00415     <span class="comment">/*pattern for dependency, if dependent it completes swap and valid */</span>
00416     <span class="keywordflow">while</span> ((Y&lt;(Nred))&amp;&amp;(!<a class="code" href="fsp_8c.html#a1">SystemComplete</a>))
00417         {
00418         <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00419           fprintf(check,<span class="stringliteral">"\n Compare column %d with %d \n"</span>, Tackon[X], 
00420                                         (<span class="keywordtype">int</span>)block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(NextToFind-1)][Y]);
00421           fprintf(check, <span class="stringliteral">"\n it is %f \n"</span>,fabs(n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[Y][0]));
00422         }
00423         <span class="keywordflow">if</span> ((fabs(n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[Y][0]) &gt; <a class="code" href="general_8h.html#a13">SMALL</a>) &amp;&amp; (FirstOK[Y]))
00424             {
00425             <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) 
00426               fprintf(check, <span class="stringliteral">"*************** %d **************** \n"</span>, 
00427                                                                 NextToFind);
00428             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check,<span class="stringliteral">"\n** block"</span>,block);
00429             fprintf(check,<span class="stringliteral">"** Tackon="</span>);
00430             <span class="keywordflow">for</span>(j=0; j&lt;(M-N); j++)
00431               fprintf(check,<span class="stringliteral">"%d "</span>,Tackon[j]);
00432             fprintf(check,<span class="stringliteral">"\nX=%d Y=%d\n"</span>,X,Y);
00433 
00434             <span class="keywordflow">for</span> (i=0; i&lt;Nred;i++)
00435                 block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][i]=block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(NextToFind-1)][i];
00436             Newtack[0]=(<span class="keywordtype">int</span>)block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][Y];
00437             block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][Y] =Tackon[X];
00438             <span class="keywordflow">for</span> (i=0; i&lt;X; i++)
00439                 Newtack[i+1]=Tackon[i];
00440             <span class="keywordflow">for</span> (j=X+1; j&lt;(Mred-Nred); j++) {
00441                 Newtack[j]=Tackon[j];   
00442             }
00443 
00444             fprintf(check,<span class="stringliteral">"** Newtack="</span>);
00445             <span class="keywordflow">for</span>(j=0; j&lt;(Mred-Nred); j++)
00446               fprintf(check,<span class="stringliteral">"%d "</span>,Newtack[j]);
00447             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check,<span class="stringliteral">"\n** block"</span>,block);
00448             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check,<span class="stringliteral">"** g"</span>,g);
00449 
00450             <a class="code" href="headers_8h.html#a16">BLOCK_COL_FIND_X</a>(Newtack,g-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind], block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind], 
00451                                                 bred,Ared,Mred,Nred,check);
00452 
00453             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check,<span class="stringliteral">"** block"</span>,block);
00454             <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check,<span class="stringliteral">"** g"</span>,g);
00455 
00456             <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) 
00457               fprintf(check, <span class="stringliteral">"\n it will be %f \n"</span>,fabs(g-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(NextToFind)] 
00458                                 [(<span class="keywordtype">int</span>)block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][Y]]));
00459 
00460             <span class="comment">/*Check to ensure the newly created g vector is independent */</span>
00461             <span class="comment">/*of previously created ones in branch                      */</span>
00462             <span class="keywordflow">if</span> (fabs(g-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(NextToFind)][(<span class="keywordtype">int</span>)block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][Y]]) &gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00463                 <span class="keywordflow">if</span> (NextToFind &lt;(Mred-Nred))
00464                     {
00465                     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00466                         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"block"</span>, block);
00467                         <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"solutions"</span>, g);
00468                         <span class="keywordflow">for</span> (i=0; i&lt;(Mred-Nred); i++)
00469                             fprintf(check, <span class="stringliteral">"Ord %d"</span>,Newtack[i]);
00470                     }
00471                     <span class="comment">/*if more g vectors are needed it goes to next level*/</span>
00472                     <a class="code" href="headers_8h.html#a15">RestofSoln</a>(Mred, Nred, NextToFind, block, g, bred, Ared, 
00473                                Newtack, Changed, check);
00474                     }
00475                 <span class="keywordflow">else</span>
00476                     {
00477                     <a class="code" href="fsp_8c.html#a1">SystemComplete</a> = <a class="code" href="general_8h.html#a17">TRUE</a>;
00478                     }
00479             <span class="keywordflow">if</span> (!<a class="code" href="fsp_8c.html#a1">SystemComplete</a>)
00480                 block-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[NextToFind][Y]=Newtack[0];
00481             <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) fprintf(check, <span class="stringliteral">"\n **************************** \n"</span>);
00482             }
00483         Y++;
00484         }
00485    <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
00486     X++;
00487     }
00488 
00489   free (Changed);
00490 }
00491 
00492 
00493 
00494 <span class="comment">/* ________________________________________________________</span>
00495 <span class="comment">  | name:    Dependency                                    |</span>
00496 <span class="comment">  | description:  Returns whether or not the given two     |</span>
00497 <span class="comment">  |               columns are dependent upon each other or |</span>
00498 <span class="comment">  |               not.  Essential for detection of an      |</span>
00499 <span class="comment">  |               occurance of SpecialCase1.               |</span>
00500 <span class="comment">  |                                                        |</span>
00501 <span class="comment">  |                                                        |</span>
00502 <span class="comment">  | inputs:  Aorig, SLRow, Nred, first, second             |</span>
00503 <span class="comment">  | outputs: whether columns SLRow[first] and SLRow[second]|</span>
00504 <span class="comment">  |          are dependent                                 |</span>
00505 <span class="comment">  |________________________________________________________|</span>
00506 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00507 <span class="comment">  |  g fries     3/95      Created                         |</span>
00508 <span class="comment">  |________________________________________________________| */</span>
00509 
<a name="l00510"></a><a class="code" href="fsp_8c.html#a6">00510</a> <span class="keywordtype">int</span> <a class="code" href="fsp_8c.html#a6">Dependency</a> (<a class="code" href="structMATRIX.html">MATRIX</a> *Atemp, <span class="keywordtype">int</span> *SLRow, <span class="keywordtype">int</span> Nred, <span class="keywordtype">int</span> first, <span class="keywordtype">int</span> second)
00511 {
00512 <span class="keywordtype">int</span> i,STOP;
00513 <span class="keywordtype">float</span> devidor;
00514 i=0;
00515 devidor=0;
00516 STOP=<a class="code" href="general_8h.html#a18">FALSE</a>;
00517 <span class="keywordflow">while</span> (i&lt;Nred &amp;&amp; !STOP)
00518     <span class="keywordflow">if</span> ((fabs(Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][first])&lt;<a class="code" href="general_8h.html#a13">SMALL</a>) &amp;&amp; 
00519                                 (fabs(Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][second])&lt;<a class="code" href="general_8h.html#a13">SMALL</a>))
00520         i++;
00521     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((fabs(Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][first])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>) &amp;&amp;
00522                                 (fabs(Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][second])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>))
00523         <span class="keywordflow">if</span> (devidor==0)
00524             {
00525             devidor= (Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][first]/Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][second]);
00526             i++;
00527             }
00528         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][first]-
00529                         (Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][second]*devidor))&lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00530             i++;
00531         <span class="keywordflow">else</span>
00532             STOP=<a class="code" href="general_8h.html#a17">TRUE</a>;
00533     <span class="keywordflow">else</span>
00534         STOP=<a class="code" href="general_8h.html#a17">TRUE</a>;
00535 <span class="keywordflow">if</span> (STOP)
00536     <span class="keywordflow">return</span>(<a class="code" href="general_8h.html#a18">FALSE</a>);
00537 <span class="keywordflow">else</span>
00538     <span class="keywordflow">return</span>(<a class="code" href="general_8h.html#a17">TRUE</a>);
00539 }
00540 
00541 
00542 
00543 
00544 <span class="comment">/* ________________________________________________________</span>
00545 <span class="comment">  | name:    BLOCK_COL_FIND_X                              |</span>
00546 <span class="comment">  | description:  This procedure calculates a g vector for |</span>
00547 <span class="comment">  |               a given square blocking pattern.         |</span>
00548 <span class="comment">  |                                                        |</span>
00549 <span class="comment">  |                                                        |</span>
00550 <span class="comment">  | inputs:  Tackon, g, block, bred, Ared, Mred, Nred      |</span>
00551 <span class="comment">  | outputs: new g vector                                  |</span>
00552 <span class="comment">  |________________________________________________________|</span>
00553 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00554 <span class="comment">  |  k morganson 8/94      Created                         |</span>
00555 <span class="comment">  |  g fries     2/95      Adaption for new blocking       |</span>
00556 <span class="comment">  |                        strategy (keeping blocked col)  |</span>
00557 <span class="comment">  |________________________________________________________| */</span>
00558 
<a name="l00559"></a><a class="code" href="headers_8h.html#a16">00559</a> <a class="code" href="headers_8h.html#a16">BLOCK_COL_FIND_X</a>        (<span class="keywordtype">int</span> *Tackon, <span class="keywordtype">float</span> *g, <span class="keywordtype">float</span> *block,
00560                          <a class="code" href="structMATRIX.html">MATRIX</a> *b, <a class="code" href="structMATRIX.html">MATRIX</a> *A, 
00561                          <span class="keywordtype">int</span> Mred, <span class="keywordtype">int</span> Nred, FILE *check)
00562 {
00563 <span class="keywordtype">int</span> r, I, i, j,k;
00564 <span class="keywordtype">float</span>  *blocktemp, temp;
00565 <a class="code" href="structMATRIX.html">MATRIX</a> *Atemp, *gtemp, *btemp;
00566 
00567 Atemp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(Nred,Nred);
00568 btemp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(Nred,1);
00569 blocktemp = (<span class="keywordtype">float</span> *) malloc( Nred * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) );
00570 
00571 <span class="keywordflow">for</span> (i=0; i&lt;Nred; i++)
00572    btemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=b-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00573 <span class="comment">/* the columns blocked need to be listed from smallest to largest */</span>
00574 <span class="keywordflow">for</span> (i=0; i&lt;(Nred); i++)
00575    blocktemp[i]=(<span class="keywordtype">int</span>)block[i];  
00576 
00577 
00578 <span class="keywordflow">for</span> (i=(Nred-1); i&gt;0; i--)
00579    <span class="keywordflow">for</span> (j=i-1; j&gt;=0; j--)
00580       <span class="keywordflow">if</span> (blocktemp[i]&lt;blocktemp[j])
00581          {
00582          temp=blocktemp[i];
00583          blocktemp[i]=blocktemp[j];
00584          blocktemp[j]=temp;
00585          }
00586 
00587 
00588 fprintf(<a class="code" href="fsp_8c.html#a3">gcheck</a>,<span class="stringliteral">"Mred=%d Nred=%d\n"</span>,Mred,Nred);
00589    k=0; I=0;
00590    <span class="keywordflow">for</span> (i=0; i&lt;Mred; i++) {
00591       <span class="keywordflow">if</span> (blocktemp[k] == i)
00592          {
00593          <span class="keywordflow">for</span> (j=0; j&lt;Nred; j++)
00594             Atemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k] = A-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
00595          k++;
00596          }
00597       <span class="keywordflow">else</span>
00598         I++;
00599    }
00600 <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(check, <span class="stringliteral">"asqr"</span>, Atemp);
00601 
00602 
00603 <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(Atemp);
00604 
00605 gtemp = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Atemp, btemp);
00606 
00607 <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a2">DEBUG_FSP</a>) {
00608   fprintf(check, <span class="stringliteral">"\n gvector"</span>);
00609   <span class="keywordflow">for</span> (i=0; i&lt;Nred; i++)
00610     fprintf(check, <span class="stringliteral">"%f    "</span>, gtemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]);
00611 }
00612 
00613 <span class="comment">/*Now add a zero to where column was blocked */</span>
00614 j=0;
00615 I=0;
00616 <span class="keywordflow">for</span> (i=0; i&lt;Nred; i++)
00617    g[(<span class="keywordtype">int</span>)blocktemp[i]]=gtemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00618 
00619 <span class="keywordflow">for</span> (j=0; j&lt;(Mred-Nred); j++)  
00620       g[Tackon[j]]=0.0e0;
00621 
00622  fprintf(check,<span class="stringliteral">"\n** BLOCK_COL_FIND_X grow="</span>); 
00623  <span class="keywordflow">for</span> (j=0; j&lt; N; j++)
00624    fprintf(check, <span class="stringliteral">"%f    "</span>,g[j]);
00625 
00626 <a class="code" href="matrix_8h.html#a8">mat_free</a>(Atemp);
00627 <a class="code" href="matrix_8h.html#a8">mat_free</a>(gtemp);
00628 <a class="code" href="matrix_8h.html#a8">mat_free</a>(btemp);
00629 free (blocktemp);
00630 }
00631 
00632 
00633 
00634 <span class="comment">/* ________________________________________________________</span>
00635 <span class="comment">  | name:    ReduceA                                       |</span>
00636 <span class="comment">  | description:  Restricted work space motions can be     |</span>
00637 <span class="comment">  |               identified by rows of the A which only   |</span>
00638 <span class="comment">  |               have one nonzero element.  Since the     |</span>
00639 <span class="comment">  |               corresponding column must be present in  |</span>
00640 <span class="comment">  |               all final joint space solutions, the     |</span>
00641 <span class="comment">  |               appropriate joint space motion will be   |</span>
00642 <span class="comment">  |               calculated before any redundancy         |</span>
00643 <span class="comment">  |               resolution is performed, and the         |</span>
00644 <span class="comment">  |               appropriate motions and joints will be   |</span>
00645 <span class="comment">  |               removed from the work space and A        |</span>
00646 <span class="comment">  |               respectively.  Also such cases as        |</span>
00647 <span class="comment">  |               dependent rows, and SpecialCase1 must be |</span>
00648 <span class="comment">  |               identified and dealt with.               |</span>
00649 <span class="comment">  |                                                        |</span>
00650 <span class="comment">  |                                                        |</span>
00651 <span class="comment">  | inputs:  Tackon, g, block, bred, Ared, Mred, Nred      |</span>
00652 <span class="comment">  | outputs: new g vector                                  |</span>
00653 <span class="comment">  |________________________________________________________|</span>
00654 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00655 <span class="comment">  |  k morganson 8/94      Created                         |</span>
00656 <span class="comment">  |  g fries     2/95      Adaption for new blocking       |</span>
00657 <span class="comment">  |                        strategy and handling of dep row|</span>
00658 <span class="comment">  |  g fries     3/95      Recognition and handling of     |</span>
00659 <span class="comment">  |                        SpecialCase1 and cont reduction |</span>
00660 <span class="comment">  |  c hacker    9/95      the new b was wrong, corrected  |</span>
00661 <span class="comment">  |  c hacer    10/95      dependent rows bug fixed        |</span>
00662 <span class="comment">  |________________________________________________________| */</span>
00663 
<a name="l00664"></a><a class="code" href="headers_8h.html#a17">00664</a> <a class="code" href="headers_8h.html#a17">ReduceA</a>(<a class="code" href="structSolutions.html">Solutions</a> *FSP_data, <a class="code" href="structMATRIX.html">MATRIX</a> *Aorig, <a class="code" href="structMATRIX.html">MATRIX</a> *Ared, <a class="code" href="structMATRIX.html">MATRIX</a> *borig,
00665         <a class="code" href="structMATRIX.html">MATRIX</a> *bred, <span class="keywordtype">int</span>* ColElim,<span class="keywordtype">int</span>* RowElim,
00666         <span class="keywordtype">int</span> *NumSpg, <a class="code" href="structMATRIX.html">MATRIX</a> *Specialg)
00667 
00668 {
00669 <span class="keywordtype">int</span> i,j,k,m,r,p,   <span class="comment">/*loop counters                                      */</span>
00670     StillChecking, <span class="comment">/*flag to mark when all nonredundancies are gone     */</span>
00671     Stop,Stop2,    <span class="comment">/*Used as loop flag in detection for SpecialCase1&amp;2  */</span>
00672     ClassANum,     <span class="comment">/*Number of ClassificationA columns, for SpecialCase2*/</span>
00673     reference,     <span class="comment">/*Reference position used for SpecialCase2 row       */</span>
00674     LastNred,      <span class="comment">/*Check if all rows have been looked at              */</span>
00675     nullity,       <span class="comment">/*Used in mat_null when determining depend rows      */</span>
00676     nul_count,     <span class="comment">/*Loop counter for dependent rows                    */</span> 
00677     Restriction,   <span class="comment">/*num of joints which contrib to a work space d.o.f. */</span>
00678     DoneRed,       <span class="comment">/*Keeps track if reduction is done, loop has executed*/</span>
00679                    <span class="comment">/*without any reduction                              */</span>
00680     *SLRow,        <span class="comment">/*Stands for Still Left Row, stores remaining non    */</span>
00681                    <span class="comment">/*eliminated rows in sequence                        */</span>
00682     *SLCol,        <span class="comment">/*Stands for Still Left Column, stores remaining non */</span>
00683                    <span class="comment">/*eliminated columns in sequence                     */</span>
00684     *ClassA,       <span class="comment">/*Array used to store ClassificationA columns        */</span>
00685     count,count2,  <span class="comment">/*Position markers when copying over SLCol when the  */</span>
00686     position,      <span class="comment">/*  SpecialCase1 has been found                      */</span>
00687     nonzerocol,    <span class="comment">/*Number of nonzero col when check for SpecialCase1  */</span>
00688     *Nonzero,      <span class="comment">/*Stores values of nonzero col when check for SC1    */</span>
00689     NonZeroCol,    <span class="comment">/*Column which has nonzero element for give row      */</span>
00690     Flag,          <span class="comment">/*Used in SC2 for an undefined beta value            */</span>
00691     Goin;          <span class="comment">/*"Go in" for entance into ClassA for SC2            */</span>
00692 <span class="keywordtype">float</span> btemp[N],    <span class="comment">/*Holds the b vector as it is modified by backsub    */</span>
00693       K2,          <span class="comment">/*Matrix condition number:  sv_max/sv_min            */</span>
00694       *Constant,   <span class="comment">/*Constant values used when comparing ClassificationA*/</span>
00695                    <span class="comment">/*columns                                            */</span>
00696       beta;        <span class="comment">/*Value used for determining SpecialCase2            */</span>
00697 <a class="code" href="structMATRIX.html">MATRIX</a>  *n,        <span class="comment">/*null space vectors                                 */</span>
00698         *Atrans,   <span class="comment">/*Transpose matrix used when looking for depend rows */</span>
00699         *AElim;    <span class="comment">/*Matrix used to find null vectors when dealing with */</span>
00700                    <span class="comment">/* SpecialCase1                                      */</span>
00701 
00702      <span class="comment">/* allocation of memory */</span>
00703 SLRow   = (<span class="keywordtype">int</span>   *) malloc ( (N) * (<span class="keyword">sizeof</span>( <span class="keywordtype">int</span> )) );
00704 SLCol   = (<span class="keywordtype">int</span>   *) malloc ( (M) * (<span class="keyword">sizeof</span>( <span class="keywordtype">int</span> )) );
00705 Nonzero = (<span class="keywordtype">int</span>   *) malloc ( (M) * (<span class="keyword">sizeof</span>( <span class="keywordtype">int</span> )) );
00706 ClassA  = (<span class="keywordtype">int</span>   *) malloc ( (M) * (<span class="keyword">sizeof</span>( <span class="keywordtype">int</span> )) );
00707 Constant= (<span class="keywordtype">float</span> *) malloc ( (N) * (<span class="keyword">sizeof</span>( <span class="keywordtype">float</span> )) );
00708 
00709 printf(<span class="stringliteral">"here0 N=%d M=%d\n"</span>,N,M);
00710 
00711      <span class="comment">/* initialize variables */</span>
00712 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a> = N;    <span class="comment">/* number of rows in the reduced A       */</span>
00713 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a> = M;    <span class="comment">/* number of columns in the reduced A    */</span>
00714 *NumSpg=0;
00715 <span class="keywordflow">for</span> (i=0; i&lt;N; i++)
00716    {
00717    SLRow[i]=i;
00718    RowElim[i]=0;
00719    btemp[i]=borig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00720    }
00721 <span class="keywordflow">for</span> (i=0; i&lt;M; i++)
00722    {
00723    SLCol[i]=i;
00724    FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso10">Xelim</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=0.0;
00725    ColElim[i]=0;
00726    }
00727 DoneRed=<a class="code" href="general_8h.html#a18">FALSE</a>;
00728 
00729 
00730      <span class="comment">/* start reduction  */</span>
00731 <span class="keywordflow">while</span> (!DoneRed)
00732     {
00733     DoneRed=<a class="code" href="general_8h.html#a17">TRUE</a>;
00734     StillChecking = 1; 
00735      <span class="comment">/* Check each row for the number of nonzero elements.  If only one */</span>
00736      <span class="comment">/* element is nonzero, solve for the joint space motion, and       */</span>
00737      <span class="comment">/* modify the b vector so that the appropriate row and column      */</span>
00738      <span class="comment">/* can be eliminated from the A.  After a row is eliminated        */</span>
00739      <span class="comment">/* the remaining A must be rechecked for any new restrictions      */</span>
00740     <span class="keywordflow">while</span> (StillChecking)
00741         {
00742         LastNred = FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>;
00743         <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; i++)
00744             {
00745             j=-1;
00746             Restriction=0;
00747 
00748             <span class="comment">/* check for nonzero row elements */</span>
00749             <span class="keywordflow">while</span> ((j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1)) &amp;&amp; (Restriction &lt; 2)) 
00750                 {
00751                 j++;
00752                 <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[j]]) &gt; <a class="code" href="general_8h.html#a13">SMALL</a>)
00753                     {
00754                     Restriction++;
00755                     NonZeroCol = j;
00756                     }
00757                 }
00758 
00759             <span class="comment">/* if a row only has one nonzero element, eliminate it from */</span>
00760             <span class="comment">/* the A                                             */</span>
00761             <span class="keywordflow">if</span> ((Restriction == 1) &amp;&amp; (RowElim[SLRow[i]] != 1))
00762                 {
00763 <span class="comment">/* HERE CJH */</span>  FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso10">Xelim</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLCol[NonZeroCol]][0]=(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)?
00764                       0.0:btemp[SLRow[i]]/Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[NonZeroCol]];
00765                 <span class="keywordflow">for</span> (k=0; k&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; k++)
00766                     btemp[SLRow[k]]= btemp[SLRow[k]]-Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[k]][SLCol
00767                         [NonZeroCol]]*FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso10">Xelim</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLCol[NonZeroCol]][0];
00768                 ColElim[SLCol[NonZeroCol]]=1;
00769                 RowElim[SLRow[i]]=1;
00770                 <span class="keywordflow">for</span> (j=NonZeroCol; j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1); j++)
00771                     SLCol[j]=SLCol[j+1];
00772                 <span class="keywordflow">for</span> (j=i; j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1); j++)
00773                     SLRow[j]=SLRow[j+1];
00774                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>--;
00775                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>--;
00776                 }
00777             <span class="keywordflow">else</span>            <span class="comment">/* row of all zeros, also eliminated */</span>
00778             <span class="keywordflow">if</span> ((Restriction == 0) &amp;&amp; (RowElim[SLRow[i]] != 1))
00779                 {
00780                 RowElim[SLRow[i]]=1;
00781                 <span class="keywordflow">for</span> (j=i; j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1); j++)
00782                     SLRow[j]=SLRow[j+1];
00783                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>--;
00784                 }
00785             }
00786         <span class="keywordflow">if</span> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a> == LastNred)
00787         StillChecking = 0;
00788         }
00789 
00790 
00791       <span class="comment">/* check for columns of zeros */</span>
00792     <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00793         {
00794         j=0;
00795         <span class="keywordflow">while</span> ((j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>) &amp;&amp; (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[j]][SLCol[i]]) &lt;
00796                                                                         <a class="code" href="general_8h.html#a13">SMALL</a>))
00797             j++;
00798         <span class="keywordflow">if</span> (j==FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>)
00799             { 
00800             ColElim[SLCol[i]]=1;
00801             <span class="keywordflow">for</span> (j=i; j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1); j++)
00802                 SLCol[j]=SLCol[j+1];
00803             FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>--;
00804             i--;
00805             }
00806         }
00807 
00808      <span class="comment">/* check for dependent rows */</span>
00809 <span class="keywordflow">if</span> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a> !=0)
00810     {
00811     n      = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1);
00812     Atrans = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>);
00813     <span class="keywordflow">for</span> (i=0; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; i++)
00814         <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; j++)
00815             Atrans-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[j]];
00816     <span class="keywordflow">for</span> (i=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>; i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; i++)
00817         <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; j++) Atrans-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = 0;
00818 
00819     <a class="code" href="matrix_8h.html#a24">mat_null</a>(Atrans, &amp;nullity, n, &amp;K2);
00820     nullity=nullity+FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>;
00821 
00822 
00823     <span class="comment">/* This is where the b's should be checked and determined if they */</span>
00824     <span class="comment">/* are dependent as well.  If they are not, an error message      */</span>
00825     <span class="comment">/* should be displayed and the system should stop.                */</span>
00826     <span class="comment">/* This is probably the best place to do this, instead of at the  */</span>
00827     <span class="comment">/* bottom of solution_generator(), since it has the information.  */</span>
00828     nul_count=0;
00829     <span class="keywordflow">while</span> (nul_count &lt; nullity)
00830         {
00831         i=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a> +nul_count;
00832         j=0;
00833         <span class="keywordflow">while</span> ((j!=(n-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>))&amp;&amp;(fabs(n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i]) &lt; <a class="code" href="general_8h.html#a13">SMALL</a>))
00834             j++;
00835         <span class="keywordflow">if</span> ((RowElim[SLRow[j]] != 1)&amp;&amp;(j!=(n-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>)))  
00836             {
00837             RowElim[SLRow[j]] = 2;
00838             <span class="keywordflow">for</span> (k=j; k&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1); k++)
00839                 SLRow[k]=SLRow[k+1];
00840             FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>--;
00841             }
00842         nul_count++;
00843         }
00844     <a class="code" href="matrix_8h.html#a8">mat_free</a>(Atrans);
00845     <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
00846     }
00847 
00848 
00849      <span class="comment">/* check for SpecialCase1 */</span>
00850     <span class="keywordflow">for</span> (i=0;(i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>);i++)
00851         <span class="keywordflow">if</span> (fabs(btemp[SLRow[i]])&lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00852             {
00853             nonzerocol=0;
00854             j=0;
00855             Stop =<a class="code" href="general_8h.html#a18">FALSE</a>;
00856             <span class="keywordflow">while</span> (j&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1) &amp;&amp; !Stop)
00857                 <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[j]])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00858                     {
00859                     k=j+1;
00860                     <span class="keywordflow">while</span> (!Stop &amp;&amp; (k&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>))
00861                         <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[k]])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00862                             <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a6">Dependency</a>(Aorig, SLRow, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>,
00863                                                         SLCol[j], SLCol[k]))
00864                                 k++;
00865                             <span class="keywordflow">else</span>
00866                                 Stop=<a class="code" href="general_8h.html#a17">TRUE</a>;
00867                         <span class="keywordflow">else</span>
00868                             k++;
00869                     Nonzero[nonzerocol]=SLCol[j];
00870                     nonzerocol++;
00871                     j++;
00872                     }       
00873                 <span class="keywordflow">else</span>
00874                     j++;
00875             <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1)]])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00876                 {
00877                 Nonzero[nonzerocol]=SLCol[(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-1)];
00878                 nonzerocol++;
00879                 }
00880             <span class="keywordflow">if</span> (nonzerocol==1)
00881                 Stop=<a class="code" href="general_8h.html#a17">TRUE</a>;
00882             <span class="keywordflow">if</span> (!Stop) <span class="comment">/* Discovered a SpecialCase1 */</span>
00883                 {
00884                 DoneRed=<a class="code" href="general_8h.html#a18">FALSE</a>;
00885                 <span class="keywordflow">for</span> (r=0;r&lt;nonzerocol;r++)
00886                    ColElim[Nonzero[r]]=2;
00887                 count=0;
00888                 count2=0;
00889                 <span class="keywordflow">for</span> (position=0; position&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; position++)
00890                     <span class="keywordflow">if</span> (SLCol[position]!=Nonzero[count2])
00891                         {
00892                         SLCol[count]=SLCol[position];
00893                         count++;
00894                         }
00895                     <span class="keywordflow">else</span>
00896                         count2++;
00897                 <span class="comment">/* Construct new g matrix */</span>
00898                 AElim = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1, nonzerocol);
00899                 n=<a class="code" href="matrix_8h.html#a25">mat_malloc</a>(nonzerocol, nonzerocol-1);
00900                 <span class="keywordflow">for</span> (r=0; r&lt;nonzerocol;r++)
00901                     AElim-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][r]=Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][Nonzero[r]];
00902                 <a class="code" href="matrix_8h.html#a24">mat_null</a>(AElim, &amp;nullity, n, &amp;K2);
00903 
00904                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-nonzerocol;
00905                 RowElim[SLRow[i]]=1;
00906                 <span class="keywordflow">for</span> (r=i; r&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1); r++)
00907                     SLRow[r]=SLRow[r+1];
00908                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>--;
00909                 <span class="keywordflow">for</span> (m=0; m&lt;(nonzerocol-1);m++)
00910                     {
00911                     <span class="keywordflow">for</span> (r=0; r&lt;M; r++)
00912                         Specialg -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[*NumSpg][r]=0;
00913                     <span class="keywordflow">for</span> (r=0; r&lt;nonzerocol;r++)
00914                         Specialg -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[*NumSpg][Nonzero[r]]=n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[r][m];
00915                     *NumSpg=*NumSpg+1;
00916                     }
00917                 <a class="code" href="matrix_8h.html#a8">mat_free</a>(AElim);
00918                 <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
00919                 }
00920             }
00921 
00922     <span class="comment">/*Check for SpecialCase2*/</span>
00923     i=0;
00924     Stop2=<a class="code" href="general_8h.html#a18">FALSE</a>;
00925     <span class="keywordflow">while</span> ((i&lt;(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1)) &amp;&amp; (!Stop2))
00926         {
00927         j=i+1;
00928         <span class="keywordflow">while</span> ((j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>) &amp;&amp; (!Stop2))
00929             {
00930             Stop=<a class="code" href="general_8h.html#a18">FALSE</a>;
00931             Flag=<a class="code" href="general_8h.html#a18">FALSE</a>;
00932             <span class="keywordflow">if</span> (fabs(btemp[SLRow[i]])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00933                 beta= btemp[SLRow[j]]/ btemp[SLRow[i]];
00934             <span class="keywordflow">else</span>
00935                 Flag=<a class="code" href="general_8h.html#a17">TRUE</a>;
00936             ClassANum=0;
00937             k=0;
00938             reference=i;
00939             <span class="keywordflow">while</span> ((!Stop) &amp;&amp; (k&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>))
00940                 {
00941                 Goin=<a class="code" href="general_8h.html#a18">FALSE</a>;
00942                 <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[k]])&lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00943                     <span class="keywordflow">if</span> (!Flag)
00944                         Goin=<a class="code" href="general_8h.html#a17">TRUE</a>;
00945                     <span class="keywordflow">else</span>;
00946                 <span class="keywordflow">else</span>
00947                     {
00948                     <span class="keywordflow">if</span> (fabs((Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[j]][SLCol[k]]/
00949                             Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[i]][SLCol[k]])-beta)&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00950                         Goin=<a class="code" href="general_8h.html#a17">TRUE</a>;
00951                     <span class="keywordflow">if</span> (Flag)
00952                         Goin=<a class="code" href="general_8h.html#a17">TRUE</a>;
00953                     }
00954                 <span class="keywordflow">if</span> (Goin)
00955                     {
00956                     ClassA[ClassANum]=SLCol[k];
00957                     <span class="keywordflow">if</span> (ClassANum==0)
00958                         {
00959                         <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[0]])&lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00960                             {
00961                             reference=j;
00962                             <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[0]])
00963                                                                         &lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00964                                 Stop=<a class="code" href="general_8h.html#a17">TRUE</a>;
00965                             }
00966                         <span class="keywordflow">if</span> (!Stop)
00967                             <span class="keywordflow">for</span> (r=0;r&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>;r++)
00968                                 Constant[r]=Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[r]][ClassA[0]]/
00969                                         Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[0]];
00970                         }
00971                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[ClassANum]])
00972                                                                         &lt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00973                         Stop=<a class="code" href="general_8h.html#a17">TRUE</a>;
00974                     <span class="keywordflow">else</span>
00975                         {
00976                         r=0;
00977                         <span class="keywordflow">while</span> ((r&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>) &amp;&amp; (!Stop))
00978                             {
00979                             <span class="keywordflow">if</span> (fabs((Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[r]][ClassA[ClassANum]]/
00980                                 Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[ClassANum]])
00981                                                            -Constant[r])&gt;<a class="code" href="general_8h.html#a13">SMALL</a>)
00982                                 Stop=<a class="code" href="general_8h.html#a17">TRUE</a>;
00983                             r++;
00984                             }
00985                         }
00986                     ClassANum++;
00987                     }
00988                 k++;
00989                 }
00990             <span class="keywordflow">if</span> (!Stop)
00991                 Stop2=<a class="code" href="general_8h.html#a17">TRUE</a>;
00992             j++;
00993             }
00994         i++;
00995         }
00996     <span class="keywordflow">if</span> (Stop2)
00997         {
00998         DoneRed=<a class="code" href="general_8h.html#a18">FALSE</a>;
00999         <span class="comment">/* Construct new g matrix */</span>
01000         AElim = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1, ClassANum);
01001         n= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(ClassANum, ClassANum-1);
01002         <span class="keywordflow">for</span> (p=0; p&lt;ClassANum;p++)
01003             AElim-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][p]=Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[SLRow[reference]][ClassA[p]];
01004         <a class="code" href="matrix_8h.html#a24">mat_null</a>(AElim, &amp;nullity, n, &amp;K2);
01005         <span class="keywordflow">for</span> (p=0; p&lt;(ClassANum-1);p++)
01006             {
01007             <span class="keywordflow">for</span> (r=0; r&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; r++)
01008                 Specialg -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[*NumSpg][r]=0;
01009             <span class="keywordflow">for</span> (r=0; r&lt;ClassANum;r++)
01010                 Specialg -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[*NumSpg][ClassA[r]]=n-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[r][p];
01011             *NumSpg=*NumSpg+1;
01012             }
01013         FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>--;
01014         RowElim[SLRow[reference]]=1;
01015         <span class="keywordflow">for</span> (r=0;r&lt;ClassANum;r++)
01016             ColElim[ClassA[r]]=3;
01017         <span class="keywordflow">for</span> (r=reference;r&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>;r++)
01018             SLRow[r]=SLRow[(r+1)];
01019         count=0;
01020         count2=0;
01021         <span class="keywordflow">for</span> (position=0; position&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>; position++)
01022             <span class="keywordflow">if</span> (SLCol[position]!=ClassA[count2])
01023                 {
01024                 SLCol[count]=SLCol[position];
01025                 count++;
01026                 }
01027             <span class="keywordflow">else</span>
01028                 count2++;
01029         FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-ClassANum;
01030         <a class="code" href="matrix_8h.html#a8">mat_free</a>(AElim);
01031         <a class="code" href="matrix_8h.html#a8">mat_free</a>(n);
01032         }
01033     }
01034 
01035 
01036      <span class="comment">/* store the reduced A in the variable Ared, and the       */</span>
01037      <span class="comment">/* modified b in bred                                      */</span>
01038 j=-1;
01039 <span class="keywordflow">for</span> (i=0; i&lt;N; i++)
01040   <span class="keywordflow">if</span> (RowElim[i] == 0)
01041      {
01042      j++;
01043      bred-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0]=btemp[i];
01044      m=-1;
01045      <span class="keywordflow">for</span> (k=0; k&lt;M; k++)
01046         <span class="keywordflow">if</span> (ColElim[k] == 0)
01047            {
01048            m++;
01049            Ared-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][m] = Aorig-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][k];
01050            }
01051      }
01052 free (SLRow);
01053 free (SLCol);
01054 free (Nonzero);
01055 free (ClassA);  
01056 free (Constant);
01057 
01058 }
01059 
01060 
01061 
01062 <span class="comment">/* ________________________________________________________</span>
01063 <span class="comment">  | name:    CheckB                                        |</span>
01064 <span class="comment">  | description:  Checks that after reducing the A, not all|</span>
01065 <span class="comment">  |               requested workspace motions are zero     |</span>
01066 <span class="comment">  |               (trivial motion).                        |</span>
01067 <span class="comment">  |                                                        |</span>
01068 <span class="comment">  |                                                        |</span>
01069 <span class="comment">  | inputs:  b, corresponding N                            |</span>
01070 <span class="comment">  | outputs: If it is all zeros                            |</span>
01071 <span class="comment">  |________________________________________________________|</span>
01072 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
01073 <span class="comment">  |  k morganson 8/94      Created                         |</span>
01074 <span class="comment">  |________________________________________________________| */</span>
01075 
<a name="l01076"></a><a class="code" href="headers_8h.html#a18">01076</a> <span class="keywordtype">int</span> <a class="code" href="headers_8h.html#a18">CheckB</a>      (<a class="code" href="structMATRIX.html">MATRIX</a> *b, <span class="keywordtype">int</span> m)
01077 {
01078 <span class="keywordtype">int</span> i;
01079 
01080 i=0;
01081       <span class="comment">/* stop checking b when a nonzero element is found */</span>
01082 <span class="keywordflow">while</span> ((i&lt;m) &amp;&amp; (fabs(b-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]) &lt; <a class="code" href="general_8h.html#a13">SMALL</a>))
01083    i++;
01084 
01085 <span class="keywordflow">if</span> (i==m)
01086    <span class="keywordflow">return</span>(0);
01087 <span class="keywordflow">else</span>
01088    <span class="keywordflow">return</span>(m);
01089 }
01090 
01091 
01092 
01093 <span class="comment">/* ________________________________________________________</span>
01094 <span class="comment">  | name:    CheckRange                                    |</span>
01095 <span class="comment">  | description:  Checks that the original b is in the     |</span>
01096 <span class="comment">  |               range of A.                              |</span>
01097 <span class="comment">  |                                                        |</span>
01098 <span class="comment">  |                                                        |</span>
01099 <span class="comment">  | inputs:  borig, Aorig, g, RowElim, Mred                |</span>
01100 <span class="comment">  | outputs: If it is in range                             |</span>
01101 <span class="comment">  |________________________________________________________|</span>
01102 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
01103 <span class="comment">  |  k morganson 8/94      Created                         |</span>
01104 <span class="comment">  |________________________________________________________| */</span>
01105 
<a name="l01106"></a><a class="code" href="headers_8h.html#a19">01106</a> <span class="keywordtype">int</span> <a class="code" href="headers_8h.html#a19">CheckRange</a> (<a class="code" href="structMATRIX.html">MATRIX</a> * b, <a class="code" href="structMATRIX.html">MATRIX</a> * Aorig, <a class="code" href="structMATRIX.html">MATRIX</a> * g,
01107                 <span class="keywordtype">int</span>   *RowElim,    <span class="keywordtype">int</span>    Mred )
01108 {
01109   <span class="keywordtype">int</span> i, j, k;
01110   <span class="keywordtype">float</span> CheckValue, CheckTemp, CheckTemp2;
01111 <span class="comment">/*</span>
01112 <span class="comment">  for (i = 0; i &lt; (Aorig -&gt; rows); i++)</span>
01113 <span class="comment">  {</span>
01114 <span class="comment">    if (RowElim[i] == 2)</span>
01115 <span class="comment">    {</span>
01116 <span class="comment">      for (j = 0; j &lt; (g -&gt; rows); j++)</span>
01117 <span class="comment">      {</span>
01118 <span class="comment">        CheckValue = 0.0;</span>
01119 <span class="comment">        for (k = 0; k&lt; (Aorig -&gt; cols); k++)</span>
01120 <span class="comment">          CheckValue += Aorig -&gt; p[i][k] * g -&gt; p[j][k];</span>
01121 <span class="comment">        CheckTemp  = fabs (b-&gt;p[i][0] - CheckValue);</span>
01122 <span class="comment">        CheckTemp2 = .02;   </span>
01123 <span class="comment">        if (CheckTemp &gt; CheckTemp2)</span>
01124 <span class="comment">          return (0);</span>
01125 <span class="comment">      }</span>
01126 <span class="comment">    }</span>
01127 <span class="comment">  }</span>
01128 <span class="comment">*/</span>  <span class="keywordflow">return</span> (1);
01129 }
01130 
01131 
01132 
01133 
01134 <span class="comment">/* ________________________________________________________</span>
01135 <span class="comment">  | name:    Rebuild_gs                                    |</span>
01136 <span class="comment">  | description:  Given the created g vectors for the      |</span>
01137 <span class="comment">  |               reduced Jacobian, this procedure adds    |</span>
01138 <span class="comment">  |               zeros in eliminated columns and tacks on |</span>
01139 <span class="comment">  |               the g vectors created by SpecialCase1    |</span>
01140 <span class="comment">  |                                                        |</span>
01141 <span class="comment">  |                                                        |</span>
01142 <span class="comment">  | inputs:  g, ColElim, Mred, Nred, M, NumSpg, Specialg   |</span>
01143 <span class="comment">  | outputs: g                                             |</span>
01144 <span class="comment">  |________________________________________________________|</span>
01145 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
01146 <span class="comment">  |  c hacker    3/95      Created                         |</span>
01147 <span class="comment">  |  g fries     3/95      Additional ability handling     |</span>
01148 <span class="comment">  |                        SpecialCase1 (ie Specialg)      |</span>
01149 <span class="comment">  |________________________________________________________| */</span>
01150 
01151 
<a name="l01152"></a><a class="code" href="headers_8h.html#a20">01152</a> <span class="keywordtype">void</span> <a class="code" href="headers_8h.html#a20">Rebuild_gs</a> (<a class="code" href="structSolutions.html">Solutions</a> *FSP_data, <span class="keywordtype">int</span> *ColElim, <a class="code" href="structMATRIX.html">MATRIX</a> *Specialg,<span class="keywordtype">int</span> NumSpg)
01153 {
01154   <span class="keywordtype">int</span>    i,j,k;
01155   <a class="code" href="structMATRIX.html">MATRIX</a> *gtemp;
01156 
01157   gtemp = <a class="code" href="matrix_8h.html#a27">mat_cp2</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
01158 
01159   k = 0;
01160   <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; j++)
01161   {
01162     <span class="keywordflow">if</span> (ColElim[j] != 0)
01163     {
01164        <span class="keywordflow">for</span> (i=0;i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>;i++)
01165          FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = <a class="code" href="general_8h.html#a15">ZERO</a>; 
01166     }
01167     <span class="keywordflow">else</span>
01168     {
01169        <span class="keywordflow">for</span> (i=0;i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>;i++)
01170          FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = gtemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][k];
01171        k++;
01172     }
01173   }
01174 
01175   <span class="comment">/*Addition of null vectors created by SpecialCase1*/</span>
01176   <span class="keywordflow">for</span> (i=(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>+1);i&lt;
01177                         (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>+1+NumSpg);i++)
01178     <span class="keywordflow">for</span>(j=0;j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; j++)
01179         <span class="keywordflow">if</span> (ColElim[j] !=0)
01180             FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]=
01181                         Specialg-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[(i-FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso2">Mred</a>+FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso3">Nred</a>-1)][j];
01182             <span class="keywordflow">else</span>
01183                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j];
01184 
01185   <a class="code" href="matrix_8h.html#a8">mat_free</a>(gtemp);
01186 }
01187 
01188 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:35 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
