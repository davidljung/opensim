<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/jungd/unix/dev/OpenSim/opensim/physics/GJKCollisionModel.cpp.bak Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>/home/jungd/unix/dev/OpenSim/opensim/physics/GJKCollisionModel.cpp.bak</h1><a href="GJKCollisionModel_8cpp_8bak.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">  Copyright (C)1996 David Jung &lt;djung@pobox.com&gt;</font>
00003 <font class="comment"></font>
00004 <font class="comment">  This program/file is free software; you can redistribute it and/or modify</font>
00005 <font class="comment">  it under the terms of the GNU General Public License as published by</font>
00006 <font class="comment">  the Free Software Foundation; either version 2 of the License, or</font>
00007 <font class="comment">  (at your option) any later version.</font>
00008 <font class="comment">  </font>
00009 <font class="comment">  This program is distributed in the hope that it will be useful,</font>
00010 <font class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00011 <font class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
00012 <font class="comment">  GNU General Public License for more details. (http://www.gnu.org)</font>
00013 <font class="comment">  </font>
00014 <font class="comment">  You should have received a copy of the GNU General Public License</font>
00015 <font class="comment">  along with this program; if not, write to the Free Software</font>
00016 <font class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font>
00017 <font class="comment">  </font>
00018 <font class="comment">  $Id: OBBCollisionModel.cpp,v 1.9 2001/06/01 20:01:29 jungd Exp $</font>
00019 <font class="comment">  $Revision: 1.9 $</font>
00020 <font class="comment">  $Date: 2001/06/01 20:01:29 $</font>
00021 <font class="comment">  $Author: jungd $</font>
00022 <font class="comment"> </font>
00023 <font class="comment">****************************************************************************/</font>
00024 
00025 <font class="preprocessor">#include &lt;<a class="code" href="GJKCollisionModel.html">physics/GJKCollisionModel</a>&gt;</font>
00026 
00027 <font class="preprocessor">#include &lt;<a class="code" href="Box.html">physics/Box</a>&gt;</font>
00028 <font class="preprocessor">#include &lt;<a class="code" href="Shape.html">physics/Shape</a>&gt;</font>
00029 <font class="preprocessor">#include &lt;<a class="code" href="Color4.html">gfx/Color4</a>&gt;</font>
00030 <font class="preprocessor">#include &lt;<a class="code" href="Triangle3.html">gfx/Triangle3</a>&gt;</font>
00031 <font class="preprocessor">#include &lt;<a class="code" href="TriangleContainer.html">gfx/TriangleContainer</a>&gt;</font>
00032 <font class="preprocessor">#include &lt;<a class="code" href="TriangleIterator.html">gfx/TriangleIterator</a>&gt;</font>
00033 <font class="preprocessor">#include &lt;<a class="code" href="VisualTriangles.html">gfx/VisualTriangles</a>&gt;</font>
00034 <font class="preprocessor">#include &lt;<a class="code" href="IndexedPoint3Array.html">gfx/IndexedPoint3Array</a>&gt;</font>
00035 
00036 <font class="preprocessor">#include &lt;osg/Node&gt;</font>
00037 <font class="preprocessor">#include &lt;osg/Group&gt;</font>
00038 <font class="preprocessor">#include &lt;<a class="code" href="Transform.html">osg/Transform</a>&gt;</font>
00039 <font class="preprocessor">#include &lt;osg/StateSet&gt;</font>
00040 <font class="preprocessor">#include &lt;<a class="code" href="Material.html">osg/Material</a>&gt;</font>
00041 <font class="preprocessor">#include &lt;osg/Vec4&gt;</font>
00042 <font class="preprocessor">#include &lt;osg/PolygonMode&gt;</font>
00043 
00044 
00045 <font class="keyword">using</font> <a class="code" href="classphysics_1_1GJKCollisionModel.html">physics::GJKCollisionModel</a>;
00046 <font class="keyword">using</font> <a class="code" href="classphysics_1_1Shape.html">physics::Shape</a>;
00047 <font class="keyword">using</font> <a class="code" href="classphysics_1_1Box.html">physics::Box</a>;
00048 
00049 <font class="keyword">using</font> <a class="code" href="classgfx_1_1Triangle3.html">gfx::Triangle3</a>;
00050 <font class="keyword">using</font> <a class="code" href="classgfx_1_1Color4.html">gfx::Color4</a>;
00051 <font class="keyword">using</font> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>;
00052 <font class="keyword">using</font> <a class="code" href="classgfx_1_1TriangleIterator.html">gfx::TriangleIterator</a>;
00053 <font class="keyword">using</font> <a class="code" href="classgfx_1_1VisualTriangles.html">gfx::VisualTriangles</a>;
00054 <font class="keyword">using</font> <a class="code" href="classgfx_1_1IndexedPoint3Array.html">gfx::IndexedPoint3Array</a>;
00055 
00056 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix3.html">base::Matrix3</a>;
00057 <font class="keyword">using</font> base::transpose;
00058 <font class="keyword">using</font> base::cross;
00059 <font class="keyword">using</font> <a class="code" href="classbase_1_1array.html">base::array</a>;
00060 
00061 <font class="keyword">using</font> osg::Vec4;
00062 <font class="keyword">using</font> osg::StateSet;
00063 
00064 
00065 GJKCollisionModel::GJKCollisionModel(<font class="keyword">const</font> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>&amp; triangles)
00066   : objectOwner(true)
00067 {
00068   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModelb2">buildModel</a>(triangles);
00069 }
00070 
00071 GJKCollisionModel::GJKCollisionModel(ref&lt;const Shape&gt; shape)
00072   : objectOwner(true)
00073 {
00074   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModelb2">buildModel</a>(<a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln0">shape</a>);
00075 }
00076 
00077 GJKCollisionModel::GJKCollisionModel(<font class="keyword">const</font> GJKCollisionModel&amp; cm)
00078   : objectOwner(false), coord(cm.coord), indices(cm.indices), <a class="code" href="boost_8jamfile.html#a0">base</a>(cm.<a class="code" href="boost_8jamfile.html#a0">base</a>), object(cm.object)
00079 {
00080 }
00081 
00082 GJKCollisionModel::~GJKCollisionModel()
00083 {
00084   <font class="keywordflow">if</font> (objectOwner) {
00085     <font class="keyword">delete</font> <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln6">object</a>;
00086     <font class="keyword">delete</font> <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln5">base</a>;
00087     <font class="keyword">delete</font>[] <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln4">indices</a>;
00088     <font class="keyword">delete</font>[] <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a>;
00089   }
00090 }
00091 
00092 
<a name="l00093"></a><a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModelb2">00093</a> <font class="keywordtype">void</font> GJKCollisionModel::buildModel(<font class="keyword">const</font> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>&amp; triangles)
00094 {
00095   <font class="comment">// Load all the triangles into a Polyhedron</font>
00096   <font class="comment">//  NB: This would be more efficient if it indexed the existing vertex data</font>
00097   <font class="comment">//  rather than copying it. !!</font>
00098 
00099   
00100   <font class="comment">// First get all the vertices our of the TriangleContainer and</font>
00101   <font class="comment">//  into an IndexedPoint3Array</font>
00102   <font class="comment">// (this gets us an array of unique vertex points - which is all</font>
00103   <font class="comment">//  we need for a convex polyhedron)</font>
00104   IndexedPoint3Array verts(triangles);
00105 
00106   <font class="comment">// Now copy the verts into GJK-engine compat. VertexBase</font>
00107   <font class="keyword">const</font> array&lt;Point3&gt;&amp; pa = verts.getPointArray();
00108   <a class="code" href="namespacebase.html#a2">Int</a> noVerts = pa.size(); <font class="comment">// no of unique points</font>
00109   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln4">indices</a> = <font class="keyword">new</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>[noVerts];
00110   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;noVerts; i++) <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln4">indices</a>[i] = i; <font class="comment">// direct 1-1 mapping</font>
00111   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a> = <font class="keyword">new</font> gjk::Scalar[3*noVerts];
00112   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;noVerts; i++) {
00113     <font class="keyword">const</font> <a class="code" href="namespacebase.html#a32">Point3</a>&amp; p(pa[i]);
00114     <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a>[3*i]   = p.x;
00115     <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a>[3*i+1] = p.y;
00116     <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a>[3*i+2] = p.z;
00117   }
00118 
00119   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln5">base</a> = <a class="code" href="MemoryTracer.html#a0">NewObj</a> gjk::VertexBase(<a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln3">coord</a>);
00120 
00121   <font class="comment">// finally construct the GJK-engine object</font>
00122   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln6">object</a> = <a class="code" href="MemoryTracer.html#a1">NewNamedObj</a>(<font class="stringliteral">"gjk::Polyhedron"</font>) gjk::Polyhedron(*<a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln5">base</a>, noVerts, <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln4">indices</a>);
00123 }
00124 
00125 
<a name="l00126"></a><a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModelb3">00126</a> <font class="keywordtype">void</font> GJKCollisionModel::buildModel(ref&lt;const Shape&gt; shape)
00127 {
00128   <font class="comment">// Just use the Shape's triangles for now.</font>
00129   <font class="comment">//  A better approach is to create a specific SOLID primitice corresponding</font>
00130   <font class="comment">//  to the specific shape. !!</font>
00131   ref&lt;const Shape&gt; s(<a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModeln0">shape</a>);
00132   <a class="code" href="classphysics_1_1GJKCollisionModel.html#physics_1_1GJKCollisionModelb2">buildModel</a>(VisualTriangles(*s));
00133 }
00134 
00135 
00136 
00137 
00138 osg::Node* GJKCollisionModel::createOSGVisual(Visual::Attributes visualAttributes)<font class="keyword"> const</font>
00139 <font class="keyword"></font>{
00140   <font class="keywordflow">if</font> (!(visualAttributes &amp; <a class="code" href="classgfx_1_1Visual.html#gfx_1_1Visuals9gfx_1_1Visuals5">ShowCollisionModel</a>)
00141       <font class="comment">/*|| tris.empty()*/</font> ) 
00142     <font class="keywordflow">return</font> <font class="keyword">new</font> osg::Node();
00143   
00144   osg::Node* node = <font class="keyword">new</font> osg::Node();<font class="comment">//createOBBVisualRecurse(b[0], 0);</font>
00145   node-&gt;setName(<font class="stringliteral">"debug"</font>);
00146 
00147   <font class="comment">// Set state to be transparent, random colour</font>
00148   StateSet* state = <font class="keyword">new</font> osg::StateSet();
00149   osg::Material* mat = <font class="keyword">new</font> osg::Material();
00150   Vec4 col( base::random(), base::random(), base::random(), 1.0);
00151   mat-&gt;setEmission( osg::Material::FRONT_AND_BACK, Vec4(0,0,0,0) );
00152   mat-&gt;setAmbient( osg::Material::FRONT_AND_BACK, col );
00153   mat-&gt;setDiffuse( osg::Material::FRONT_AND_BACK, col );
00154   mat-&gt;setSpecular( osg::Material::FRONT_AND_BACK, Vec4(1,1,1,0) );
00155   mat-&gt;setShininess( osg::Material::FRONT_AND_BACK, 0.3);
00156   state-&gt;setAttribute( mat );
00157   state-&gt;setMode(GL_CULL_FACE,osg::StateAttribute::OFF);
00158 
00159   osg::PolygonMode* polyMode = <font class="keyword">new</font> osg::PolygonMode;
00160   polyMode-&gt;setMode( osg::PolygonMode::FRONT_AND_BACK, osg::PolygonMode::LINE );
00161   state-&gt;setAttributeAndModes(polyMode,osg::StateAttribute::ON);
00162 
00163   node-&gt;setStateSet(state);
00164   
00165   <font class="keywordflow">return</font> node;
00166 }
00167 
</pre></div><hr><address><small>Generated on Thu Aug 29 16:45:57 2002 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
