<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/KinematicChain.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/KinematicChain.cpp</h1><a href="KinematicChain_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)2003 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: KinematicChain.cpp 1039 2004-02-11 20:50:52Z jungd $</span>
00019 <span class="comment">  $Revision: 1.9 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:50:52 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="KinematicChain.html">robot/KinematicChain</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;<a class="code" href="MD5.html">base/MD5</a>&gt;</span>
00028 <span class="preprocessor">#include &lt;<a class="code" href="Externalizer.html">base/Externalizer</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="externalization__error.html">base/externalization_error</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="JFKengine.html">robot/JFKengine</a>&gt;</span>
00031 
00032 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00033 
00034 <span class="keyword">using</span> <a class="code" href="classrobot_1_1KinematicChain.html">robot::KinematicChain</a>;
00035 
00036 <span class="keyword">using</span> <a class="code" href="namespacebase.html#a0">base::Byte</a>;
00037 <span class="keyword">using</span> <a class="code" href="classbase_1_1matrix.html">base::Matrix</a>;
00038 <span class="keyword">using</span> <a class="code" href="classbase_1_1vector.html">base::Vector</a>;
00039 <span class="keyword">using</span> <a class="code" href="classbase_1_1matrix.html">base::ExpressionMatrix</a>;
00040 <span class="keyword">using</span> <a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>;
00041 <span class="keyword">using</span> <a class="code" href="classbase_1_1externalization__error.html">base::externalization_error</a>;
00042 <span class="keyword">using</span> base::dom::DOMNode;
00043 <span class="keyword">using</span> base::dom::DOMElement;
00044 <span class="keyword">using</span> <a class="code" href="classbase_1_1MD5.html">base::MD5</a>;
00045 <span class="keyword">using</span> <a class="code" href="classrobot_1_1KinematicEvaluator.html">robot::KinematicEvaluator</a>;
00046 <span class="keyword">using</span> <a class="code" href="classrobot_1_1JFKengine.html">robot::JFKengine</a>;
00047 
00048 
00049 
00050 <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> KinematicChain::unboundedMinAngleLimit = -consts::Pi - consts::epsilon;
00051 <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> KinematicChain::unboundedMaxAngleLimit = +consts::Pi + consts::epsilon;
00052 <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> KinematicChain::unboundedMinDistLimit  = consts::maxReal;
00053 <span class="keyword">const</span> <a class="code" href="namespacebase.html#a5">Real</a> KinematicChain::unboundedMaxDistLimit  = -consts::maxReal;
00054 
00055   
00056   
00057 KinematicChain::Link&amp; KinematicChain::Link::operator=(<span class="keyword">const</span> KinematicChain::Link&amp; l)
00058 {
00059   linkType=l.linkType;
00060   <span class="keywordflow">switch</span> (linkType) {
00061     <span class="keywordflow">case</span> Translating:
00062       direction=l.direction;
00063       t=l.t;
00064       <span class="keywordflow">break</span>;
00065     <span class="keywordflow">case</span> FixedTransform:
00066       transform=l.transform;
00067       <span class="keywordflow">break</span>;
00068     <span class="keywordflow">case</span> Prismatic: 
00069     <span class="keywordflow">case</span> Revolute:
00070       alpha=l.alpha; a=l.a; d=l.d; theta=l.theta;
00071       <span class="keywordflow">break</span>;
00072     <span class="keywordflow">default</span>: <a class="code" href="base.html#a21">Assertm</a>(<span class="keyword">false</span>,<span class="stringliteral">"known joint type"</span>);
00073   }
00074   jminLimit=l.jminLimit; jmaxLimit=l.jmaxLimit;
00075   jminAccel=l.jminAccel; jmaxAccel=l.jmaxAccel;
00076   active=l.active;
00077   dirtyHash(); 
00078   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00079 }
00080 
00081 
00082 <span class="keywordtype">bool</span> KinematicChain::Link::operator==(<span class="keyword">const</span> Link&amp; l)<span class="keyword"> const</span>
00083 <span class="keyword"></span>{
00084   <span class="keywordflow">if</span> (linkType != l.linkType) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00085   <span class="keywordflow">if</span> (<span class="keyword">this</span> == &amp;l) <span class="keywordflow">return</span> <span class="keyword">true</span>;
00086   
00087   <span class="keywordflow">switch</span> (linkType) {
00088     <span class="keywordflow">case</span> Prismatic:
00089     <span class="keywordflow">case</span> Revolute:
00090       <span class="keywordflow">return</span>    Math::equals(alpha,l.alpha) &amp;&amp; Math::equals(theta,l.theta) 
00091              &amp;&amp; Math::equals(d,l.d) &amp;&amp; Math::equals(a,l.a) &amp;&amp; (active==l.active);
00092     <span class="keywordflow">case</span> Translating:
00093       <span class="keywordflow">return</span> direction.equals(l.direction) &amp;&amp; (active==l.active);
00094     <span class="keywordflow">case</span> FixedTransform:
00095       <span class="keywordflow">return</span> transform.equals(l.transform);
00096     <span class="keywordflow">default</span>:
00097       <span class="keywordflow">throw</span> std::runtime_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unhandled KinematicChain::Link type"</span>));
00098   }
00099   
00100   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00101 }
00102 
00103 
00104 <a class="code" href="classbase_1_1matrix.html">base::Matrix</a> KinematicChain::Link::kinematicTransform(<span class="keyword">const</span> <a class="code" href="classbase_1_1vector.html">base::Vector</a>&amp; q)<span class="keyword"> const</span>
00105 <span class="keyword"></span>{
00106   <a class="code" href="base.html#a19">Assert</a>(q.<a class="code" href="classbase_1_1vector.html#base_1_1vectora12">size</a>() == dof());
00107   <a class="code" href="classbase_1_1matrix.html">Matrix</a> A(4,4);
00108   
00109   <span class="keywordflow">if</span> (isDHType()) {
00110     <a class="code" href="namespacebase.html#a5">Real</a> d = ((linkType == Prismatic) &amp;&amp; active)?q[0]:this-&gt;d;
00111     <a class="code" href="namespacebase.html#a5">Real</a> theta = ((linkType == Revolute) &amp;&amp; active)?q[0]:this-&gt;theta;
00112     
00113     <span class="comment">// Compute the transformation that transforms the coord. frame of</span>
00114     <span class="comment">//  this link into the frame of the previous one</span>
00115     <span class="comment">// (see a ref on Denavit-Hartenberg parameters - e.g. "Robot Manipulators" by Richard P. Paul.)</span>
00116     <a class="code" href="namespacebase.html#a5">Real</a> sinAlpha = Math::sin(alpha);
00117     <a class="code" href="namespacebase.html#a5">Real</a> cosAlpha = Math::cos(alpha);
00118     <a class="code" href="namespacebase.html#a5">Real</a> sinTheta = Math::sin(theta);
00119     <a class="code" href="namespacebase.html#a5">Real</a> cosTheta = Math::cos(theta);
00120     
00121     A(0,0) = cosTheta; A(0,1) = -sinTheta*cosAlpha; A(0,2) = sinTheta*sinAlpha;  A(0,3) = a*cosTheta; 
00122     A(1,0) = sinTheta; A(1,1) = cosTheta*cosAlpha;  A(1,2) = -cosTheta*sinAlpha; A(1,3) = a*sinTheta;
00123     A(2,0) = 0;        A(2,1) = sinAlpha;           A(2,2) = cosAlpha;           A(2,3) = d;
00124     A(3,0) = 0;        A(3,1) = 0;                  A(3,2) = 0;                  A(3,3) = 1;
00125   }
00126   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (linkType == Translating) {
00127     A = <a class="code" href="namespacebase.html#a101">base::identityMatrix</a>(4,4);
00128     <a class="code" href="base.html#a19">Assert</a>(direction.length() &gt; 0);
00129     Vector3 dir(direction);
00130     dir.normalize();
00131     <a class="code" href="namespacebase.html#a5">Real</a> v = active?q[0]:t;
00132     A(0,3) = dir.x * v;
00133     A(1,3) = dir.y * v;
00134     A(2,3) = dir.z * v;
00135   }
00136   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (linkType == FixedTransform) {
00137     A = <a class="code" href="namespacebase.html#a103">base::fromMatrix4</a>(transform);
00138   }
00139   <span class="keywordflow">else</span>
00140     <span class="keywordflow">throw</span> std::runtime_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unhandled KinematicChain::Link type"</span>));
00141   
00142   <span class="keywordflow">return</span> A;
00143 }
00144 
00145 
00146 <a class="code" href="classbase_1_1array.html">base::array&lt;base::Byte&gt;</a> KinematicChain::Link::hashCode()<span class="keyword"> const</span>
00147 <span class="keyword"></span>{
00148   <span class="keywordflow">if</span> (!hashDirty) <span class="keywordflow">return</span> hash;
00149   
00150   <span class="comment">// create an MD5 hash over relevant link parameters</span>
00151   <a class="code" href="classbase_1_1MD5.html">MD5</a> md5;
00152   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;linkType), <span class="keyword">sizeof</span>(LinkType) );
00153   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;active), <span class="keyword">sizeof</span>(<span class="keywordtype">bool</span>) );
00154   
00155   <span class="keywordflow">switch</span> (linkType) {
00156     <span class="keywordflow">case</span> Translating:
00157       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;direction.x), <span class="keyword">sizeof</span>(Real) );
00158       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;direction.y), <span class="keyword">sizeof</span>(Real) );
00159       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;direction.z), <span class="keyword">sizeof</span>(Real) );
00160       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;t), <span class="keyword">sizeof</span>(Real) );
00161       <span class="keywordflow">break</span>;
00162     <span class="keywordflow">case</span> FixedTransform:
00163       <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=4; r++)
00164         <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=4; c++) {
00165           <a class="code" href="namespacebase.html#a5">Real</a> e = transform(r,c);
00166           md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;e), <span class="keyword">sizeof</span>(Real) );
00167         }
00168       <span class="keywordflow">break</span>;
00169     <span class="keywordflow">case</span> Prismatic: 
00170     <span class="keywordflow">case</span> Revolute:
00171       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;alpha), <span class="keyword">sizeof</span>(Real) );
00172       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;a), <span class="keyword">sizeof</span>(Real) );
00173       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;d), <span class="keyword">sizeof</span>(Real) );
00174       md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;theta), <span class="keyword">sizeof</span>(Real) );
00175       <span class="keywordflow">break</span>;
00176     <span class="keywordflow">default</span>: <a class="code" href="base.html#a21">Assertm</a>(<span class="keyword">false</span>,<span class="stringliteral">"known joint type"</span>);
00177   }
00178   
00179   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a5">finalize</a>();
00180   hash.resize(16); <span class="comment">// MD5 implies 16 byte hash</span>
00181   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *digest = md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a10">raw_digest</a>();
00182   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> b=0; b&lt;16; b++) hash[b] = digest[b];
00183   
00184   <span class="keywordflow">return</span> hash;
00185 }
00186 
00187 
00188 
00189 
00190 
00191 
00192 
00193 
00194 
00195 <span class="keywordtype">bool</span> KinematicChain::isDHType()<span class="keyword"> const</span>
00196 <span class="keyword"></span>{
00197   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;links.size(); i++)
00198     <span class="keywordflow">if</span> (!links[i].isDHType()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00199   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00200 }
00201 
00202   
00203 KinematicChain KinematicChain::subChain(Int first, Int count)<span class="keyword"> const</span>
00204 <span class="keyword"></span>{
00205   <a class="code" href="base.html#a19">Assert</a>( first &lt; size() );
00206   <a class="code" href="base.html#a19">Assert</a>( first+count &lt;= size() );
00207   LinkArray la(count);
00208   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;count; i++) la[i]=links[first+i];
00209   <span class="keywordflow">return</span> KinematicChain(la);
00210 }
00211 
00212     
00213 KinematicChain&amp; KinematicChain::operator+=(<span class="keyword">const</span> KinematicChain&amp; kc)
00214 {
00215   <span class="keywordflow">if</span> (kc.size() &gt; 0) {
00216     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;kc.size(); i++)
00217       links.push_back(kc[i]);
00218     computeVariables(); 
00219   }
00220   dirtyHash();
00221   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00222 }
00223 
00224 
00225 KinematicChain&amp; KinematicChain::insert(Int pos, <span class="keyword">const</span> KinematicChain&amp; kc)
00226 {
00227   <a class="code" href="base.html#a19">Assert</a>( pos &lt;= size() );
00228   KinematicChain newkc( subChain(0,pos) );
00229   newkc += kc;
00230   newkc += subChain(pos,size()-pos);
00231   *<span class="keyword">this</span> = newkc;
00232   computeVariables(); 
00233   dirtyHash();
00234   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00235 }
00236 
00237 
00238 KinematicChain&amp; KinematicChain::insert(Int pos, <span class="keyword">const</span> Link&amp; l)
00239 {
00240   <a class="code" href="base.html#a19">Assert</a>( pos &lt;= size() );
00241   KinematicChain newkc( subChain(0,pos) );
00242   newkc += l;
00243   newkc += subChain(pos,size()-pos);
00244   *<span class="keyword">this</span> = newkc;
00245   computeVariables(); 
00246   dirtyHash();
00247   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00248 }  
00249 
00250 
00251 KinematicChain&amp; KinematicChain::erase(Int pos)
00252 {
00253   <a class="code" href="base.html#a19">Assert</a>( pos &lt; size() );
00254   KinematicChain newkc( size()-1);
00255   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;size(); i++)
00256     <span class="keywordflow">if</span> (i!=pos) newkc.push_back(links[i]);
00257   *<span class="keyword">this</span> = newkc;
00258   computeVariables(); 
00259   dirtyHash();
00260   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00261 }
00262 
00263 
00264 KinematicChain&amp; KinematicChain::erase(Int first, Int last)
00265 {
00266   <a class="code" href="base.html#a19">Assert</a>( first &lt;= last );
00267   <a class="code" href="base.html#a19">Assert</a>( first &lt; size() );
00268   <a class="code" href="base.html#a19">Assert</a>( last &lt;= size() );
00269   KinematicChain newkc( size()-(last-first) );
00270   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;size(); i++)
00271     <span class="keywordflow">if</span> (!((i&gt;=first) &amp;&amp; (i&lt;last))) newkc.push_back(links[i]);
00272   *<span class="keyword">this</span> = newkc;
00273   computeVariables(); 
00274   dirtyHash();
00275   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00276 }
00277 
00278 
00279 
00280 <span class="keywordtype">void</span> KinematicChain::computeVariables()
00281 {
00282   variables.clear();
00283   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> l=0; l&lt;size(); l++) {
00284     <span class="keyword">const</span> Link&amp; link(links[l]);
00285 
00286     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> d=0; d&lt;link.dof(); d++)
00287       variables.push_back( std::make_pair&lt;Int,Int&gt;(l,d) );
00288   } 
00289 }
00290 
00291 
00292 
00293 
00294 
00295 <span class="keywordtype">bool</span> KinematicChain::KinematicEvaluatorInitialized = <span class="keyword">false</span>;
00296 ref&lt;KinematicEvaluator&gt; KinematicChain::defaultKinematicEvaluator;
00297 
00298 
00299 <span class="keywordtype">void</span> KinematicChain::initKinematicEvaluator() 
00300 {
00301   <span class="keywordflow">if</span> (!KinematicEvaluatorInitialized) {
00302     KinematicEvaluatorInitialized = <span class="keyword">true</span>;
00303     defaultKinematicEvaluator = ref&lt;JFKengine&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> JFKengine()); 
00304   }
00305   kinematicEvaluator = defaultKinematicEvaluator;
00306 }
00307 
00308 
00309 
00310 <a class="code" href="classbase_1_1matrix.html">Matrix</a> KinematicChain::getForwardKinematics(<span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q)<span class="keyword"> const</span>
00311 <span class="keyword"></span>{
00312   <span class="keywordflow">return</span> kinematicEvaluator-&gt;getForwardKinematics(*<span class="keyword">this</span>,q);
00313 }
00314 
00315   
00316 <a class="code" href="classbase_1_1matrix.html">Matrix</a> KinematicChain::getJacobian(<span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q, <span class="keywordtype">bool</span> includeOrientation)<span class="keyword"> const</span>
00317 <span class="keyword"></span>{
00318   <span class="keywordflow">return</span> kinematicEvaluator-&gt;getJacobian(*<span class="keyword">this</span>, q, includeOrientation);
00319 }
00320 
00321 array&lt;Vector&gt; KinematicChain::getJointOrigins(<span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q)<span class="keyword"> const</span>
00322 <span class="keyword"></span>{
00323   <span class="keywordflow">return</span> kinematicEvaluator-&gt;getJointOrigins(*<span class="keyword">this</span>, q);
00324 }
00325 
00326 
00327 array&lt;Vector&gt; KinematicChain::getLinkOrigins(<span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q)<span class="keyword"> const</span>
00328 <span class="keyword"></span>{
00329   <span class="keywordflow">return</span> kinematicEvaluator-&gt;getLinkOrigins(*<span class="keyword">this</span>, q);
00330 }
00331 
00332 
00333 
00334 
00335 <a class="code" href="classdemeter_1_1Vector.html">Vector</a> KinematicChain::transform(Int fromLink, Int toLink, <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; v, <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q)<span class="keyword"> const</span>
00336 <span class="keyword"></span>{
00337   <span class="keywordflow">if</span> (fromLink == toLink) <span class="keywordflow">return</span> v;
00338   
00339   <a class="code" href="namespacebase.html#a2">Int</a> from = fromLink;
00340   <a class="code" href="namespacebase.html#a2">Int</a> to = toLink;
00341   
00342   <span class="keywordflow">if</span> (fromLink &lt; toLink) <a class="code" href="namespacebase.html#a46">base::swap</a>(from, to);
00343   
00344   KinematicChain subTo_From(subChain(toLink, fromLink-toLink)); <span class="comment">// chain from 'to' to 'from'</span>
00345   KinematicChain sub0_To(subChain(0, toLink)); <span class="comment">// chain from 0 to 'to'</span>
00346   <a class="code" href="classdemeter_1_1Vector.html">Vector</a> subq( <a class="code" href="namespacebase.html#a205">vectorRange</a>(q, <a class="code" href="namespacebase.html#a30">Range</a>(sub0_To.dof(), subTo_From.dof())) );
00347   
00348   Matrix4 T( base::toMatrix4(subTo_From.getForwardKinematics(subq)) );
00349     
00350   <span class="keywordflow">if</span> (fromLink &lt; toLink) T.invert();
00351   
00352   <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a212">base::fromVector3</a>(T*base::toVector3(v));
00353 }
00354 
00355   
00356 <a class="code" href="classdemeter_1_1Vector.html">Vector</a> KinematicChain::transform(<span class="keyword">const</span> String&amp; fromFrame, <span class="keyword">const</span> String&amp; toFrame, <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; v, <span class="keyword">const</span> <a class="code" href="classdemeter_1_1Vector.html">Vector</a>&amp; q)<span class="keyword"> const</span>
00357 <span class="keyword"></span>{
00358   <span class="keyword">const</span> <a class="code" href="namespacebase.html#a1">SInt</a> NotFound = -2;
00359   <span class="keyword">const</span> <a class="code" href="namespacebase.html#a1">SInt</a> InitialFrame = -1;
00360   
00361   <span class="comment">// find link frames</span>
00362   <a class="code" href="namespacebase.html#a1">SInt</a> from = NotFound;
00363   <span class="keywordflow">if</span> (fromFrame == initialFrame)
00364     from=InitialFrame;
00365   <span class="keywordflow">else</span> {
00366     <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> fl=0; fl&lt;size(); fl++) 
00367       <span class="keywordflow">if</span> (links[fl].frameName == fromFrame) {
00368         from=fl;
00369         <span class="keywordflow">break</span>;
00370       }
00371   }
00372     
00373   
00374   <a class="code" href="namespacebase.html#a1">SInt</a> to = NotFound;
00375   <span class="keywordflow">if</span> (toFrame == initialFrame)
00376     to=InitialFrame;
00377   <span class="keywordflow">else</span> {
00378     <span class="keywordflow">for</span> (<a class="code" href="namespacebase.html#a2">Int</a> tl=0; tl&lt;size(); tl++)
00379       <span class="keywordflow">if</span> (links[tl].frameName == toFrame) {
00380         to=tl;
00381         <span class="keywordflow">break</span>;
00382       }
00383   }
00384     
00385   <span class="keywordflow">if</span> (from==NotFound)
00386     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unknown frame name:"</span>+fromFrame));
00387   <span class="keywordflow">if</span> (to==NotFound)
00388     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unknown frame name:"</span>+toFrame));
00389 
00390   <span class="keywordflow">if</span> (from == to) <span class="keywordflow">return</span> v; <span class="comment">// nothing to do</span>
00391   
00392   
00393   <span class="keywordflow">if</span> ((from != InitialFrame) &amp;&amp; (to != InitialFrame))
00394     <span class="keywordflow">return</span> transform(from, to, v, q);
00395 
00396   <span class="comment">// special case when one frame is the initial frame</span>
00397   <a class="code" href="debugtools.html#a12">Unimplemented</a>;
00398   
00399 }
00400 
00401   
00402   
00403 
00404 <span class="keywordtype">void</span> KinematicChain::externalize(<a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>&amp; e, String format, Real version)
00405 {
00406   <span class="keywordflow">if</span> (format == <span class="stringliteral">""</span>) format = <span class="stringliteral">"xml"</span>;
00407 
00408   <span class="keywordflow">if</span> (!formatSupported(format,version,e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera6">ioType</a>()))
00409     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"format "</span>)+format+<span class="stringliteral">" v"</span>+base::realToString(version)+<span class="stringliteral">" unsupported"</span>));
00410 
00411   <span class="keywordflow">if</span> (e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera4">isOutput</a>()) {
00412 
00413     DOMElement* chainElem = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera18">createElement</a>(<span class="stringliteral">"kinematicchain"</span>);
00414     <span class="keywordtype">bool</span> allDHLinks = isDHType();
00415     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera26">setElementAttribute</a>(chainElem,<span class="stringliteral">"type"</span>,allDHLinks?<span class="stringliteral">"DH"</span>:<span class="stringliteral">"mixed"</span> );
00416 
00417     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera31">appendComment</a>(chainElem,<span class="stringliteral">"Parameters describing the serial Kinematic Chain:"</span>);
00418     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera31">appendComment</a>(chainElem,<span class="stringliteral">"  revolute , {alpha} ,     {a} ,     {d} , {theta} ,{minlimit},{maxlimit} "</span>);
00419     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera31">appendComment</a>(chainElem,<span class="stringliteral">"  prismatic, {alpha} ,     {a} ,     {d} , {theta} ,{minlimit},{maxlimit} "</span>);
00420     <span class="keywordflow">if</span> (!allDHLinks) {
00421       e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera31">appendComment</a>(chainElem,<span class="stringliteral">"  translating,         {dir.x} , {dir.y} , {dir.z} ,{minlimit},{maxlimit} "</span>);
00422       <span class="comment">// transform here!!!</span>
00423     }
00424 
00425     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera19">pushContext</a>(chainElem);
00426     <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> l=0; l&lt;links.size(); l++) 
00427       links[l].externalize(e, format, version);
00428     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera20">popContext</a>();
00429     
00430     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera21">appendElement</a>(chainElem);
00431 
00432   } <span class="keywordflow">else</span> { <span class="comment">// input</span>
00433 
00434     DOMNode* context = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera16">context</a>();
00435     
00436     DOMElement* chainElem = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera36">getFirstElement</a>(context, <span class="stringliteral">"kinematicchain"</span>);
00437 
00438     <a class="code" href="namespacebase.html#a4">String</a> units = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera42">getDefaultedElementAttribute</a>(chainElem, <span class="stringliteral">"units"</span>, <span class="stringliteral">"meters"</span>);
00439     <span class="keywordflow">if</span> ((units != <span class="stringliteral">"meters"</span>) &amp;&amp; (units != <span class="stringliteral">"inches"</span>))
00440       <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"unknown/unsupported length unit:"</span>+units));
00441     
00442     <a class="code" href="namespacebase.html#a4">String</a> type = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera42">getDefaultedElementAttribute</a>(chainElem, <span class="stringliteral">"type"</span>, <span class="stringliteral">"mixed"</span>);
00443     <span class="keywordflow">if</span> ( (type == <span class="stringliteral">"mixed"</span>) || (type == <span class="stringliteral">"DH"</span>)) {
00444 
00445       links.clear();
00446       e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera19">pushContext</a>(chainElem);
00447       
00448       <span class="keywordflow">while</span> (e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera37">getFirstChildElement</a>(chainElem, <span class="stringliteral">"link"</span>,<span class="keyword">false</span>) != 0) { <span class="comment">// more joints?</span>
00449         Link l;
00450         l.externalize(e, format, version);
00451         <span class="keywordflow">if</span> ( (!l.isDHType()) &amp;&amp; (type == <span class="stringliteral">"DH"</span>))
00452           <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"a non D-H type joint was specified for a kinematic chain of type 'DH' (try type 'mixed')"</span>));
00453         
00454         <span class="comment">// convert all length measures to meters</span>
00455         <span class="keywordflow">if</span> (units != <span class="stringliteral">"meters"</span>) {
00456           <a class="code" href="namespacebase.html#a5">Real</a> scale = 1.0;
00457           <span class="keywordflow">if</span> (units == <span class="stringliteral">"inches"</span>) scale = 0.0254;
00458           
00459           <span class="keywordflow">if</span> (l.isDHType()) {
00460             l.setA( l.getA()*scale );
00461             l.setD( l.getD()*scale );
00462           }
00463           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l.type() == KinematicChain::Link::FixedTransform) {
00464             <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: conversion from "</span>+units+<span class="stringliteral">" to meters unsupported for fixed transform links"</span>);
00465           }
00466 
00467         }
00468         
00469         links.push_back(l);
00470       }
00471       
00472       e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera20">popContext</a>();
00473     
00474       <span class="keywordflow">if</span> (links.size() &lt; 1)
00475         <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"a KinematicChain must contain at least one link (&lt;link&gt;...&lt;/link&gt;)."</span>));
00476 
00477     }
00478     <span class="keywordflow">else</span>
00479       <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"unknown KinematicChain type "</span>)+type));
00480       
00481     computeVariables();
00482     dirtyHash(); 
00483   }
00484 }
00485 
00486 
00487 
00488 <span class="keywordtype">void</span> KinematicChain::Link::externalize(<a class="code" href="classbase_1_1Externalizer.html">base::Externalizer</a>&amp; e, String format, Real version)
00489 {
00490   <span class="keywordflow">if</span> (format == <span class="stringliteral">""</span>) format = <span class="stringliteral">"xml"</span>;
00491   
00492   <span class="keywordflow">if</span> (!formatSupported(format,version,e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera6">ioType</a>()))
00493     <span class="keywordflow">throw</span> std::invalid_argument(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"format "</span>)+format+<span class="stringliteral">" v"</span>+base::realToString(version)+<span class="stringliteral">" unsupported"</span>));
00494   
00495   <span class="keywordflow">if</span> (e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera4">isOutput</a>()) {
00496     DOMElement* linkElem = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera18">createElement</a>(<span class="stringliteral">"link"</span>,<span class="keyword">false</span>);
00497     <span class="keywordtype">char</span> buf[1024];
00498 
00499     <span class="keywordflow">if</span> (type() == Revolute) {
00500       <span class="keywordflow">if</span> (  (Math::equals(jminLimit, KinematicChain::unboundedMinAngleLimit))
00501           ||(Math::equals(jmaxLimit, KinematicChain::unboundedMaxAngleLimit)) )
00502         sprintf(buf, <span class="stringliteral">"revolute , %8.4f, %8.4f, %8.4f, %8.4f,    -inf ,     +inf "</span>,
00503                 Math::radToDeg(alpha), a, d, Math::radToDeg(theta));
00504       <span class="keywordflow">else</span>
00505         sprintf(buf, <span class="stringliteral">"revolute , %8.4f, %8.4f, %8.4f, %8.4f, %8.4f, %8.4f "</span>,
00506                 Math::radToDeg(alpha), a, d, Math::radToDeg(theta),
00507                 Math::radToDeg(jminLimit), Math::radToDeg(jmaxLimit));
00508     }
00509     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type() == Prismatic) {
00510       <span class="keywordtype">char</span> minBuf[32], maxBuf[32];
00511       <span class="keywordflow">if</span> (Math::equals(jminLimit, KinematicChain::unboundedMinDistLimit,999))
00512         sprintf(minBuf, <span class="stringliteral">"%8.4f"</span>, jminLimit);
00513       <span class="keywordflow">else</span>
00514         sprintf(minBuf, <span class="stringliteral">"%s"</span>, <span class="stringliteral">"-inf"</span>);
00515 
00516       <span class="keywordflow">if</span> (Math::equals(jmaxLimit, KinematicChain::unboundedMaxDistLimit,999))
00517         sprintf(maxBuf, <span class="stringliteral">"%8.4f"</span>, jmaxLimit);
00518       <span class="keywordflow">else</span>
00519         sprintf(maxBuf, <span class="stringliteral">"%s"</span>, <span class="stringliteral">"+inf"</span>);
00520 
00521       sprintf(buf, <span class="stringliteral">"prismatic, %8.4f, %8.4f, %8.4f, %8.4f, %s, %s "</span>,
00522               Math::radToDeg(alpha), a, d, Math::radToDeg(theta),
00523               minBuf, maxBuf);
00524     }
00525     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type() == Translating) {
00526       <span class="keywordtype">char</span> minBuf[32], maxBuf[32];
00527       <span class="keywordflow">if</span> (Math::equals(jminLimit, KinematicChain::unboundedMinDistLimit,999))
00528         sprintf(minBuf, <span class="stringliteral">"%8.4f"</span>, jminLimit);
00529       <span class="keywordflow">else</span>
00530         sprintf(minBuf, <span class="stringliteral">"%s"</span>, <span class="stringliteral">"-inf"</span>);
00531 
00532       <span class="keywordflow">if</span> (Math::equals(jmaxLimit, KinematicChain::unboundedMaxDistLimit,999))
00533         sprintf(maxBuf, <span class="stringliteral">"%8.4f"</span>, jmaxLimit);
00534       <span class="keywordflow">else</span>
00535         sprintf(maxBuf, <span class="stringliteral">"%s"</span>, <span class="stringliteral">"+inf"</span>);
00536 
00537       sprintf(buf, <span class="stringliteral">"translating,         %8.4f, %8.4f, %8.4f, %s, %s "</span>,
00538               direction.x, direction.y, direction.z,
00539               minBuf, maxBuf);
00540     }
00541     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type() == FixedTransform) {
00542       <a class="code" href="debugtools.html#a12">Unimplemented</a>; <span class="comment">///!!!</span>
00543 <span class="comment"></span>    } 
00544     <span class="keywordflow">else</span>
00545       <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"unknown link type"</span>)));
00546       
00547     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera29">appendText</a>(linkElem,<a class="code" href="namespacebase.html#a4">String</a>(buf));
00548     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera21">appendElement</a>(linkElem);
00549     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera22">appendBreak</a>();
00550   }
00551   <span class="keywordflow">else</span> { <span class="comment">// input</span>
00552     DOMNode* context = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera16">context</a>();
00553     
00554     DOMElement* linkElem = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera37">getFirstChildElement</a>(context, <span class="stringliteral">"link"</span>);
00555 
00556     <a class="code" href="namespacebase.html#a4">String</a> linkText = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera40">getContainedText</a>(linkElem);
00557     array&lt;String&gt; elts = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizere2">splitAtDelimiter</a>(linkText,<span class="charliteral">','</span>);
00558     elts[0] = e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizere14">removeChar</a>(elts[0],<span class="charliteral">' '</span>);
00559     <span class="keywordflow">if</span> (elts[0] == <span class="stringliteral">"revolute"</span>)
00560       linkType = Revolute;
00561     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elts[0] == <span class="stringliteral">"prismatic"</span>)
00562       linkType = Prismatic;
00563     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elts[0] == <span class="stringliteral">"translating"</span>)
00564       linkType = Translating;
00565     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elts[0] == <span class="stringliteral">"transform"</span>)
00566       linkType = FixedTransform;
00567     <span class="keywordflow">else</span>
00568       <span class="keywordflow">throw</span> <a class="code" href="classbase_1_1externalization__error.html">externalization_error</a>(<a class="code" href="base.html#a15">Exception</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"link type should be either 'revolute', 'prismatic', 'translating' or 'transform'; not '"</span>)+elts[0]+<span class="stringliteral">"'."</span>));
00569 
00570     <a class="code" href="classdemeter_1_1Vector.html">Vector</a> vals( e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizere3">stringsToReals</a>(elts) );
00571     jminLimit=jmaxLimit = 0.0;
00572     <span class="keywordflow">if</span> (isDHType()) {
00573       alpha = Math::degToRad( vals[1] );
00574       a = vals[2];
00575       d = vals[3];
00576       theta = Math::degToRad( vals[4] );
00577       <span class="keywordflow">if</span> (type() == Revolute) {
00578         <span class="keywordflow">if</span> (vals.size() &gt; 6) {
00579           jminLimit = Math::degToRad( vals[5] );
00580           jmaxLimit = Math::degToRad( vals[6] );
00581         }
00582         <span class="keywordflow">if</span> (Math::equals(jminLimit,0) &amp;&amp; Math::equals(jmaxLimit,0)) { <span class="comment">// unbounded</span>
00583           jminLimit = KinematicChain::unboundedMinAngleLimit;
00584           jmaxLimit = KinematicChain::unboundedMaxAngleLimit;
00585         }
00586         
00587       }
00588       <span class="keywordflow">else</span> {
00589         <span class="keywordflow">if</span> (vals.size() &gt; 6) {
00590           jminLimit = vals[5];
00591           jmaxLimit = vals[6];
00592         }
00593         <span class="keywordflow">if</span> (Math::equals(jminLimit,0) &amp;&amp; Math::equals(jmaxLimit,0)) { <span class="comment">// unbounded</span>
00594           jminLimit = unboundedMinDistLimit;
00595           jmaxLimit = unboundedMaxDistLimit;
00596         }
00597       }
00598     }
00599     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type() == Translating) {
00600       direction.x = vals[1];
00601       direction.<a class="code" href="classdemeter_1_1Vector.html#demeter_1_1Vectoro1">y</a> = vals[2];
00602       direction.<a class="code" href="classdemeter_1_1Vector.html#demeter_1_1Vectoro2">z</a> = vals[3];
00603       <span class="keywordflow">if</span> (vals.size() &gt; 5) {
00604         jminLimit = vals[4];
00605         jmaxLimit = vals[5];
00606       }
00607       <span class="keywordflow">if</span> (Math::equals(jminLimit,0) &amp;&amp; Math::equals(jmaxLimit,0)) { <span class="comment">// unbounded</span>
00608         jminLimit = unboundedMinDistLimit;
00609         jmaxLimit = unboundedMaxDistLimit;
00610       }
00611     }
00612     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type() == FixedTransform) {
00613       <a class="code" href="debugtools.html#a12">Unimplemented</a>; <span class="comment">///!!!</span>
00614 <span class="comment"></span>    }
00615     <span class="keywordflow">else</span>
00616       <a class="code" href="base.html#a21">Assertm</a>(<span class="keyword">false</span>,<span class="stringliteral">"link type not implemented"</span>);
00617 
00618     e.<a class="code" href="classbase_1_1Externalizer.html#base_1_1Externalizera39">removeElement</a>(linkElem);
00619     
00620     dirtyHash(); 
00621   }
00622 
00623 }
00624 
00625 
00626 <a class="code" href="classbase_1_1array.html">base::array&lt;base::Byte&gt;</a> KinematicChain::hashCode()<span class="keyword"> const</span>
00627 <span class="keyword"></span>{
00628   <span class="keywordflow">if</span> (!hashDirty) <span class="keywordflow">return</span> hash;
00629   
00630   <span class="comment">// create an MD5 hash over the link size, dof and each link's hashCode()</span>
00631   <a class="code" href="classbase_1_1MD5.html">MD5</a> md5;
00632   <a class="code" href="namespacebase.html#a2">Int</a> chainSize = size();
00633   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;chainSize), <span class="keyword">sizeof</span>(Int));
00634   <a class="code" href="namespacebase.html#a2">Int</a> chainDOF = dof();
00635   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;chainDOF), <span class="keyword">sizeof</span>(Int));
00636   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> l=0; l&lt;size(); l++) {
00637     array&lt;Byte&gt; hashCode( links[l].hashCode() );
00638     md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a1">update</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)(&amp;(hashCode[0])), hashCode.size()); <span class="comment">// assumes array stores Bytes contigously</span>
00639   }
00640   md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a5">finalize</a>();
00641   
00642   hash.resize(16); <span class="comment">// MD5 implies 16 byte hash</span>
00643   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *digest = md5.<a class="code" href="classbase_1_1MD5.html#base_1_1MD5a10">raw_digest</a>();
00644   <span class="keywordflow">for</span>(<a class="code" href="namespacebase.html#a2">Int</a> b=0; b&lt;16; b++) hash[b] = digest[b];
00645   
00646   <span class="keywordflow">return</span> hash;
00647 }
00648 
00649 
00650 
<a name="l00651"></a><a class="code" href="namespacerobot.html#a0">00651</a> std::ostream&amp; <a class="code" href="namespacerobot.html#a0">robot::operator&lt;&lt;</a>(std::ostream&amp; out, <span class="keyword">const</span> <a class="code" href="classrobot_1_1KinematicChain_1_1Link.html">robot::KinematicChain::Link</a>&amp; l) <span class="comment">// Output</span>
00652 {
00653 
00654   <span class="keywordflow">switch</span>(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka8">type</a>()){
00655   <span class="keywordflow">case</span> KinematicChain::Link::Revolute:  
00656     <span class="keywordflow">if</span> (l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka9">isActive</a>()) 
00657       out &lt;&lt; <span class="stringliteral">"DH Revolute :"</span> &lt;&lt; <span class="stringliteral">" alpha:"</span> &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka14">getAlpha</a>()) &lt;&lt; <span class="stringliteral">",  a:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka15">getA</a>() &lt;&lt; <span class="stringliteral">",  d:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka16">getD</a>() &lt;&lt; <span class="stringliteral">",  {theta}:"</span>  &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka17">getTheta</a>()) &lt;&lt; std::endl; 
00658     <span class="keywordflow">else</span>
00659       out &lt;&lt; <span class="stringliteral">"DH Revolute :"</span> &lt;&lt; <span class="stringliteral">" alpha:"</span> &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka14">getAlpha</a>()) &lt;&lt; <span class="stringliteral">",  a:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka15">getA</a>() &lt;&lt; <span class="stringliteral">",  d:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka16">getD</a>() &lt;&lt; <span class="stringliteral">",  theta:"</span>  &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka17">getTheta</a>()) &lt;&lt; std::endl;       
00660     <span class="keywordflow">break</span>;
00661   <span class="keywordflow">case</span> KinematicChain::Link::Prismatic:  
00662     <span class="keywordflow">if</span> (l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka9">isActive</a>())
00663       out &lt;&lt; <span class="stringliteral">"DH Prismatic:"</span> &lt;&lt; <span class="stringliteral">" alpha:"</span> &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka14">getAlpha</a>()) &lt;&lt; <span class="stringliteral">",  a:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka15">getA</a>() &lt;&lt; <span class="stringliteral">",  {d}:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka16">getD</a>() &lt;&lt; <span class="stringliteral">",  theta:"</span>  &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka17">getTheta</a>()) &lt;&lt; std::endl;
00664     <span class="keywordflow">else</span>
00665       out &lt;&lt; <span class="stringliteral">"DH Prismatic:"</span> &lt;&lt; <span class="stringliteral">" alpha:"</span> &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka14">getAlpha</a>()) &lt;&lt; <span class="stringliteral">",  a:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka15">getA</a>() &lt;&lt; <span class="stringliteral">",  d:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka16">getD</a>() &lt;&lt; <span class="stringliteral">",  theta:"</span>  &lt;&lt; Math::radToDeg(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka17">getTheta</a>()) &lt;&lt; std::endl;
00666     <span class="keywordflow">break</span>;
00667   <span class="keywordflow">case</span> KinematicChain::Link::Translating:
00668     <span class="keywordflow">if</span> (l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka9">isActive</a>())
00669       out &lt;&lt; <span class="stringliteral">"Translating : direction {t}:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka23">getT</a>() &lt;&lt; <span class="stringliteral">"*"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka22">getDirection</a>() &lt;&lt; std::endl;
00670     <span class="keywordflow">else</span>
00671       out &lt;&lt; <span class="stringliteral">"Translating : direction t:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka23">getT</a>() &lt;&lt; <span class="stringliteral">"*"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka22">getDirection</a>() &lt;&lt; std::endl;
00672     <span class="keywordflow">break</span>;
00673   <span class="keywordflow">case</span> KinematicChain::Link::FixedTransform:
00674     out &lt;&lt; <span class="stringliteral">"Transform   : translation:"</span> &lt;&lt; l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka26">getTransform</a>().<a class="code" href="classbase_1_1Matrix4.html#base_1_1Matrix4a17">column</a>(4).<a class="code" href="classbase_1_1Vector4.html#base_1_1Vector4a24">toVector3</a>() &lt;&lt; <span class="stringliteral">" rotation:"</span> &lt;&lt; <a class="code" href="classbase_1_1Orient.html">base::Orient</a>(<a class="code" href="classbase_1_1Matrix3.html">Matrix3</a>(l.<a class="code" href="classrobot_1_1KinematicChain_1_1Link.html#robot_1_1KinematicChain_1_1Linka26">getTransform</a>())).getQuat4() &lt;&lt; std::endl;
00675     <span class="keywordflow">break</span>;
00676   <span class="keywordflow">default</span>: out &lt;&lt; <span class="stringliteral">"unknown joint type\n"</span>;
00677   }
00678   <span class="keywordflow">return</span> out;
00679 }
00680 
00681 
00682 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:36 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
