<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: base/OrientTest.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>base/OrientTest.cpp</h1><a href="OrientTest_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)2002 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: OrientTest.cpp 1029 2004-02-11 20:45:54Z jungd $</span>
00019 <span class="comment">  $Revision: 1.6 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:45:54 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="OrientTest.html">base/OrientTest</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;<a class="code" href="Math.html">base/Math</a>&gt;</span>
00028 
00029 <span class="preprocessor">#include &lt;<a class="code" href="Transform.html">base/Transform</a>&gt;</span>
00030 
00031 <span class="keyword">using</span> <a class="code" href="classbase_1_1OrientTest.html">base::OrientTest</a>;
00032 
00033 <span class="keyword">using</span> <a class="code" href="classbase_1_1Math.html">base::Math</a>;
00034 <span class="keyword">using</span> <a class="code" href="classbase_1_1Quat4.html">base::Quat4</a>;
00035 <span class="keyword">using</span> <a class="code" href="classbase_1_1matrix.html">base::Matrix</a>;
00036 <span class="keyword">using</span> <a class="code" href="classbase_1_1vector.html">base::Vector</a>;
00037 <span class="keyword">using</span> <a class="code" href="classbase_1_1Transform.html">base::Transform</a>;
00038 
00039 
00040 
00041 OrientTest::OrientTest()
00042   : m(3,3)
00043 {
00044 }
00045 
00046 
00047 <span class="keywordtype">void</span> OrientTest::setUp() 
00048 { 
00049 
00050 }
00051   
00052 
00053 <span class="keywordtype">void</span> OrientTest::tearDown()
00054 { 
00055 }
00056 
00057 
00058 
00059 <span class="keywordtype">void</span> OrientTest::testQuatMat()
00060 {
00061   <span class="comment">// test a basic Quat4 rotation</span>
00062   Quat4 qr(Vector3(1,1,0),consts::Pi/2.0);
00063   <a class="code" href="namespacebase.html#a26">Point3</a> up(1,0,0);
00064   CPPUNIT_ASSERT( qr.rotate(up).equals(<a class="code" href="namespacebase.html#a26">Point3</a>(0.5,0.5,-0.707107),1e-5) );
00065 
00066 
00067   <span class="comment">// test some basic interconversions first</span>
00068   Quat4 rotx45(Vector3(1,0,0),Math::degToRad(45));
00069   Orient o(rotx45);
00070 
00071   CPPUNIT_ASSERT( o.getQuat4() == rotx45 );
00072 
00073   <a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp1">m</a>.<a class="code" href="classbase_1_1matrix.html#base_1_1matrixa17">reset</a>( o.getRotationMatrix() );
00074   CPPUNIT_ASSERT(<a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp1">m</a>.<a class="code" href="classbase_1_1matrix.html#base_1_1matrixa8">size1</a>() == 3);
00075   CPPUNIT_ASSERT(<a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp1">m</a>.<a class="code" href="classbase_1_1matrix.html#base_1_1matrixa9">size2</a>() == 3);
00076 
00077   Orient o2(m);
00078 
00079   <a class="code" href="classbase_1_1matrix.html">Matrix</a> m2( o2.getRotationMatrix() );
00080   
00081   CPPUNIT_ASSERT( base::equals(m2,m) );
00082 
00083 
00084   Quat4 <a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp0">q</a>(Vector3(1,1,0),consts::Pi/4.0);
00085 
00086   <span class="comment">// test two paths for getting the same matrix into an Orient</span>
00087   Orient oq(q);
00088   Matrix4 oqm(oq.getRotationMatrix3()); 
00089   Orient  om = Matrix3(oqm);
00090   Matrix4 omm(om.getRotationMatrix3());
00091   CPPUNIT_ASSERT( omm.equals(oqm) );
00092  
00093   <span class="comment">// test Quat4 &amp; Orient to matrix conversions are identical</span>
00094   Orient q3(q);
00095   Matrix3 m3(q3.getRotationMatrix3());
00096   CPPUNIT_ASSERT( Matrix4(m3).<a class="code" href="namespacebase.html#a61">equals</a>(Matrix4(q)) );
00097   
00098 
00099   <span class="comment">// test quat-&gt;Mat-&gt;quat</span>
00100   Orient q3m(m3);
00101   Orient q3mq(q3m.getQuat4());
00102 
00103   Quat4 q31(q3.getQuat4());
00104   Quat4 q32(q3mq.getQuat4());
00105   <a class="code" href="namespacebase.html#a26">Point3</a> u(1,2,3);
00106   <a class="code" href="namespacebase.html#a26">Point3</a> u1(q31.rotate(u));
00107   <a class="code" href="namespacebase.html#a26">Point3</a> u2(q32.rotate(u));
00108   <a class="code" href="namespacebase.html#a26">Point3</a> u3(m3*u);
00109   <a class="code" href="namespacebase.html#a26">Point3</a> u4(q.rotate(u));
00110 
00111   CPPUNIT_ASSERT( u1.equals(u2) );
00112   CPPUNIT_ASSERT( u1.equals(u3) );
00113   CPPUNIT_ASSERT( u1.equals(u4) );
00114   
00115   <span class="comment">// test quat inverse</span>
00116   Quat4 q4(Vector3(1,2,4), consts::Pi/3.0);
00117   Quat4 q4i( <a class="code" href="namespacebase.html#a115">inverse</a>(q4) );
00118   CPPUNIT_ASSERT( q4i.rotate(q4.rotate(u)).equals(u) );
00119   Matrix4 m4(q4);
00120   Matrix4 m4i(q4i);
00121   CPPUNIT_ASSERT( (m4i*m4*u).<a class="code" href="namespacebase.html#a61">equals</a>(u) );
00122   Matrix4 m4id( m4i*m4 );
00123   Matrix4 I; I.setIdentity();
00124   CPPUNIT_ASSERT( m4id.equals(I) );
00125 
00126   <span class="comment">// test orient inverse</span>
00127   Orient o4 = Quat4(Vector3(1,2,4), consts::Pi/3.0);
00128   Orient o4i = <a class="code" href="namespacebase.html#a115">inverse</a>(o4.getQuat4());
00129   CPPUNIT_ASSERT( o4i.rotate(o4.rotate(u)).equals(u) );
00130   Matrix4 om4(o4);
00131   Matrix4 om4i(o4i);
00132   CPPUNIT_ASSERT( (om4i*om4*u).<a class="code" href="namespacebase.html#a61">equals</a>(u) );
00133   Matrix4 om4id( om4i*om4 );
00134   CPPUNIT_ASSERT( om4id.equals(I) );
00135 }
00136 
00137 
00138 
00139 <span class="keywordtype">void</span> OrientTest::testTransform()
00140 {
00141   Quat4 <a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp0">q</a>(0.158724,0.508859,0.458874,0.710847);
00142   Orient o(q);
00143   Transform t(q);
00144   
00145   <a class="code" href="namespacebase.html#a26">Point3</a> p(1,2,3);
00146   CPPUNIT_ASSERT( q.rotate(p).equals(o.rotate(p)) );
00147   CPPUNIT_ASSERT( q.rotate(p).equals(t.rotate(p)) );
00148 }
00149 
00150 
00151 
00152 <span class="keywordtype">void</span> OrientTest::testEulerRPY()
00153 {
00154   <span class="comment">// construct a EulerRPY manually as rotations about</span>
00155   <span class="comment">//  axes and see if we get what we expect</span>
00156   
00157   <a class="code" href="namespacebase.html#a5">Real</a> roll = consts::Pi/3.1;
00158   <a class="code" href="namespacebase.html#a5">Real</a> pitch = consts::Pi/5.1;
00159   <a class="code" href="namespacebase.html#a5">Real</a> yaw = consts::Pi/2.1;
00160   
00161   <span class="comment">// construct rotation about X, Y, Z axes in that order (static/fixed frames)</span>
00162   Transform rotx = Quat4(Vector3(1,0,0), roll);
00163   Transform roty = Quat4(Vector3(0,1,0), pitch);
00164   Transform rotz = Quat4(Vector3(0,0,1), yaw);
00165   Transform qt( rotz*roty*rotx );
00166   
00167   Orient rpyt(roll,pitch, yaw);
00168   
00169   <a class="code" href="namespacebase.html#a26">Point3</a> p(1,2,3); <span class="comment">// test point to transform</span>
00170   <a class="code" href="namespacebase.html#a26">Point3</a> pqt( qt.rotate(p) ); <span class="comment">// transform using manually constructed quat</span>
00171   <a class="code" href="namespacebase.html#a26">Point3</a> prpyt( rpyt.rotate(p) ); <span class="comment">// transform using RPY</span>
00172   <a class="code" href="namespacebase.html#a26">Point3</a> pit( rotz.rotate(roty.rotate(rotx.rotate(p))) ); <span class="comment">// transform via sucessive application of individual rotations in order</span>
00173   
00174   CPPUNIT_ASSERT( pqt.equals(prpyt) );
00175   CPPUNIT_ASSERT( pqt.equals(pit) );
00176 
00177   
00178   <span class="comment">// convert to a Quat and back and test preservation</span>
00179   Orient <a class="code" href="classbase_1_1OrientTest.html#base_1_1OrientTestp0">q</a>(rpyt);
00180   q.changeRepresentation(Orient::Quat);
00181   CPPUNIT_ASSERT( q.rotate(p).equals(pqt) ); <span class="comment">// check is same transformation</span>
00182   q.changeRepresentation(Orient::EulerRPY);
00183   
00184   CPPUNIT_ASSERT( q.equals(rpyt) );
00185 
00186   <span class="comment">// convert to matrix and back</span>
00187   q.changeRepresentation(Orient::Mat);
00188   CPPUNIT_ASSERT( <a class="code" href="namespacebase.html#a26">Point3</a>(q.getRotationMatrix3() * p).equals(pqt) ); <span class="comment">// check is same transformation</span>
00189   q.changeRepresentation(Orient::EulerRPY);
00190 
00191   CPPUNIT_ASSERT( q.equals(rpyt) );
00192   
00193   <span class="comment">// convert to EulerZYXs and back</span>
00194   q.changeRepresentation(Orient::EulerZYXs);
00195   q.changeRepresentation(Orient::EulerRPY);
00196   CPPUNIT_ASSERT( q.equals(rpyt) );
00197   
00198   <span class="comment">// Try converting from EulerRPY to Quat, to Mat and back</span>
00199   Orient o1(1.57071,-1.00007,0.800039);
00200   Orient o2(o1); 
00201   o2.changeRepresentation(Orient::Quat);
00202   o2.changeRepresentation(Orient::Mat);
00203   o2.changeRepresentation(Orient::EulerRPY);
00204   CPPUNIT_ASSERT( o1.equals(o2) );
00205   
00206   <span class="comment">// try another conversion from RPY-&gt;Quat and back at gymbal-lock config</span>
00207   Orient o3(0,0,1.5708);
00208   Orient o4(o3);
00209   o3.changeRepresentation(Orient::Quat);
00210   o3.changeRepresentation(Orient::EulerRPY);
00211   CPPUNIT_ASSERT( o3.equals(o4) );
00212 }
00213 
00214 
00215 
00216 
00217 
00218 <span class="preprocessor">#ifdef DEBUG</span>
00219 <span class="preprocessor"></span>CPPUNIT_TEST_SUITE_REGISTRATION( OrientTest );
00220 <span class="preprocessor">#endif</span>
00221 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:08 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
