<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/control/oldikor/IKOR/analytical.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/control/oldikor/IKOR/analytical.c</h1><a href="analytical_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ________________________________________________________</span>
00002 <span class="comment">  |                                                        |</span>
00003 <span class="comment">  | Program Name:   Analytical.c                           |</span>
00004 <span class="comment">  |________________________________________________________|</span>
00005 <span class="comment">  |                                                        |</span>
00006 <span class="comment">  | description: Aquires Betas for constraints and det-    |</span>
00007 <span class="comment">  |     ermine the Analytical solution for each time step. |</span>
00008 <span class="comment">  |                                                        |</span>
00009 <span class="comment">  | Procedures:                                            |</span>
00010 <span class="comment">  |    Build_Grammian2 :                                   |</span>
00011 <span class="comment">  |    find_jl_beta    :                                   |</span>
00012 <span class="comment">  |    find_obs_beta   :                                   |</span>
00013 <span class="comment">  |    findt           :  A whole slew of these            |</span>
00014 <span class="comment">  |________________________________________________________| */</span>
00015 
00016 
00017 <span class="preprocessor">#include &lt;<a class="code" href="general_8h.html">IKOR/general.h</a>&gt;</span>       <span class="comment">/* Header File to link all others */</span>
00018 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00019 <span class="preprocessor">#include &lt;math.h&gt;</span>
00020 
<a name="l00021"></a><a class="code" href="analytical_8c.html#a3">00021</a> <span class="keywordtype">void</span> <a class="code" href="analytical_8c.html#a3">simp1</a>(a,mm,ll,nll,iabf,kp,bmax)
00022 <span class="keywordtype">float</span> **a,*bmax;
00023 <span class="keywordtype">int</span> *kp,iabf,ll[],mm,nll;
00024 {
00025   <span class="keywordtype">int</span> k;
00026   <span class="keywordtype">float</span> test;
00027 
00028   *kp=ll[1];
00029   *bmax=a[mm+1][*kp+1];
00030   <span class="keywordflow">for</span> (k=2;k&lt;=nll;k++) {
00031     <span class="keywordflow">if</span> (iabf == 0)
00032       test=a[mm+1][ll[k]+1]-(*bmax);
00033     <span class="keywordflow">else</span>
00034       test=fabs(a[mm+1][ll[k]+1])-fabs(*bmax);
00035     <span class="keywordflow">if</span> (test &gt; 0.0) {
00036       *bmax=a[mm+1][ll[k]+1];
00037       *kp=ll[k];
00038     }
00039   }
00040 }
00041 
00042 
<a name="l00043"></a><a class="code" href="analytical_8c.html#a0">00043</a> <span class="preprocessor">#define EPS 1.0e-6</span>
<a name="l00044"></a><a class="code" href="analytical_8c.html#a4">00044</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="analytical_8c.html#a4">simp2</a>(a,n,l2,nl2,ip,kp,q1)
00045 <span class="keywordtype">float</span> **a,*q1;
00046 <span class="keywordtype">int</span> *ip,kp,l2[],n,nl2;
00047 {
00048   <span class="keywordtype">int</span> k,ii,i;
00049   <span class="keywordtype">float</span> qp,q0,q;
00050 
00051   *ip=0;
00052   <span class="keywordflow">for</span> (i=1;i&lt;=nl2;i++) {
00053     <span class="keywordflow">if</span> (a[l2[i]+1][kp+1] &lt; -<a class="code" href="analytical_8c.html#a0">EPS</a>) {
00054       *q1 = -a[l2[i]+1][1]/a[l2[i]+1][kp+1];
00055       *ip=l2[i];
00056       <span class="keywordflow">for</span> (i=i+1;i&lt;=nl2;i++) {
00057         ii=l2[i];
00058         <span class="keywordflow">if</span> (a[ii+1][kp+1] &lt; -<a class="code" href="analytical_8c.html#a0">EPS</a>) {
00059           q = -a[ii+1][1]/a[ii+1][kp+1];
00060           <span class="keywordflow">if</span> (q &lt; *q1) {
00061             *ip=ii;
00062             *q1=q;
00063           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q == *q1) {
00064             <span class="keywordflow">for</span> (k=1;k&lt;=n;k++) {
00065               qp = -a[*ip+1][k+1]/a[*ip+1][kp+1];
00066               q0 = -a[ii+1][k+1]/a[ii+1][kp+1];
00067               <span class="keywordflow">if</span> (q0 != qp) <span class="keywordflow">break</span>;
00068             }
00069             <span class="keywordflow">if</span> (q0 &lt; qp) *ip=ii;
00070           }
00071         }
00072       }
00073     }
00074   }
00075 }
00076 
00077 
<a name="l00078"></a><a class="code" href="analytical_8c.html#a5">00078</a> <span class="keywordtype">void</span> <a class="code" href="analytical_8c.html#a5">simp3</a>(a,i1,k1,ip,kp)
00079 <span class="keywordtype">float</span> **a;
00080 <span class="keywordtype">int</span> i1,ip,k1,kp;
00081 {
00082   <span class="keywordtype">int</span> kk,ii;
00083   <span class="keywordtype">float</span> piv;
00084 
00085   piv=1.0/a[ip+1][kp+1];
00086   <span class="keywordflow">for</span> (ii=1;ii&lt;=i1+1;ii++)
00087     <span class="keywordflow">if</span> (ii-1 != ip) {
00088       a[ii][kp+1] *= piv;
00089       <span class="keywordflow">for</span> (kk=1;kk&lt;=k1+1;kk++)
00090         <span class="keywordflow">if</span> (kk-1 != kp)
00091           a[ii][kk] -= a[ip+1][kk]*a[ii][kp+1];
00092     }
00093   <span class="keywordflow">for</span> (kk=1;kk&lt;=k1+1;kk++)
00094     <span class="keywordflow">if</span> (kk-1 != kp) a[ip+1][kk] *= -piv;
00095   a[ip+1][kp+1]=piv;
00096 }
00097 
00098 
<a name="l00099"></a><a class="code" href="analytical_8c.html#a1">00099</a> <span class="preprocessor">#define FREEALL free_ivector(l3,1,m);free_ivector(l2,1,m);\</span>
00100 <span class="preprocessor">                free_ivector(l1,1,n+1);</span>
00101 <span class="preprocessor"></span>
<a name="l00102"></a><a class="code" href="analytical_8c.html#a6">00102</a> <span class="keywordtype">void</span> <a class="code" href="analytical_8c.html#a6">simplx</a>(a,m,n,m1,m2,m3,icase,izrov,iposv)
00103 <span class="keywordtype">float</span> **a;
00104 <span class="keywordtype">int</span> *icase,iposv[],izrov[],m,m1,m2,m3,n;
00105 {
00106   <span class="keywordtype">void</span> <a class="code" href="analytical_8c.html#a3">simp1</a>(),<a class="code" href="analytical_8c.html#a4">simp2</a>(),<a class="code" href="analytical_8c.html#a5">simp3</a>();
00107   <span class="keywordtype">int</span> i,ip,ir,is,k,kh,kp,m12,nl1,nl2;
00108   <span class="keywordtype">int</span> *l1,*l2,*l3;
00109   <span class="keywordtype">float</span> q1,bmax;
00110 
00111   <span class="keywordflow">if</span> (m != (m1+m2+m3)) <a class="code" href="nrutil_8h.html#a13">nrerror</a>(<span class="stringliteral">"Bad input constraint counts in simplx"</span>);
00112   l1=<a class="code" href="nrutil_8h.html#a21">ivector</a>(1,n+1);
00113   l2=<a class="code" href="nrutil_8h.html#a21">ivector</a>(1,m);
00114   l3=<a class="code" href="nrutil_8h.html#a21">ivector</a>(1,m);
00115   nl1=n;
00116   <span class="keywordflow">for</span> (k=1;k&lt;=n;k++) l1[k]=izrov[k]=k;
00117   nl2=m;
00118   <span class="keywordflow">for</span> (i=1;i&lt;=m;i++) {
00119     <span class="keywordflow">if</span> (a[i+1][1] &lt; 0.0) <a class="code" href="nrutil_8h.html#a13">nrerror</a>(<span class="stringliteral">"Bad input tableau in simplx"</span>);
00120     l2[i]=i;
00121     iposv[i]=n+i;
00122   }
00123   <span class="keywordflow">for</span> (i=1;i&lt;=m2;i++) l3[i]=1;
00124   ir=0;
00125   <span class="keywordflow">if</span> (m2+m3) {
00126     ir=1;
00127     <span class="keywordflow">for</span> (k=1;k&lt;=(n+1);k++) {
00128       q1=0.0;
00129       <span class="keywordflow">for</span> (i=m1+1;i&lt;=m;i++) q1 += a[i+1][k];
00130       a[m+2][k] = -q1;
00131     }
00132     <span class="keywordflow">do</span> {
00133       <a class="code" href="analytical_8c.html#a3">simp1</a>(a,m+1,l1,nl1,0,&amp;kp,&amp;bmax);
00134       <span class="keywordflow">if</span> (bmax &lt;= <a class="code" href="analytical_8c.html#a0">EPS</a> &amp;&amp; a[m+2][1] &lt; -<a class="code" href="analytical_8c.html#a0">EPS</a>) {
00135         *icase = -1;
00136         <a class="code" href="analytical_8c.html#a1">FREEALL</a> <span class="keywordflow">return</span>;
00137       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bmax &lt;= <a class="code" href="analytical_8c.html#a0">EPS</a> &amp;&amp; a[m+2][1] &lt;= <a class="code" href="analytical_8c.html#a0">EPS</a>) {
00138         m12=m1+m2+1;
00139         <span class="keywordflow">if</span> (m12 &lt;= m) {
00140           <span class="keywordflow">for</span> (ip=m12;ip&lt;=m;ip++) {
00141             <span class="keywordflow">if</span> (iposv[ip] == (ip+n)) {
00142               <a class="code" href="analytical_8c.html#a3">simp1</a>(a,ip,l1,
00143                 nl1,1,&amp;kp,&amp;bmax);
00144               <span class="keywordflow">if</span> (bmax &gt; 0.0)
00145                 <span class="keywordflow">goto</span> one;
00146             }
00147           }
00148         }
00149         ir=0;
00150         --m12;
00151         <span class="keywordflow">if</span> (m1+1 &lt;= m12)
00152           <span class="keywordflow">for</span> (i=m1+1;i&lt;=m12;i++)
00153             <span class="keywordflow">if</span> (l3[i-m1] == 1)
00154               <span class="keywordflow">for</span> (k=1;k&lt;=n+1;k++)
00155                 a[i+1][k] = -a[i+1][k];
00156         <span class="keywordflow">break</span>;
00157       }
00158       <a class="code" href="analytical_8c.html#a4">simp2</a>(a,n,l2,nl2,&amp;ip,kp,&amp;q1);
00159       <span class="keywordflow">if</span> (ip == 0) {
00160         *icase = -1;
00161         <a class="code" href="analytical_8c.html#a1">FREEALL</a> <span class="keywordflow">return</span>;
00162       }
00163   one:  <a class="code" href="analytical_8c.html#a5">simp3</a>(a,m+1,n,ip,kp);
00164       <span class="keywordflow">if</span> (iposv[ip] &gt;= (n+m1+m2+1)) {
00165         <span class="keywordflow">for</span> (k=1;k&lt;=nl1;k++)
00166           <span class="keywordflow">if</span> (l1[k] == kp) <span class="keywordflow">break</span>;
00167         --nl1;
00168         <span class="keywordflow">for</span> (is=k;is&lt;=nl1;is++) l1[is]=l1[is+1];
00169         ++a[m+2][kp+1];
00170         <span class="keywordflow">for</span> (i=1;i&lt;=m+2;i++) a[i][kp+1] = -a[i][kp+1];
00171       } <span class="keywordflow">else</span> {
00172         <span class="keywordflow">if</span> (iposv[ip] &gt;= (n+m1+1)) {
00173           kh=iposv[ip]-m1-n;
00174           <span class="keywordflow">if</span> (l3[kh]) {
00175             l3[kh]=0;
00176             ++a[m+2][kp+1];
00177             <span class="keywordflow">for</span> (i=1;i&lt;=m+2;i++)
00178               a[i][kp+1] = -a[i][kp+1];
00179           }
00180         }
00181       }
00182       is=izrov[kp];
00183       izrov[kp]=iposv[ip];
00184       iposv[ip]=is;
00185     } <span class="keywordflow">while</span> (ir);
00186   }
00187   <span class="keywordflow">for</span> (;;) {
00188     <a class="code" href="analytical_8c.html#a3">simp1</a>(a,0,l1,nl1,0,&amp;kp,&amp;bmax);
00189     <span class="keywordflow">if</span> (bmax &lt;= 0.0) {
00190       *icase=0;
00191       <a class="code" href="analytical_8c.html#a1">FREEALL</a> <span class="keywordflow">return</span>;
00192     }
00193     <a class="code" href="analytical_8c.html#a4">simp2</a>(a,n,l2,nl2,&amp;ip,kp,&amp;q1);
00194     <span class="keywordflow">if</span> (ip == 0) {
00195       *icase=1;
00196       <a class="code" href="analytical_8c.html#a1">FREEALL</a> <span class="keywordflow">return</span>;
00197     }
00198     <a class="code" href="analytical_8c.html#a5">simp3</a>(a,m,n,ip,kp);
00199     is=izrov[kp];
00200     izrov[kp]=iposv[ip];
00201     iposv[ip]=is;
00202   }
00203 }
00204 <span class="preprocessor">#undef FREEALL</span>
00205 <span class="preprocessor"></span>
00206 
00207 <span class="comment">/* Driver for routine simplx */</span>
<a name="l00208"></a><a class="code" href="analytical_8c.html#a2">00208</a> <span class="preprocessor">#define NM1M2 (sN+sM1+sM2)</span>
00209 <span class="preprocessor"></span>
<a name="l00210"></a><a class="code" href="analytical_8c.html#a7">00210</a> <a class="code" href="analytical_8c.html#a7">mysimplx</a>( c, sM, sN, sM1, sM2, sM3, NP, MP )
00211 <span class="keywordtype">float</span> **c;
00212 <span class="keywordtype">int</span> sM, sN, sM1, sM2, sM3;
00213 {
00214   <span class="keywordtype">int</span> i,icase,j,*izrov,*iposv;
00215   <span class="keywordtype">float</span> **a;
00216   <span class="keyword">static</span> <span class="keywordtype">char</span> *txt[9]=
00217     {<span class="stringliteral">" "</span>,<span class="stringliteral">"x1"</span>,<span class="stringliteral">"x2"</span>,<span class="stringliteral">"x3"</span>,<span class="stringliteral">"x4"</span>,<span class="stringliteral">"y1"</span>,<span class="stringliteral">"y2"</span>,<span class="stringliteral">"y3"</span>};
00218 
00219 
00220     printf(<span class="stringliteral">"\n\n N: %d, M: %d, M1: %d, M2: %d, M3: %d, NP: %d, MP: %d"</span>,
00221                 sN,    sM,    sM1,    sM2,    sM3,     NP,     MP);             
00222     <span class="keywordflow">for</span> (i = 0; i&lt;MP; i++)      { printf( <span class="stringliteral">"\nA[%d] = "</span>, i );
00223       <span class="keywordflow">for</span> (j=0; j&lt;NP; j++)   printf( <span class="stringliteral">" %9.6f "</span>, c[i][j] ); }
00224     printf(<span class="stringliteral">"\n"</span>);
00225 
00226 
00227   izrov=<a class="code" href="nrutil_8h.html#a21">ivector</a>(1,sN);
00228   iposv=<a class="code" href="nrutil_8h.html#a21">ivector</a>(1,sM);
00229   a=<a class="code" href="nrutil_8h.html#a17">convert_matrix</a>(&amp;c[0][0],1,MP,1,NP);
00230   <a class="code" href="analytical_8c.html#a6">simplx</a>(a,sM,sN,sM1,sM2,sM3,&amp;icase,izrov,iposv);
00231   <span class="keywordflow">if</span> (icase == 1)
00232     printf(<span class="stringliteral">"\nunbounded objective function\n"</span>);
00233   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (icase == -1)
00234     printf(<span class="stringliteral">"\nno solutions satisfy constraints given\n"</span>);
00235   <span class="keywordflow">else</span> {
00236     printf(<span class="stringliteral">"\n%11s"</span>,<span class="stringliteral">" "</span>);
00237     <span class="keywordflow">for</span> (i=1;i&lt;=sN;i++)
00238       <span class="keywordflow">if</span> (izrov[i] &lt;= <a class="code" href="analytical_8c.html#a2">NM1M2</a>) printf(<span class="stringliteral">"%10s"</span>,txt[izrov[i]]);
00239     printf(<span class="stringliteral">"\n"</span>);
00240     <span class="keywordflow">for</span> (i=1;i&lt;=M+1;i++) {
00241       <span class="keywordflow">if</span> (i == 1 || iposv[i-1] &lt;= <a class="code" href="analytical_8c.html#a2">NM1M2</a>) {
00242         <span class="keywordflow">if</span> (i &gt; 1)
00243           printf(<span class="stringliteral">"%s"</span>,txt[iposv[i-1]]);
00244         <span class="keywordflow">else</span>
00245           printf(<span class="stringliteral">"  "</span>);
00246         printf(<span class="stringliteral">"%10.2f"</span>,a[i][1]);
00247         <span class="keywordflow">for</span> (j=2;j&lt;=N+1;j++)
00248           <span class="keywordflow">if</span> (izrov[j-1] &lt;= <a class="code" href="analytical_8c.html#a2">NM1M2</a>)
00249             printf(<span class="stringliteral">"%10.2f"</span>,a[i][j]);
00250         printf(<span class="stringliteral">"\n"</span>);
00251       }
00252     }
00253   }
00254   <a class="code" href="nrutil_8h.html#a32">free_convert_matrix</a>(a,1,MP,1,NP);
00255   <a class="code" href="nrutil_8h.html#a27">free_ivector</a>(iposv,1,sM);
00256   <a class="code" href="nrutil_8h.html#a27">free_ivector</a>(izrov,1,sN);
00257 
00258   exit (1);
00259   <span class="keywordflow">return</span> 0;
00260 }
00261 
00262 
00263 
00264 <span class="comment">/* ____________________________________________________</span>
00265 <span class="comment">  | name:    findt_without_Betas_SIMPLX                |</span>
00266 <span class="comment">  | description:                                       |</span>
00267 <span class="comment">  |                                                    |</span>
00268 <span class="comment">  | inputs:  FSP_data's betall and g vectors           |</span>
00269 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
00270 <span class="comment">  |____________________________________________________|</span>
00271 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
00272 <span class="comment">  | c hacker     02/95     Created                     |</span>
00273 <span class="comment">  |____________________________________________________| */</span>
00274 
<a name="l00275"></a><a class="code" href="headers_8h.html#a44">00275</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a44">findt_without_Betas_SIMPLX</a>(FSP_data, B, H, datafp)
00276 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>       
00277 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
00278           *H;             <span class="comment">/* H in Pins paper             */</span>
00279 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
00280 {
00281   <span class="keywordtype">int</span>     t_ind,
00282           col_ind,
00283           sN, sM, i, j; 
00284   <span class="keywordtype">float</span>  **coeff;
00285   <a class="code" href="structMATRIX.html">MATRIX</a> *dq;
00286 
00287   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00288     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n Executing SIMPLX Optimization \n"</span>);
00289     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n SPAN = %d  Bcols = %d gcols = %d\n"</span>, 
00290                         <a class="code" href="general_8h.html#a1">SPAN</a>, B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>);
00291     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">" Solution Vectors "</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00292   }
00293 
00294   dq   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>( FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>, 1 ); 
00295   coeff= (<span class="keywordtype">float</span> **) malloc ( 3 * <span class="keyword">sizeof</span>( <span class="keywordtype">float</span> * ) );
00296 
00297   <span class="keywordflow">for</span> (t_ind=0;t_ind&lt;3;t_ind++)
00298     coeff[t_ind]= (<span class="keywordtype">float</span> *) malloc ( (<a class="code" href="general_8h.html#a1">SPAN</a> + 1) * <span class="keyword">sizeof</span>( <span class="keywordtype">float</span> ) );
00299   coeff[0][0] = coeff[2][0] = 0.0; coeff[1][0] = 1.0;
00300 
00301   <span class="comment">/* This is the ONE SHOT Method, It is default or borig != 0      */</span>
00302   <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a25">ONE</a>) &amp;&amp; (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)) 
00303   {
00304     <span class="keywordflow">for</span> (t_ind = 1; t_ind &lt; <a class="code" href="general_8h.html#a1">SPAN</a>+1; t_ind++)
00305     {
00306       coeff[0][t_ind] = coeff[2][t_ind] = 0.0; coeff[1][t_ind] = -1.0;
00307       <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++)  coeff[0][t_ind] +=
00308         B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][col_ind] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[t_ind-1][col_ind];
00309     }
00310 
00311       <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) ;
00312 
00313     sN = <a class="code" href="general_8h.html#a1">SPAN</a>;
00314     sM = 1;
00315     printf(<span class="stringliteral">"\n N: %d, M: %d, M1: %d, M2: %d, M3: %d, NP: %d, MP: %d"</span>,
00316               sN,    sM,     0,      0,      1,     sN+1,   sM+2);              
00317     <span class="keywordflow">for</span> (i = 0; i&lt;3; i++)      { printf( <span class="stringliteral">"\nA[%d] = "</span>, i );
00318       <span class="keywordflow">for</span> (j=0; j&lt;<a class="code" href="general_8h.html#a1">SPAN</a>+1; j++)   printf( <span class="stringliteral">" %9.6f "</span>, coeff[i][j] ); }
00319     printf(<span class="stringliteral">"\n"</span>);
00320 
00321     <span class="comment">/*               sM  sN  sM1 sM2 sM3  NP    MP     */</span>
00322     <a class="code" href="analytical_8c.html#a7">mysimplx</a>( coeff, sM, sN,  0,  0,  1, sN+1, sM+2 );
00323 
00324   }
00325   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a26">TWO</a>) || (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)) {
00326     <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(31, <a class="code" href="general_8h.html#a24">OK</a>, <span class="stringliteral">" SIMPLX has no Null_Space Motions "</span>);
00327     <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++)
00328        dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0] = <a class="code" href="general_8h.html#a15">ZERO</a>;
00329   }
00330   <span class="keywordflow">else</span> <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(29,<a class="code" href="general_8h.html#a23">FATAL</a>,<span class="stringliteral">"findt_without_Betas_SIMPLX"</span>);
00331 
00332 
00333   <span class="keywordflow">return</span> (dq);
00334 }
00335 
00336 
00337 
00338 
00339 
00340 
00341 <span class="comment">/* ________________________________________________________</span>
00342 <span class="comment">  | name:    Build_Grammian2                               |</span>
00343 <span class="comment">  | description:  The Grammian is a multiplication of one  |</span>
00344 <span class="comment">  |     each solution vector with each solution vector.    |</span>
00345 <span class="comment">  |     Each component is a dot product of two of the      |</span>
00346 <span class="comment">  |     vectors.  The B values are used as a weighting     |</span>
00347 <span class="comment">  |     factor.  If B is the diagonal matrix for the       |</span>
00348 <span class="comment">  |     link weights, as the value goes from 1 to zero the |</span>
00349 <span class="comment">  |     joint that it relates to becomes more active. B    |</span>
00350 <span class="comment">  |     is the same as the matrix B (not Beta) in F.G.     |</span>
00351 <span class="comment">  |     Pin's paper.                                       |</span>
00352 <span class="comment">  |                                                        |</span>
00353 <span class="comment">  | inputs:  Solution Vectors (g), and alphas              |</span>
00354 <span class="comment">  | outputs: Allocates memory (the 2 in Build_Grammian2,   |</span>
00355 <span class="comment">  |     means that it allocates memory which must be freed |</span>
00356 <span class="comment">  |     by the calling routine), builds, and return the    |</span>
00357 <span class="comment">  |     structure to the calling routine.                  |</span>
00358 <span class="comment">  |________________________________________________________|</span>
00359 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00360 <span class="comment">  |  c hacker     10/94    Created                         |</span>
00361 <span class="comment">  |                1/95    Alphas implemented              |</span>
00362 <span class="comment">  |________________________________________________________| */</span>
00363 
<a name="l00364"></a><a class="code" href="headers_8h.html#a35">00364</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a35">Build_Grammian2</a> (FSP_data, B, datafp)
00365 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;
00366 <a class="code" href="structMATRIX.html">MATRIX</a>    *B;
00367 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;
00368 {
00369   <span class="keywordtype">int</span> i,j,k;
00370   <a class="code" href="structMATRIX.html">MATRIX</a> *Grammian,
00371          *gtemp,
00372          *Btemp,
00373          *gBtrans;
00374 
00375   Grammian = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, <a class="code" href="general_8h.html#a1">SPAN</a>);
00376   Btemp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>);   
00377                                      <span class="comment">/* if b is completely reduced this */</span>
00378                                      <span class="comment">/* is smaller than B               */</span>
00379   <span class="keywordflow">if</span> (B-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a> == Btemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>)
00380     <a class="code" href="matrix_8h.html#a20">mat_cp</a>(B, Btemp);
00381   <span class="keywordflow">else</span>
00382     <span class="keywordflow">for</span> (i=0; i&lt;Btemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)
00383       <span class="keywordflow">for</span> (j=0; j&lt;Btemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; j++)
00384         Btemp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00385   gtemp = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>, <a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo12">Weights</a>);
00386   gBtrans = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(gtemp, Btemp);
00387 
00388 
00389   <span class="keywordflow">for</span> (i = 0; i &lt; gBtrans-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++)
00390     <span class="keywordflow">for</span> (j = 0; j &lt; gBtrans-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; j++)
00391     {           
00392       Grammian-&gt; p[i][j] = 0;
00393       <span class="keywordflow">for</span> (k = 0; k &lt; gBtrans-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; k++)
00394       {
00395         Grammian -&gt; p[i][j] += gBtrans -&gt; p[i][k] *  gBtrans -&gt; p[j][k];
00396       }
00397     }
00398 
00399   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00400     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"\n  ______________________________  \n"</span>);
00401     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"\n         Building Grammian        \n"</span>);
00402     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,  <span class="stringliteral">"  ______________________________  \n\n"</span>);
00403     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"g"</span>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00404     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Angle Weights"</span>, <a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo12">Weights</a>);
00405     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"B Vector"</span>, B);
00406     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"g*Weights*B"</span>,gtemp);
00407     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Grammian"</span>,Grammian);
00408   }
00409 
00410   <a class="code" href="matrix_8h.html#a8">mat_free</a>(gtemp);
00411   <a class="code" href="matrix_8h.html#a8">mat_free</a>(gBtrans);
00412   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Btemp);
00413 
00414   <span class="keywordflow">return</span> (Grammian);
00415 }
00416 
00417 
00418 <span class="comment">/* ________________________________________________________</span>
00419 <span class="comment">  | name:    find_jl_beta                                  |</span>
00420 <span class="comment">  | description:  finds beta values for the joint defined  |</span>
00421 <span class="comment">  |    by chk.  Restricts said joint by confining it to    |</span>
00422 <span class="comment">  |    remain at a maximum or minimum limit.  The variable |</span>
00423 <span class="comment">  |    distance is the amount that the joint must move to  |</span>
00424 <span class="comment">  |    get to the max or the min.                          |</span>
00425 <span class="comment">  |                                                        |</span>
00426 <span class="comment">  | inputs:  See Declarations below                        |</span>
00427 <span class="comment">  | outputs: Alters two variables within FSP_data.         |</span>
00428 <span class="comment">  |     the beta vector for the joint is added to betall,  |</span>
00429 <span class="comment">  |     and cn, the number of beta vectors present, is     |</span>
00430 <span class="comment">  |     incremented.                                       |</span>
00431 <span class="comment">  |________________________________________________________|</span>
00432 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00433 <span class="comment">  |  F Tulloch     4/94    Algorithm Creation for 2 g's    |</span>
00434 <span class="comment">  |  c hacker     10/94    Ported from 2 g's to FSP        |</span>
00435 <span class="comment">  |                2/95    Ported to Solutions struct      |</span>
00436 <span class="comment">  |________________________________________________________| */</span>
00437 
<a name="l00438"></a><a class="code" href="headers_8h.html#a37">00438</a> <span class="keywordtype">void</span> <a class="code" href="headers_8h.html#a37">find_jl_beta</a>(FSP_data, chk, distance, datafp)
00439 FILE  *<a class="code" href="general_8h.html#a34">datafp</a>;         <span class="comment">/* data file declaration            */</span>
00440 <span class="keywordtype">int</span>    chk;            <span class="comment">/* link number and collision flag   */</span>
00441 <span class="keywordtype">double</span> distance;       <span class="comment">/* distance over low/up joint limit */</span>
00442 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;   <span class="comment">/* see structures.h                 */</span>
00443 {
00444   <span class="keywordtype">int</span> i;
00445 
00446   <span class="keywordflow">if</span> (chk &gt; (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a> -1));
00447   <span class="keywordflow">else</span>
00448     <span class="keywordflow">for</span>( i=0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>; i++ )
00449       FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>] = 
00450                              FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][chk]/(distance);
00451 
00452   FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>++;
00453 }                 <span class="comment">/* end find_jl_beta */</span>
00454 
00455 
00456 <span class="comment">/* ________________________________________________________</span>
00457 <span class="comment">  | name:    find_obs_beta                                 |</span>
00458 <span class="comment">  | description:  finds beta values for a link[chk] at a   |</span>
00459 <span class="comment">  |   distance, newl from its beginning, that has entered  |</span>
00460 <span class="comment">  |   an obstacle's buffer zone.  A Jacobian is created    |</span>
00461 <span class="comment">  |   for up to that portion of the link, and the beta     |</span>
00462 <span class="comment">  |   vector is calculated such that the point pushed back |</span>
00463 <span class="comment">  |   to the edge of the zone.                             |</span>
00464 <span class="comment">  |                                                        |</span>
00465 <span class="comment">  | inputs:  See Declarations below                        |</span>
00466 <span class="comment">  | outputs: Alters two variables within FSP_data. The     |</span>
00467 <span class="comment">  |   beta vector for the joint is added to betall, and    |</span>
00468 <span class="comment">  |   cn, the number of beta vectors present, is           |</span>
00469 <span class="comment">  |   incremented.                                         |</span>
00470 <span class="comment">  |________________________________________________________|</span>
00471 <span class="comment">  |  Authors:      Date:     Modifications:                |</span>
00472 <span class="comment">  |  F Tulloch     4/94      Algorithm Creation for 2 g's  |</span>
00473 <span class="comment">  |  c hacker     10/94      Ported from 2 g's to FSP      |</span>
00474 <span class="comment">  |                2/95      Ported to Solutions struct    |</span>
00475 <span class="comment">  |________________________________________________________| */</span>
00476 
<a name="l00477"></a><a class="code" href="analytical_8c.html#a11">00477</a> <span class="keywordtype">void</span> <a class="code" href="headers_8h.html#a38">find_obs_beta</a>(FSP_data, chk, newl, delta, normal, datafp)
00478   FILE   *<a class="code" href="general_8h.html#a34">datafp</a>;      <span class="comment">/* data file declaration                */</span>
00479   <span class="keywordtype">int</span>     chk;         <span class="comment">/* link that has moved into buffer      */</span>
00480   <span class="keywordtype">double</span> *newl,        <span class="comment">/* distance on chk link of most contact */</span>
00481           delta,       <span class="comment">/* distance needed to move along normal */</span>
00482           normal[3];   <span class="comment">/* normal guide vector                  */</span>
00483   <a class="code" href="structSolutions.html">Solutions</a> *FSP_data; <span class="comment">/* See structures.h                     */</span>
00484 {
00485   <span class="keywordtype">int</span>    i, j, p, k;
00486   <a class="code" href="structMATRIX.html">MATRIX</a> *alpha,        <span class="comment">/* Holds alphas        */</span>
00487          *Jacob;        <span class="comment">/* Holds Jacobian      */</span>
00488 
00489   alpha = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>( 3, <a class="code" href="general_8h.html#a1">SPAN</a> );
00490   Jacob = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>( N, M );
00491 
00492   <span class="comment">/*****************************************************************</span>
00493 <span class="comment">   *                                                               *</span>
00494 <span class="comment">   *        get new jacob using using new links based on inters    *</span>
00495 <span class="comment">   *****************************************************************/</span>
00496 
00497   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>; i++) <a class="code" href="general_8h.html#a58">LL</a>[i] = <a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo14">LINKS</a>[i];
00498 
00499   <a class="code" href="general_8h.html#a58">LL</a>[chk] = *newl;
00500   <span class="keywordflow">for</span> (i=chk+1; i&lt;<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>; i++ )  <a class="code" href="general_8h.html#a58">LL</a>[i] = 0.0;
00501 
00502   <a class="code" href="Jacob__UTILS_8c.html#a1">GET_JACOBIAN_ALTERED</a>(Jacob, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso7">Qarray</a>);      
00503  
00504   <span class="comment">/***********************************************************</span>
00505 <span class="comment">   *        Calculate Alphas and then betas necessary        *</span>
00506 <span class="comment">   ***********************************************************/</span>
00507 
00508   <span class="keywordflow">for</span> (i = 0;i&lt;3;i++) <span class="keywordflow">for</span> (p = 0;p&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;p++) alpha -&gt; p[i][p] = 0.0;
00509 
00510   <span class="comment">/* Calculate Alpha: J * g = (3 x VSpan) */</span>
00511   <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)  
00512     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00513       <span class="keywordflow">for</span> (k = 0; k &lt; M; k++)
00514         alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] += Jacob-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][k] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k];
00515 
00516   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00517     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Jacobian @ Xj ***"</span>, Jacob);
00518     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Alpha ***"</span>, alpha);
00519   }
00520 
00521   <span class="comment">/* Calculate Beta: Alpha * normal = (VSpan x 1) */</span>
00522   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00523   {
00524     FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>] = 0;
00525     <span class="keywordflow">for</span> (j = 0; j &lt; 3; j++)
00526       FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>] += 
00527                  alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] * normal[j];
00528     FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>] /= fabs(delta);
00529     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"b[%d]: %f  "</span>, i, 
00530                                 FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>]);
00531   }
00532   FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>++;
00533 
00534   <a class="code" href="matrix_8h.html#a8">mat_free</a>(alpha);
00535   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Jacob);
00536 }                 <span class="comment">/* end find_obs_beta */</span>
00537 
00538 
00539 <span class="comment">/* ____________________________________________________</span>
00540 <span class="comment">  | name:    findt_without_Betas_BANGBANG              |</span>
00541 <span class="comment">  | description:                                       |</span>
00542 <span class="comment">  |                                                    |</span>
00543 <span class="comment">  | inputs:  FSP_data's betall and g vectors           |</span>
00544 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
00545 <span class="comment">  |____________________________________________________|</span>
00546 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
00547 <span class="comment">  | c hacker     02/95     Created                     |</span>
00548 <span class="comment">  |____________________________________________________| */</span>
00549 
<a name="l00550"></a><a class="code" href="headers_8h.html#a43">00550</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a43">findt_without_Betas_BANGBANG</a>(FSP_data, B, H, old, datafp)
00551 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>       
00552 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
00553           *H,             <span class="comment">/* H in Pins paper             */</span>
00554           *old;           <span class="comment">/* previous dq                 */</span>
00555 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
00556 {
00557   <span class="keywordtype">int</span>   t_ind,
00558         col_ind,
00559         least_ind = -1,
00560         MISMATCH  = <a class="code" href="general_8h.html#a18">FALSE</a>; 
00561   <span class="keywordtype">float</span> least_flow,
00562         total_flow;
00563   <a class="code" href="structMATRIX.html">MATRIX</a> *dq, *dq1;
00564 
00565   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00566     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n Executing BIGBANG Optimization \n"</span>);
00567     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n SPAN = %d  Bcols = %d gcols = %d\n"</span>, 
00568                         <a class="code" href="general_8h.html#a1">SPAN</a>, B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>);
00569     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">" Solution Vectors "</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>);
00570   }
00571 
00572   dq   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>( FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>, 1 ); 
00573 
00574   <span class="comment">/* This is the ONE SHOT Method, It is default or borig != 0      */</span>
00575   <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a25">ONE</a>) &amp;&amp; (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)) 
00576   {
00577     <span class="keywordflow">for</span> (t_ind = 0; t_ind &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; t_ind++)
00578     {
00579       total_flow=0.0;
00580       <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++)
00581         total_flow += (old-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]&gt;0)?1.0:-1.0 *
00582                 ( B-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][col_ind] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[t_ind][col_ind] );
00583 
00584       <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>);{ fprintf(stderr, <span class="stringliteral">" %9.6f "</span>, total_flow ); }
00585  
00586       <span class="keywordflow">if</span> ((total_flow &lt; least_flow) || (least_ind&lt;0))
00587       { least_ind = t_ind; least_flow = total_flow; }
00588     }
00589 
00590     <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++) {
00591       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0] = FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[least_ind][col_ind];
00592       <span class="keywordflow">if</span> ((dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]&gt;=0)&amp;&amp;(old-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]&gt;=0));
00593       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]&lt;=0)&amp;&amp;(old-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]&lt;=0)); 
00594       <span class="keywordflow">else</span> {
00595         MISMATCH = <a class="code" href="general_8h.html#a17">TRUE</a>;
00596         fprintf(stderr, <span class="stringliteral">"MISMATCH: dq[%d] = %9.6f, old[%d] = %9.6f \n"</span>,
00597                 col_ind, dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0], col_ind, old-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0]);
00598         <span class="keywordflow">break</span>;
00599       }
00600     }
00601 
00602     <span class="keywordflow">if</span> (MISMATCH) {
00603         dq1 = <a class="code" href="headers_8h.html#a43">findt_without_Betas_BANGBANG</a>(FSP_data, B, H, dq, <a class="code" href="general_8h.html#a34">datafp</a>);
00604         <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++)
00605           dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0] = dq1-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0];
00606         <a class="code" href="matrix_8h.html#a8">mat_free</a>(dq1);
00607         MISMATCH = <a class="code" href="general_8h.html#a18">FALSE</a>;
00608     }
00609     <span class="keywordflow">else</span> fprintf(stderr, <span class="stringliteral">"OK"</span>);
00610 
00611 
00612     <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00613       fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nLeast Flow: %f, Least Index: %d \n\n\n"</span>, 
00614                 least_flow, least_ind );
00615     }
00616   }
00617   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a26">TWO</a>) || (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)) {
00618     <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(31, <a class="code" href="general_8h.html#a24">OK</a>, <span class="stringliteral">" BANGBANG has no Null_Space Motions "</span>);
00619     <span class="keywordflow">for</span> (col_ind=0; col_ind&lt;B-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>; col_ind++)
00620       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[col_ind][0] = <a class="code" href="general_8h.html#a15">ZERO</a>;
00621   }
00622   <span class="keywordflow">else</span> <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(29,<a class="code" href="general_8h.html#a23">FATAL</a>,<span class="stringliteral">"findt_without_Betas_BANGBANG"</span>);
00623 
00624 fprintf(stderr,<span class="stringliteral">"\n"</span>);
00625 
00626   <span class="keywordflow">return</span> (dq);
00627 }
00628 
00629 
00630 <span class="comment">/* ____________________________________________________</span>
00631 <span class="comment">  | name:    findt_with_Betas_Holonomic                |</span>
00632 <span class="comment">  | description:  find the parameterization for the    |</span>
00633 <span class="comment">  |    solution vectors found using FSP blocking.  The |</span>
00634 <span class="comment">  |    linear cmbination produced will either be a     |</span>
00635 <span class="comment">  |    full space or null space motion based on the    |</span>
00636 <span class="comment">  |    values of nu, and mu.  A macro is used to       |</span>
00637 <span class="comment">  |    determine which method to use.  TWOSTEP means   |</span>
00638 <span class="comment">  |    that a motion is first produced, and then       |</span>
00639 <span class="comment">  |    obstacles and joint limits are avoided in the   |</span>
00640 <span class="comment">  |    null space.  Otherwise, everything is done at   |</span>
00641 <span class="comment">  |    once in the full space.                         |</span>
00642 <span class="comment">  |                                                    |</span>
00643 <span class="comment">  | inputs:  FSP_data's betall and g vectors           |</span>
00644 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
00645 <span class="comment">  |____________________________________________________|</span>
00646 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
00647 <span class="comment">  | F Tulloch     4/94     Algorithm Creation for 2 g's|</span>
00648 <span class="comment">  | c hacker     10/94     Ported from 2 g's to FSP    |</span>
00649 <span class="comment">  |               2/95     Ported to Solutions struct  |</span>
00650 <span class="comment">  |               3/95     Implemented ONE &amp; TWO step  |</span>
00651 <span class="comment">  |____________________________________________________| */</span>
00652 
<a name="l00653"></a><a class="code" href="headers_8h.html#a39">00653</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a39">findt_with_Betas_Holonomic</a>(FSP_data, B, H, datafp)
00654 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>       
00655 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
00656           *H;             <span class="comment">/* H in Pins paper             */</span>
00657 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
00658 {
00659   <span class="keywordtype">int</span>     i, j, k, a, b;
00660   <span class="keywordtype">double</span>  sum1 = 0, sum2 = 0,
00661           afinal;
00662   <a class="code" href="structMATRIX.html">MATRIX</a> *bfinal,
00663          *cfinal,
00664          *dfinal,
00665          *A,  *Ainv,
00666          *nu, *mu,
00667          *e, *eT, 
00668          *t, *temp, *temp2, *temp3,
00669          *G, *Ginv, *iden,
00670          *dq;
00671   <span class="keywordtype">float</span>  ctemp;
00672 
00673   dq   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M   , 1); 
00674   e    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
00675   eT   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>( 1,   <a class="code" href="general_8h.html#a1">SPAN</a>);
00676 
00677   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n\n# of constraints %d \n"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00678 
00679   <span class="comment">/* initialize the vectors of ones */</span>
00680   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)   
00681   { e -&gt; p[i][0] = eT -&gt; p[0][i] = 1.0e0;}
00682 
00683   <span class="comment">/* See Methods.c, malloc's G, multiplies g's  and returns */</span>
00684   G = <a class="code" href="headers_8h.html#a35">Build_Grammian2</a>(FSP_data, B, <a class="code" href="general_8h.html#a34">datafp</a>);  
00685 
00686   Ginv = <a class="code" href="matrix_8h.html#a27">mat_cp2</a>(G);
00687   <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(Ginv);
00688   iden = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Ginv, G); 
00689 
00690   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {
00691     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Identity Matrix Check (G * Ginv) ***"</span>, iden);
00692     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** betas ***"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>);
00693   }
00694 
00695 
00696 
00697   <span class="comment">/***************************************************************</span>
00698 <span class="comment">   *                                                             *</span>
00699 <span class="comment">   *    a,b,c,d, A, mu, and nu are based on F.G. Pin's TM        *</span>
00700 <span class="comment">   *                                                             *</span>
00701 <span class="comment">   ***************************************************************/</span>
00702 
00703   <span class="comment">/********* Calculate a's *********/</span>
00704   afinal = 0;
00705   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00706     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00707       afinal += Ginv -&gt; p[i][j];
00708 
00709   <span class="comment">/********* Calculate b's *********/</span>
00710 
00711   temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>,1);
00712   bfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (1, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00713   <span class="keywordflow">for</span> (k = 0; k &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; k++)
00714   {
00715     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00716     {
00717       temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
00718       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00719         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k];
00720     }
00721     bfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][k] = 0.0;
00722     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00723       bfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][k] += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00724   }                 <span class="comment">/* end k for */</span>
00725   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00726 
00727   <span class="comment">/********* Calculate c's ********/</span>
00728 
00729   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
00730   cfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a> , 1);
00731   <span class="keywordflow">for</span> (a = 0; a &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; a++)
00732   {
00733     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00734     {
00735       temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
00736       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00737     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00738     }
00739     cfinal -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[a][0] = 0.0;
00740     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00741       cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[a][0] += FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][a] * temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0];
00742    }                 <span class="comment">/* end a for */</span>
00743   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00744 
00745   <span class="comment">/******** Calculate d's ********/</span>
00746   temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
00747   dfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00748   <span class="keywordflow">for</span> (k = 0; k &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; k++)
00749     <span class="keywordflow">for</span> (b = 0; b &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; b++)
00750     {
00751       dfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[k][b] = 0.0;
00752       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00753       {
00754         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
00755         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00756           temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k];
00757       }
00758       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00759       dfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[k][b] += FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][b] * temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0];
00760     }                 <span class="comment">/* end k for */</span>
00761   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00762 
00763   <span class="comment">/******** Calculate A  ********/</span>
00764 
00765   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00766   <span class="keywordflow">for</span>(a=0;a&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;a++)
00767     <span class="keywordflow">for</span>(b=0;b&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;b++)
00768       temp -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[a][b]=dfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[a][b]*afinal;  
00769 
00770   temp2= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00771     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
00772       <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
00773         temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]=cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]*bfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j];
00774       
00775   A    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00776   Ainv = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
00777 
00778   <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
00779     <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
00780       A -&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]=temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]-temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00781 
00782   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00783   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
00784   <a class="code" href="matrix_8h.html#a20">mat_cp</a>(A, Ainv);
00785 
00786   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {    
00787      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"   a= %9.9f\n"</span>, afinal);
00788      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"b= "</span>, bfinal);
00789      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"c= "</span>, cfinal);
00790      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"d= "</span>, dfinal);
00791      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"A = "</span>, A);
00792   }
00793   <span class="keywordflow">if</span> ((A-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]==0.0)&amp;&amp;(A-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>=1)&amp;&amp;(A-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>=1))
00794         <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(30,<a class="code" href="general_8h.html#a23">FATAL</a>,<span class="stringliteral">""</span>);
00795   <span class="keywordflow">else</span> <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(Ainv);
00796 
00797 
00798   <span class="comment">/**************************************************************</span>
00799 <span class="comment">   *                                                            *</span>
00800 <span class="comment">   *    Find mu and nu Lagrange multipliers for Null or Full    *</span>
00801 <span class="comment">   *                                                            *</span>
00802 <span class="comment">   **************************************************************/</span>
00803   <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a25">ONE</a>) <span class="comment">/* This is the ONE SHOT Method, It is default      */</span>
00804         &amp;&amp; (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)) <span class="comment">/* This is for the case borig == 0 */</span>
00805   {
00806      <span class="comment">/************&lt;&lt; find nu &gt;&gt;*********** FULLSPACE ********/</span>
00807     temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
00808     <span class="keywordflow">for</span>(i=0;i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;i++)
00809       temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=afinal - cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00810     nu=<a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Ainv,temp);
00811     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00812 
00813     <span class="comment">/*************&lt;&lt; find mu &gt;&gt;*********** FULLSPACE ********/</span>
00814     mu = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(bfinal, nu);
00815     mu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] = -1 * (mu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + 1 )/ afinal;
00816   }
00817   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a26">TWO</a>) || (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>))
00818   {
00819     <span class="comment">/************&lt;&lt; find nu &gt;&gt;************ NULLSPACE ********/</span>
00820     temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
00821     <span class="keywordflow">for</span>(i=0;i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;i++)
00822       temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=afinal;
00823     nu=<a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Ainv,temp);
00824     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
00825 
00826     <span class="comment">/************&lt;&lt; find mu &gt;&gt;************ NULLSPACE ********/</span>
00827     mu = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(bfinal, nu);
00828     mu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] /= -afinal;  
00829   }
00830   <span class="keywordflow">else</span> <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(29,<a class="code" href="general_8h.html#a23">FATAL</a>,<span class="stringliteral">"findt_with_Betas_Holonomic"</span>);
00831 
00832   <span class="comment">/**************************************************************</span>
00833 <span class="comment">   *                                                            *</span>
00834 <span class="comment">   *    Find the parametric Analytical Solutions 't'            *</span>
00835 <span class="comment">   *                                                            *</span>
00836 <span class="comment">   **************************************************************/</span>
00837   temp2 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);    <span class="comment">/* temp2= Ge     */</span>
00838   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++)
00839   {
00840     temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
00841     <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;j++)
00842       temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]+=Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
00843   }
00844        
00845   temp3 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);    <span class="comment">/* temp3= -muGe   */</span>
00846   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++)
00847     temp3-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]= -(mu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0])*temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
00848   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
00849 
00850   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>, 1);   <span class="comment">/* temp = bNu     */</span>
00851   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++)
00852   {
00853     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
00854     <span class="keywordflow">for</span>(a=0;a&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;a++)
00855       temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]+=FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][a]*nu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[a][0];
00856   }
00857 
00858   temp2= <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>, 1);   <span class="comment">/* temp2= GbNu    */</span>
00859   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++)
00860   {
00861     temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;        
00862     <span class="keywordflow">for</span>(j=0;j&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;j++)
00863       temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]+=Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j]*temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0];
00864   }
00865 
00866   t = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
00867   <span class="keywordflow">for</span>(i=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++)
00868     t-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = temp3-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] - temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];        
00869 
00870 
00871   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp );
00872   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
00873   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp3);
00874 
00875   sum1 = 0;
00876   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00877      sum1 += t -&gt; p[i][0];
00878   <span class="keywordflow">if</span> (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) {
00879        <span class="keywordflow">if</span> ((sum1&lt; .99)||(sum1&gt;1.01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>, 
00880                 <span class="stringliteral">"findt_with_Betas_Holonomic"</span>);
00881   }
00882   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((sum1&lt;-.01)||(sum1&gt; .01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>,
00883                  <span class="stringliteral">"findt_with_Betas_Holonomic"</span>);
00884 
00885 
00886   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {    
00887      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Nu ="</span>, nu); 
00888      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"   Mu = %9.9f \n"</span>, mu-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]);
00889      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Ginv * -mu"</span>, temp3);   
00890      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Ginv * B * nu"</span>, temp2);
00891      <a class="code" href="useful__UTILS_8c.html#a6">fmat_prf</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"*** t's for Collision ***"</span>, t);
00892 
00893      sum1 = 0;
00894      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00895         sum1 += t -&gt; p[i][0];
00896      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum ti:  %7.4f\n"</span>, sum1);
00897 
00898      <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
00899      {
00900         sum1 = 0;
00901         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
00902           sum1 += FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a> -&gt; p[i][j] * t -&gt; p[i][0];
00903         fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum betai*ti:  %7.4f \n"</span>, sum1);
00904      }
00905   }
00906 
00907   <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; i++)  
00908   {
00909     dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=0.0;
00910     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
00911       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += (t -&gt; p[j][0]) * (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i]);
00912   }
00913 
00914 
00915   
00916   <a class="code" href="matrix_8h.html#a8">mat_free</a>(t);
00917   <a class="code" href="matrix_8h.html#a8">mat_free</a>(nu);
00918   <a class="code" href="matrix_8h.html#a8">mat_free</a>(mu);
00919 
00920   <a class="code" href="matrix_8h.html#a8">mat_free</a>(iden);
00921   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Ginv);
00922   <a class="code" href="matrix_8h.html#a8">mat_free</a>(bfinal);
00923   <a class="code" href="matrix_8h.html#a8">mat_free</a>(cfinal);
00924   <a class="code" href="matrix_8h.html#a8">mat_free</a>(dfinal);
00925   <a class="code" href="matrix_8h.html#a8">mat_free</a>(A);
00926   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Ainv);
00927   <a class="code" href="matrix_8h.html#a8">mat_free</a>(G);
00928   <a class="code" href="matrix_8h.html#a8">mat_free</a>(e);
00929   <a class="code" href="matrix_8h.html#a8">mat_free</a>(eT);
00930  <span class="keywordflow">return</span> (dq);
00931 }                 <span class="comment">/* end findt */</span>
00932 
00933 
00934 
00935 <span class="comment">/* ____________________________________________________</span>
00936 <span class="comment">  | name:    findt_without_Betas_Holonomic             |</span>
00937 <span class="comment">  | description:  find the parameterization for the    |</span>
00938 <span class="comment">  |    solution vectors found using FSP blocking.  The |</span>
00939 <span class="comment">  |    linear cmbination produced will be a full space |</span>
00940 <span class="comment">  |    leastnorm motion.  This is called when there are|</span>
00941 <span class="comment">  |    no constraints on the system.                   |</span>
00942 <span class="comment">  |                                                    |</span>
00943 <span class="comment">  | inputs:  g vectors                                 |</span>
00944 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
00945 <span class="comment">  |____________________________________________________|</span>
00946 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
00947 <span class="comment">  |  F Tulloch     4/94    Algorithm Creation for 2 g's|</span>
00948 <span class="comment">  |  c hacker     10/94    Ported from 2 g's to FSP    |</span>
00949 <span class="comment">  |                2/95    Ported to Solutions struct  |</span>
00950 <span class="comment">  |                3/95    Implemented ONE &amp; TWO step  |</span>
00951 <span class="comment">  |____________________________________________________| */</span>
00952 
<a name="l00953"></a><a class="code" href="headers_8h.html#a40">00953</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a40">findt_without_Betas_Holonomic</a>(FSP_data, B, H, datafp)
00954 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>
00955 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
00956           *H;             <span class="comment">/* H in Pins paper             */</span>
00957 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
00958 {
00959   <span class="keywordtype">int</span>    i, j, k;
00960   <span class="keywordtype">float</span>  sum=0.0;
00961   <span class="keywordtype">double</span> a, b;
00962   <a class="code" href="structMATRIX.html">MATRIX</a> *dq,
00963          *G,*Gtemp,      <span class="comment">/* Grammian formed of solution vectors  */</span>
00964          *t,             <span class="comment">/* weighting factors, one for each vect */</span>
00965          *x,*y,*z,*iden, <span class="comment">/* dummy variable for calculations      */</span>
00966          *e,             <span class="comment">/* vertical vector of ones              */</span>
00967          *eT;            <span class="comment">/* horizontal vector of ones            */</span>
00968 
00969 
00970   dq    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (M   ,    1); 
00971   e     = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (<a class="code" href="general_8h.html#a1">SPAN</a>,    1);
00972   eT    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (   1, <a class="code" href="general_8h.html#a1">SPAN</a>);
00973   z     = <a class="code" href="matrix_8h.html#a25">mat_malloc</a> (H-&gt;<a class="code" href="structMATRIX.html#MATRIXo1">rows</a>, H-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a>);
00974 
00975   <span class="comment">/* initialize the vectors of ones */</span>
00976   <span class="keywordflow">for</span> (i = 0; i &lt; (<a class="code" href="general_8h.html#a1">SPAN</a>); i++)   
00977   { e  -&gt; p[i][0] = eT -&gt; p[0][i] = 1.0e0; }
00978 
00979   Gtemp = <a class="code" href="headers_8h.html#a35">Build_Grammian2</a> (FSP_data, B, <a class="code" href="general_8h.html#a34">datafp</a>);
00980 
00981   G = <a class="code" href="matrix_8h.html#a27">mat_cp2</a>(Gtemp);
00982   <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(G);
00983 
00984   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {       
00985     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"\n  ______________________________  \n"</span>);
00986     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"\n         LEAST NORM MOTION        \n"</span>);
00987     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>,  <span class="stringliteral">"  ______________________________  \n\n"</span>);
00988 
00989     iden = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(G,Gtemp);  <span class="comment">/* This code verifies Grammian Inversion */</span>
00990     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** G  ***"</span>,Gtemp);
00991     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Ginv ***"</span>, G);
00992     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** iden ***"</span>, iden);
00993     <a class="code" href="matrix_8h.html#a8">mat_free</a>(iden);
00994   }                <span class="comment">/* if DEBUGGING print out  (see file: info) */</span>
00995 
00996   x = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(eT, G);
00997   y = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(x, e);
00998 
00999   a = y-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]; <a class="code" href="matrix_8h.html#a8">mat_free</a>(y);
01000 
01001   y = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(x, H);
01002 
01003   <span class="keywordflow">if</span> (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>)
01004     b = -(1 + y-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0])/a;
01005   <span class="keywordflow">else</span>
01006     b = -y-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]/a;
01007 
01008   <a class="code" href="matrix_8h.html#a14">mat_sca</a>(e, b);
01009 
01010   <a class="code" href="matrix_8h.html#a12">mat_add</a>(H, e, z);
01011   <a class="code" href="matrix_8h.html#a14">mat_sca</a>(G, -1.0);
01012 
01013   t = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(G, z);  <span class="comment">/* t's now complete */</span>
01014 
01015   <span class="keywordflow">for</span> (i = 0; i &lt; M; i++)
01016   {
01017     dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0e0;
01018     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01019       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += (t -&gt; p[j][0]) * (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a> -&gt; p[j][i]);
01020   }  
01021 
01022   <span class="keywordflow">for</span> (i = 0, sum = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++) sum += t -&gt; p[i][0];
01023   <span class="keywordflow">if</span> (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) {
01024     <span class="keywordflow">if</span> ((sum&lt; .99)||(sum&gt;1.01)) 
01025         <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>, <span class="stringliteral">"findt_without_Betas_Holonomic"</span>);
01026   }
01027   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((sum&lt;-.01)||(sum&gt; .01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>, 
01028                 <span class="stringliteral">"findt_without_Betas_Holonomic"</span>);
01029 
01030 
01031   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {              <span class="comment">/** print out t's, sums and New dq's **/</span>
01032     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"*** t's ***"</span>, t);
01033     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum (no betas):  %7.4f \n"</span>, sum);
01034     <span class="keywordflow">for</span> (i = 0, sum = 0; i &lt; M; i++)
01035       sum += dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01036     fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum t*g:  %7.4f\n"</span>, sum);
01037   }             <span class="comment">/* if DEBUGGING, include code  (see file info) */</span>
01038 
01039   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Gtemp);
01040   <a class="code" href="matrix_8h.html#a8">mat_free</a>(G);
01041   <a class="code" href="matrix_8h.html#a8">mat_free</a>(eT);
01042   <a class="code" href="matrix_8h.html#a8">mat_free</a>(e);
01043   <a class="code" href="matrix_8h.html#a8">mat_free</a>(t);
01044   <a class="code" href="matrix_8h.html#a8">mat_free</a>(x);
01045   <a class="code" href="matrix_8h.html#a8">mat_free</a>(y);
01046 
01047   <span class="keywordflow">return</span> (dq);
01048 }
01049 
01050 
01051 <span class="comment">/* ____________________________________________________</span>
01052 <span class="comment">  | name:    findt_with_Betas_Nonholonomic             |</span>
01053 <span class="comment">  | description:  find the parameterization for the    |</span>
01054 <span class="comment">  |    solution vectors found using FSP blocking.  The |</span>
01055 <span class="comment">  |    linear cmbination produced will either be a     |</span>
01056 <span class="comment">  |    full space or null space motion based on the    |</span>
01057 <span class="comment">  |    values of nu, and mu.  A macro is used to       |</span>
01058 <span class="comment">  |    determine which method to use.  TWOSTEP means   |</span>
01059 <span class="comment">  |    that a motion is first produced, and then       |</span>
01060 <span class="comment">  |    obstacles and joint limits are avoided in the   |</span>
01061 <span class="comment">  |    null space.  Otherwise, everything is done at   |</span>
01062 <span class="comment">  |    once in the full space.                         |</span>
01063 <span class="comment">  |                                                    |</span>
01064 <span class="comment">  | inputs:  FSP_data's betall and g vectors           |</span>
01065 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
01066 <span class="comment">  |____________________________________________________|</span>
01067 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
01068 <span class="comment">  | K Gower      10/95     Created                     |</span>
01069 <span class="comment">  |                        e-mail: akgower@aol.com     |  </span>
01070 <span class="comment">  |____________________________________________________| */</span>
01071 
01072 <span class="preprocessor">#include"<a class="code" href="general_8h.html">general.h</a>"</span>
01073 
<a name="l01074"></a><a class="code" href="headers_8h.html#a41">01074</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a41">findt_with_Betas_Nonholonomic</a>(FSP_data, B, H, datafp)
01075 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>
01076 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
01077           *H;             <span class="comment">/* H in Pins paper             */</span>
01078 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
01079 
01080 {
01081 
01082 <a class="code" href="structMATRIX.html">MATRIX</a>  *temp,
01083         *temp1,
01084         *temp2,
01085         *temp3,
01086         *temp4,
01087         *temp5,
01088         *temp6,
01089         *e, *eT,
01090         *G, *Ginv,
01091         *cfinal,
01092         *sfinal,
01093         *tfinal,
01094         *mfinal,
01095         *rfinal,
01096         *zfinal,
01097         *wfinal,
01098         *delta,
01099         *lambda,  *lambda_inv,
01100         *Afinal,
01101         *alpha,   *alphaT,
01102         *xfinal,
01103         *nu,
01104         *iden,
01105         *dq,
01106         *betas;
01107 <span class="keywordtype">float</span>    ctemp,
01108          ctemp1,
01109          ctemp2,
01110          ctemp3,
01111          bfinal,
01112          dfinal,
01113          lfinal,
01114          kfinal,
01115          pfinal,
01116          eta,
01117          mu;
01118 <span class="keywordtype">double</span>   sum1 = 0, sum2 = 0; 
01119 
01120 <span class="keywordtype">int</span>      i,j,k,
01121          b;
01122 
01123   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>)  fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n\n# of constraints %d \n"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01124 
01125   <span class="comment">/* initialize the vectors of ones */</span>
01126   e = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01127   eT= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01128   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)   
01129   { e -&gt; p[i][0] = eT -&gt; p[0][i] = 1.0e0;}
01130 
01131   <span class="comment">/* See Methods.c, malloc's G, multiplies g's  and returns */</span>
01132   G = <a class="code" href="headers_8h.html#a35">Build_Grammian2</a>(FSP_data, B, <a class="code" href="general_8h.html#a34">datafp</a>);  
01133 
01134   Ginv = <a class="code" href="matrix_8h.html#a27">mat_cp2</a>(G);
01135   <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(Ginv);   
01136 
01137   <span class="comment">/* Puts betall into column form to be used by Findt_with_Betas_</span>
01138 <span class="comment">     Nonholonomic   */</span>
01139   betas = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);  
01140   <span class="keywordflow">for</span> (i = 0; i &lt; M; i++)
01141       <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01142         betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01143   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>)
01144     {
01145     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"betas (betall)"</span>, betas);
01146     iden = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Ginv, G); 
01147     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Identity Matrix Check (G * Ginv) ***"</span>, iden);
01148     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** betas ***"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso9">betall</a>);
01149     <a class="code" href="matrix_8h.html#a8">mat_free</a>(iden);
01150     }
01151   <span class="comment">/***************************************************************</span>
01152 <span class="comment">   *                                                             *</span>
01153 <span class="comment">   *   b, c, d, k, l, m, p, r, s, w, x, z, delta, lambda, eta,   *</span>
01154 <span class="comment">   *      mu, and nu are based on Katie's paper.                 *</span>
01155 <span class="comment">   *                                                             *</span>
01156 <span class="comment">   ***************************************************************/</span>
01157 
01158  <span class="comment">/******** Generate A-vector ********/</span>
01159   Afinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M,1);
01160   <span class="keywordflow">for</span> (i = 0; i &lt; M; i++) Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
01161   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 3][0] = -sin(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso7">Qarray</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M-1][0] + (<a class="code" href="general_8h.html#a16">PI</a>/2));
01162   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 2][0] =  cos(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso7">Qarray</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M-1][0] + (<a class="code" href="general_8h.html#a16">PI</a>/2));
01163   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 1][0] = -(<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo11">PLAT</a>.<a class="code" href="structPlatform.html#Platformo3">Length</a>)/2;
01164   <span class="comment">/********* Generate alpha. *********/</span>
01165   alpha = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01166     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01167       alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
01168   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01169     <span class="keywordflow">for</span> (j = M - 3; j &lt; M; j++)
01170       alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01171   alphaT=<a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01172   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01173     alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01174 
01175 <span class="comment">/********** Calculate b's ***********/</span>                         
01176 temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01177 bfinal = 0.0;
01178 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01179     {
01180     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01181     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01182         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j] * Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01183     }
01184 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01185     bfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i];
01186 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);                                                   
01187 
01188 <span class="comment">/********** Calculate d's **********  */</span>                     
01189 temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>); 
01190 dfinal = 0.0;
01191 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01192     {
01193     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01194     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01195         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j] * Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01196     }
01197 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01198     dfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] * alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01199 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01200                                 
01201 <span class="comment">/********** Calculate k's ********** */</span>                    
01202 kfinal = 0.0;
01203 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01204     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01205         kfinal += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01206 
01207 <span class="comment">/********** Calculate l's ********** */</span>                     
01208 temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01209 lfinal = 0.0;
01210 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01211     {
01212     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01213     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01214         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01215     }
01216 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01217     lfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] * alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01218 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01219 
01220 <span class="comment">/********** Calculate p's **********  */</span> 
01221                      
01222 pfinal = (bfinal * lfinal) - (dfinal * kfinal);
01223 
01224 <span class="comment">/********** Calculate c's **********  */</span>                 
01225 cfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01226 temp  = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1, <a class="code" href="general_8h.html#a1">SPAN</a>);
01227 <a class="code" href="matrix_8h.html#a11">mat_mul</a>(alphaT, Ginv, temp);
01228 <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01229     {
01230     cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] = 0.0;
01231     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01232         cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] * betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01233     }
01234 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01235 
01236 <span class="comment">/********** Calculate s's **********  */</span>                  
01237 sfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01238 temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
01239 <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv, alpha, temp);
01240 <a class="code" href="matrix_8h.html#a19">mat_tra</a>(betas);
01241 <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01242     {
01243     sfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] = 0.0;
01244     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01245         sfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] += betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] * temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]; 
01246     }
01247 <a class="code" href="matrix_8h.html#a19">mat_tra</a>(betas);
01248 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01249 
01250 <span class="comment">/********** Calculate m's **********  */</span>                                        
01251 mfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,1);
01252 temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01253 <a class="code" href="matrix_8h.html#a11">mat_mul</a>(eT, Ginv, temp);
01254 <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
01255     {
01256     mfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0;
01257     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01258         mfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j] * betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01259     }
01260 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01261 
01262 <span class="comment">/********** Calculate r's **********  */</span>                                        
01263 rfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01264 temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01265 <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv, e, temp);
01266 <a class="code" href="matrix_8h.html#a19">mat_tra</a>(betas);
01267 <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
01268     {
01269     rfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0;
01270     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01271         rfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] * temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0];
01272     }
01273 <a class="code" href="matrix_8h.html#a19">mat_tra</a>(betas);
01274 <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01275 
01276 <span class="comment">/********** Calculate z's **********  */</span>        
01277 zfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01278 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(sfinal, bfinal);
01279 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(rfinal, dfinal);
01280 <a class="code" href="matrix_8h.html#a13">mat_sub</a>(sfinal, rfinal, zfinal);
01281 ctemp1 = 1 / bfinal;
01282 ctemp2 = 1 / dfinal;
01283 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(sfinal, ctemp1);
01284 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(rfinal, ctemp2);
01285  
01286 <span class="comment">/********** Calculate w's **********  */</span>                  
01287 wfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01288 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(cfinal, kfinal);
01289 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(mfinal, bfinal);
01290 <a class="code" href="matrix_8h.html#a13">mat_sub</a>(cfinal, mfinal, wfinal);
01291 ctemp1 = 1 / kfinal;
01292 ctemp2 = 1 / bfinal;
01293 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(cfinal, ctemp1);
01294 <a class="code" href="matrix_8h.html#a14">mat_sca</a>(mfinal, ctemp2);
01295 <span class="comment">/******** Calculate delta's ********   */</span>
01296 <span class="comment">/* Something is fishy here with the limits for the mat_malloc and the </span>
01297 <span class="comment">   for loops */</span>
01298 
01299   temp   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>, 1);
01300   delta = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01301   <span class="keywordflow">for</span> (k = 0; k &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; k++)
01302     <span class="keywordflow">for</span> (b = 0; b &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; b++)
01303     {
01304       delta-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[k][b] = 0.0;
01305       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01306       {
01307         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
01308         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01309           temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] * betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][k];
01310       }      
01311       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01312       delta-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[k][b] += betas-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][b] * temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0];
01313     }                 <span class="comment">/* end k for */</span>
01314   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01315 
01316 <span class="comment">/********** Calculate lambda's **********/</span>
01317 lambda = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01318 <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01319     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
01320         {
01321         ctemp1 = bfinal * delta-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01322         ctemp2 = rfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] * cfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01323         lambda-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] = pfinal * (ctemp1 - ctemp2);
01324         lambda-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i] += zfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] * wfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01325         } 
01326 
01327  <span class="comment">/**************************************************************</span>
01328 <span class="comment">   *                                                            *</span>
01329 <span class="comment">   *Find x, eta, mu and nu Lagrange multipliers for Null or Full*</span>
01330 <span class="comment">   *                                                            *</span>
01331 <span class="comment">   **************************************************************/</span>
01332   <span class="comment">/* This is the ONE SHOT Method, It is default */</span>
01333    
01334   <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a25">ONE</a>) &amp;&amp; (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>))
01335   {  
01336    <span class="comment">/************&lt;&lt; find x's &gt;&gt;********** FULLSPACE ********/</span>
01337     xfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,1);
01338     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(zfinal, bfinal);
01339     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
01340         xfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = zfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] - (bfinal * pfinal);
01341     ctemp1 = 1/bfinal;
01342     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(zfinal,ctemp1);
01343 
01344    <span class="comment">/************&lt;&lt; find nu &gt;&gt;*********** FULLSPACE ********/</span>
01345     nu = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,1);
01346     lambda_inv = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01347     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;i++)
01348         <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01349             lambda_inv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = lambda-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01350     <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(lambda_inv);
01351     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(lambda_inv, xfinal, nu);
01352 
01353    <span class="comment">/*************&lt;&lt; find eta &gt;&gt;********** FULLSPACE ********/</span>
01354     temp1 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01355     temp2 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01356     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01357     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,cfinal,temp1);
01358     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp1,kfinal);
01359     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,mfinal,temp2);
01360     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp2,bfinal);
01361     eta = -(bfinal - temp1-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0])/pfinal;
01362     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01363     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);
01364     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
01365           
01366    <span class="comment">/*************&lt;&lt; find mu &gt;&gt;*********** FULLSPACE ********/</span>
01367     temp1 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01368     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01369     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,cfinal,temp1);
01370     mu = -(temp1-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + (eta * dfinal))/bfinal;
01371     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01372     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);   
01373   }
01374   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="general_8h.html#a55">STEP</a> == <a class="code" href="general_8h.html#a26">TWO</a>) || (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>))
01375   {
01376    <span class="comment">/**********&lt;&lt; find x's &gt;&gt;************** NULLSPACE ********/</span> 
01377     xfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,1);
01378     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; i++)
01379         xfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = -bfinal * pfinal;
01380 
01381    <span class="comment">/************&lt;&lt; find nu &gt;&gt;************ NULLSPACE ********/</span> 
01382     nu = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>, 1);
01383     lambda_inv = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01384     <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>;i++)
01385         <span class="keywordflow">for</span> (j = 0; j &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01386         lambda_inv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j] = lambda-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01387     <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(lambda_inv);
01388     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(lambda_inv, xfinal, nu);
01389 
01390    <span class="comment">/**********&lt;&lt; find eta &gt;&gt;************* NULLSPACE ********/</span> 
01391     temp1    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01392     temp2    = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01393     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01394     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,cfinal,temp1);
01395     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp1,kfinal);
01396     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,mfinal,temp2);
01397     <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp2,bfinal);
01398     eta = -temp2-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + temp1-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0];
01399     eta /= pfinal;
01400     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01401     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);
01402     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
01403 
01404     <span class="comment">/************&lt;&lt; find mu &gt;&gt;************ NULLSPACE ********/</span> 
01405     temp1 = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,1);
01406     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01407     <a class="code" href="matrix_8h.html#a11">mat_mul</a>(nu,cfinal,temp1);
01408     mu = -(temp1-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + (eta * dfinal));
01409     mu /= bfinal;
01410     <a class="code" href="matrix_8h.html#a19">mat_tra</a>(nu);
01411     <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);
01412 
01413   }
01414   <span class="keywordflow">else</span> <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a>(29,<a class="code" href="general_8h.html#a23">FATAL</a>,<span class="stringliteral">"findt_with_Betas_Nonholonomic"</span>);   
01415 
01416   <span class="comment">/**************************************************************</span>
01417 <span class="comment">   *                                                            *</span>
01418 <span class="comment">   *    Find the parametric Analytical Solutions 't'            *</span>
01419 <span class="comment">   *                                                            *</span>
01420 <span class="comment">   **************************************************************/</span>
01421    <span class="comment">/********** Calculate t's ***********/</span>
01422    tfinal  = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01423    temp1   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01424    temp2   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01425    temp3   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01426    temp4   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01427    temp5   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01428    temp6   = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01429    <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv,e,temp1);          <span class="comment">/* temp1 = Ge         */</span>
01430    <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp1,mu);              <span class="comment">/* temp1 = muGe       */</span>
01431    <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv,betas,temp2);     <span class="comment">/* temp2 = GBeta      */</span>
01432    <a class="code" href="matrix_8h.html#a11">mat_mul</a>(temp2,nu,temp3);        <span class="comment">/* temp3 = nuGBeta    */</span>
01433    <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv,alpha,temp4);      <span class="comment">/* temp4 = Galpha     */</span>
01434    <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp4,eta);             <span class="comment">/* temp4 = etaGalpha  */</span>
01435    <a class="code" href="matrix_8h.html#a12">mat_add</a>(temp1,temp3,temp5);
01436    <a class="code" href="matrix_8h.html#a12">mat_add</a>(temp5,temp4,temp6);
01437    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)  tfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = -(temp6-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]);
01438    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);
01439    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
01440    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp3);
01441    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp4);
01442    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp5);
01443    <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp6);
01444 
01445   <span class="keywordflow">for</span> (i = 0, sum1 = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01446       sum1 += tfinal -&gt; p[i][0];
01447   <span class="keywordflow">if</span> (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) {
01448        <span class="keywordflow">if</span> ((sum1&lt; .99)||(sum1&gt;1.01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>,
01449                 <span class="stringliteral">"findt_with_Betas_Nonholonomic"</span>);
01450   }
01451   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((sum1&lt;-.01)||(sum1&gt; .01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a23">FATAL</a>,
01452                 <span class="stringliteral">"findt_with_Betas_Nonholonomic"</span>);
01453 
01454   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {    
01455      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  b= %9.4f\n"</span>, bfinal);
01456      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  d= %9.4f\n"</span>, dfinal);
01457      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  k= %9.4f\n"</span>, kfinal);
01458      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  l= %9.4f\n"</span>, lfinal);
01459      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  p= %9.4f\n"</span>, pfinal);
01460      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"c= "</span>, cfinal);
01461      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"m= "</span>, mfinal);
01462      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"r= "</span>, rfinal);
01463      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"s= "</span>, sfinal);
01464      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"z= "</span>, zfinal);
01465      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"w= "</span>, wfinal);
01466      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"delta = "</span>, delta);
01467      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Nu ="</span>, nu); 
01468      fprintf (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Mu = %9.4f \n"</span>, mu);
01469      fprintf (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Eta = %9.4f \n"</span>, eta);
01470      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Term1"</span>, temp3);   
01471      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"Term2"</span>, temp2);
01472      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"*** t's for Collision ***"</span>, tfinal);
01473 
01474      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum ti:  %7.4f\n"</span>, sum1);
01475      <span class="keywordflow">for</span> (j=0; j&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>; j++)
01476      {
01477         sum1 = 0;
01478         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01479           sum1 += betas -&gt; p[i][j] * tfinal -&gt; p[i][0];
01480         fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum betai*ti:  %7.4f \n"</span>, sum1);
01481      }
01482   }
01483   dq = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M, 1);
01484   <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; i++)  
01485   {
01486     dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=0.0;
01487     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01488       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += (tfinal -&gt; p[j][0]) * (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i]);
01489   }
01490   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"New dq reflecting constraints (t * g)"</span>, dq);
01491 
01492 <span class="keywordflow">for</span> (i=sum1=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++) { sum1 = tfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] * eta; } 
01493 <span class="comment">/*fprintf(stderr,"%11.6f  ",sum1);</span>
01494 <span class="comment">fprintf(stderr,"%11.6f\n", Afinal-&gt;p[M-3][0]*dq-&gt;p[M-3][0] +</span>
01495 <span class="comment">                 Afinal-&gt;p[M-2][0]*dq-&gt;p[M-2][0] +</span>
01496 <span class="comment">                 Afinal-&gt;p[M-1][0]*dq-&gt;p[M-1][0]);</span>
01497 <span class="comment">*/</span>
01498   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Afinal);
01499   <a class="code" href="matrix_8h.html#a8">mat_free</a>(tfinal);
01500   <a class="code" href="matrix_8h.html#a8">mat_free</a>(nu);
01501   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Ginv);
01502   <a class="code" href="matrix_8h.html#a8">mat_free</a>(cfinal);
01503   <a class="code" href="matrix_8h.html#a8">mat_free</a>(sfinal);
01504   <a class="code" href="matrix_8h.html#a8">mat_free</a>(mfinal);
01505   <a class="code" href="matrix_8h.html#a8">mat_free</a>(rfinal);
01506   <a class="code" href="matrix_8h.html#a8">mat_free</a>(zfinal);
01507   <a class="code" href="matrix_8h.html#a8">mat_free</a>(wfinal);
01508   <a class="code" href="matrix_8h.html#a8">mat_free</a>(xfinal);
01509   <a class="code" href="matrix_8h.html#a8">mat_free</a>(delta);
01510   <a class="code" href="matrix_8h.html#a8">mat_free</a>(lambda);
01511   <a class="code" href="matrix_8h.html#a8">mat_free</a>(lambda_inv);
01512   <a class="code" href="matrix_8h.html#a8">mat_free</a>(alphaT);
01513   <a class="code" href="matrix_8h.html#a8">mat_free</a>(G);
01514   <a class="code" href="matrix_8h.html#a8">mat_free</a>(e);
01515   <a class="code" href="matrix_8h.html#a8">mat_free</a>(eT);
01516   <a class="code" href="matrix_8h.html#a8">mat_free</a>(betas);
01517 
01518   <span class="keywordflow">return</span> (dq);
01519 }                 <span class="comment">/* end findt */</span>
01520 
01521 
01522 <span class="comment">/* ____________________________________________________</span>
01523 <span class="comment">  | name:    findt_without_Betas_Nonholonomic          |</span>
01524 <span class="comment">  | description:  find the parameterization for the    |</span>
01525 <span class="comment">  |    solution vectors found using FSP blocking.  The |</span>
01526 <span class="comment">  |    linear cmbination produced will be a full space |</span>
01527 <span class="comment">  |    leastnorm motion.  This is called when there are|</span>
01528 <span class="comment">  |    no constraints on the system.                   |</span>
01529 <span class="comment">  |                                                    |</span>
01530 <span class="comment">  | inputs:  g vectors                                 |</span>
01531 <span class="comment">  | outputs: dq contains the new delta angles for step |</span>
01532 <span class="comment">  |____________________________________________________|</span>
01533 <span class="comment">  | Authors:     Date:     Modifications:              |</span>
01534 <span class="comment">  | K Gower      10/95      Created                    |</span>
01535 <span class="comment">  |                        e-mail: akgower@aol.com     |  </span>
01536 <span class="comment">  |____________________________________________________| */</span>
01537 
<a name="l01538"></a><a class="code" href="headers_8h.html#a42">01538</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="headers_8h.html#a42">findt_without_Betas_Nonholonomic</a>(FSP_data, B, H, datafp)
01539 FILE      *<a class="code" href="general_8h.html#a34">datafp</a>;        <span class="comment">/* data file declaration       */</span>
01540 <a class="code" href="structMATRIX.html">MATRIX</a>    *B,             <span class="comment">/* B, not Beta, in Pins paper  */</span>
01541           *H;             <span class="comment">/* H in Pins paper             */</span>
01542 <a class="code" href="structSolutions.html">Solutions</a> *FSP_data;      <span class="comment">/* See structures.h            */</span>
01543 
01544 {
01545 <a class="code" href="structMATRIX.html">MATRIX</a>  *temp,
01546         *temp1,
01547         *temp2,
01548         *tfinal,        
01549         *alphaT,
01550         *e, *eT,
01551         *G, *Ginv,
01552         *iden,
01553         *dq,
01554         *alpha,
01555         *Afinal;
01556 <span class="keywordtype">float</span>    ctemp,
01557          bfinal,
01558          dfinal,
01559          lfinal,
01560          kfinal,
01561          pfinal,
01562          eta,
01563          mu;
01564 <span class="keywordtype">int</span>      i,j;
01565 <span class="keywordtype">double</span>   sum1 = 0, sum2 = 0; 
01566 
01567   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\n\n# of constraints %d \n"</span>, FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso4">cn</a>);
01568 
01569   <span class="comment">/* initialize the vectors of ones */</span>
01570   e = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01571   eT= <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01572   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)   
01573   { e -&gt; p[i][0] = eT -&gt; p[0][i] = 1.0e0;}
01574 
01575   <span class="comment">/* malloc's G, multiplies g's and returns */</span>
01576   G = <a class="code" href="headers_8h.html#a35">Build_Grammian2</a>(FSP_data, B, <a class="code" href="general_8h.html#a34">datafp</a>);  
01577 
01578   Ginv = <a class="code" href="matrix_8h.html#a27">mat_cp2</a>(G);
01579   <a class="code" href="matrix_8h.html#a15">mat_LU_inv</a>(Ginv);   
01580   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>)
01581     {
01582     iden = <a class="code" href="matrix_8h.html#a26">mat_mul2</a>(Ginv, G); 
01583     <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>,<span class="stringliteral">"*** Identity Matrix Check (G * Ginv) ***"</span>, iden);
01584     <a class="code" href="matrix_8h.html#a8">mat_free</a>(iden);
01585     }
01586   <span class="comment">/***************************************************************</span>
01587 <span class="comment">   *                                                             *</span>
01588 <span class="comment">   *      b, d, k, l, p, eta, and mu are based on Katie's        *</span>
01589 <span class="comment">   *      paper.                                                 *</span>
01590 <span class="comment">   *                                                             *</span>
01591 <span class="comment">   ***************************************************************/</span>
01592 
01593  <span class="comment">/******** Generate A-vector ********/</span>
01594   Afinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M,1);
01595   <span class="keywordflow">for</span> (i = 0; i &lt; M; i++) Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
01596   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 3][0] = -sin(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso7">Qarray</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M-1][0] + (<a class="code" href="general_8h.html#a16">PI</a>/2));
01597   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 2][0] =  cos(FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso7">Qarray</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M-1][0] + (<a class="code" href="general_8h.html#a16">PI</a>/2));
01598   Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[M - 1][0] = -(<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo11">PLAT</a>.<a class="code" href="structPlatform.html#Platformo3">Length</a>)/2.25;  
01599 <span class="comment">/********* Generate alpha. *********/</span>
01600   alpha = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01601     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01602       alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] = 0.0;
01603   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01604     <span class="keywordflow">for</span> (j = M - 3; j &lt; M; j++)
01605       alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += Afinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][0] * FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01606   alphaT=<a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01607   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01608     alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01609 
01610   <span class="comment">/********** Calculate b's ***********/</span>                         
01611   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01612   bfinal = 0.0;
01613   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01614     {
01615     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01616     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01617         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j] * Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01618     }
01619   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01620     bfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i];
01621   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);                                                   
01622 
01623   <span class="comment">/********** Calculate d's **********  */</span>                     
01624   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>); 
01625   dfinal = 0.0;
01626   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01627     {
01628     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01629     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01630         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += alphaT-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][j] * Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01631     }
01632   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01633     dfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] * alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01634   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01635                                 
01636   <span class="comment">/********** Calculate k's ********** */</span>                    
01637   kfinal = 0.0;
01638   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01639     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01640         kfinal += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][j];
01641 
01642   <span class="comment">/********** Calculate l's ********** */</span>                     
01643   temp = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(1,<a class="code" href="general_8h.html#a1">SPAN</a>);
01644   lfinal = 0.0;
01645   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01646     {
01647     temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] = 0.0;
01648     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01649         temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] += Ginv-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i];
01650     }
01651   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++)
01652     lfinal += temp-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][i] * alpha-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0];
01653   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp);
01654 
01655   <span class="comment">/********** Calculate p's **********  */</span> 
01656                      
01657   pfinal = (bfinal * lfinal) - (dfinal * kfinal);
01658 
01659 
01660  <span class="comment">/**************************************************************</span>
01661 <span class="comment">   *                                                            *</span>
01662 <span class="comment">   *Find x, eta, mu and nu Lagrange multipliers for Null or Full*</span>
01663 <span class="comment">   *                                                            *</span>
01664 <span class="comment">   **************************************************************/</span>
01665   <span class="comment">/* This is the ONE SHOT Method, It is default */</span>
01666 <span class="comment">/*  if ((STEP == ONE) &amp;&amp; (!FSP_data-&gt;Null_Space))</span>
01667 <span class="comment">  else if ((STEP == TWO) || (FSP_data-&gt;Null_Space))</span>
01668 <span class="comment">  else IKerror(29,FATAL,"findt_without_Betas_Nonholonomic");    */</span>
01669   { 
01670     <span class="comment">/*************&lt;&lt; find eta &gt;&gt;********** FULLSPACE ********/</span>
01671     eta = - (bfinal / pfinal );
01672 
01673     <span class="comment">/*************&lt;&lt; find mu &gt;&gt;*********** FULLSPACE ********/</span>
01674     mu = ( -( eta ) * dfinal ) / bfinal;
01675   }
01676 
01677   <span class="comment">/**************************************************************</span>
01678 <span class="comment">   *                                                            *</span>
01679 <span class="comment">   *    Find the parametric Analytical Solutions 't'            *</span>
01680 <span class="comment">   *                                                            *</span>
01681 <span class="comment">   **************************************************************/</span>
01682   <span class="comment">/********** Calculate t's ***********/</span>
01683   tfinal = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01684   temp1  = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01685   temp2  = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(<a class="code" href="general_8h.html#a1">SPAN</a>,1);
01686   <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv,e,temp1);
01687   <a class="code" href="matrix_8h.html#a11">mat_mul</a>(Ginv,alpha,temp2);       
01688   <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp1,mu);
01689   <a class="code" href="matrix_8h.html#a14">mat_sca</a>(temp2,eta);
01690   <a class="code" href="matrix_8h.html#a12">mat_add</a>(temp1,temp2,tfinal);
01691   ctemp = -1;
01692   <a class="code" href="matrix_8h.html#a14">mat_sca</a>(tfinal,ctemp);
01693   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp1);
01694   <a class="code" href="matrix_8h.html#a8">mat_free</a>(temp2);
01695 
01696   <span class="keywordflow">for</span> (i = 0, sum1 = 0; i &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; i++) sum1 += tfinal -&gt; p[i][0];
01697   <span class="keywordflow">if</span> (!FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) {
01698        <span class="keywordflow">if</span> ((sum1&lt; .99)||(sum1&gt;1.01)) <a class="code" href="useful__UTILS_8c.html#a0">IKerror</a> (21, <a class="code" href="general_8h.html#a24">OK</a>,
01699                 <span class="stringliteral">"findt_without_Betas_Nonholonomic"</span>);
01700   }
01701 
01702   <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) {    
01703      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  b= %9.4f\n"</span>, bfinal);
01704      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  d= %9.4f\n"</span>, dfinal);
01705      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  k= %9.4f\n"</span>, kfinal);
01706      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  l= %9.4f\n"</span>, lfinal);
01707      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"  p= %9.4f\n"</span>, pfinal);
01708      fprintf (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Mu = %9.4f \n"</span>, mu);
01709      fprintf (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"Eta = %9.4f \n"</span>, eta);
01710      <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a> (<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"*** t's for Collision ***"</span>, tfinal);
01711      fprintf(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"\nsum ti:  %7.4f\n"</span>, sum1);
01712   }
01713 
01714   dq = <a class="code" href="matrix_8h.html#a25">mat_malloc</a>(M, 1);
01715   <span class="keywordflow">for</span> (i = 0; i &lt; FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; i++)  
01716   {
01717     dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0]=0.0;
01718     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="general_8h.html#a1">SPAN</a>; j++)
01719       dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] += (tfinal -&gt; p[j][0]) * (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso6">g</a>-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[j][i]);
01720   }
01721 
01722 <span class="keywordflow">for</span> (i=sum1=0;i&lt;<a class="code" href="general_8h.html#a1">SPAN</a>;i++) { sum1 = tfinal-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i][0] * eta; } 
01723 <span class="comment">/*fprintf(stderr, "%11.6f  ", sum1);</span>
01724 <span class="comment">fprintf(stderr, "&lt;%11.6f, %11.6f, %11.6f&gt; %11.6f\n",</span>
01725 <span class="comment">                   Afinal-&gt;p[M-3][0]*dq-&gt;p[M-3][0],</span>
01726 <span class="comment">                   Afinal-&gt;p[M-2][0]*dq-&gt;p[M-2][0],</span>
01727 <span class="comment">                   Afinal-&gt;p[M-1][0]*dq-&gt;p[M-1][0],</span>
01728 <span class="comment">                   Afinal-&gt;p[M-3][0]*dq-&gt;p[M-3][0] +</span>
01729 <span class="comment">                   Afinal-&gt;p[M-2][0]*dq-&gt;p[M-2][0] +</span>
01730 <span class="comment">                   Afinal-&gt;p[M-1][0]*dq-&gt;p[M-1][0]);</span>
01731 <span class="comment"></span>
01732 <span class="comment">*/</span>  <span class="keywordflow">if</span> (<a class="code" href="fsp_8c.html#a0">DEBUG</a>) <a class="code" href="useful__UTILS_8c.html#a5">fmat_pr</a>(<a class="code" href="general_8h.html#a34">datafp</a>, <span class="stringliteral">"New dq reflecting constraints (t * g)"</span>, dq);
01733 
01734   <span class="keywordflow">if</span> (FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso5">Null_Space</a>) <span class="keywordflow">for</span>(i=0;i&lt;FSP_data-&gt;<a class="code" href="structSolutions.html#Solutionso0">M</a>; dq-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[i++][0] = 0.0);
01735 
01736   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Afinal);
01737   <a class="code" href="matrix_8h.html#a8">mat_free</a>(tfinal);
01738   <a class="code" href="matrix_8h.html#a8">mat_free</a>(Ginv);
01739   <a class="code" href="matrix_8h.html#a8">mat_free</a>(alphaT);
01740   <a class="code" href="matrix_8h.html#a8">mat_free</a>(G);
01741   <a class="code" href="matrix_8h.html#a8">mat_free</a>(e);
01742   <a class="code" href="matrix_8h.html#a8">mat_free</a>(eT);
01743 
01744   <span class="keywordflow">return</span> (dq);
01745 }                 <span class="comment">/* end findt */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:34 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
