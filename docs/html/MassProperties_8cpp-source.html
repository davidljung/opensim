<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: physics/MassProperties.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>physics/MassProperties.cpp</h1><a href="MassProperties_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: MassProperties.cpp 1031 2004-02-11 20:46:36Z jungd $</span>
00019 <span class="comment">  $Revision: 1.4 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:46:36 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="MassProperties.html">physics/MassProperties</a>&gt;</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="Material.html">physics/Material</a>&gt;</span>
00027 <span class="preprocessor">#include &lt;<a class="code" href="TriangleContainer.html">gfx/TriangleContainer</a>&gt;</span>
00028 <span class="preprocessor">#include &lt;<a class="code" href="TriangleIterator.html">gfx/TriangleIterator</a>&gt;</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="Triangle3.html">gfx/Triangle3</a>&gt;</span>
00030 
00031 <span class="keyword">using</span> <a class="code" href="classphysics_1_1MassProperties.html">physics::MassProperties</a>;
00032 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Material.html">physics::Material</a>;
00033 <span class="keyword">using</span> <a class="code" href="classgfx_1_1TriangleContainer.html">gfx::TriangleContainer</a>;
00034 <span class="keyword">using</span> <a class="code" href="classgfx_1_1TriangleIterator.html">gfx::TriangleIterator</a>;
00035 <span class="keyword">using</span> <a class="code" href="classgfx_1_1Triangle3.html">gfx::Triangle3</a>;
00036 
00037 
00038 
00039 <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa0">MassProperties::MassProperties</a>()
00040         : mass(1.0), centerOfMass(0,0,0)
00041 {
00042 }
00043 
00044 <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa0">MassProperties::MassProperties</a>(<span class="keyword">const</span> TriangleContainer&amp; triangles, ref&lt;const Material&gt; material)
00045 {
00046   <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb0">computeMassProperties</a>(triangles, material);
00047 }
00048 
00049 <span class="keywordtype">void</span> <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa7">MassProperties::setIbody</a>(<span class="keyword">const</span> Matrix3&amp; Ibody) 
00050 {
00051   <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp0">_Ibody</a> = Ibody;
00052   <span class="keywordflow">try</span> {
00053     <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp1">_IbodyInv</a> = <a class="code" href="namespacebase.html#a115">base::inverse</a>(Ibody);
00054   } <span class="keywordflow">catch</span> (std::invalid_argument&amp; e) {
00055     <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: Invalid Inertia matrix (body frame) - cannot be inverted. Setting to identity."</span>);
00056     <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp0">_Ibody</a>.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00057     <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp1">_IbodyInv</a>.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00058   }
00059 }
00060 
<a name="l00061"></a><a class="code" href="classMassProperties_1_1VolData.html">00061</a> <span class="keyword">class </span><a class="code" href="classMassProperties_1_1VolData.html">MassProperties::VolData</a> {
00062 <span class="keyword">public</span>:
<a name="l00063"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao2">00063</a>   SInt A,B,C;
<a name="l00064"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao12">00064</a>   Real <a class="code" href="Globals_8h.html#a25">P1</a>, Pa, Pb, Paa, Pab, Pbb, Paaa, Paab, Pabb, Pbbb; <span class="comment">// projection integrals</span>
<a name="l00065"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao21">00065</a>   Real Fa, Fb, Fc, Faa, Fbb, Fcc, Faaa, Fbbb, Fccc, Faab, Fbbc, Fcca; <span class="comment">// face integrals</span><span class="comment"></span>
00066 <span class="comment">  /// volume integrals</span>
<a name="l00067"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">00067</a> <span class="comment"></span>  Real T0;
<a name="l00068"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao26">00068</a>   Real T1[4]; <span class="comment">// using only 1..3</span>
<a name="l00069"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">00069</a>   Real T2[4];
<a name="l00070"></a><a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao28">00070</a>   Real TP[4];
00071 };
00072 
00073 
<a name="l00074"></a><a class="code" href="classMassProperties_1_1WTriangle.html">00074</a> <span class="keyword">class </span><a class="code" href="classMassProperties_1_1WTriangle.html">MassProperties::WTriangle</a> : <span class="keyword">public</span> <a class="code" href="gfx_2Jamfile_8ft.html#a0">gfx</a>::Triangle3
00075 {
00076 <span class="keyword">public</span>:
<a name="l00077"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea0">00077</a>   <a class="code" href="classMassProperties_1_1WTriangle.html">WTriangle</a>() { compNorm(); compW(); }
<a name="l00078"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea1">00078</a>   <a class="code" href="classMassProperties_1_1WTriangle.html">WTriangle</a>(<span class="keyword">const</span> <a class="code" href="classgfx_1_1Triangle3.html">gfx::Triangle3</a>&amp; t) : <a class="code" href="gfx_2Jamfile_8ft.html#a0">gfx</a>::Triangle3(t) { compNorm(); compW(); }
<a name="l00079"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea2">00079</a>   <a class="code" href="classMassProperties_1_1WTriangle.html">WTriangle</a>(<span class="keyword">const</span> <a class="code" href="classMassProperties_1_1WTriangle.html">WTriangle</a>&amp; t) : <a class="code" href="gfx_2Jamfile_8ft.html#a0">gfx</a>::Triangle3(t), norm(t.norm), w(t.w) {}
<a name="l00080"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea3">00080</a>   <span class="keyword">virtual</span> ~<a class="code" href="classMassProperties_1_1WTriangle.html">WTriangle</a>() {}
00081 
<a name="l00082"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea4">00082</a>   <span class="keywordtype">void</span> compNorm() { norm=normal(); }
<a name="l00083"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTrianglea5">00083</a>   <span class="keywordtype">void</span> compW() { w = -norm.x*_p1.x - norm.y*_p1.y - norm.z*_p1.z; }
00084 
<a name="l00085"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTriangleo0">00085</a>   Vector3 norm;
<a name="l00086"></a><a class="code" href="classMassProperties_1_1WTriangle.html#MassProperties_1_1WTriangleo1">00086</a>   Real w;
00087 };
00088 
00089 
00090 
00091 <span class="keywordtype">void</span> <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb0">MassProperties::computeMassProperties</a>(<span class="keyword">const</span> TriangleContainer&amp; triangles, ref&lt;const Material&gt; material)
00092 {
00093   Int X=1, Y=2, Z=3;
00094 
00095   Matrix3 J; <span class="comment">// inertia tensor</span>
00096   Point3  r; <span class="comment">// center of mass</span>
00097 
00098   <a class="code" href="classMassProperties_1_1VolData.html">VolData</a> v;
00099   <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb1">compVolumeIntegrals</a>(triangles, v);
00100 
00101   Real density = material-&gt;density();
00102 
00103   <span class="keywordflow">if</span> ( Math::isNAN(v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>) || Math::equals(v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>,0) ) {
00104     <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: Mass property calculation failed.  Setting inertia matrix to identity, mass to 1*density and center of mass to 0"</span>);
00105     _Ibody.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00106     _IbodyInv.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00107     mass = density * 1.0;
00108     centerOfMass = Point3(0,0,0);
00109   }
00110   <span class="keywordflow">else</span> {
00111     mass = density * v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>;
00112   
00113     <span class="comment">// compute center of mass</span>
00114     r.x = v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao26">T1</a>[X]/v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>;
00115     r.y = v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao26">T1</a>[Y]/v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>;
00116     r.z = v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao26">T1</a>[Z]/v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao25">T0</a>;
00117 
00118     <span class="comment">// compute inertia tensor </span>
00119     J.e(1,1) = density * (v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[Y] + v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[Z]);
00120     J.e(2,2) = density * (v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[Z] + v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[X]);
00121     J.e(3,3) = density * (v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[X] + v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao27">T2</a>[Y]);
00122     J.e(1,2) = J.e(2,1) = - density * v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao28">TP</a>[X];
00123     J.e(2,3) = J.e(3,2) = - density * v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao28">TP</a>[Y];
00124     J.e(3,1) = J.e(1,3) = - density * v.<a class="code" href="classMassProperties_1_1VolData.html#MassProperties_1_1VolDatao28">TP</a>[Z];
00125 
00126     <span class="comment">// translate inertia tensor to center of mass </span>
00127     J.e(1,1) -= mass * (r.y*r.y + r.z*r.z);
00128     J.e(2,2) -= mass * (r.z*r.z + r.x*r.x);
00129     J.e(3,3) -= mass * (r.x*r.x + r.y*r.y);
00130     J.e(1,2) = J.e(2,1) += mass * r.x * r.y; 
00131     J.e(2,3) = J.e(3,2) += mass * r.y * r.z; 
00132     J.e(3,1) = J.e(1,3) += mass * r.z * r.x; 
00133     
00134     _Ibody = J;
00135     <span class="keywordflow">try</span> {
00136       _IbodyInv = <a class="code" href="namespacebase.html#a115">base::inverse</a>(_Ibody);
00137     } <span class="keywordflow">catch</span> (std::invalid_argument&amp; e) {
00138       <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: Inertia matrix (body frame) cannot be inverted - setting to identity"</span>);
00139       <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp0">_Ibody</a>.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00140       <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesp1">_IbodyInv</a>.<a class="code" href="classbase_1_1Matrix3.html#base_1_1Matrix3a5">setIdentity</a>();
00141     }
00142     
00143     <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso1">centerOfMass</a> = r;
00144 
00145     <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso1">centerOfMass</a>.<a class="code" href="classbase_1_1Vector3.html#base_1_1Vector3a17">equals</a>(<a class="code" href="namespacebase.html#a26">Point3</a>(0,0,0))) {
00146       <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: Center of mass is not at coordinate origin - it is "</span> &lt;&lt; centerOfMass &lt;&lt; <span class="stringliteral">"."</span>);
00147     }
00148 
00149   }
00150 
00151 }
00152 
00153 
00154 <span class="keywordtype">void</span> <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb1">MassProperties::compVolumeIntegrals</a>(<span class="keyword">const</span> TriangleContainer&amp; triangles, VolData&amp; v)
00155 {
00156   <a class="code" href="namespacebase.html#a1">SInt</a> <a class="code" href="Globals_8h.html#a16">X</a>=1, Y=2, Z=3;
00157 
00158   TriangleContainer::const_iterator tris = triangles.begin();
00159   TriangleContainer::const_iterator endtris = triangles.end();
00160   
00161   <a class="code" href="namespacebase.html#a5">Real</a> nx, ny, nz;
00162 
00163   v.T0 = 0;
00164   v.T1[<a class="code" href="Globals_8h.html#a16">X</a>] = v.T1[Y] = v.T1[Z] = 0;
00165   v.T2[<a class="code" href="Globals_8h.html#a16">X</a>] = v.T2[Y] = v.T2[Z] = 0.0;
00166   v.TP[<a class="code" href="Globals_8h.html#a16">X</a>] = v.TP[Y] = v.TP[Z] = 0.0;
00167   
00168   <span class="keywordflow">while</span> (tris != endtris) {
00169 
00170     WTriangle <a class="code" href="Makefile_8in.html#a5">f</a>(*tris);
00171 
00172     nx = <a class="code" href="namespacebase.html#a62">base::abs</a>(<a class="code" href="Makefile_8in.html#a5">f</a>.norm.x);
00173     ny = <a class="code" href="namespacebase.html#a62">base::abs</a>(<a class="code" href="Makefile_8in.html#a5">f</a>.norm.y);
00174     nz = <a class="code" href="namespacebase.html#a62">base::abs</a>(<a class="code" href="Makefile_8in.html#a5">f</a>.norm.z);
00175     <span class="keywordflow">if</span> (nx &gt; ny &amp;&amp; nx &gt; nz)
00176       v.C = <a class="code" href="Globals_8h.html#a16">X</a>;
00177     <span class="keywordflow">else</span>
00178       v.C = (ny &gt; nz) ? Y : Z;
00179     v.A = ((v.C + 1 -1)%3)+1;
00180     v.B = ((v.A + 1 -1)%3)+1;
00181     
00182     <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb2">compFaceIntegrals</a>(f,v);
00183     
00184     v.T0 += <a class="code" href="Makefile_8in.html#a5">f</a>.norm.x * ((v.A == <a class="code" href="Globals_8h.html#a16">X</a>) ? v.Fa : ((v.B == <a class="code" href="Globals_8h.html#a16">X</a>) ? v.Fb : v.Fc));
00185     
00186     v.T1[v.A] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.A] * v.Faa;
00187     v.T1[v.B] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.B] * v.Fbb;
00188     v.T1[v.C] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.C] * v.Fcc;
00189     v.T2[v.A] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.A] * v.Faaa;
00190     v.T2[v.B] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.B] * v.Fbbb;
00191     v.T2[v.C] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.C] * v.Fccc;
00192     v.TP[v.A] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.A] * v.Faab;
00193     v.TP[v.B] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.B] * v.Fbbc;
00194     v.TP[v.C] += <a class="code" href="Makefile_8in.html#a5">f</a>.norm[v.C] * v.Fcca;
00195 
00196     ++tris;
00197   }
00198   
00199   v.T1[<a class="code" href="Globals_8h.html#a16">X</a>] /= 2.0; v.T1[Y] /= 2.0; v.T1[Z] /= 2.0;
00200   v.T2[<a class="code" href="Globals_8h.html#a16">X</a>] /= 3.0; v.T2[Y] /= 3.0; v.T2[Z] /= 3.0;
00201   v.TP[<a class="code" href="Globals_8h.html#a16">X</a>] /= 2.0; v.TP[Y] /= 2.0; v.TP[Z] /= 2.0;
00202 
00203 }
00204 
00205 <span class="keywordtype">void</span> <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb2">MassProperties::compFaceIntegrals</a>(<span class="keyword">const</span> WTriangle&amp; t, VolData&amp; v)
00206 {
00207   <a class="code" href="namespacebase.html#a5">Real</a> w;
00208   <a class="code" href="namespacebase.html#a5">Real</a> k1, k2, k3, k4;
00209 
00210   <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb3">compProjectionIntegrals</a>(t,v);
00211 
00212   w = t.w;
00213   k1 = 1 / t.norm[v.C]; k2 = k1 * k1; k3 = k2 * k1; k4 = k3 * k1;
00214 
00215   v.Fa = k1 * v.Pa;
00216   v.Fb = k1 * v.Pb;
00217   v.Fc = -k2 * (t.norm[v.A]*v.Pa + t.norm[v.B]*v.Pb + w*v.P1);
00218   
00219   v.Faa = k1 * v.Paa;
00220   v.Fbb = k1 * v.Pbb;
00221   v.Fcc = k3 * (Math::sqr(t.norm[v.A])*v.Paa + 2*t.norm[v.A]*t.norm[v.B]*v.Pab + Math::sqr(t.norm[v.B])*v.Pbb
00222                 + w*(2*(t.norm[v.A]*v.Pa + t.norm[v.B]*v.Pb) + w*v.P1));
00223   
00224   v.Faaa = k1 * v.Paaa;
00225   v.Fbbb = k1 * v.Pbbb;
00226   v.Fccc = -k4 * (Math::cube(t.norm[v.A])*v.Paaa + 3*Math::sqr(t.norm[v.A])*t.norm[v.B]*v.Paab 
00227                   + 3*t.norm[v.A]*Math::sqr(t.norm[v.B])*v.Pabb + Math::cube(t.norm[v.B])*v.Pbbb
00228                   + 3*w*(Math::sqr(t.norm[v.A])*v.Paa + 2*t.norm[v.A]*t.norm[v.B]*v.Pab + Math::sqr(t.norm[v.B])*v.Pbb)
00229                   + w*w*(3*(t.norm[v.A]*v.Pa + t.norm[v.B]*v.Pb) + w*v.P1));
00230   
00231   v.Faab = k1 * v.Paab;
00232   v.Fbbc = -k2 * (t.norm[v.A]*v.Pabb + t.norm[v.B]*v.Pbbb + w*v.Pbb);
00233   v.Fcca = k3 * (Math::sqr(t.norm[v.A])*v.Paaa + 2*t.norm[v.A]*t.norm[v.B]*v.Paab + Math::sqr(t.norm[v.B])*v.Pabb
00234                  + w*(2*(t.norm[v.A]*v.Paa + t.norm[v.B]*v.Pab) + w*v.Pa));
00235 }
00236 
00237 
00238 <span class="keywordtype">void</span> <a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesb3">MassProperties::compProjectionIntegrals</a>(<span class="keyword">const</span> WTriangle&amp; t, VolData&amp; v)
00239 {
00240    <a class="code" href="namespacebase.html#a5">Real</a> a0, a1, da;
00241    <a class="code" href="namespacebase.html#a5">Real</a> b0, b1, db;
00242    <a class="code" href="namespacebase.html#a5">Real</a> a0_2, a0_3, a0_4, b0_2, b0_3, b0_4;
00243    <a class="code" href="namespacebase.html#a5">Real</a> a1_2, a1_3, b1_2, b1_3;
00244    <a class="code" href="namespacebase.html#a5">Real</a> C1, Ca, Caa, Caaa, Cb, Cbb, Cbbb;
00245    <a class="code" href="namespacebase.html#a5">Real</a> Cab, Kab, Caab, Kaab, Cabb, Kabb;
00246 
00247    v.P1 = v.Pa = v.Pb = v.Paa = v.Pab = v.Pbb = v.Paaa = v.Paab = v.Pabb = v.Pbbb = 0.0;
00248 
00249    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= 3; i++) {
00250      a0 = t(i)[v.A];
00251      b0 = t(i)[v.B];
00252      a1 = t(((i+1-1)%3)+1)[v.A];
00253      b1 = t(((i+1-1)%3)+1)[v.B];
00254      da = a1 - a0;
00255      db = b1 - b0;
00256      a0_2 = a0 * a0; a0_3 = a0_2 * a0; a0_4 = a0_3 * a0;
00257      b0_2 = b0 * b0; b0_3 = b0_2 * b0; b0_4 = b0_3 * b0;
00258      a1_2 = a1 * a1; a1_3 = a1_2 * a1; 
00259      b1_2 = b1 * b1; b1_3 = b1_2 * b1;
00260      
00261      C1 = a1 + a0;
00262      Ca = a1*C1 + a0_2; Caa = a1*Ca + a0_3; Caaa = a1*Caa + a0_4;
00263      Cb = b1*(b1 + b0) + b0_2; Cbb = b1*Cb + b0_3; Cbbb = b1*Cbb + b0_4;
00264      Cab = 3*a1_2 + 2*a1*a0 + a0_2; Kab = a1_2 + 2*a1*a0 + 3*a0_2;
00265      Caab = a0*Cab + 4*a1_3; Kaab = a1*Kab + 4*a0_3;
00266      Cabb = 4*b1_3 + 3*b1_2*b0 + 2*b1*b0_2 + b0_3;
00267      Kabb = b1_3 + 2*b1_2*b0 + 3*b1*b0_2 + 4*b0_3;
00268      
00269      v.P1 += db*C1;
00270      v.Pa += db*Ca;
00271      v.Paa += db*Caa;
00272      v.Paaa += db*Caaa;
00273      v.Pb += da*Cb;
00274      v.Pbb += da*Cbb;
00275      v.Pbbb += da*Cbbb;
00276      v.Pab += db*(b1*Cab + b0*Kab);
00277      v.Paab += db*(b1*Caab + b0*Kaab);
00278      v.Pabb += da*(a1*Cabb + a0*Kabb);
00279    }
00280    
00281    v.P1 /= 2.0;
00282    v.Pa /= 6.0;
00283    v.Paa /= 12.0;
00284    v.Paaa /= 20.0;
00285    v.Pb /= -6.0;
00286    v.Pbb /= -12.0;
00287    v.Pbbb /= -20.0;
00288    v.Pab /= 24.0;
00289    v.Paab /= 60.0;
00290    v.Pabb /= -60.0;
00291 }
00292 
00293 
<a name="l00294"></a><a class="code" href="namespacephysics.html#a4">00294</a> std::ostream&amp; <a class="code" href="namespacephysics.html#a0">physics::operator&lt;&lt;</a>(std::ostream&amp; out, <span class="keyword">const</span> <a class="code" href="classphysics_1_1MassProperties.html">MassProperties</a>&amp; mp) <span class="comment">// Output</span>
00295 {
00296   <span class="keywordflow">return</span> out &lt;&lt; <span class="stringliteral">"Ibody:"</span> &lt;&lt; mp.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa5">Ibody</a>() &lt;&lt; std::endl 
00297              &lt;&lt; <span class="stringliteral">"mass:"</span> &lt;&lt; mp.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso0">mass</a> &lt;&lt; std::endl
00298              &lt;&lt; <span class="stringliteral">"centerOfMass:"</span> &lt;&lt; mp.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso1">centerOfMass</a> &lt;&lt; std::endl;
00299 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:24 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
