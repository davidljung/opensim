<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: physics/ODESolid.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>physics/ODESolid.cpp</h1><a href="ODESolid_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: ODESolid.cpp 1031 2004-02-11 20:46:36Z jungd $</span>
00019 <span class="comment">  $Revision: 1.6 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:46:36 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="ODESolid.html">physics/ODESolid</a>&gt;</span>
00026 <span class="preprocessor">#include &lt;<a class="code" href="ref.html">base/ref</a>&gt;</span>
00027 
00028 <span class="comment">// need to know about shapes to map them to ODE's equivelent geoms</span>
00029 <span class="preprocessor">#include &lt;<a class="code" href="Box.html">physics/Box</a>&gt;</span>
00030 <span class="preprocessor">#include &lt;<a class="code" href="Sphere.html">physics/Sphere</a>&gt;</span>
00031 
00032 <span class="preprocessor">#include &lt;<a class="code" href="ODECollidableBody.html">physics/ODECollidableBody</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="ODESolidConnectedCollidableBody.html">physics/ODESolidConnectedCollidableBody</a>&gt;</span>
00034 
00035 
00036 <span class="keyword">using</span> <a class="code" href="classbase_1_1Vector3.html">base::Point3</a>;
00037 <span class="keyword">using</span> <a class="code" href="classbase_1_1Quat4.html">base::Quat4</a>;
00038 <span class="keyword">using</span> <a class="code" href="classbase_1_1Orient.html">base::Orient</a>;
00039 <span class="keyword">using</span> <a class="code" href="classbase_1_1Vector3.html">base::Vector3</a>;
00040 <span class="keyword">using</span> <a class="code" href="classbase_1_1Matrix3.html">base::Matrix3</a>;
00041 
00042 <span class="keyword">using</span> base::copyMemory;
00043 
00044 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Body.html">physics::Body</a>;
00045 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Shape.html">physics::Shape</a>;
00046 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Material.html">physics::Material</a>;
00047 <span class="keyword">using</span> <a class="code" href="classphysics_1_1MassProperties.html">physics::MassProperties</a>;
00048 <span class="keyword">using</span> <a class="code" href="classphysics_1_1ODESolid.html">physics::ODESolid</a>;
00049 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Collidable.html">physics::Collidable</a>;
00050 <span class="keyword">using</span> <a class="code" href="classphysics_1_1CollidableBody.html">physics::CollidableBody</a>;
00051 <span class="keyword">using</span> <a class="code" href="classphysics_1_1ODECollidableBody.html">physics::ODECollidableBody</a>;
00052 <span class="keyword">using</span> <a class="code" href="classphysics_1_1ODESolidConnectedCollidableBody.html">physics::ODESolidConnectedCollidableBody</a>;
00053 
00054 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Box.html">physics::Box</a>;
00055 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Sphere.html">physics::Sphere</a>;
00056 
00057 
00058   
00059 
00060 ODESolid::ODESolid(ref&lt;const Shape&gt; shape, ref&lt;const Material&gt; material)
00061   : Solid(shape, material), created(false)
00062 {
00063 }
00064 
00065 <span class="keywordtype">void</span> ODESolid::create(dWorldID worldID)<span class="keyword"> const</span>
00066 <span class="keyword"></span>{
00067   <span class="keywordflow">if</span> (<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>)
00068     <span class="keywordflow">throw</span> std::runtime_error(<a class="code" href="base.html#a15">Exception</a>(<span class="stringliteral">"create() called twice"</span>));
00069 
00070   this-&gt;worldID = worldID;
00071 
00072   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp6">bodyID</a> = dBodyCreate(worldID);
00073   <span class="comment">// initialize default state</span>
00074   dBodySetPosition(bodyID, 0,0,0);
00075   dQuaternion q = { 1,0,0,0 };
00076   dBodySetQuaternion(bodyID, q);
00077   dBodySetLinearVel(bodyID, 0,0,0);
00078   dBodySetAngularVel(bodyID, 0,0,0);
00079 
00080   <span class="comment">// calculate mass properties </span>
00081   <a class="code" href="classphysics_1_1MassProperties.html">MassProperties</a> massProps( Solid::massProperties() );
00082 
00083   dMass odemass;
00084   dMassSetZero(&amp;odemass);
00085   <span class="keyword">const</span> Matrix3&amp; Ibody(massProps.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa5">Ibody</a>());
00086   dMassSetParameters(&amp;odemass, massProps.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso0">mass</a>,
00087                      0,0,0,
00088                      Ibody(1,1), Ibody(2,2), Ibody(3,3),
00089                      Ibody(1,2), Ibody(1,3), Ibody(2,3));
00090 
00091   dBodySetMass(bodyID, &amp;odemass);
00092 
00093   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a> = <span class="keyword">true</span>;
00094 }
00095 
00096 
00097 <span class="keywordtype">void</span> ODESolid::destroy()<span class="keyword"> const</span>
00098 <span class="keyword"></span>{
00099   <span class="keywordflow">if</span> (<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) {
00100     dBodyDestroy(bodyID);
00101     worldID = 0; 
00102     <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp6">bodyID</a> = 0;
00103     <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a> = <span class="keyword">false</span>;
00104   }
00105 }
00106 
00107 
00108 
00109 
00110 ODESolid::ODESolid(<span class="keyword">const</span> Solid&amp; s)
00111   : Solid(s)
00112 {
00113   <span class="comment">// copy state (prev state will be lost)</span>
00114   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida7">setPosition</a>(s.getPosition());
00115   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida8">setOrientation</a>(s.getOrientation());
00116   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida9">setVelocity</a>(s.getVelocity());
00117   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida10">setAngVelocity</a>(s.getAngVelocity());
00118   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida5">setEnabled</a>(s.isEnabled());
00119 }
00120 
00121 ODESolid::~ODESolid() 
00122 {
00123   <span class="keywordflow">if</span> (<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidb2">destroy</a>();
00124 }
00125 
00126 
00127 <a class="code" href="classphysics_1_1MassProperties.html">MassProperties</a> ODESolid::massProperties()<span class="keyword"> const</span>
00128 <span class="keyword"></span>{
00129   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Solid::massProperties();
00130 
00131   <span class="comment">// get properties from ODE</span>
00132   dMass odemass;
00133   dBodyGetMass(bodyID, &amp;odemass);
00134 
00135   <a class="code" href="classphysics_1_1MassProperties.html">MassProperties</a> massProps;
00136   massProps.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso0">mass</a> = odemass.mass;
00137   massProps.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertieso1">centerOfMass</a> = <a class="code" href="namespacebase.html#a26">Point3</a>(odemass.c[0], odemass.c[1], odemass.c[2]);
00138   Matrix3 Ibody;
00139   <span class="comment">// get from standard ODE matrix format. order or row/col irrelevant as matrix is symmetric</span>
00140   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r=1; r&lt;3; r++)
00141     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c=1; c&lt;3; c++)
00142       Ibody(r,c) = odemass.I[(r-1)*4+(c-1)];
00143   massProps.<a class="code" href="classphysics_1_1MassProperties.html#physics_1_1MassPropertiesa7">setIbody</a>(Ibody);
00144 
00145   <span class="keywordflow">return</span> massProps;
00146 }
00147 
00148 
00149 
00150 <a class="code" href="classphysics_1_1Body.html">Body</a>&amp; ODESolid::operator=(<span class="keyword">const</span> <a class="code" href="classphysics_1_1Body.html">Body</a>&amp; b)
00151 {
00152   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
00153 
00154   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida7">setPosition</a>(b.<a class="code" href="classphysics_1_1DynamicSpatial.html#physics_1_1Solida25">getPosition</a>());
00155   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida8">setOrientation</a>(b.<a class="code" href="classphysics_1_1DynamicSpatial.html#physics_1_1Solida26">getOrientation</a>());
00156   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida9">setVelocity</a>(b.<a class="code" href="classphysics_1_1DynamicSpatial.html#physics_1_1Solida29">getVelocity</a>());
00157   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida10">setAngVelocity</a>(b.<a class="code" href="classphysics_1_1DynamicSpatial.html#physics_1_1Solida30">getAngVelocity</a>());
00158   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida5">setEnabled</a>(<span class="keyword">true</span>);
00159   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00160 }
00161 
00162 
00163 <span class="keywordtype">void</span> ODESolid::setEnabled(<span class="keywordtype">bool</span> enable)
00164 {
00165   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span>; }
00166 
00167   <span class="keywordflow">if</span> (enable)
00168     dBodyEnable(bodyID);
00169   <span class="keywordflow">else</span>
00170     dBodyDisable(bodyID);
00171 }
00172 
00173 <span class="keywordtype">bool</span> ODESolid::isEnabled()<span class="keyword"> const</span>
00174 <span class="keyword"></span>{
00175   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00176 
00177   <span class="keywordflow">return</span> dBodyIsEnabled(bodyID);
00178 }
00179 
00180 
00181 <span class="keywordtype">void</span> ODESolid::setPosition(<span class="keyword">const</span> Point3&amp; x)
00182 {
00183   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span>; }
00184 
00185   dBodySetPosition(bodyID, x.x, x.y, x.z);
00186 }
00187 
00188 <span class="keywordtype">void</span> ODESolid::ODESolid::setOrientation(<span class="keyword">const</span> Orient&amp; orient)
00189 {
00190   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span>; }
00191 
00192   dQuaternion quat;
00193   Quat4 q( orient );
00194   quat[0] = q.w; quat[1] = q.v.x; quat[2] = q.v.y; quat[3] = q.v.z;
00195   dBodySetQuaternion(bodyID, quat);
00196 }
00197 
00198 <span class="keywordtype">void</span> ODESolid::setVelocity(<span class="keyword">const</span> Vector3&amp; v)
00199 {
00200   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span>; }
00201 
00202   dBodySetLinearVel(bodyID, v.x, v.y, v.z);
00203 }
00204 
00205 <span class="keywordtype">void</span> ODESolid::setAngVelocity(<span class="keyword">const</span> Vector3&amp; w)
00206 {
00207   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) { <a class="code" href="base.html#a3">Logln</a>(<span class="stringliteral">"Warning: no effect until added to SolidSystem"</span>); <span class="keywordflow">return</span>; }
00208 
00209   dBodySetAngularVel(bodyID, w.x, w.y, w.z);
00210 
00211 }
00212 
00213 <a class="code" href="namespacebase.html#a26">Point3</a>  ODESolid::getPosition()<span class="keyword"> const</span>
00214 <span class="keyword"></span>{
00215   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a26">Point3</a>(); 
00216 
00217   <span class="keyword">const</span> dReal* pos = dBodyGetPosition(bodyID);
00218   <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a26">Point3</a>(pos[0],pos[1],pos[2]);
00219 }
00220 
00221 Orient  ODESolid::getOrientation()<span class="keyword"> const</span>
00222 <span class="keyword"></span>{
00223   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Orient(); 
00224 
00225   <span class="keyword">const</span> dReal* orient = dBodyGetQuaternion(bodyID);
00226   <span class="keywordflow">return</span> Orient(Quat4(orient[1], orient[2], orient[3], orient[0]));
00227 }
00228 
00229 Vector3 ODESolid::getVelocity()<span class="keyword"> const</span>
00230 <span class="keyword"></span>{
00231   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00232 
00233   <span class="keyword">const</span> dReal* vel = dBodyGetLinearVel(bodyID);
00234   <span class="keywordflow">return</span> Vector3(vel[0], vel[1], vel[2]);
00235 }
00236 
00237 
00238 Vector3 ODESolid::getAngVelocity()<span class="keyword"> const</span>
00239 <span class="keyword"></span>{
00240   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00241 
00242   <span class="keyword">const</span> dReal* angVel = dBodyGetAngularVel(bodyID);
00243   <span class="keywordflow">return</span> Vector3(angVel[0], angVel[1], angVel[2]);
00244 }
00245 
00246 <span class="keywordtype">void</span> ODESolid::saveState()
00247 {
00248   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00249 
00250   <a class="code" href="namespacebase.html#a38">copyMemory</a>(dBodyGetPosition(bodyID), savedPos, 3);
00251   <a class="code" href="namespacebase.html#a38">copyMemory</a>(dBodyGetQuaternion(bodyID), savedOrient, 4);
00252   <a class="code" href="namespacebase.html#a38">copyMemory</a>(dBodyGetLinearVel(bodyID), savedVel, 3);
00253   <a class="code" href="namespacebase.html#a38">copyMemory</a>(dBodyGetAngularVel(bodyID), savedAngVel, 3);
00254 }
00255 
00256 <span class="keywordtype">void</span> ODESolid::restoreState()
00257 {
00258   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00259 
00260   dBodySetPosition(bodyID, savedPos[0], savedPos[1], savedPos[2]);
00261   dBodySetQuaternion(bodyID, savedOrient);
00262   dBodySetLinearVel(bodyID, savedVel[0], savedVel[1], savedVel[2]);
00263   dBodySetAngularVel(bodyID, savedAngVel[0], savedAngVel[1], savedAngVel[2]);
00264 }
00265 
00266 <a class="code" href="namespacebase.html#a26">Point3</a>  ODESolid::getSavedPosition()<span class="keyword"> const</span>
00267 <span class="keyword"></span>{
00268   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a26">Point3</a>(); 
00269 
00270   <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a26">Point3</a>(savedPos[0],savedPos[1],savedPos[2]);
00271 }
00272 
00273 Orient  ODESolid::getSavedOrientation()<span class="keyword"> const</span>
00274 <span class="keyword"></span>{
00275   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Orient(); 
00276 
00277   <span class="keywordflow">return</span> Orient(Quat4(savedOrient[1], savedOrient[2], savedOrient[2], savedOrient[0]));
00278 }
00279 
00280 Vector3 ODESolid::getSavedVelocity()<span class="keyword"> const</span>
00281 <span class="keyword"></span>{
00282   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00283 
00284   <span class="keywordflow">return</span> Vector3(savedVel[0], savedVel[1], savedVel[2]);
00285 }
00286 
00287 Vector3 ODESolid::getSavedAngVelocity()<span class="keyword"> const</span>
00288 <span class="keyword"></span>{
00289   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00290 
00291   <span class="keywordflow">return</span> Vector3(savedAngVel[0], savedAngVel[1], savedAngVel[2]);
00292 }
00293 
00294 
00295 <a class="code" href="namespacebase.html#a26">Point3</a> ODESolid::getRelPointPos(<span class="keyword">const</span> Point3&amp; p)
00296 {
00297   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> p; 
00298 
00299   dVector3 result;
00300   dBodyGetRelPointPos(bodyID, p.x, p.y, p.z, result);
00301   <span class="keywordflow">return</span> <a class="code" href="namespacebase.html#a26">Point3</a>(result[0], result[1], result[2]);
00302 }
00303 
00304 Vector3 ODESolid::getRelPointVel(<span class="keyword">const</span> Point3&amp; p)
00305 {
00306   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> p; 
00307 
00308   dVector3 result;
00309   dBodyGetRelPointVel(bodyID, p.x, p.y, p.z, result);
00310   <span class="keywordflow">return</span> Vector3(result[0], result[1], result[2]);
00311 }
00312 
00313 
00314 <a class="code" href="namespacebase.html#a26">Point3</a> ODESolid::getGlobalPointRelPos(<span class="keyword">const</span> Point3&amp; p)
00315 {
00316   <a class="code" href="namespacebase.html#a26">Point3</a> local(p - <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida11">getPosition</a>());
00317   <a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolida12">getOrientation</a>().invert().rotatePoint(local);
00318   <span class="keywordflow">return</span> local;
00319 }
00320 
00321 
00322 
00323 <span class="keywordtype">void</span> ODESolid::addForce(<span class="keyword">const</span> Vector3&amp; f)
00324 {
00325   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00326   dBodyAddForce(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z);
00327 }
00328 
00329 <span class="keywordtype">void</span> ODESolid::addTorque(<span class="keyword">const</span> Vector3&amp; t)
00330 {
00331   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00332   dBodyAddTorque(bodyID, t.x, t.y, t.z);
00333 }
00334 
00335 <span class="keywordtype">void</span> ODESolid::addRelForce(<span class="keyword">const</span> Vector3&amp; f)
00336 {
00337   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00338   dBodyAddRelForce(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z);
00339 }
00340 
00341 <span class="keywordtype">void</span> ODESolid::addRelTorque(<span class="keyword">const</span> Vector3&amp; t)
00342 {
00343   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00344   dBodyAddRelTorque(bodyID, t.x, t.y, t.z);
00345 }
00346 
00347 <span class="keywordtype">void</span> ODESolid::addForceAtPos(<span class="keyword">const</span> Vector3&amp; f, <span class="keyword">const</span> Point3&amp; p)
00348 {
00349   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00350   dBodyAddForceAtPos(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z, p.x, p.y, p.z);
00351 }
00352 
00353 <span class="keywordtype">void</span> ODESolid::addForceAtRelPos(<span class="keyword">const</span> Vector3&amp; f, <span class="keyword">const</span> Point3&amp; p)
00354 {
00355   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00356   dBodyAddForceAtRelPos(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z, p.x, p.y, p.z);
00357 }
00358 
00359 <span class="keywordtype">void</span> ODESolid::addRelForceAtPos(<span class="keyword">const</span> Vector3&amp; f, <span class="keyword">const</span> Point3&amp; p)
00360 {
00361   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00362   dBodyAddRelForceAtPos(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z, p.x, p.y, p.z);
00363 }
00364 
00365 <span class="keywordtype">void</span> ODESolid::addRelForceAtRelPos(<span class="keyword">const</span> Vector3&amp; f, <span class="keyword">const</span> Point3&amp; p)
00366 {
00367   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span>; 
00368   dBodyAddRelForceAtRelPos(bodyID, <a class="code" href="Makefile_8in.html#a5">f</a>.x, <a class="code" href="Makefile_8in.html#a5">f</a>.y, <a class="code" href="Makefile_8in.html#a5">f</a>.z, p.x, p.y, p.z);
00369 }
00370 
00371 Vector3 ODESolid::getForce()<span class="keyword"> const</span>
00372 <span class="keyword"></span>{
00373   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00374 
00375   <span class="keyword">const</span> dReal* <a class="code" href="Makefile_8in.html#a5">f</a> = dBodyGetForce(bodyID);
00376   <span class="keywordflow">return</span> Vector3(f[0], f[1], f[32]);
00377 }
00378 
00379 Vector3 ODESolid::getTorque()<span class="keyword"> const</span>
00380 <span class="keyword"></span>{
00381   <span class="keywordflow">if</span> (!<a class="code" href="classphysics_1_1ODESolid.html#physics_1_1ODESolidp4">created</a>) <span class="keywordflow">return</span> Vector3(); 
00382 
00383   <span class="keyword">const</span> dReal* t = dBodyGetTorque(bodyID);
00384   <span class="keywordflow">return</span> Vector3(t[0], t[1], t[2]);
00385 }
00386 
00387 
00388 ref&lt;Collidable&gt; ODESolid::createCollidable(ref&lt;const Shape&gt; collisionShape, CollidableFlags flags)
00389 {
00390   <span class="keywordflow">if</span> (!flags.test(SolidNotConnected)) {
00391     ref&lt;Solid&gt; self( <span class="keyword">this</span> );
00392     <span class="keywordflow">return</span> ref&lt;CollidableBody&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> <a class="code" href="classphysics_1_1ODESolidConnectedCollidableBody.html">ODESolidConnectedCollidableBody</a>(self, collisionShape));
00393   }
00394   <span class="keywordflow">else</span>
00395     <span class="keywordflow">return</span> ref&lt;CollidableBody&gt;(<a class="code" href="MemoryTracer.html#a0">NewObj</a> ODECollidableBody(<a class="code" href="classphysics_1_1Body.html#physics_1_1SolidConnectedCollidableBodya36">getShape</a>()));
00396 }
00397 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:27 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
