<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: gfx/EnhancedShapeDrawable.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>gfx/EnhancedShapeDrawable.cpp</h1><a href="EnhancedShapeDrawable_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* -*-c++-*- OpenSceneGraph - Copyright (C) 1998-2003 Robert Osfield </span>
00002 <span class="comment"> *</span>
00003 <span class="comment"> * This library is open source and may be redistributed and/or modified under  </span>
00004 <span class="comment"> * the terms of the OpenSceneGraph Public License (OSGPL) version 0.0 or </span>
00005 <span class="comment"> * (at your option) any later version.  The full license is in LICENSE file</span>
00006 <span class="comment"> * included with this distribution, and on the openscenegraph.org website.</span>
00007 <span class="comment"> * </span>
00008 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
00009 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00010 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the </span>
00011 <span class="comment"> * OpenSceneGraph Public License for more details.</span>
00012 <span class="comment">*/</span>
00013 <span class="preprocessor">#include &lt;<a class="code" href="EnhancedShapeDrawable.html">gfx/EnhancedShapeDrawable</a>&gt;</span>
00014 <span class="preprocessor">#include &lt;osg/GL&gt;</span>
00015 <span class="preprocessor">#include &lt;osg/Notify&gt;</span>
00016 
00017 <span class="preprocessor">#include &lt;<a class="code" href="Capsule.html">physics/Capsule</a>&gt;</span>
00018 
00019 <span class="keyword">using</span> <span class="keyword">namespace </span>osg;
00020 
00021 <span class="keyword">using</span> <a class="code" href="classgfx_1_1EnhancedShapeDrawable.html">gfx::EnhancedShapeDrawable</a>;
00022 <span class="keyword">using</span> <a class="code" href="classphysics_1_1Capsule.html">physics::Capsule</a>;
00023 
00024 
00025 <span class="comment"></span>
00026 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
00027 <span class="comment"></span><span class="comment">//</span>
00028 <span class="comment">// draw shape</span>
00029 <span class="comment">//</span>
00030 
00031 
00032 <span class="keyword">class </span>osg::DrawShapeVisitor;
00033 
00034 
00035 
<a name="l00036"></a><a class="code" href="classEnhancedDrawShapeVisitor.html">00036</a> <span class="keyword">class </span><a class="code" href="classEnhancedDrawShapeVisitor.html">EnhancedDrawShapeVisitor</a> : <span class="keyword">public</span> <a class="code" href="classosg_1_1ConstShapeVisitor.html">ConstShapeVisitor</a>
00037 {
00038     <span class="keyword">public</span>:
00039     
<a name="l00040"></a><a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitora0">00040</a>         <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitora0">EnhancedDrawShapeVisitor</a>(State&amp; state,<span class="keyword">const</span> TessellationHints* hints):
00041             <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro0">_state</a>(state),
00042             <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>(hints)
00043         {
00044         }
00045     
00046         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitora1">apply</a>(<span class="keyword">const</span> Capsule&amp;);
00047         
<a name="l00048"></a><a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro0">00048</a>         State&amp;              <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro0">_state</a>;
<a name="l00049"></a><a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">00049</a>         <span class="keyword">const</span> TessellationHints*  <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>;
00050 };
00051 
00052 
00053 
<a name="l00054"></a><a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitora1">00054</a> <span class="keywordtype">void</span> <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitora1">EnhancedDrawShapeVisitor::apply</a>(<span class="keyword">const</span> Capsule&amp; capsule)
00055 {
00056     glPushMatrix();
00057 
00058         glTranslatef(capsule.getCenter().x(),capsule.getCenter().y(),capsule.getCenter().z());
00059 
00060         <span class="keywordflow">if</span> (!capsule.zeroRotation())
00061         {
00062             <a class="code" href="classbase_1_1matrix.html">Matrix</a> rotation(capsule.getRotationMatrix());
00063             glMultMatrix(rotation.ptr());
00064         }
00065 
00066         <span class="comment">// evaluate hints</span>
00067         <span class="keywordtype">bool</span> createBody = (<a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a> ? <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>-&gt;getCreateBody() : <span class="keyword">true</span>);
00068         <span class="keywordtype">bool</span> createTop = (<a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a> ? <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>-&gt;getCreateTop() : <span class="keyword">true</span>);
00069         <span class="keywordtype">bool</span> createBottom = (<a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a> ? <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>-&gt;getCreateBottom() : <span class="keyword">true</span>);
00070 
00071         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numSegments = 40;
00072         <span class="keywordflow">if</span> (<a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a> &amp;&amp; <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>-&gt;getDetailRatio() != 1.0f) {
00073             <span class="keywordtype">float</span> ratio = <a class="code" href="classEnhancedDrawShapeVisitor.html#EnhancedDrawShapeVisitoro1">_hints</a>-&gt;getDetailRatio();
00074             numSegments = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) (numSegments * ratio);
00075             <span class="keywordflow">if</span> (numSegments &lt; MIN_NUM_SEGMENTS)
00076                 numSegments = MIN_NUM_SEGMENTS;
00077         }
00078         
00079         <span class="keywordtype">float</span> angleDelta = 2.0f*osg::PI/(<span class="keywordtype">float</span>)numSegments;
00080         <span class="keywordtype">float</span> texCoordDelta = 1.0f/(<span class="keywordtype">float</span>)numSegments;
00081         
00082         <span class="keywordtype">float</span> r = cylinder.getRadius();
00083         <span class="keywordtype">float</span> h = cylinder.getHeight();
00084         
00085         <span class="keywordtype">float</span> basez = -h*0.5f;
00086         <span class="keywordtype">float</span> topz = h*0.5f;
00087         
00088         <span class="keywordtype">float</span> angle = 0.0f;
00089         <span class="keywordtype">float</span> texCoord = 0.0f;
00090 
00091         <span class="comment">// cylinder body</span>
00092         <span class="keywordflow">if</span> (createBody) {
00093             glBegin(GL_QUAD_STRIP);
00094         
00095             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bodyi=0;
00096                 bodyi&lt;numSegments;
00097                 ++bodyi,angle+=angleDelta,texCoord+=texCoordDelta)
00098             {
00099                 <span class="keywordtype">float</span> c = cosf(angle);
00100                 <span class="keywordtype">float</span> s = sinf(angle);
00101 
00102                 glNormal3f(c,s,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00103 
00104                 glTexCoord2f(texCoord,1.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00105                 glVertex3f(c*r,s*r,topz);
00106 
00107                 glTexCoord2f(texCoord,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00108                 glVertex3f(c*r,s*r,basez);
00109             }
00110 
00111             <span class="comment">// do last point by hand to ensure no round off errors.</span>
00112             glNormal3f(1.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00113 
00114             glTexCoord2f(1.0<a class="code" href="Makefile_8in.html#a5">f</a>,1.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00115             glVertex3f(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz);
00116 
00117             glTexCoord2f(1.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00118             glVertex3f(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez);
00119         
00120             glEnd();
00121         }
00122 
00123         <span class="comment">// cylinder top</span>
00124         <span class="keywordflow">if</span> (createTop) {
00125             glBegin(GL_TRIANGLE_FAN);
00126         
00127             glNormal3f(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,1.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00128             glTexCoord2f(0.5<a class="code" href="Makefile_8in.html#a5">f</a>,0.5<a class="code" href="Makefile_8in.html#a5">f</a>);
00129             glVertex3f(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz);
00130 
00131             angle = 0.0f;
00132             texCoord = 0.0f;
00133             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> topi=0;
00134                 topi&lt;numSegments;
00135                 ++topi,angle+=angleDelta,texCoord+=texCoordDelta)
00136             {
00137                 <span class="keywordtype">float</span> c = cosf(angle);
00138                 <span class="keywordtype">float</span> s = sinf(angle);
00139 
00140                 glTexCoord2f(c*0.5<a class="code" href="Makefile_8in.html#a5">f</a>+0.5<a class="code" href="Makefile_8in.html#a5">f</a>,s*0.5<a class="code" href="Makefile_8in.html#a5">f</a>+0.5<a class="code" href="Makefile_8in.html#a5">f</a>);
00141                 glVertex3f(c*r,s*r,topz);
00142             }
00143 
00144             glTexCoord2f(1.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00145             glVertex3f(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz);
00146         
00147             glEnd();
00148         }
00149 
00150         <span class="comment">// cylinder bottom</span>
00151         <span class="keywordflow">if</span> (createBottom) {
00152             glBegin(GL_TRIANGLE_FAN);
00153         
00154             glNormal3f(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,-1.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00155             glTexCoord2f(0.5<a class="code" href="Makefile_8in.html#a5">f</a>,0.5<a class="code" href="Makefile_8in.html#a5">f</a>);
00156             glVertex3f(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez);
00157 
00158             angle = osg::PI*2.0f;
00159             texCoord = 1.0f;
00160             <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bottomi=0;
00161                 bottomi&lt;numSegments;
00162                 ++bottomi,angle-=angleDelta,texCoord-=texCoordDelta)
00163             {
00164                 <span class="keywordtype">float</span> c = cosf(angle);
00165                 <span class="keywordtype">float</span> s = sinf(angle);
00166 
00167                 glTexCoord2f(c*0.5<a class="code" href="Makefile_8in.html#a5">f</a>+0.5<a class="code" href="Makefile_8in.html#a5">f</a>,s*0.5<a class="code" href="Makefile_8in.html#a5">f</a>+0.5<a class="code" href="Makefile_8in.html#a5">f</a>);
00168                 glVertex3f(c*r,s*r,basez);
00169             }
00170 
00171             glTexCoord2f(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>);
00172             glVertex3f(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez);
00173         
00174             glEnd();
00175         }
00176 
00177     glPopMatrix();
00178 }
00179 
00180 
00181 
00182 <span class="comment"></span>
00183 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
00184 <span class="comment"></span><span class="comment">//</span>
00185 <span class="comment">// Compute bounding of shape</span>
00186 <span class="comment">//</span>
00187 
<a name="l00188"></a><a class="code" href="classEnhancedComputeBoundShapeVisitor.html">00188</a> <span class="keyword">class </span><a class="code" href="classEnhancedComputeBoundShapeVisitor.html">EnhancedComputeBoundShapeVisitor</a> : <span class="keyword">public</span> osg::<a class="code" href="classosg_1_1ConstShapeVisitor.html">ConstShapeVisitor</a>
00189 {
00190     <span class="keyword">public</span>:
00191     
<a name="l00192"></a><a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitora0">00192</a>         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitora0">EnhancedComputeBoundShapeVisitor</a>(BoundingBox&amp; bb):<a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>(bb) {}
00193     
00194         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitora1">apply</a>(<span class="keyword">const</span> Capsule&amp;);
00195         
<a name="l00196"></a><a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">00196</a>         BoundingBox&amp;    <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>;
00197 };
00198 
00199 
00200 
<a name="l00201"></a><a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitora1">00201</a> <span class="keywordtype">void</span> <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitora1">EnhancedComputeBoundShapeVisitor::apply</a>(<span class="keyword">const</span> Capsule&amp; capsule)
00202 {
00203     <span class="keywordflow">if</span> (capsule.zeroRotation())
00204     {
00205         Vec3 halfLengths(capsule.radius(),capsule.radius(),capsule.height()*0.5f+capsule.radius());
00206         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(-halfLengths);
00207         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(halfLengths);
00208 
00209     }
00210     <span class="keywordflow">else</span>
00211     {
00212         <span class="keywordtype">float</span> r = capsule.radius();
00213         <span class="keywordtype">float</span> z = capsule.height()*0.5f;
00214 
00215         Vec3 base_1(Vec3(-r,-r,-z-r));
00216         Vec3 base_2(Vec3(r,-r,-z-r));
00217         Vec3 base_3(Vec3(r,r,-z-r));
00218         Vec3 base_4(Vec3(-r,r,-z-r));
00219     
00220         Vec3 top_1(Vec3(-r,-r,z+r));
00221         Vec3 top_2(Vec3(r,-r,z+r));
00222         Vec3 top_3(Vec3(r,r,z+r));
00223         Vec3 top_4(Vec3(-r,r,z+r));
00224 
00225         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(base_1);
00226         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(base_2);
00227         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(base_3);
00228         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(base_4);
00229 
00230         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(top_1);
00231         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(top_2);
00232         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(top_3);
00233         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html#EnhancedComputeBoundShapeVisitoro0">_bb</a>.expandBy(top_4);
00234     }
00235 }
00236 
00237 
00238 
00239 
00240 <span class="comment"></span>
00241 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
00242 <span class="comment"></span><span class="comment">//</span>
00243 <span class="comment">// Accept a primtive functor for each of the shapes.</span>
00244 <span class="comment">//</span>
00245 
<a name="l00246"></a><a class="code" href="classEnhancedPrimitiveShapeVisitor.html">00246</a> <span class="keyword">class </span><a class="code" href="classEnhancedPrimitiveShapeVisitor.html">EnhancedPrimitiveShapeVisitor</a> : <span class="keyword">public</span> osg::<a class="code" href="classosg_1_1ConstShapeVisitor.html">ConstShapeVisitor</a>
00247 {
00248     <span class="keyword">public</span>:
00249     
<a name="l00250"></a><a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitora0">00250</a>         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitora0">EnhancedPrimitiveShapeVisitor</a>(Drawable::PrimitiveFunctor&amp; functor,<span class="keyword">const</span> TessellationHints* hints):
00251             <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>(functor),
00252             _hints(hints) {}
00253 
00254     
00255         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitora1">apply</a>(<span class="keyword">const</span> Capsule&amp;);
00256         
<a name="l00257"></a><a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">00257</a>         Drawable::PrimitiveFunctor&amp; <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>;
<a name="l00258"></a><a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro1">00258</a>         <span class="keyword">const</span> TessellationHints*  _hints;
00259 };
00260 
00261 
00262 
<a name="l00263"></a><a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitora1">00263</a> <span class="keywordtype">void</span> <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitora1">EnhancedPrimitiveShapeVisitor::apply</a>(<span class="keyword">const</span> Capsule&amp; capsule)
00264 {
00265     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numSegments = 40;
00266 
00267     <span class="keywordtype">float</span> angleDelta = 2.0f*osg::PI/(<span class="keywordtype">float</span>)numSegments;
00268 
00269     <span class="keywordtype">float</span> texCoordDelta = 1.0/(<span class="keywordtype">float</span>)numSegments;
00270 
00271     <span class="keywordtype">float</span> r = capsule.radius();
00272     <span class="keywordtype">float</span> h = capsule.height();
00273 
00274     <span class="keywordtype">float</span> basez = -h*0.5f;
00275     <span class="keywordtype">float</span> topz = h*0.5f;
00276 
00277     <span class="comment">// cylinder body</span>
00278     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.begin(GL_QUAD_STRIP);
00279 
00280         <span class="keywordtype">float</span> angle = 0.0f;
00281         <span class="keywordtype">float</span> texCoord = 0.0f;
00282         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bodyi=0;
00283             bodyi&lt;numSegments;
00284             ++bodyi,angle+=angleDelta,texCoord+=texCoordDelta)
00285         {
00286 
00287             <span class="keywordtype">float</span> c = cosf(angle);
00288             <span class="keywordtype">float</span> s = sinf(angle);
00289 
00290             <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(c*r,s*r,topz));
00291             <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(c*r,s*r,basez));
00292 
00293         }
00294 
00295         <span class="comment">// do last point by hand to ensure no round off errors.</span>
00296         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz));
00297         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez));
00298 
00299     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.end();
00300 
00301 
00302     <span class="comment">// cylinder top</span>
00303     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.begin(GL_TRIANGLE_FAN);
00304 
00305         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz));
00306 
00307         angle = 0.0f;
00308         texCoord = 0.0f;
00309         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> topi=0;
00310             topi&lt;numSegments;
00311             ++topi,angle+=angleDelta,texCoord+=texCoordDelta)
00312         {
00313 
00314             <span class="keywordtype">float</span> c = cosf(angle);
00315             <span class="keywordtype">float</span> s = sinf(angle);
00316 
00317             <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(c*r,s*r,topz));
00318 
00319         }
00320 
00321         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,topz));
00322 
00323     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.end();
00324 
00325     <span class="comment">// cylinder bottom</span>
00326     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.begin(GL_TRIANGLE_FAN);
00327 
00328         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(0.0<a class="code" href="Makefile_8in.html#a5">f</a>,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez));
00329 
00330         angle = osg::PI*2.0f;
00331         texCoord = 1.0f;
00332         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bottomi=0;
00333             bottomi&lt;numSegments;
00334             ++bottomi,angle-=angleDelta,texCoord-=texCoordDelta)
00335         {
00336 
00337             <span class="keywordtype">float</span> c = cosf(angle);
00338             <span class="keywordtype">float</span> s = sinf(angle);
00339 
00340             <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(c*r,s*r,basez));
00341 
00342         }
00343 
00344         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.vertex(Vec3(r,0.0<a class="code" href="Makefile_8in.html#a5">f</a>,basez));
00345 
00346     <a class="code" href="classEnhancedPrimitiveShapeVisitor.html#EnhancedPrimitiveShapeVisitoro0">_functor</a>.end();
00347 }
00348 
00349 <span class="comment"></span>
00350 <span class="comment">///////////////////////////////////////////////////////////////////////////////</span>
00351 <span class="comment"></span><span class="comment">//</span>
00352 <span class="comment">// ShapeDrawable itself..</span>
00353 <span class="comment">//</span>
00354 
00355 
00356 EnhancedShapeDrawable::EnhancedShapeDrawable():
00357 {
00358 }
00359 
00360 EnhancedShapeDrawable::EnhancedShapeDrawable(Shape* shape,TessellationHints* hints):
00361   <a class="code" href="classosg_1_1ShapeDrawable.html">ShapeDrawable</a>(shape, hints)
00362 {
00363 }
00364 
00365 EnhancedShapeDrawable::EnhancedShapeDrawable(<span class="keyword">const</span> <a class="code" href="classosg_1_1ShapeDrawable.html">ShapeDrawable</a>&amp; pg,<span class="keyword">const</span> CopyOp&amp; copyop):
00366     <a class="code" href="classosg_1_1ShapeDrawable.html">ShapeDrawable</a>(pg,copyop)
00367 {
00368 }
00369 
00370 EnhancedShapeDrawable::~EnhancedShapeDrawable()
00371 {
00372 }
00373 
00374 <span class="keywordtype">void</span> ShapeDrawable::drawImplementation(State&amp; state)<span class="keyword"> const</span>
00375 <span class="keyword"></span>{
00376     <span class="keywordflow">if</span> (_shape.valid())
00377     {
00378       <span class="keywordflow">if</span> (<a class="code" href="base.html#a25">base::instanceof</a>(*_shape, <span class="keyword">const</span> 
00379       
00380         glColor4fv(_color.ptr());
00381     
00382         <a class="code" href="classEnhancedDrawShapeVisitor.html">EnhancedDrawShapeVisitor</a> dsv(state,_tessellationHints.get());
00383         
00384         _shape-&gt;accept(dsv);
00385     }
00386 }
00387 
00388 <span class="keywordtype">void</span> ShapeDrawable::accept(ConstAttributeFunctor&amp;)<span class="keyword"> const</span>
00389 <span class="keyword"></span>{
00390 }
00391 
00392 <span class="keywordtype">void</span> ShapeDrawable::accept(PrimitiveFunctor&amp; pf)<span class="keyword"> const</span>
00393 <span class="keyword"></span>{
00394     <span class="keywordflow">if</span> (_shape.valid())
00395     {
00396         <a class="code" href="classEnhancedPrimitiveShapeVisitor.html">EnhancedPrimitiveShapeVisitor</a> psv(pf,_tessellationHints.get());
00397         _shape-&gt;accept(psv);
00398     }
00399 }
00400 
00401 
00402 <span class="keywordtype">bool</span> ShapeDrawable::computeBound()<span class="keyword"> const</span>
00403 <span class="keyword"></span>{
00404     _bbox.init();
00405 
00406 
00407     <span class="keywordflow">if</span> (_shape.valid())
00408     {
00409         <a class="code" href="classEnhancedComputeBoundShapeVisitor.html">EnhancedComputeBoundShapeVisitor</a> cbsv(_bbox);
00410         _shape-&gt;accept(cbsv);
00411         _bbox_computed = <span class="keyword">true</span>;
00412 
00413         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00414     }
00415 
00416     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00417 }
00418 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:19 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
