<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>base/Matrix.cpp.bak Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>base/Matrix.cpp.bak</h1><a href="Matrix_8cpp_8bak.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</font>
00003 <font class="comment"></font>
00004 <font class="comment">  This program/file is free software; you can redistribute it and/or modify</font>
00005 <font class="comment">  it under the terms of the GNU General Public License as published by</font>
00006 <font class="comment">  the Free Software Foundation; either version 2 of the License, or</font>
00007 <font class="comment">  (at your option) any later version.</font>
00008 <font class="comment">  </font>
00009 <font class="comment">  This program is distributed in the hope that it will be useful,</font>
00010 <font class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00011 <font class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
00012 <font class="comment">  GNU General Public License for more details. (http://www.gnu.org)</font>
00013 <font class="comment">  </font>
00014 <font class="comment">  You should have received a copy of the GNU General Public License</font>
00015 <font class="comment">  along with this program; if not, write to the Free Software</font>
00016 <font class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font>
00017 <font class="comment">  </font>
00018 <font class="comment">  $Id: Matrix.cpp,v 1.6 2001/05/22 19:24:19 jungd Exp $</font>
00019 <font class="comment">  $Revision: 1.6 $</font>
00020 <font class="comment">  $Date: 2001/05/22 19:24:19 $</font>
00021 <font class="comment">  $Author: jungd $</font>
00022 <font class="comment"> </font>
00023 <font class="comment">****************************************************************************/</font>
00024 
00025 <font class="preprocessor">#include &lt;<a class="code" href="Matrix.html">base/Matrix</a>&gt;</font>
00026 
00027 <font class="comment">// Implementations of MatrixImpl</font>
00028 <font class="preprocessor">#include &lt;base/StandardMatrixImpl&gt;</font>
00029 <font class="preprocessor">#include &lt;base/RowVecMatrixImpl&gt;</font>
00030 
00031 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix.html">base::Matrix</a>;
00032 <font class="keyword">using</font> <a class="code" href="classbase_1_1Vector.html">base::Vector</a>;
00033 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix4.html">base::Matrix4</a>;
00034 <font class="keyword">using</font> <a class="code" href="classbase_1_1Vector4.html">base::Vector4</a>;
00035 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix3.html">base::Matrix3</a>;
00036 
00037 <font class="keyword">using</font> std::ostream;
00038 
00039 <font class="keywordtype">void</font> Matrix::construct(<a class="code" href="namespacebase.html#a2">Int</a> rows, <a class="code" href="namespacebase.html#a2">Int</a> cols, Implementation impl) <font class="keywordflow">throw</font>(std::invalid_argument)
00040 {
00041   <font class="keywordflow">if</font> ((rows==0) || (cols==0))
00042     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix rows and cols must be &gt; 0"</font>));
00043   
00044   <font class="keywordflow">switch</font> (impl) {
00045   <font class="keywordflow">case</font> Standard:
00046   <font class="keywordflow">default</font>: mimpl = ref&lt;MatrixImpl&gt;(<a class="code" href="MemoryTracer.html#a1">NewNamedObj</a>(<font class="stringliteral">"StandardMatrixImpl"</font>) StandardMatrixImpl(rows,cols)); <font class="keywordflow">break</font>;
00047   }
00048 }
00049 
00050 
<a name="l00051"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa48">00051</a> Matrix::Matrix(<a class="code" href="namespacebase.html#a2">Int</a> rows=1, <a class="code" href="namespacebase.html#a2">Int</a> cols=1, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; diagonal, Implementation impl)
00052   : impl(impl)
00053 {
00054   construct(<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>, cols, <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixn0">impl</a>);
00055   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa57">setDiagonal</a>(diagonal); 
00056 }
00057 
00058 Matrix::Matrix(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m) 
00059   : impl(m.implementation())
00060 {
00061   construct(m.rows(), m.columns(), <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixn0">impl</a>);
00062   this-&gt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa21">operator=</a>(m); 
00063 }
00064 
00065 Matrix::Matrix(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v) 
00066   : impl(Standard)
00067 {
00068   construct(1,v.dimension(), <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixn0">impl</a>);
00069   this-&gt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa21">operator=</a>(v); 
00070 }
00071 
00072 Matrix::Matrix(<font class="keyword">const</font> Matrix3&amp; m) 
00073   : impl(Standard)
00074 {
00075   construct(3,3,<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixn0">impl</a>);
00076   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1)=m.e(1,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2)=m.e(1,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3)=m.e(1,3); 
00077   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1)=m.e(2,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2)=m.e(2,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3)=m.e(2,3); 
00078   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1)=m.e(3,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2)=m.e(3,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3)=m.e(3,3); 
00079 } 
00080 
00081 Matrix:: Matrix(<font class="keyword">const</font> Matrix4&amp; m) 
00082   : impl(Standard)
00083 {
00084   construct(4,4,<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixn0">impl</a>);
00085   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1)=m.e(1,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2)=m.e(1,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3)=m.e(1,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,4)=m.e(1,4);
00086   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1)=m.e(2,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2)=m.e(2,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3)=m.e(2,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,4)=m.e(2,4);
00087   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1)=m.e(3,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2)=m.e(3,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3)=m.e(3,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,4)=m.e(3,4);
00088   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,1)=m.e(4,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,2)=m.e(4,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,3)=m.e(4,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,4)=m.e(4,4);
00089 } 
00090 
00091 Matrix::~Matrix() 
00092 {}
00093 
00094 
00095 
00096 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> exchange(<a class="code" href="namespacebase.html#a5">Real</a>&amp; a, <a class="code" href="namespacebase.html#a5">Real</a>&amp; b)
00097 {
00098   <a class="code" href="namespacebase.html#a5">Real</a> t(a);
00099   a = b;
00100   b = t;
00101 }
00102 
00103 
<a name="l00104"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa70">00104</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::getRow(<a class="code" href="namespacebase.html#a2">Int</a> row) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::out_of_range)
00105 {
00106   <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; rows()))
00107     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"row is out of range"</font>));
00108 
00109   <font class="keywordflow">return</font> mimpl-&gt;getRow(row);
00110 }
00111 
<a name="l00112"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa71">00112</a> <font class="keywordtype">void</font> Matrix::setRow(<a class="code" href="namespacebase.html#a2">Int</a> row, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; rowVector) <font class="keywordflow">throw</font>(std::out_of_range)
00113 {
00114   <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; rows()))
00115     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"row is out of range"</font>));
00116 
00117   <font class="keywordflow">if</font> (rowVector.dimension() != columns())
00118     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"rowVector must have dimension equal to the number of Matrix columns"</font>));
00119 
00120   mimpl-&gt;setRow(row, rowVector);
00121 }
00122 
<a name="l00123"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa72">00123</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::getColumn(<a class="code" href="namespacebase.html#a2">Int</a> col) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::out_of_range)
00124 {
00125   <font class="keywordflow">if</font> ((col &lt; 1) || (col &gt; columns()))
00126     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"col is out of range"</font>));
00127 
00128   <font class="keywordflow">return</font> mimpl-&gt;getColumn(col);
00129 }
00130 
<a name="l00131"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa73">00131</a> <font class="keywordtype">void</font> Matrix::setColumn(<a class="code" href="namespacebase.html#a2">Int</a> col, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; colVector) <font class="keywordflow">throw</font>(std::out_of_range)
00132 {
00133   <font class="keywordflow">if</font> ((col &lt; 1) || (col &gt; columns()))
00134     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"col is out of range"</font>));
00135 
00136   <font class="keywordflow">if</font> (colVector.dimension() != rows())
00137     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"colVector must have dimension equal to the number of Matrix rows"</font>));
00138 
00139   mimpl-&gt;setColumn(col, colVector);
00140 }
00141 
00142 <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; Matrix::row(<a class="code" href="namespacebase.html#a2">Int</a> row) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::out_of_range, <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>)
00143 {
00144   <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; rows()))
00145     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"row is out of range"</font>));
00146   
00147   <font class="keywordflow">return</font> mimpl-&gt;row(row);
00148 }
00149 
<a name="l00150"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa75">00150</a> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; Matrix::row(<a class="code" href="namespacebase.html#a2">Int</a> row) <font class="keywordflow">throw</font>(std::out_of_range, <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>)
00151 {
00152   <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; rows()))
00153     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"row is out of range"</font>));
00154   
00155   <font class="keywordflow">return</font> mimpl-&gt;row(row);
00156 }
00157 
00158 
00159 
00160 
00161 
00162 <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::invert()
00163 {
00164   <a class="code" href="namespacebase.html#a2">Int</a> nr = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>();
00165   <a class="code" href="namespacebase.html#a2">Int</a> nc = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa10">columns</a>();
00166 
00167   <font class="keywordflow">if</font> (nr == nc) {
00168     <font class="comment">// Solve AX = I by solving eqns: Ax = e (for each e a col of I)</font>
00169     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> I(nr,nc); <font class="comment">// identity</font>
00170     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> <a class="code" href="Globals_8h.html#a21">X</a>(nr,nc), A(*<font class="keyword">this</font>);
00171     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="matrix_8c~.html#a13">x</a>(nr);
00172     
00173     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> L(nr,nc),U(nr,nc);
00174     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>(nr);
00175     
00176     A.decomposeLUP(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>);
00177     
00178     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++) {
00179       x = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd0">solveLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>,I.getColumn(c));
00180       <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++) <a class="code" href="Globals_8h.html#a21">X</a>.e(r,c) = x[r];
00181     }
00182     
00183     <font class="keywordflow">return</font> (*<font class="keyword">this</font> = <a class="code" href="Globals_8h.html#a21">X</a>);
00184   }
00185   <font class="keywordflow">else</font>
00186     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Can't invert a non-square matrix"</font>));
00187 }
00188 
00189 
00190 <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::negate() <font class="keywordflow">throw</font>()
00191 {
00192   mimpl-&gt;operator-();
00193   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00194 }
00195 
00196 
00197 <font class="keywordtype">void</font> Matrix::decomposeLUP(<a class="code" href="namespacebase.html#a18">Matrix</a>&amp; L, <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; U, <a class="code" href="namespacebase.html#a30">Vector</a>&amp; <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>)<font class="keyword"> const</font>
00198 <font class="keyword"></font>{
00199   <a class="code" href="namespacebase.html#a2">Int</a> n = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>();
00200 
00201   <font class="keywordflow">if</font> ( (L.rows() != n) || (L.columns() != n)
00202        || (U.rows()!=n) || (U.columns() != n) 
00203        || (<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>.dimension() != n) )
00204     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"L,U,Pi must be square and of same dimension (that of *this)"</font>));
00205 
00206   <a class="code" href="namespacebase.html#a5">Real</a> p,a;
00207   <a class="code" href="namespacebase.html#a2">Int</a> <a class="code" href="analytical_8c.html#a4">kp</a>,i,j,k;
00208   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> AA(*<font class="keyword">this</font>);
00209 
00210   <font class="keywordflow">for</font>(i=1; i&lt;=n; i++) <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[i] = i;
00211   <font class="keywordflow">for</font>(k=1; k&lt;=n-1; k++) {
00212     p = <a class="code" href="namespacebase.html#a5">Real</a>(0); <a class="code" href="analytical_8c.html#a4">kp</a> = 1;
00213     <font class="keywordflow">for</font>(i=k; i&lt;=n; i++) {
00214       a = <a class="code" href="namespacebase.html#a5">Real</a>(base::abs(AA.e(i,k)));
00215       <font class="keywordflow">if</font> ( a &gt; p ) {
00216         p = a;
00217         <a class="code" href="analytical_8c.html#a4">kp</a> = i;
00218       }
00219     }
00220     <font class="keywordflow">if</font> (p == <a class="code" href="namespacebase.html#a5">Real</a>(0))
00221       <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix is singular"</font>));
00222     
00223     exchange(<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[k],<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[<a class="code" href="analytical_8c.html#a4">kp</a>]);
00224     <font class="keywordflow">for</font>(i=1; i&lt;=n;i++) exchange(AA.e(k,i),AA.e(<a class="code" href="analytical_8c.html#a4">kp</a>,i));
00225     
00226     <font class="keywordflow">for</font>(i=k+1; i&lt;=n;i++) {
00227       AA.e(i,k) /= AA.e(k,k);
00228       <font class="keywordflow">for</font>(j=k+1; j&lt;=n; j++)
00229         AA.e(i,j) -= AA.e(i,k)*AA.e(k,j);
00230     }
00231   }
00232   
00233   <font class="keywordflow">for</font>(i=1;i&lt;=n;i++) {
00234     <font class="keywordflow">for</font>(j=1;j&lt;=n;j++)
00235       <font class="keywordflow">if</font> (i&gt;j) {
00236         L.e(i,j) = AA.e(i,j); U.e(i,j) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00237       }
00238       <font class="keywordflow">else</font> {
00239         U.e(i,j) = AA.e(i,j); L.e(i,j) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00240       }
00241     L.e(i,i) = <a class="code" href="namespacebase.html#a5">Real</a>(1);
00242     
00243   }
00244 
00245 }
00246 
00247 
00248 <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::solve(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; b)<font class="keyword"> const</font>
00249 <font class="keyword"></font>{
00250   <a class="code" href="namespacebase.html#a2">Int</a> n = b.dimension();
00251   
00252   <font class="keywordflow">if</font> (<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>() != n)
00253     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Vector b doesn't have same dimension as rows of Matrix"</font>));
00254 
00255   <font class="keywordflow">if</font> (<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>()==<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa10">columns</a>()) {
00256     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> L(n,n),U(n,n);
00257     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>(n);
00258     
00259     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa37">decomposeLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>);
00260     <font class="keywordflow">return</font> <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd0">solveLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>,b);
00261   }
00262   <font class="keywordflow">else</font> {
00263     <font class="comment">// use Gauss elminiation instead</font>
00264     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"not implemented"</font>));
00265 
00266   }
00267 }
00268 
00269 
00270 <font class="comment">/*</font>
00271 <font class="comment">Matrix Matrix::select(const Vector&amp; rowIndices,</font>
00272 <font class="comment">                      const Vector&amp; colIndices) const throw(std::out_of_range)</font>
00273 <font class="comment">{</font>
00274 <font class="comment">  const Vector&amp; ri(rowIndices); // save typing</font>
00275 <font class="comment">  const Vector&amp; ci(colIndices);</font>
00276 <font class="comment"></font>
00277 <font class="comment">  if ((ri.dimension()==0) || (ci.dimension()==0))</font>
00278 <font class="comment">    throw std::out_of_range(Exception("index arrays can't be empty"));</font>
00279 <font class="comment"></font>
00280 <font class="comment">  Matrix s(ri.dimension(), ci.dimension());</font>
00281 <font class="comment">  for(Int r=1; r&lt;=ri.dimension(); r++)</font>
00282 <font class="comment">    for(Int c=1; c&lt;=ci.dimension(); c++) {</font>
00283 <font class="comment">      if (   (Int(ri[r]) &lt; 1) || (Int(ri[r]) &gt; rows()) </font>
00284 <font class="comment">          || (Int(ci[c]) &lt; 1) || (Int(ci[c]) &gt; columns()))</font>
00285 <font class="comment">        throw std::out_of_range(Exception("index out of range"));</font>
00286 <font class="comment">      s.e(r,c) = e(Int(ri[r]), Int(ci[c]));</font>
00287 <font class="comment">    }</font>
00288 <font class="comment">  return s;</font>
00289 <font class="comment">}</font>
00290 <font class="comment">*/</font>
00291 
00292 
00293 
00294 
00295 
00296 <font class="keywordtype">void</font> Matrix::zeroUpperTriangle() <font class="keywordflow">throw</font>(std::invalid_argument)
00297 {
00298   <font class="keywordflow">if</font> (rows() != columns()) 
00299     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"only square Matrices have an upper triangle"</font>));
00300 
00301   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=rows(); r++)
00302     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=r+1; c&lt;=columns(); c++)
00303       e(r,c) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00304 }
00305 
00306 <font class="keywordtype">void</font> Matrix::zeroLowerTriangle() <font class="keywordflow">throw</font>(std::invalid_argument)
00307 {
00308   <font class="keywordflow">if</font> (rows() != columns()) 
00309     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"only square Matrices have a lower triangle"</font>));
00310 
00311   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=rows(); r++)
00312     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;r; c++)
00313       e(r,c) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00314 }
00315 
00316 <font class="keywordtype">void</font> Matrix::setRandom(<a class="code" href="namespacebase.html#a5">Real</a> range)
00317 {
00318   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>(); r++)
00319     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa10">columns</a>(); c++)
00320       <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(r,c) = (base::random()*<a class="code" href="namespacebase.html#a5">Real</a>(2)-<a class="code" href="namespacebase.html#a5">Real</a>(1))*range;
00321 }
00322 
00323 
00324 <a class="code" href="namespacebase.html#a5">Real</a> Matrix::maxDifference(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; a) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::invalid_argument)
00325 {
00326   <font class="keywordflow">if</font> (rows() != a.rows() || columns() != a.columns())
00327     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrices are not same dimensions"</font>));
00328 
00329   <a class="code" href="namespacebase.html#a5">Real</a> max = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00330   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=rows(); r++)
00331     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=columns(); c++) {
00332       <a class="code" href="namespacebase.html#a5">Real</a> diff = <a class="code" href="namespacebase.html#a89">base::abs</a>(e(r,c) - a.e(r,c));
00333       <font class="keywordflow">if</font> (diff &gt; max) max = diff;
00334     }
00335   <font class="keywordflow">return</font> max;
00336 }
00337 
00338 <font class="comment">/*</font>
00339 <font class="comment">Matrix Matrix::sub(Int row, Int col, Int rows, Int cols) const</font>
00340 <font class="comment">{</font>
00341 <font class="comment">  if ((row+rows-1 &gt; nr) || (col+cols-1 &gt; nc))</font>
00342 <font class="comment">    throw std::invalid_argument(Exception("Submatrix is out of bounds"));</font>
00343 <font class="comment"></font>
00344 <font class="comment">  Matrix sm(rows,cols);</font>
00345 <font class="comment"></font>
00346 <font class="comment">  for(Int r=row; r&lt;row+rows; r++)</font>
00347 <font class="comment">    for(Int c=col; c&lt;col+cols; c++)</font>
00348 <font class="comment">      sm.e(r-row+1,c-col+1) = e(r,c);</font>
00349 <font class="comment"></font>
00350 <font class="comment">  return sm;</font>
00351 <font class="comment">}</font>
00352 <font class="comment"></font>
00353 <font class="comment"></font>
00354 <font class="comment">void Matrix::sub(Int row, Int col, const Matrix&amp; sm)</font>
00355 <font class="comment">{</font>
00356 <font class="comment">  Int rows = sm.rows();</font>
00357 <font class="comment">  Int cols = sm.columns();</font>
00358 <font class="comment"></font>
00359 <font class="comment">  if ((row+rows-1 &gt; nr) || (col+cols-1 &gt; nc))</font>
00360 <font class="comment">    throw std::invalid_argument(Exception("Submatrix is out of bounds"));</font>
00361 <font class="comment"></font>
00362 <font class="comment">  for(Int r=row; r&lt;row+rows; r++)</font>
00363 <font class="comment">    for(Int c=col; c&lt;col+cols; c++)</font>
00364 <font class="comment">      e(r,c) = sm.e(r-row+1,c-col+1);</font>
00365 <font class="comment">}</font>
00366 <font class="comment">*/</font>
00367 
00368 
00369 
00370 <font class="comment">// Operators</font>
00371 
00372 
00373 Matrix::operator Matrix3()<font class="keyword"> const</font>
00374 <font class="keyword"></font>{
00375   Matrix3 r;
00376   r.e(1,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1); r.e(1,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2); r.e(1,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3);
00377   r.e(2,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1); r.e(2,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2); r.e(2,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3);
00378   r.e(3,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1); r.e(3,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2); r.e(3,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3);
00379   <font class="keywordflow">return</font> r;
00380 }
00381 
00382 Matrix::operator Matrix4()<font class="keyword"> const</font>
00383 <font class="keyword"></font>{
00384   Matrix4 r;
00385   r.e(1,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1); r.e(1,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2); r.e(1,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3); r.e(1,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,4);
00386   r.e(2,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1); r.e(2,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2); r.e(2,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3); r.e(2,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,4);
00387   r.e(3,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1); r.e(3,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2); r.e(3,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3); r.e(3,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,4);
00388   r.e(4,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,1); r.e(4,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,2); r.e(4,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,3); r.e(4,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,4);
00389   <font class="keywordflow">return</font> r;
00390 }
00391 
00392 
00393 <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::matrixMulVector(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v) 
00394 {
00395   <font class="keywordflow">if</font> (m.columns() != v.dimension())
00396     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix must have same columns as Vector dimension"</font>));
00397 
00398   <a class="code" href="namespacebase.html#a30">Vector</a> rv(m.rows());
00399 
00400   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.rows(); r++)
00401     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.columns(); c++)
00402       rv[r] += (m.e(r,c) * v[c]);
00403 
00404   <font class="keywordflow">return</font> rv;
00405 }
00406 
00407 
00408 <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::matrixMulVectorAddVector(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v2) 
00409 {
00410   <font class="keywordflow">if</font> ((m.columns() != v.dimension()) || (m.columns() != v2.dimension()))
00411     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix must have same columns as Vector dimension"</font>));
00412 
00413   <a class="code" href="namespacebase.html#a30">Vector</a> rv(m.rows());
00414 
00415   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.rows(); r++) {
00416     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.columns(); c++)
00417       rv[r] += m.e(r,c)*v[c];
00418     rv[r] += v2[r];
00419   }
00420   <font class="keywordflow">return</font> rv;
00421 }
00422 
00423 
00424 <font class="comment">// Solve for Ax = b, given LUP decomposition of A as L, U and Pi, and given b, returns x</font>
00425 <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::solveLUP(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; L, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; U, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; b)
00426 {
00427   <a class="code" href="namespacebase.html#a2">Int</a> n = L.rows();
00428 
00429   <font class="keywordflow">if</font> ( (b.dimension() != n) || (L.columns() != n)
00430        || (U.rows()!=n) || (U.columns() != n) 
00431        || (<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>.dimension() != n) )
00432     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"L,U,Pi must be square and of same dimension (that of b)"</font>));
00433 
00434   <a class="code" href="namespacebase.html#a2">Int</a> i,j;
00435   <a class="code" href="namespacebase.html#a30">Vector</a> y(n), <a class="code" href="matrix_8c~.html#a13">x</a>(n);
00436   <a class="code" href="namespacebase.html#a5">Real</a> s;
00437   <font class="comment">// forward subst.</font>
00438   <font class="keywordflow">for</font>(i=1;i&lt;=n;i++) {
00439     s = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00440     <font class="keywordflow">for</font>(j=1;j&lt;=i-1;j++) s += L.e(i,j)*y[j];
00441     y[i] = b[int(<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[i])] - s;
00442   }
00443   <font class="comment">// backward subst.</font>
00444   <font class="keywordflow">for</font>(i=n;i&gt;=1;i--) {
00445     s = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00446     <font class="keywordflow">for</font>(j=i+1;j&lt;=n;j++) s += U.e(i,j)*x[j];
00447     x[i] = (y[i] - s)/(U.e(i,i));
00448   }
00449   <font class="keywordflow">return</font> x;
00450 }
00451 
00452 <font class="comment">/*</font>
00453 <font class="comment">const Real* Matrix::c_array() const</font>
00454 <font class="comment">{</font>
00455 <font class="comment">  if (m)</font>
00456 <font class="comment">    return m;</font>
00457 <font class="comment">  else</font>
00458 <font class="comment">    throw std::runtime_error(Exception("no array representation"));</font>
00459 <font class="comment">}</font>
00460 <font class="comment"></font>
00461 <font class="comment">Real* Matrix::c_array() </font>
00462 <font class="comment">{</font>
00463 <font class="comment">  if (m)</font>
00464 <font class="comment">    return m;</font>
00465 <font class="comment">  else</font>
00466 <font class="comment">    throw std::runtime_error(Exception("no array representation"));</font>
00467 <font class="comment">}</font>
00468 <font class="comment">*/</font>
00469 
00470 
00471 <font class="comment">// output</font>
00472 ostream&amp; <a class="code" href="namespacebase.html#a52">base::operator&lt;&lt;</a>(ostream&amp; out, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m)
00473 {
00474   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.rows(); r++) {
00475     <font class="keywordflow">for</font> (<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.columns(); c++) 
00476       out &lt;&lt; m.e(r,c) &lt;&lt; <font class="stringliteral">" "</font>;
00477     out &lt;&lt; std::endl;
00478   }
00479   <font class="keywordflow">return</font> out;
00480 }
00481 
00482 
00483 
00484 
00485 
00486 
00487 
</pre></div><hr><address><small>Generated on Sun Mar 30 14:02:10 2003 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
