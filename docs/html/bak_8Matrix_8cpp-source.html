<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>base/bak.Matrix.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>base/bak.Matrix.cpp</h1><a href="bak_8Matrix_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</font>
00003 <font class="comment"></font>
00004 <font class="comment">  This program/file is free software; you can redistribute it and/or modify</font>
00005 <font class="comment">  it under the terms of the GNU General Public License as published by</font>
00006 <font class="comment">  the Free Software Foundation; either version 2 of the License, or</font>
00007 <font class="comment">  (at your option) any later version.</font>
00008 <font class="comment">  </font>
00009 <font class="comment">  This program is distributed in the hope that it will be useful,</font>
00010 <font class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00011 <font class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
00012 <font class="comment">  GNU General Public License for more details. (http://www.gnu.org)</font>
00013 <font class="comment">  </font>
00014 <font class="comment">  You should have received a copy of the GNU General Public License</font>
00015 <font class="comment">  along with this program; if not, write to the Free Software</font>
00016 <font class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font>
00017 <font class="comment">  </font>
00018 <font class="comment">  $Id: Matrix.cpp,v 1.6 2001/05/22 19:24:19 jungd Exp $</font>
00019 <font class="comment">  $Revision: 1.6 $</font>
00020 <font class="comment">  $Date: 2001/05/22 19:24:19 $</font>
00021 <font class="comment">  $Author: jungd $</font>
00022 <font class="comment"> </font>
00023 <font class="comment">****************************************************************************/</font>
00024 
00025 <font class="preprocessor">#include &lt;<a class="code" href="Matrix.html">base/Matrix</a>&gt;</font>
00026 
00027 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix.html">base::Matrix</a>;
00028 <font class="keyword">using</font> <a class="code" href="classbase_1_1Vector.html">base::Vector</a>;
00029 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix4.html">base::Matrix4</a>;
00030 <font class="keyword">using</font> <a class="code" href="classbase_1_1Vector4.html">base::Vector4</a>;
00031 <font class="keyword">using</font> <a class="code" href="classbase_1_1Matrix3.html">base::Matrix3</a>;
00032 
00033 <font class="keyword">using</font> std::ostream;
00034 
00035 <font class="comment">// Note that the memory layout of Matrix is not compatible with</font>
00036 <font class="comment">//  Matrix3 or Matrix4 (which are designed to be compatible with OpenGL)</font>
<a name="l00037"></a><a class="code" href="bak_8Matrix_8cpp.html#a0">00037</a> <font class="keyword">inline</font> <a class="code" href="namespacebase.html#a2">Int</a> <a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(<a class="code" href="namespacebase.html#a2">Int</a> nc,<a class="code" href="namespacebase.html#a2">Int</a> r,<a class="code" href="namespacebase.html#a2">Int</a> c) 
00038 {
00039   <font class="keywordflow">return</font> (nc*(r-1)+c-1); 
00040 }
00041 
00042 
00043 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> exchange(<a class="code" href="namespacebase.html#a5">Real</a>&amp; a, <a class="code" href="namespacebase.html#a5">Real</a>&amp; b)
00044 {
00045   <a class="code" href="namespacebase.html#a5">Real</a> t(a);
00046   a = b;
00047   b = t;
00048 }
00049 
00050 <font class="comment">// row, col element exchange</font>
00051 <font class="keyword">inline</font> <font class="keyword">static</font> <font class="keywordtype">void</font> rcswap(<a class="code" href="namespacebase.html#a2">Int</a> nc, <a class="code" href="namespacebase.html#a5">Real</a> m[], <a class="code" href="namespacebase.html#a2">Int</a> r, <a class="code" href="namespacebase.html#a2">Int</a> c) 
00052 {
00053   <a class="code" href="namespacebase.html#a5">Real</a>* rcp = &amp;m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,r,c)];
00054   <a class="code" href="namespacebase.html#a5">Real</a>* crp = &amp;m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,c,r)];
00055   exchange(*rcp, *crp);
00056 }
00057 
00058 
00059 
<a name="l00060"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">00060</a> Matrix::Matrix(<a class="code" href="namespacebase.html#a2">Int</a> rows=1, <a class="code" href="namespacebase.html#a2">Int</a> cols=1, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; diagonal)
00061   : nr(rows), nc(cols)
00062 {
00063   <font class="keywordflow">if</font> ((<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>==0) || (cols==0))
00064     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix rows and cols must be &gt; 0"</font>));
00065   
00066   m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00067   
00068   setDiag(diagonal); 
00069 }
00070 
<a name="l00071"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa1">00071</a> Matrix::Matrix(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m) 
00072   :nr(m.nr), nc(m.nc) 
00073 {
00074   this-&gt;m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00075   this-&gt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa21">operator=</a>(m); 
00076 }
00077 
<a name="l00078"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa2">00078</a> Matrix::Matrix(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v) 
00079   :nr(1), nc(v.dimension())
00080 {
00081   this-&gt;m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00082   this-&gt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa21">operator=</a>(v); 
00083 }
00084 
<a name="l00085"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa3">00085</a> Matrix::Matrix(<font class="keyword">const</font> Matrix3&amp; m) 
00086   : nr(3), nc(3)
00087 {
00088   this-&gt;m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00089   
00090   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1)=m.e(1,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2)=m.e(1,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3)=m.e(1,3); 
00091   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1)=m.e(2,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2)=m.e(2,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3)=m.e(2,3); 
00092   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1)=m.e(3,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2)=m.e(3,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3)=m.e(3,3); 
00093 } 
00094 
<a name="l00095"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa4">00095</a> Matrix:: Matrix(<font class="keyword">const</font> Matrix4&amp; m) 
00096   : nr(4), nc(4)
00097 {
00098   this-&gt;m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00099   
00100   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1)=m.e(1,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2)=m.e(1,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3)=m.e(1,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,4)=m.e(1,4);
00101   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1)=m.e(2,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2)=m.e(2,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3)=m.e(2,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,4)=m.e(2,3);
00102   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1)=m.e(3,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2)=m.e(3,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3)=m.e(3,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,4)=m.e(3,4);
00103   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,1)=m.e(4,1); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,2)=m.e(4,2); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,3)=m.e(4,3); <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,4)=m.e(4,4);
00104 } 
00105 
<a name="l00106"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa5">00106</a> Matrix::~Matrix() 
00107 {
00108   <font class="keyword">delete</font>[] m; 
00109 }
00110 
<a name="l00111"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">00111</a> <a class="code" href="namespacebase.html#a5">Real</a>&amp; Matrix::e(<a class="code" href="namespacebase.html#a2">Int</a> row, <a class="code" href="namespacebase.html#a2">Int</a> col) <font class="keywordflow">throw</font>()
00112 {
00113 <font class="preprocessor">#ifdef DEBUG</font>
00114 <font class="preprocessor"></font>  <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; nr) || (col &lt; 1) || (col &gt; nc))
00115     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix row or col out of bounds (debug only check)"</font>));
00116 <font class="preprocessor">#endif </font>
00117 <font class="preprocessor"></font>  <font class="keywordflow">return</font> m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,row,col)]; 
00118 }
00119 
<a name="l00120"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa13">00120</a> <font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; Matrix::e(<a class="code" href="namespacebase.html#a2">Int</a> row, <a class="code" href="namespacebase.html#a2">Int</a> col) <font class="keyword">const</font> <font class="keywordflow">throw</font>()
00121 {
00122 <font class="preprocessor">#ifdef DEBUG</font>
00123 <font class="preprocessor"></font>  <font class="keywordflow">if</font> ((row &lt; 1) || (row &gt; nr) || (col &lt; 1) || (col &gt; nc))
00124     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix row or col out of bounds (debug only check)"</font>));
00125 <font class="preprocessor">#endif </font>
00126 <font class="preprocessor"></font>  <font class="keywordflow">return</font> m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,row,col)]; 
00127 }
00128 
00129 
00130 <font class="keywordtype">void</font> Matrix::setDiag(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; d)
00131 {
00132   <a class="code" href="namespacebase.html#a64">clearMemory</a>(m, nr*nc); <font class="comment">// zero</font>
00133   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> rc=1; rc&lt;=minimum(nr,nc); rc++)
00134     m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,rc,rc)] = d;
00135 }
00136 
00137 
00138 
00139 
<a name="l00140"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa11">00140</a> <font class="keywordtype">void</font> Matrix::resize(<a class="code" href="namespacebase.html#a2">Int</a> rows, <a class="code" href="namespacebase.html#a2">Int</a> cols, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; diagonal)
00141 {
00142   <font class="keywordflow">if</font> ((<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>==0) || (cols==0))
00143     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix rows and cols must be &gt; 0"</font>));
00144   
00145   <font class="comment">// Copy the old matrix values into the new resized matrix.</font>
00146   <font class="comment">// If the new size is bigger, fill in values like for identity </font>
00147   <a class="code" href="namespacebase.html#a5">Real</a>* oldm = m;
00148   m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>*cols];
00149   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>; r++)
00150     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=cols; c++)
00151       <font class="keywordflow">if</font> ((r&lt;=nr) &amp;&amp; (c&lt;=nc))
00152         m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(cols,r,c)] = oldm[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,r,c)];
00153       <font class="keywordflow">else</font>
00154         m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(cols,r,c)] = (r!=c)?<a class="code" href="namespacebase.html#a5">Real</a>(0):diagonal;
00155   
00156   nr = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>; nc = cols;
00157   <font class="keyword">delete</font>[] oldm;
00158 }
00159 
00160 
<a name="l00161"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa21">00161</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; src) <font class="keywordflow">throw</font>()
00162 { 
00163   <font class="keywordflow">if</font> (&amp;src != <font class="keyword">this</font>) {
00164     <font class="keywordflow">if</font> ((src.nr != nr) || (src.nc != nc)) {
00165       <font class="keyword">delete</font>[] m;
00166       nr = src.nr; 
00167       nc = src.nc;
00168       m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00169     }
00170     
00171     <a class="code" href="namespacebase.html#a65">copyMemory</a>(src.m,m,nr*nc);
00172   }
00173   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00174 }
00175 
00176 
<a name="l00177"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa22">00177</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; src) <font class="keywordflow">throw</font>()
00178 {
00179   <font class="keywordflow">if</font> ((nr != src.dimension()) || (nc != 1)) {
00180     <font class="keyword">delete</font>[] m;
00181     nc = src.dimension(); 
00182     nr = 1;
00183     m = <font class="keyword">new</font> <a class="code" href="namespacebase.html#a5">Real</a>[nr*nc];
00184   }
00185   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++)
00186     e(1,c) = src[c];
00187   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00188 }
00189 
<a name="l00190"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa23">00190</a> <font class="keywordtype">bool</font> Matrix::operator==(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; <a class="code" href="analytical_8c.html#a20">m1</a>) <font class="keyword">const</font> <font class="keywordflow">throw</font>()
00191 {
00192   <font class="keywordflow">if</font> (&amp;<a class="code" href="analytical_8c.html#a20">m1</a> != <font class="keyword">this</font>) {
00193     <font class="keywordflow">if</font> ((<a class="code" href="analytical_8c.html#a20">m1</a>.nr != nr) || (<a class="code" href="analytical_8c.html#a20">m1</a>.nc != nc))
00194       <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Can't Matrices of difference dimensions for equality"</font>));
00195     
00196     <font class="keywordtype">bool</font> equal=<font class="keyword">true</font>;
00197     <a class="code" href="namespacebase.html#a5">Real</a>* s=<a class="code" href="analytical_8c.html#a20">m1</a>.m;
00198     <a class="code" href="namespacebase.html#a5">Real</a>* t=m;
00199     <a class="code" href="namespacebase.html#a2">Int</a> i=nr*nc;
00200     <font class="keywordflow">while</font> (equal &amp;&amp; (i--&gt;0))
00201       equal = (*t++) == (*s++);
00202     <font class="keywordflow">return</font> equal;
00203   }
00204   <font class="keywordflow">else</font>
00205     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00206 }
00207 
<a name="l00208"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa24">00208</a> <font class="keywordtype">bool</font> Matrix::equals(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; <a class="code" href="analytical_8c.html#a20">m1</a>) <font class="keyword">const</font> <font class="keywordflow">throw</font>()
00209 {
00210   <font class="keywordflow">if</font> (&amp;<a class="code" href="analytical_8c.html#a20">m1</a> != <font class="keyword">this</font>) {
00211     <font class="keywordflow">if</font> ((<a class="code" href="analytical_8c.html#a20">m1</a>.nr != nr) || (<a class="code" href="analytical_8c.html#a20">m1</a>.nc != nc))
00212       <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Can't Matrices of difference dimensions for equality"</font>));
00213     
00214     <font class="keywordtype">bool</font> equal=<font class="keyword">true</font>;
00215     <a class="code" href="namespacebase.html#a5">Real</a>* s=<a class="code" href="analytical_8c.html#a20">m1</a>.m;
00216     <a class="code" href="namespacebase.html#a5">Real</a>* t=m;
00217     <a class="code" href="namespacebase.html#a2">Int</a> i=nr*nc;
00218     <font class="keywordflow">while</font> (equal &amp;&amp; (i--&gt;0))
00219       equal = <a class="code" href="namespacebase.html#a88">base::equals</a>(*t++,*s++);
00220     <font class="keywordflow">return</font> equal;
00221   }
00222   <font class="keywordflow">else</font>
00223     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00224 }
00225 
00226 
<a name="l00227"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa25">00227</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::transpose()
00228 {
00229   <font class="keywordflow">if</font> (nr==nc) {
00230     <font class="comment">// faster in-place version for square matrices</font>
00231     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;nr; r++)
00232       <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=r+1; c&lt;=nc; c++)
00233         rcswap(nc,m,r,c);
00234   }
00235   <font class="keywordflow">else</font> {
00236     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> t(nc,nr);
00237     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00238       <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++)
00239         t.m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nr,c,r)] = m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,r,c)];
00240     *<font class="keyword">this</font> = t;
00241   }
00242   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00243 }
00244 
00245 
<a name="l00246"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa26">00246</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::invert()
00247 {
00248   <font class="keywordflow">if</font> (nr == nc) {
00249     <font class="comment">// Solve AX = I by solving eqns: Ax = e (for each e a col of I)</font>
00250     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> I(nr,nc); <font class="comment">// identity</font>
00251     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> <a class="code" href="Globals_8h.html#a21">X</a>(nr,nc), A(*<font class="keyword">this</font>);
00252     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="matrix_8c~.html#a13">x</a>(nr);
00253     
00254     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> L(nr,nc),U(nr,nc);
00255     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>(nr);
00256     
00257     A.decomposeLUP(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>);
00258     
00259     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++) {
00260       x = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd0">solveLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>,I.column(c));
00261       <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++) <a class="code" href="Globals_8h.html#a21">X</a>.e(r,c) = x[r];
00262     }
00263     
00264     <font class="keywordflow">return</font> (*<font class="keyword">this</font> = <a class="code" href="Globals_8h.html#a21">X</a>);
00265   }
00266   <font class="keywordflow">else</font>
00267     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Can't invert a non-square matrix"</font>));
00268 }
00269 
00270 
<a name="l00271"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa37">00271</a> <font class="keywordtype">void</font> Matrix::decomposeLUP(<a class="code" href="namespacebase.html#a18">Matrix</a>&amp; L, <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; U, <a class="code" href="namespacebase.html#a30">Vector</a>&amp; <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>)<font class="keyword"> const</font>
00272 <font class="keyword"></font>{
00273   <a class="code" href="namespacebase.html#a2">Int</a> n = nr;
00274 
00275   <font class="keywordflow">if</font> ( (L.nr != n) || (L.nc != n)
00276        || (U.nr!=n) || (U.nc != n) 
00277        || (<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>.dimension() != n) )
00278     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"L,U,Pi must be square and of same dimension (that of *this)"</font>));
00279 
00280   <a class="code" href="namespacebase.html#a5">Real</a> p,a;
00281   <a class="code" href="namespacebase.html#a2">Int</a> <a class="code" href="analytical_8c.html#a4">kp</a>,i,j,k;
00282   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> AA(*<font class="keyword">this</font>);
00283 
00284   <font class="keywordflow">for</font>(i=1; i&lt;=n; i++) <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[i] = i;
00285   <font class="keywordflow">for</font>(k=1; k&lt;=n-1; k++) {
00286     p = <a class="code" href="namespacebase.html#a5">Real</a>(0); <a class="code" href="analytical_8c.html#a4">kp</a> = 1;
00287     <font class="keywordflow">for</font>(i=k; i&lt;=n; i++) {
00288       a = <a class="code" href="namespacebase.html#a5">Real</a>(base::abs(AA.e(i,k)));
00289       <font class="keywordflow">if</font> ( a &gt; p ) {
00290         p = a;
00291         <a class="code" href="analytical_8c.html#a4">kp</a> = i;
00292       }
00293     }
00294     <font class="keywordflow">if</font> (p == <a class="code" href="namespacebase.html#a5">Real</a>(0))
00295       <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix is singular"</font>));
00296     
00297     exchange(<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[k],<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[<a class="code" href="analytical_8c.html#a4">kp</a>]);
00298     <font class="keywordflow">for</font>(i=1; i&lt;=n;i++) exchange(AA.e(k,i),AA.e(<a class="code" href="analytical_8c.html#a4">kp</a>,i));
00299     
00300     <font class="keywordflow">for</font>(i=k+1; i&lt;=n;i++) {
00301       AA.e(i,k) /= AA.e(k,k);
00302       <font class="keywordflow">for</font>(j=k+1; j&lt;=n; j++)
00303         AA.e(i,j) -= AA.e(i,k)*AA.e(k,j);
00304     }
00305   }
00306   
00307   <font class="keywordflow">for</font>(i=1;i&lt;=n;i++) {
00308     <font class="keywordflow">for</font>(j=1;j&lt;=n;j++)
00309       <font class="keywordflow">if</font> (i&gt;j) {
00310         L.e(i,j) = AA.e(i,j); U.e(i,j) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00311       }
00312       <font class="keywordflow">else</font> {
00313         U.e(i,j) = AA.e(i,j); L.e(i,j) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00314       }
00315     L.e(i,i) = <a class="code" href="namespacebase.html#a5">Real</a>(1);
00316     
00317   }
00318 
00319 }
00320 
00321 
<a name="l00322"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa38">00322</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::solve(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; b)<font class="keyword"> const</font>
00323 <font class="keyword"></font>{
00324   <a class="code" href="namespacebase.html#a2">Int</a> n = b.dimension();
00325   
00326   <font class="keywordflow">if</font> (nr != n)
00327     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Vector b doesn't have same dimension as rows of Matrix"</font>));
00328 
00329   <font class="keywordflow">if</font> (nr==nc) {
00330     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> L(n,n),U(n,n);
00331     <a class="code" href="namespacebase.html#a30">Vector</a> <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>(n);
00332     
00333     <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa37">decomposeLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>);
00334     <font class="keywordflow">return</font> <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd0">solveLUP</a>(L,U,<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>,b);
00335   }
00336   <font class="keywordflow">else</font> {
00337     <font class="comment">// use Gauss elminiation instead</font>
00338     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"not implemented"</font>));
00339 
00340   }
00341 }
00342 
00343 
<a name="l00344"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa27">00344</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::negate() <font class="keywordflow">throw</font>()
00345 {
00346   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00347     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++)
00348       e(r,c) = -e(r,c);
00349   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00350 }
00351 
00352 
<a name="l00353"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa32">00353</a> <a class="code" href="namespacebase.html#a18">Matrix</a> Matrix::select(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; rowIndices,
00354                       <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; colIndices) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::out_of_range)
00355 {
00356   <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; ri(rowIndices); <font class="comment">// save typing</font>
00357   <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; ci(colIndices);
00358 
00359   <font class="keywordflow">if</font> ((ri.dimension()==0) || (ci.dimension()==0))
00360     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"index arrays can't be empty"</font>));
00361 
00362   <a class="code" href="namespacebase.html#a18">Matrix</a> s(ri.dimension(), ci.dimension());
00363   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=ri.dimension(); r++)
00364     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=ci.dimension(); c++) {
00365       <font class="keywordflow">if</font> (   (<a class="code" href="namespacebase.html#a2">Int</a>(ri[r]) &lt; 1) || (<a class="code" href="namespacebase.html#a2">Int</a>(ri[r]) &gt; nr) 
00366           || (<a class="code" href="namespacebase.html#a2">Int</a>(ci[c]) &lt; 1) || (<a class="code" href="namespacebase.html#a2">Int</a>(ci[c]) &gt; nc))
00367         <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"index out of range"</font>));
00368       s.e(r,c) = e(<a class="code" href="namespacebase.html#a2">Int</a>(ri[r]), <a class="code" href="namespacebase.html#a2">Int</a>(ci[c]));
00369     }
00370   <font class="keywordflow">return</font> s;
00371 }
00372 
00373 
<a name="l00374"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa28">00374</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::swapRows(<a class="code" href="namespacebase.html#a2">Int</a> i, <a class="code" href="namespacebase.html#a2">Int</a> j) <font class="keywordflow">throw</font>(std::out_of_range)
00375 {
00376   <font class="keywordflow">if</font> ((i &lt; 1) || (i &gt; nr) || (j &lt; 1) || (j &gt; nr))
00377     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix row out of bounds"</font>));
00378 
00379   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++)
00380     exchange(e(i,c),e(j,c));
00381   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00382 }
00383 
<a name="l00384"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa29">00384</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::swapCols(<a class="code" href="namespacebase.html#a2">Int</a> i, <a class="code" href="namespacebase.html#a2">Int</a> j) <font class="keywordflow">throw</font>(std::out_of_range)
00385 {
00386   <font class="keywordflow">if</font> ((i &lt; 1) || (i &gt; nc) || (j &lt; 1) || (j &gt; nc))
00387     <font class="keywordflow">throw</font> std::out_of_range(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix col out of bounds"</font>));
00388 
00389   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00390     exchange(e(r,i),e(r,j));
00391   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00392 }
00393 
00394 
00395 
<a name="l00396"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa33">00396</a> <font class="keywordtype">void</font> Matrix::zeroUpperTriangle() <font class="keywordflow">throw</font>(std::invalid_argument)
00397 {
00398   <font class="keywordflow">if</font> (nr != nc) 
00399     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"only square Matrices have an upper triangle"</font>));
00400 
00401   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00402     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=r+1; c&lt;=nc; c++)
00403       e(r,c) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00404 }
00405 
<a name="l00406"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa34">00406</a> <font class="keywordtype">void</font> Matrix::zeroLowerTriangle() <font class="keywordflow">throw</font>(std::invalid_argument)
00407 {
00408   <font class="keywordflow">if</font> (nr != nc) 
00409     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"only square Matrices have a lower triangle"</font>));
00410 
00411   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00412     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;r; c++)
00413       e(r,c) = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00414 }
00415 
<a name="l00416"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa35">00416</a> <font class="keywordtype">void</font> Matrix::setRandom(<a class="code" href="namespacebase.html#a5">Real</a> range)
00417 {
00418   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00419     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++)
00420       <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(r,c) = (base::random()*<a class="code" href="namespacebase.html#a5">Real</a>(2)-<a class="code" href="namespacebase.html#a5">Real</a>(1))*range;
00421 }
00422 
<a name="l00423"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa36">00423</a> <a class="code" href="namespacebase.html#a5">Real</a> Matrix::maxDifference(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; a) <font class="keyword">const</font> <font class="keywordflow">throw</font>(std::invalid_argument)
00424 {
00425   <font class="keywordflow">if</font> (nr != a.nr || nc != a.nc)
00426     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrices are not same dimensions"</font>));
00427 
00428   <a class="code" href="namespacebase.html#a5">Real</a> max = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00429   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=nr; r++)
00430     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=nc; c++) {
00431       <a class="code" href="namespacebase.html#a5">Real</a> diff = <a class="code" href="namespacebase.html#a89">base::abs</a>(e(r,c) - a.e(r,c));
00432       <font class="keywordflow">if</font> (diff &gt; max) max = diff;
00433     }
00434   <font class="keywordflow">return</font> max;
00435 }
00436 
00437 
<a name="l00438"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa30">00438</a> <a class="code" href="namespacebase.html#a18">Matrix</a> Matrix::sub(<a class="code" href="namespacebase.html#a2">Int</a> row, <a class="code" href="namespacebase.html#a2">Int</a> col, <a class="code" href="namespacebase.html#a2">Int</a> rows, <a class="code" href="namespacebase.html#a2">Int</a> cols)<font class="keyword"> const</font>
00439 <font class="keyword"></font>{
00440   <font class="keywordflow">if</font> ((<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>-1 &gt; nr) || (col+cols-1 &gt; nc))
00441     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Submatrix is out of bounds"</font>));
00442 
00443   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> sm(<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>,cols);
00444 
00445   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>; r&lt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>; r++)
00446     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=col; c&lt;col+cols; c++)
00447       sm.e(r-<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+1,c-col+1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(r,c);
00448 
00449   <font class="keywordflow">return</font> sm;
00450 }
00451 
00452 
<a name="l00453"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa31">00453</a> <font class="keywordtype">void</font> Matrix::sub(<a class="code" href="namespacebase.html#a2">Int</a> row, <a class="code" href="namespacebase.html#a2">Int</a> col, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; sm)
00454 {
00455   <a class="code" href="namespacebase.html#a2">Int</a> <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a> = sm.rows();
00456   <a class="code" href="namespacebase.html#a2">Int</a> cols = sm.columns();
00457 
00458   <font class="keywordflow">if</font> ((<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>-1 &gt; nr) || (col+cols-1 &gt; nc))
00459     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Submatrix is out of bounds"</font>));
00460 
00461   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>; r&lt;<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa9">rows</a>; r++)
00462     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=col; c&lt;col+cols; c++)
00463       <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(r,c) = sm.e(r-<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa18">row</a>+1,c-col+1);
00464 }
00465 
00466 
00467 
00468 
00469 <font class="comment">// Operators</font>
00470 
00471 <font class="comment">// multiplication</font>
<a name="l00472"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa39">00472</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator*=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; <a class="code" href="analytical_8c.html#a21">m2</a>)
00473 {
00474   <font class="keywordflow">if</font> (nc != <a class="code" href="analytical_8c.html#a21">m2</a>.nr)
00475     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"RHS Matrix must have same rows as *this Matrix does columns"</font>));
00476 
00477   <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa0">Matrix</a> <a class="code" href="matrix_8c~.html#a20">r</a>(nr,<a class="code" href="analytical_8c.html#a21">m2</a>.nc);
00478 
00479   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=1; i&lt;=nr; i++)
00480     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> j=1; j&lt;=<a class="code" href="analytical_8c.html#a21">m2</a>.nc; j++) {
00481       r.m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(r.nc,i,j)] = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00482       <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> k=1; k&lt;=nc; k++)
00483         r.m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(r.nc,i,j)] 
00484           += m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(nc,i,k)] * <a class="code" href="analytical_8c.html#a21">m2</a>.m[<a class="code" href="bak_8Matrix_8cpp.html#a0">elementOffset</a>(<a class="code" href="analytical_8c.html#a21">m2</a>.nc,k,j)];
00485     }
00486  
00487   <font class="keywordflow">return</font> (*<font class="keyword">this</font> = r);
00488 }
00489 
00490 <font class="comment">// addition</font>
<a name="l00491"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa40">00491</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator+=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; <a class="code" href="analytical_8c.html#a21">m2</a>)
00492 {
00493   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;nr*nc; i++)
00494     m[i] += <a class="code" href="analytical_8c.html#a21">m2</a>.m[i];
00495   <font class="keywordflow">return</font> (*this);
00496 }
00497 
00498 <font class="comment">// subtration</font>
<a name="l00499"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa41">00499</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator-=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; <a class="code" href="analytical_8c.html#a21">m2</a>)
00500 {
00501   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;nr*nc; i++)
00502     m[i] -= <a class="code" href="analytical_8c.html#a21">m2</a>.m[i];
00503   <font class="keywordflow">return</font> (*this);
00504 }
00505 
00506 <font class="comment">// Scalar multiplication</font>
<a name="l00507"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa42">00507</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator*=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; s)
00508 {
00509   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;nr*nc; i++)
00510     m[i] *= s;
00511   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00512 }
00513 
00514 <font class="comment">// Scalar division</font>
<a name="l00515"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa43">00515</a> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; Matrix::operator/=(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>&amp; s)
00516 {
00517   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> i=0; i&lt;nr*nc; i++)
00518     m[i] /= s;
00519   <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00520 }
00521 
00522 
<a name="l00523"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa44">00523</a> Matrix::operator Matrix3()<font class="keyword"> const</font>
00524 <font class="keyword"></font>{
00525   Matrix3 r;
00526   r.e(1,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1); r.e(1,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2); r.e(1,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3);
00527   r.e(2,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1); r.e(2,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2); r.e(2,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3);
00528   r.e(3,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1); r.e(3,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2); r.e(3,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3);
00529   <font class="keywordflow">return</font> r;
00530 }
00531 
<a name="l00532"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa45">00532</a> Matrix::operator Matrix4()<font class="keyword"> const</font>
00533 <font class="keyword"></font>{
00534   Matrix4 r;
00535   r.e(1,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,1); r.e(1,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,2); r.e(1,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,3); r.e(1,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(1,4);
00536   r.e(2,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,1); r.e(2,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,2); r.e(2,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,3); r.e(2,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(2,4);
00537   r.e(3,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,1); r.e(3,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,2); r.e(3,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,3); r.e(3,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(3,4);
00538   r.e(4,1) = <a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,1); r.e(4,2)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,2); r.e(4,3)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,3); r.e(4,4)=<a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa12">e</a>(4,4);
00539   <font class="keywordflow">return</font> r;
00540 }
00541 
00542 
<a name="l00543"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd2">00543</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::matrixMulVector(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v) 
00544 {
00545   <font class="keywordflow">if</font> (m.nc != v.dimension())
00546     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix must have same columns as Vector dimension"</font>));
00547 
00548   <a class="code" href="namespacebase.html#a30">Vector</a> rv(m.nr);
00549 
00550   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.nr; r++)
00551     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.nc; c++)
00552       rv[r] += (m.e(r,c) * v[c]);
00553 
00554   <font class="keywordflow">return</font> rv;
00555 }
00556 
00557 
<a name="l00558"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd3">00558</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::matrixMulVectorAddVector(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; v2) 
00559 {
00560   <font class="keywordflow">if</font> ((m.nc != v.dimension()) || (m.nc != v2.dimension()))
00561     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"Matrix must have same columns as Vector dimension"</font>));
00562 
00563   <a class="code" href="namespacebase.html#a30">Vector</a> rv(m.nr);
00564 
00565   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.nr; r++) {
00566     <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.nc; c++)
00567       rv[r] += m.e(r,c)*v[c];
00568     rv[r] += v2[r];
00569   }
00570   <font class="keywordflow">return</font> rv;
00571 }
00572 
00573 
00574 <font class="comment">// Solve for Ax = b, given LUP decomposition of A as L, U and Pi, and given b, returns x</font>
<a name="l00575"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixd0">00575</a> <a class="code" href="namespacebase.html#a30">Vector</a> Matrix::solveLUP(<font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; L, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; U, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; <a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a30">Vector</a>&amp; b)
00576 {
00577   <a class="code" href="namespacebase.html#a2">Int</a> n = L.nr;
00578 
00579   <font class="keywordflow">if</font> ( (b.dimension() != n) || (L.nc != n)
00580        || (U.nr!=n) || (U.nc != n) 
00581        || (<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>.dimension() != n) )
00582     <font class="keywordflow">throw</font> std::invalid_argument(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"L,U,Pi must be square and of same dimension (that of b)"</font>));
00583 
00584   <a class="code" href="namespacebase.html#a2">Int</a> i,j;
00585   <a class="code" href="namespacebase.html#a30">Vector</a> y(n), <a class="code" href="matrix_8c~.html#a13">x</a>(n);
00586   <a class="code" href="namespacebase.html#a5">Real</a> s;
00587   <font class="comment">// forward subst.</font>
00588   <font class="keywordflow">for</font>(i=1;i&lt;=n;i++) {
00589     s = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00590     <font class="keywordflow">for</font>(j=1;j&lt;=i-1;j++) s += L.e(i,j)*y[j];
00591     y[i] = b[int(<a class="code" href="namespacebase_1_1consts.html#a8">Pi</a>[i])] - s;
00592   }
00593   <font class="comment">// backward subst.</font>
00594   <font class="keywordflow">for</font>(i=n;i&gt;=1;i--) {
00595     s = <a class="code" href="namespacebase.html#a5">Real</a>(0);
00596     <font class="keywordflow">for</font>(j=i+1;j&lt;=n;j++) s += U.e(i,j)*x[j];
00597     x[i] = (y[i] - s)/(U.e(i,i));
00598   }
00599   <font class="keywordflow">return</font> x;
00600 }
00601 
00602 
<a name="l00603"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa46">00603</a> <font class="keyword">const</font> <a class="code" href="namespacebase.html#a5">Real</a>* Matrix::c_array()<font class="keyword"> const</font>
00604 <font class="keyword"></font>{
00605   <font class="keywordflow">if</font> (m)
00606     <font class="keywordflow">return</font> m;
00607   <font class="keywordflow">else</font>
00608     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"no array representation"</font>));
00609 }
00610 
<a name="l00611"></a><a class="code" href="classbase_1_1Matrix.html#base_1_1Matrixa47">00611</a> <a class="code" href="namespacebase.html#a5">Real</a>* Matrix::c_array() 
00612 {
00613   <font class="keywordflow">if</font> (m)
00614     <font class="keywordflow">return</font> m;
00615   <font class="keywordflow">else</font>
00616     <font class="keywordflow">throw</font> <a class="code" href="classstd_1_1runtime__error.html">std::runtime_error</a>(<a class="code" href="base.html#a14">Exception</a>(<font class="stringliteral">"no array representation"</font>));
00617 }
00618 
00619 
00620 
00621 <font class="comment">// output</font>
00622 ostream&amp; <a class="code" href="namespacebase.html#a52">base::operator&lt;&lt;</a>(ostream&amp; out, <font class="keyword">const</font> <a class="code" href="namespacebase.html#a18">Matrix</a>&amp; m)
00623 {
00624   <font class="keywordflow">for</font>(<a class="code" href="namespacebase.html#a2">Int</a> r=1; r&lt;=m.rows(); r++) {
00625     <font class="keywordflow">for</font> (<a class="code" href="namespacebase.html#a2">Int</a> c=1; c&lt;=m.columns(); c++) 
00626       out &lt;&lt; m.e(r,c) &lt;&lt; <font class="stringliteral">" "</font>;
00627     out &lt;&lt; std::endl;
00628   }
00629   <font class="keywordflow">return</font> out;
00630 }
00631 
00632 
00633 
00634 
00635 
00636 
00637 
</pre></div><hr><address><small>Generated on Sun Mar 30 14:02:02 2003 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
