<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: base/SimpleXMLSerializer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>base/SimpleXMLSerializer.cpp</h1><a href="SimpleXMLSerializer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment">  Copyright (C)1996 David Jung &lt;opensim@pobox.com&gt;</span>
00003 <span class="comment"></span>
00004 <span class="comment">  This program/file is free software; you can redistribute it and/or modify</span>
00005 <span class="comment">  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment">  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment">  (at your option) any later version.</span>
00008 <span class="comment">  </span>
00009 <span class="comment">  This program is distributed in the hope that it will be useful,</span>
00010 <span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment">  GNU General Public License for more details. (http://www.gnu.org)</span>
00013 <span class="comment">  </span>
00014 <span class="comment">  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment">  along with this program; if not, write to the Free Software</span>
00016 <span class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00017 <span class="comment">  </span>
00018 <span class="comment">  $Id: SimpleXMLSerializer.cpp 1029 2004-02-11 20:45:54Z jungd $</span>
00019 <span class="comment">  $Revision: 1.6 $</span>
00020 <span class="comment">  $Date: 2004-02-11 15:45:54 -0500 (Wed, 11 Feb 2004) $</span>
00021 <span class="comment">  $Author: jungd $</span>
00022 <span class="comment"> </span>
00023 <span class="comment">****************************************************************************/</span>
00024 
00025 <span class="preprocessor">#include &lt;<a class="code" href="SimpleXMLSerializer.html">base/SimpleXMLSerializer</a>&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;<a class="code" href="Serializable.html">base/Serializable</a>&gt;</span>
00028 
00029 <span class="keyword">using</span> <a class="code" href="classbase_1_1SimpleXMLSerializer.html">base::SimpleXMLSerializer</a>;
00030 <span class="keyword">using</span> <a class="code" href="classbase_1_1Serializer.html">base::Serializer</a>;
00031 <span class="keyword">using</span> <a class="code" href="classbase_1_1Serializable.html">base::Serializable</a>;
00032 <span class="keyword">using</span> <a class="code" href="classbase_1_1Referenced.html">base::Referenced</a>;
00033 <span class="keyword">using</span> <a class="code" href="classbase_1_1VFile.html">base::VFile</a>;
00034 <span class="keyword">using</span> <a class="code" href="classbase_1_1ref.html">base::ref</a>;
00035 
00036 <span class="keyword">using</span> std::iostream;
00037 <span class="keyword">using</span> std::istream;
00038 <span class="keyword">using</span> std::ostream;
00039 
00040 
00041 <span class="preprocessor">#ifdef DEBUG</span>
00042 <span class="preprocessor"></span>
00043 <span class="comment">// comment out to inhibit serialization debugging</span>
00044 <span class="comment">//#define SDEBUG</span>
00045 
00046 <span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>
00048 
00049 SimpleXMLSerializer::SimpleXMLSerializer(SerializerType type, ref&lt;VFile&gt; archive)
00050   : Serializer(type,archive),
00051     istream(output?0:&amp;archive-&gt;iostream(iostream::in)),
00052     ostream(output?&amp;archive-&gt;iostream(iostream::out):0),
00053     indent(0)
00054 {
00055   <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb12">serializeHeader</a>(archive-&gt;name().str());
00056 
00057 <span class="preprocessor">#ifdef SDEBUG</span>
00058 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"Constructed:"</span> &lt;&lt; (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializera7">isOutput</a>()?<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"Output"</span>):<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"Input"</span>)) );
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>}
00061 
00062 SimpleXMLSerializer::SimpleXMLSerializer(SerializerType type, std::ios&amp; stream)
00063   : Serializer(type,stream),
00064     indent(0)
00065 {
00066   <a class="code" href="base.html#a19">Assert</a>(output?<a class="code" href="base.html#a25">instanceof</a>(stream, std::ostream)
00067                :<a class="code" href="base.html#a25">instanceof</a>(stream, std::istream));
00068   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) 
00069     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp1">ostream</a> = dynamic_cast&lt;std::ostream*&gt;(&amp;stream);
00070   <span class="keywordflow">else</span> 
00071     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a> = dynamic_cast&lt;std::istream*&gt;(&amp;stream);
00072 
00073   <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb12">serializeHeader</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"stream"</span>));
00074 
00075 <span class="preprocessor">#ifdef SDEBUG</span>
00076 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"Constructed:"</span> &lt;&lt; (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializera7">isOutput</a>()?<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"Output"</span>):<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"Input"</span>)) );
00077 <span class="preprocessor">#endif</span>
00078 <span class="preprocessor"></span>}
00079 
00080 
00081 SimpleXMLSerializer::~SimpleXMLSerializer()
00082 {
00083   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp5">aborted</a>) {
00084     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializera5">flush</a>();
00085     <span class="keywordflow">return</span>;
00086   }
00087 
00088   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00089     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>--;
00090     (*ostream) &lt;&lt; <span class="stringliteral">"&lt;/serialization&gt;"</span> &lt;&lt; std::endl;
00091     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializera5">flush</a>();
00092   }
00093   <span class="keywordflow">else</span> {
00094     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(<span class="stringliteral">"serialization"</span>);
00095   }
00096 }
00097 
00098 
00099 <span class="keywordtype">bool</span> SimpleXMLSerializer::followReferences(<span class="keywordtype">bool</span> follow)
00100 {
00101 <span class="preprocessor">#ifdef SDEBUG</span>
00102 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"Reference following "</span> &lt;&lt; (follow?<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"enabled"</span>):<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"disabled"</span>)));
00103 <span class="preprocessor">#endif</span>
00104 <span class="preprocessor"></span>  <span class="keywordflow">return</span> Serializer::followReferences(follow);
00105 }
00106 
00107 
00108 Serializer&amp; SimpleXMLSerializer::serialize(<span class="keywordtype">char</span>&amp; c, <span class="keyword">const</span> String&amp; memberName)
00109 {
00110   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"char"</span>:memberName);
00111   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00112     <span class="keywordflow">try</span> {
00113       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00114     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00115   }
00116   <span class="keywordflow">else</span> { 
00117     TagData tag;
00118     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00119       <span class="keywordflow">if</span> ((tag.name != tagName) &amp;&amp; (tag.name != <span class="stringliteral">"char"</span>))
00120         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00121       <span class="keywordflow">try</span> {
00122         (*istream) &gt;&gt; c;
00123       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00124       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00125     }
00126   }
00127 
00128 <span class="preprocessor">#ifdef SDEBUG</span>
00129 <span class="preprocessor"></span>  <span class="comment">//Debugln(Ser,"serialized char:" &lt;&lt; c);</span>
00130 <span class="preprocessor">#endif</span>
00131 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00132 }
00133 
00134 Serializer&amp; SimpleXMLSerializer::serialize(Byte&amp; b, <span class="keyword">const</span> String&amp; memberName)
00135 {
00136   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"Byte"</span>:memberName);
00137   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00138     <span class="keywordflow">try</span> {
00139       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; <a class="code" href="namespacebase.html#a2">Int</a>(b) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00140     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00141   }
00142   <span class="keywordflow">else</span> {
00143     TagData tag;
00144     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00145       <span class="keywordflow">if</span> (tag.name != tagName)
00146         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00147       <a class="code" href="namespacebase.html#a2">Int</a> i;
00148       <span class="keywordflow">try</span> {
00149         (*istream) &gt;&gt; i;
00150       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00151       b = <a class="code" href="namespacebase.html#a0">Byte</a>(i);
00152       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00153     }
00154   }
00155 
00156 <span class="preprocessor">#ifdef SDEBUG</span>
00157 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized Byte:"</span> &lt;&lt; b);
00158 <span class="preprocessor">#endif</span>
00159 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00160 }
00161 
00162 Serializer&amp; SimpleXMLSerializer::serialize(<span class="keywordtype">bool</span>&amp; b, <span class="keyword">const</span> String&amp; memberName)
00163 {
00164   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"bool"</span>:memberName);
00165   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00166     <span class="keywordflow">try</span> {
00167       (*ostream) &lt;&lt; std::boolalpha;
00168       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; b &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00169     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00170   }
00171   <span class="keywordflow">else</span> {
00172     TagData tag;
00173     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00174       <span class="keywordflow">if</span> (tag.name != tagName)
00175         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00176       <span class="keywordflow">try</span> {
00177         (*istream) &gt;&gt; std::boolalpha;
00178         (*istream) &gt;&gt; b;
00179       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00180       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00181     }
00182   }
00183 
00184 <span class="preprocessor">#ifdef SDEBUG</span>
00185 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized bool:"</span> &lt;&lt; b);
00186 <span class="preprocessor">#endif</span>
00187 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00188 }
00189 
00190 Serializer&amp; SimpleXMLSerializer::serialize(SInt&amp; i, <span class="keyword">const</span> String&amp; memberName)
00191 {
00192   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"SInt"</span>:memberName);
00193   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00194     <span class="keywordflow">try</span> {
00195       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; <a class="code" href="namespacebase.html#a50">base::intToString</a>(i) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00196     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00197   }
00198   <span class="keywordflow">else</span> {
00199     TagData tag;
00200     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00201       <span class="keywordflow">if</span> (tag.name != tagName)
00202         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00203       <span class="keywordflow">try</span> {
00204         (*istream) &gt;&gt; i;
00205       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00206       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00207     }
00208   }
00209 
00210 <span class="preprocessor">#ifdef SDEBUG</span>
00211 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized SInt:"</span> &lt;&lt; i);
00212 <span class="preprocessor">#endif</span>
00213 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00214 }
00215 
00216 Serializer&amp; SimpleXMLSerializer::serialize(Int&amp; i, <span class="keyword">const</span> String&amp; memberName)
00217 {
00218   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"Int"</span>:memberName);
00219   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00220     <span class="keywordflow">try</span> {
00221       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; <a class="code" href="namespacebase.html#a50">base::intToString</a>(i) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00222     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00223   }
00224   <span class="keywordflow">else</span> {
00225     TagData tag;
00226     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00227       <span class="keywordflow">if</span> (tag.name != tagName)
00228         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00229       <span class="keywordflow">try</span> {
00230         (*istream) &gt;&gt; i;
00231       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00232       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00233     }
00234   }
00235 <span class="preprocessor">#ifdef SDEBUG</span>
00236 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized Int:"</span> &lt;&lt; i);
00237 <span class="preprocessor">#endif</span>
00238 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00239 }
00240 
00241 Serializer&amp; SimpleXMLSerializer::serialize(LInt&amp; i, <span class="keyword">const</span> String&amp; memberName)
00242 {
00243   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"LInt"</span>:memberName);
00244   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00245     <span class="keywordflow">try</span> {
00246       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; <a class="code" href="namespacebase.html#a50">base::intToString</a>(i) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00247     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00248   }
00249   <span class="keywordflow">else</span> {
00250     TagData tag;
00251     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00252       <span class="keywordflow">if</span> (tag.name != tagName)
00253         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00254       <span class="keywordflow">try</span> {
00255         (*istream) &gt;&gt; i;
00256       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00257       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00258     }
00259   }
00260 
00261 <span class="preprocessor">#ifdef SDEBUG</span>
00262 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized LInt:"</span> &lt;&lt; i);
00263 <span class="preprocessor">#endif</span>
00264 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00265 }
00266 
00267 Serializer&amp; SimpleXMLSerializer::serialize(String&amp; s, <span class="keyword">const</span> String&amp; memberName)
00268 {
00269   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"string"</span>:memberName);
00270   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00271     <span class="keywordflow">try</span> {
00272       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00273     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00274   }
00275   <span class="keywordflow">else</span> {
00276     TagData tag;
00277     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00278       <span class="keywordflow">if</span> (tag.name != tagName)
00279         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00280       <span class="keywordflow">try</span> {
00281         s.clear();
00282         <span class="comment">// read chars until '&lt;'</span>
00283         <span class="keywordtype">char</span> p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00284         <span class="keywordflow">while</span> (p != <span class="charliteral">'&lt;'</span>) { s += p; p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>(); }
00285         <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p);
00286       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00287       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00288     }
00289   }
00290 
00291 <span class="preprocessor">#ifdef SDEBUG</span>
00292 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized String:"</span> &lt;&lt; s);
00293 <span class="preprocessor">#endif</span>
00294 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00295 }
00296 
00297 Serializer&amp; SimpleXMLSerializer::serialize(Real&amp; r, <span class="keyword">const</span> String&amp; memberName)
00298 {
00299   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"real"</span>:memberName);
00300   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00301     <span class="keywordflow">try</span> {
00302       (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; <a class="code" href="namespacebase.html#a51">base::realToString</a>(r) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00303     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00304   }
00305   <span class="keywordflow">else</span> {
00306     TagData tag;
00307     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00308       <span class="keywordflow">if</span> (tag.name != tagName)
00309         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00310       <span class="keywordflow">try</span> {
00311         (*istream) &gt;&gt; r;
00312       } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00313       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tag.name);
00314     }
00315   }
00316 
00317 <span class="preprocessor">#ifdef SDEBUG</span>
00318 <span class="preprocessor"></span>  <a class="code" href="debugtools.html#a7">Debugln</a>(Ser,<span class="stringliteral">"serialized Real:"</span> &lt;&lt; r);
00319 <span class="preprocessor">#endif</span>
00320 <span class="preprocessor"></span>  <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00321 }
00322 
00323 <span class="keywordtype">void</span> SimpleXMLSerializer::flush()
00324 {
00325   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) 
00326     (*ostream) &lt;&lt; std::flush;
00327 }
00328 
00329 
00330 
00331 
00332 Serializer::TypeModifier SimpleXMLSerializer::preSerializeObject(String&amp; typeName, TypeModifier typeModifier, <span class="keyword">const</span> String&amp; memberName, <span class="keywordtype">bool</span> forceTypeSerialization)
00333 {
00334   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"object"</span>:memberName);
00335   <a class="code" href="namespacebase.html#a4">String</a> typeString;
00336     
00337   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00338     
00339     <span class="keywordflow">try</span> {
00340       typeString = <a class="code" href="namespacebase.html#a57">base::demangleTypeidName</a>(typeName);
00341     } <span class="keywordflow">catch</span> (std::exception&amp; e) {
00342       <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"error demangling typeName:"</span>)+typeName+<span class="stringliteral">" for element:"</span> +tagName+<span class="stringliteral">" - "</span>+e.what());
00343     }
00344     
00345     <a class="code" href="namespacebase.html#a4">String</a> modifierString;
00346     <span class="keywordflow">if</span> (typeModifier == <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx2">ReferencedObjectType</a>)
00347       modifierString = <span class="stringliteral">"ro"</span>;
00348     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (typeModifier == <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx3">ObjectReferenceType</a>)
00349       modifierString = <span class="stringliteral">"r"</span>;
00350 
00351     <span class="keywordflow">if</span> (!modifierString.empty())
00352       modifierString = <a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">" ref=\""</span>+modifierString+<span class="stringliteral">"\""</span>);
00353 
00354     (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">" type=\""</span> &lt;&lt; typeString &lt;&lt; <span class="stringliteral">"\""</span> &lt;&lt; modifierString &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00355     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>++;
00356 
00357     <span class="keywordflow">return</span> typeModifier;
00358   }
00359   <span class="keywordflow">else</span> { <span class="comment">// input</span>
00360     TagData tag;
00361 
00362     <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag)) {
00363 
00364       <span class="keywordflow">if</span> (tag.name != tagName)
00365         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected element "</span>+tagName+<span class="stringliteral">" but got "</span>+tag.name);
00366 
00367       <span class="keywordflow">if</span> (!typeName.empty()) {
00368         <span class="keywordflow">try</span> {
00369           typeString = <a class="code" href="namespacebase.html#a57">base::demangleTypeidName</a>(typeName);
00370         } <span class="keywordflow">catch</span> (std::exception&amp; e) {
00371           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"error demangling typeName:"</span>)+typeName+<span class="stringliteral">" for element:"</span> +tagName+<span class="stringliteral">" - "</span>+e.what());
00372         }
00373 
00374         <span class="keywordflow">if</span> (tag.attribute(<span class="stringliteral">"type"</span>) != typeString) 
00375           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected object of type "</span>+typeString+<span class="stringliteral">" but got "</span>+tag.attribute(<span class="stringliteral">"type"</span>));
00376       }
00377       <span class="keywordflow">else</span>
00378         typeName = tag.attribute(<span class="stringliteral">"type"</span>);
00379       
00380       <a class="code" href="namespacebase.html#a4">String</a> modifierString(tag.attribute(<span class="stringliteral">"ref"</span>));
00381       <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5">TypeModifier</a> readTypeModifier = <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx1">ObjectType</a>;
00382 
00383       <span class="keywordflow">if</span> (modifierString == <span class="stringliteral">"r"</span>)
00384         readTypeModifier = <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx3">ObjectReferenceType</a>;
00385       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modifierString == <span class="stringliteral">"ro"</span>)
00386         readTypeModifier = <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx2">ReferencedObjectType</a>;
00387 
00388       <span class="keywordflow">if</span> (typeModifier != <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx0">UnknownType</a>)
00389         <span class="keywordflow">if</span> (typeModifier != readTypeModifier)
00390           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"got difference object reference type modifier than expected"</span>);
00391 
00392       <span class="keywordflow">return</span> readTypeModifier;
00393     }
00394     <span class="keywordflow">else</span> 
00395       <span class="keywordflow">return</span> <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerx5base_1_1SimpleXMLSerializerx0">UnknownType</a>;
00396   }
00397 }
00398 
00399 
00400 <span class="keywordtype">void</span> SimpleXMLSerializer::postSerializeObject(<span class="keyword">const</span> String&amp; memberName)
00401 {
00402   <a class="code" href="namespacebase.html#a4">String</a> tagName(memberName.empty()?<span class="stringliteral">"object"</span>:memberName);
00403 
00404   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00405     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>--;
00406     (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; tagName &lt;&lt; <span class="stringliteral">"&gt;"</span> &lt;&lt; std::endl;
00407   }
00408   <span class="keywordflow">else</span> { <span class="comment">// input </span>
00409     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb16">readEndTag</a>(tagName);
00410   }
00411 }
00412 
00413 
00414 <span class="keywordtype">void</span> SimpleXMLSerializer::serializeComment(<span class="keyword">const</span> String&amp; comment)
00415 {
00416   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00417     (*ostream) &lt;&lt; <a class="code" href="namespacebase.html#a4">String</a>(indent,<span class="charliteral">' '</span>) &lt;&lt; <span class="stringliteral">"&lt;!-- "</span> &lt;&lt; comment &lt;&lt; <span class="stringliteral">" --&gt;"</span> &lt;&lt; std::endl;
00418   }
00419 }
00420 
00421 
00422 Serializer&amp; SimpleXMLSerializer::hint(Int h)
00423 {
00424   <span class="keywordflow">if</span> (h == <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerw5base_1_1SimpleXMLSerializerw2">Indent</a>) <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>++;
00425   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (h == <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerw5base_1_1SimpleXMLSerializerw3">Unindent</a>) <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>--;
00426   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00427 }
00428 
00429 
00430 <span class="keywordtype">bool</span> SimpleXMLSerializer::serializeHeader(<span class="keyword">const</span> String&amp; target)
00431 {
00432   
00433   <span class="keywordflow">if</span> (<a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerp3">output</a>) {
00434     <span class="keywordflow">try</span> {
00435       (*ostream) &lt;&lt; <span class="stringliteral">"&lt;?xml version =\"1.0\" encoding=\"UTF-8\" standalone=\"yes\" ?&gt;"</span> &lt;&lt; std::endl;
00436       (*ostream) &lt;&lt; <span class="stringliteral">"&lt;serialization type=\"base::SimpleXMLSerializer\" version=\"1.0\" target=\""</span> &lt;&lt; target &lt;&lt; <span class="stringliteral">"\"&gt;"</span> &lt;&lt; std::endl;
00437       <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp2">indent</a>++;
00438     } <span class="keywordflow">catch</span> (std::exception&amp; e) { <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(e.what()); }
00439   }
00440   <span class="keywordflow">else</span> { <span class="comment">// input</span>
00441     TagData tag;
00442     <span class="keywordtype">bool</span> xmlTagOK = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag);
00443     <span class="keywordflow">if</span> (xmlTagOK) {
00444       <span class="keywordflow">if</span> (tag.name != <span class="stringliteral">"?xml"</span>) {
00445         xmlTagOK = <span class="keyword">false</span>;
00446       } 
00447     }
00448     
00449     <span class="keywordflow">if</span> (!xmlTagOK)
00450       <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"Bad XML header"</span>);
00451     
00452     <span class="keywordtype">bool</span> rootElementOK = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb15">readStartTag</a>(tag);
00453     <span class="keywordflow">if</span> (rootElementOK) {
00454       <span class="keywordflow">if</span> (tag.name != <span class="stringliteral">"serialization"</span>) {
00455         rootElementOK = <span class="keyword">false</span>;
00456       }
00457       <span class="keywordflow">else</span> {
00458         <span class="keywordflow">if</span> (tag.attribute(<span class="stringliteral">"type"</span>) != <span class="stringliteral">"base::SimpleXMLSerializer"</span>)
00459           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"Serialization format not supported"</span>);
00460 
00461         <span class="keywordflow">if</span> (tag.attribute(<span class="stringliteral">"version"</span>) != <span class="stringliteral">"1.0"</span>)
00462           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"Only serialization format version 1.0 is supported"</span>);
00463       }
00464     }
00465 
00466     <span class="keywordflow">if</span> (!rootElementOK)
00467       <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"This XML format or version not is supported"</span>);
00468 
00469   }
00470 
00471   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00472 }
00473 
00474 
00475 <span class="keywordtype">bool</span> SimpleXMLSerializer::readStartTag(TagData&amp; tag)
00476 {
00477   <a class="code" href="base.html#a19">Assert</a>(!output);
00478 
00479   tag.name.clear();
00480   tag.attributeNames.clear();
00481   tag.attributeValues.clear();
00482 
00483   (*istream) &gt;&gt; std::noskipws;
00484 
00485   <span class="keywordtype">char</span> p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00486   <span class="keywordflow">if</span> (p == <span class="charliteral">'&lt;'</span>) {
00487     <span class="comment">// check for '!--' comment start</span>
00488     p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00489     tag.name += p;
00490     <span class="keywordflow">if</span> (p==<span class="charliteral">'!'</span>) {
00491       tag.name += p;
00492       <span class="keywordflow">do</span> { p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>(); tag.name += p; } <span class="keywordflow">while</span> (p==<span class="charliteral">' '</span>);
00493       <span class="keywordflow">if</span> (p==<span class="charliteral">'-'</span>) {
00494         tag.name += p;
00495         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00496         <span class="keywordflow">if</span> (p==<span class="charliteral">'-'</span>) { <span class="comment">// comment start</span>
00497           tag.name.clear();
00498           <span class="comment">// skip to end of comment</span>
00499           <span class="keywordtype">bool</span> endcomment = <span class="keyword">false</span>;
00500           <span class="keywordflow">do</span> {
00501             p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00502             <span class="keywordflow">if</span> (p == <span class="charliteral">'-'</span>) {
00503               p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00504               <span class="keywordflow">if</span> (p == <span class="charliteral">'-'</span>) {
00505                 p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00506                 <span class="keywordflow">if</span> (p == <span class="charliteral">'&gt;'</span>) {
00507                   endcomment = <span class="keyword">true</span>;
00508                   <span class="comment">// eat whitespace after comment</span>
00509                   p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00510                   <span class="keywordflow">if</span> (p!=<span class="charliteral">'&lt;'</span>) {
00511                     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p);
00512                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00513                   }
00514                 }
00515               }
00516             }
00517           } <span class="keywordflow">while</span> (!endcomment);
00518         }
00519       }
00520     } <span class="comment">// end check for comment</span>
00521 
00522     <span class="comment">// read tag name (ends with space or '&gt;')</span>
00523     p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00524     <span class="keywordflow">while</span> ((p != <span class="charliteral">'&gt;'</span>) &amp;&amp; (p != <span class="charliteral">' '</span>)) {
00525       tag.name += p;
00526       p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00527     } 
00528 
00529     <span class="comment">// white space is allowed after tag name, but before '&gt;', eat it</span>
00530     <span class="keywordflow">if</span> (p!=<span class="charliteral">'&gt;'</span>) {
00531       p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00532       <span class="keywordflow">if</span> (p!=<span class="charliteral">'&gt;'</span>) 
00533         <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p); <span class="comment">// still isn't tag close '&gt;', must be start of attribute name, put it back</span>
00534     }
00535 
00536     <span class="keywordflow">if</span> (p!=<span class="charliteral">'&gt;'</span>) { <span class="comment">// tag must have some attributes, read them</span>
00537       <span class="keywordtype">bool</span> tagclose=<span class="keyword">false</span>;
00538       <span class="keywordflow">do</span> {
00539         <a class="code" href="namespacebase.html#a4">String</a> attribName;
00540         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00541         <span class="keywordflow">while</span> ((p!=<span class="charliteral">' '</span>) &amp;&amp; (p!=<span class="charliteral">'='</span>)) { attribName += p; p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>(); }
00542         <span class="keywordflow">if</span> (p!=<span class="charliteral">'='</span>) p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00543         <span class="keywordflow">if</span> (p!=<span class="charliteral">'='</span>) <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"'=' expected after attribute name:"</span>+attribName+<span class="stringliteral">" of element:"</span>+tag.name);
00544         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00545         <span class="keywordflow">if</span> (p!=<span class="charliteral">'\"'</span>) <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"attribute value must be quoted (in attribute name:"</span>+attribName+<span class="stringliteral">" of element:"</span>+tag.name+<span class="stringliteral">")"</span>);
00546         <span class="comment">// read in attribute value</span>
00547         <a class="code" href="namespacebase.html#a4">String</a> attribValue;
00548         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00549         <span class="keywordflow">while</span> (p!=<span class="charliteral">'\"'</span>) { attribValue += p; p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>(); }
00550         tag.attributeNames.push_back(attribName);
00551         tag.attributeValues.push_back(attribValue);
00552 
00553         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00554 
00555         <span class="keywordflow">if</span> ((tag.name[0]==<span class="charliteral">'?'</span>) &amp;&amp; (p==<span class="charliteral">'?'</span>)) 
00556           p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00557 
00558         <span class="keywordflow">if</span> (p == <span class="charliteral">'&gt;'</span>) tagclose=<span class="keyword">true</span>;
00559 
00560         <span class="keywordflow">if</span> (p == <span class="charliteral">'&lt;'</span>) 
00561           <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"unexpected '&lt;' - element "</span>+tag.name+<span class="stringliteral">" not terminated?"</span>);
00562 
00563         <span class="keywordflow">if</span> (!tagclose) <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p);
00564 
00565       } <span class="keywordflow">while</span> (!tagclose);
00566 
00567     }
00568 
00569     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00570   }    
00571 
00572   <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p);
00573   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00574 
00575 }
00576 
00577 
00578 <span class="keywordtype">bool</span> SimpleXMLSerializer::readEndTag(<span class="keyword">const</span> String&amp; tagName)
00579 {
00580   <a class="code" href="base.html#a19">Assert</a>(!output);
00581 
00582   (*istream) &gt;&gt; std::noskipws;
00583 
00584   <a class="code" href="namespacebase.html#a4">String</a> name;
00585   <span class="keywordtype">char</span> p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00586   <span class="keywordflow">if</span> (p == <span class="charliteral">'&lt;'</span>) {
00587     <span class="comment">// check for '!--' comment start</span>
00588     p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00589     name += p;
00590     <span class="keywordflow">if</span> (p==<span class="charliteral">'!'</span>) {
00591       name += p;
00592       <span class="keywordflow">do</span> { p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>(); name += p; } <span class="keywordflow">while</span> (p==<span class="charliteral">' '</span>);
00593       <span class="keywordflow">if</span> (p==<span class="charliteral">'-'</span>) {
00594         name += p;
00595         p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00596         <span class="keywordflow">if</span> (p==<span class="charliteral">'-'</span>) { <span class="comment">// comment start</span>
00597           name.clear();
00598           <span class="comment">// skip to end of comment</span>
00599           <span class="keywordtype">bool</span> endcomment = <span class="keyword">false</span>;
00600           <span class="keywordflow">do</span> {
00601             p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00602             <span class="keywordflow">if</span> (p == <span class="charliteral">'-'</span>) {
00603               p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00604               <span class="keywordflow">if</span> (p == <span class="charliteral">'-'</span>) {
00605                 p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00606                 <span class="keywordflow">if</span> (p == <span class="charliteral">'&gt;'</span>) {
00607                   endcomment = <span class="keyword">true</span>;
00608                   <span class="comment">// eat whitespace after comment</span>
00609                   p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00610                   <span class="keywordflow">if</span> (p!=<span class="charliteral">'&lt;'</span>) {
00611                     <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerp0">istream</a>-&gt;putback(p);
00612                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00613                   }
00614                 }
00615               }
00616             }
00617           } <span class="keywordflow">while</span> (!endcomment);
00618         }
00619       }
00620     } <span class="comment">// end check for comment</span>
00621     
00622     <span class="comment">// read tag name (ends with space or '&gt;')</span>
00623     p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00624     <span class="keywordflow">while</span> ((p != <span class="charliteral">'&gt;'</span>) &amp;&amp; (p != <span class="charliteral">' '</span>)) {
00625       name += p;
00626       p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb13">nextChar</a>();
00627     } 
00628 
00629 
00630     <span class="comment">// white space is allowed after tag name, but before '&gt;', eat it</span>
00631     <span class="keywordflow">if</span> (p!=<span class="charliteral">'&gt;'</span>) 
00632       p = <a class="code" href="classbase_1_1SimpleXMLSerializer.html#base_1_1SimpleXMLSerializerb14">nextNWSChar</a>();
00633     
00634     <span class="keywordflow">if</span> (p!=<span class="charliteral">'&gt;'</span>) <span class="comment">// still no '&gt;'?, improperly terminated</span>
00635       <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected '&gt;' to close element:&lt;"</span>+name);
00636 
00637     <span class="keywordflow">if</span> (!tagName.empty())
00638       <span class="keywordflow">if</span> (name != <a class="code" href="namespacebase.html#a4">String</a>(<span class="stringliteral">"/"</span>+tagName))
00639         <a class="code" href="classbase_1_1Serializer.html#base_1_1SimpleXMLSerializerb19">abort</a>(<span class="stringliteral">"expected closing element &lt;/"</span>+tagName+<span class="stringliteral">"&gt; but read &lt;"</span>+name+<span class="stringliteral">"&gt;"</span>);
00640     
00641     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00642   }
00643 
00644   <span class="keywordflow">return</span> <span class="keyword">false</span>;
00645 }
00646 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:14 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
