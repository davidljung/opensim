<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OpenSim: robot/control/oldikor/IKOR/Jacob_UTILS.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>robot/control/oldikor/IKOR/Jacob_UTILS.c</h1><a href="Jacob__UTILS_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/* ________________________________________________________</span>
00002 <span class="comment">  |                                                        |</span>
00003 <span class="comment">  | Program Name:   Jacob_UTILS.c                          |</span>
00004 <span class="comment">  |________________________________________________________|</span>
00005 <span class="comment">  |                                                        |</span>
00006 <span class="comment">  | description:  Driver for GET_JACOB as well as code for |</span>
00007 <span class="comment">  |     the transformation matrixes and the extraction of  |</span>
00008 <span class="comment">  |     Euler Angles.                                      |</span>
00009 <span class="comment">  |                                                        |</span>
00010 <span class="comment">  | Procedures:                                            |</span>
00011 <span class="comment">  |     GET_JACOBIAN   :                                   |</span>
00012 <span class="comment">  |________________________________________________________| */</span>
00013 
00014 
00015 <span class="preprocessor">#include &lt;<a class="code" href="general_8h.html">IKOR/general.h</a>&gt;</span>       <span class="comment">/* Generic Constants             */</span>
00016 
00017 <span class="comment">/* ________________________________________________________</span>
00018 <span class="comment">  | name:    GET_JACOBIAN /GET_JACOBIAN_ALTERED            |</span>
00019 <span class="comment">  | description:  if N SPACE == 6 or 3, then the jacobian  |</span>
00020 <span class="comment">  |    is a (6x7), or (6x10), or a (3x7), or (3x10) matrix.|</span>
00021 <span class="comment">  |                                                        |</span>
00022 <span class="comment">  |    For Obstacle Avoidance, the Jacobian must be comput-|</span>
00023 <span class="comment">  |    ed at the point of intersection.  Functions in      |</span>
00024 <span class="comment">  |    Jacob_UTILS.c accomplish this assuming the follow-  |</span>
00025 <span class="comment">  |    ing hold:                                           |</span>
00026 <span class="comment">  |      1. The links should be labeled as LL[0] - LL[4]   |</span>
00027 <span class="comment">  |      2. Change constants such as Link Lengths ect..    |</span>
00028 <span class="comment">  |         into a data file (see ROBOT_AIRARM.dat and     |</span>
00029 <span class="comment">  |         the Users Guide)                               |</span>
00030 <span class="comment">  |                                                        |</span>
00031 <span class="comment">  | inputs:  Initial Qarray and LL[0]-LL[4]                |</span>
00032 <span class="comment">  | outputs: Returns the Jacobian                          |</span>
00033 <span class="comment">  |________________________________________________________|</span>
00034 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00035 <span class="comment">  |  c hacker     10/94    Created                         |</span>
00036 <span class="comment">  |________________________________________________________| */</span>
00037 
<a name="l00038"></a><a class="code" href="Jacob__UTILS_8c.html#a0">00038</a> <span class="keywordtype">void</span> <a class="code" href="Jacob__UTILS_8c.html#a0">GET_JACOBIAN</a> (<a class="code" href="structMATRIX.html">MATRIX</a> *Jacob, <a class="code" href="structMATRIX.html">MATRIX</a> *Qarray)
00039 {
00040   <span class="keywordtype">int</span> i;
00041   <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>; i++) <a class="code" href="general_8h.html#a58">LL</a>[i] = <a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo14">LINKS</a>[i];
00042 
00043   <a class="code" href="headers_8h.html#a12">GET_JACOB</a> (Jacob, Qarray);
00044 }
00045 
<a name="l00046"></a><a class="code" href="Jacob__UTILS_8c.html#a1">00046</a> <span class="keywordtype">void</span> <a class="code" href="Jacob__UTILS_8c.html#a1">GET_JACOBIAN_ALTERED</a> (<a class="code" href="structMATRIX.html">MATRIX</a> *Jacob, <a class="code" href="structMATRIX.html">MATRIX</a> *Qarray)
00047 {
00048   <a class="code" href="headers_8h.html#a12">GET_JACOB</a> (Jacob, Qarray);
00049 }
00050 
00051 
00052 <span class="comment">/* ________________________________________________________</span>
00053 <span class="comment">  | name:                  getT2                           |</span>
00054 <span class="comment">  | description:   Calculate transformation matrix for a   |</span>
00055 <span class="comment">  |     given three angular rotations and three transla-   |</span>
00056 <span class="comment">  |     tions.  Parameters entered in the order: z axis    |</span>
00057 <span class="comment">  |     rotation, y axis rotation, x axis rotation, x axis |</span>
00058 <span class="comment">  |     translation, y axis translation, z axis transla-   |</span>
00059 <span class="comment">  |     tion. The following equations come from the mult-  |</span>
00060 <span class="comment">  |     iplication of three separate rotation matrices and |</span>
00061 <span class="comment">  |     one translation matrix (all are 4x4).              |</span>
00062 <span class="comment">  |                                                        |</span>
00063 <span class="comment">  | inputs:  x,y,z rot and x,y,z tran                      |</span>
00064 <span class="comment">  | outputs: Returns the Transformation Matrix             |</span>
00065 <span class="comment">  |________________________________________________________|</span>
00066 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00067 <span class="comment">  | unkown       ?/??      Created                         |</span>
00068 <span class="comment">  |________________________________________________________| */</span>
00069 
<a name="l00070"></a><a class="code" href="Jacob__UTILS_8c.html#a2">00070</a> <a class="code" href="structMATRIX.html">MATRIX</a> *<a class="code" href="Jacob__UTILS_8c.html#a2">getT2</a>(<span class="keywordtype">double</span> ZA,<span class="keywordtype">double</span> YB,<span class="keywordtype">double</span> XG, <span class="keywordtype">double</span> tx,<span class="keywordtype">double</span> ty,<span class="keywordtype">double</span> tz)
00071 {
00072 <span class="keywordtype">double</span> sa, sb, sg, ca, cb, cg;
00073 <a class="code" href="structMATRIX.html">MATRIX</a> *T;
00074 
00075 T=<a class="code" href="matrix_8h.html#a25">mat_malloc</a>(4,4);
00076 
00077 sa = sin(ZA); sb = sin(YB); sg = sin(XG);
00078 ca = cos(ZA); cb = cos(YB); cg = cos(XG);
00079 
00080 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]=  ca*cb;  T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][1]=ca*sb*sg-sa*cg;  T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][2]=ca*sb*cg+sa*sg;
00081 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][0]=  sa*cb;  T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][1]=sa*sb*sg+ca*cg;  T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][2]=sa*sb*cg-ca*sg;
00082 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[2][0]= -sb;     T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[2][1]=cb*sg;           T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[2][2]=cb*cg;
00083 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[3][0]=  0.0;    T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[3][1]=0.0;             T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[3][2]=0.0;   
00084 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][3]= tx;     
00085 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][3]= ty;              
00086 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[2][3]= tz;
00087 T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[3][3]=  1;
00088 
00089 <span class="keywordflow">return</span> (T);
00090 }  <span class="comment">/* getT2 */</span>
00091  
00092 
00093 
00094 <span class="comment">/* ________________________________________________________</span>
00095 <span class="comment">  | name:                  ExtractRPY2                     |</span>
00096 <span class="comment">  | description: Now to extract Euler Angles from T matrix |</span>
00097 <span class="comment">  |     which is in effect the homogenous transform matrix |</span>
00098 <span class="comment">  |     from base to end effector.  Purpose- extracts roll,|</span>
00099 <span class="comment">  |     pitch, and yaw angles from orthogonal rotation     |</span>
00100 <span class="comment">  |     matrix using  J.J. Craig's algorithm(2nd ed. 1989) |</span>
00101 <span class="comment">  |                                                        |</span>
00102 <span class="comment">  | inputs:  transformation matrix                         |</span>
00103 <span class="comment">  | outputs: Returns Euler angles in x_of_link structur    |</span>
00104 <span class="comment">  |________________________________________________________|</span>
00105 <span class="comment">  | Authors:     Date:     Modifications:                  |</span>
00106 <span class="comment">  | unkown       ?/??      Implemented                     |</span>
00107 <span class="comment">  | c hacker     3/95      incorporated new x_of_link      |</span>
00108 <span class="comment">  |________________________________________________________| */</span>
00109 
<a name="l00110"></a><a class="code" href="Jacob__UTILS_8c.html#a3">00110</a> <span class="keywordtype">void</span> <a class="code" href="Jacob__UTILS_8c.html#a3">ExtractRPY2</a>(<a class="code" href="structMATRIX.html">MATRIX</a> * T, <a class="code" href="structMATRIX.html">MATRIX</a> *x_of_link)
00111 {
00112   <span class="keyword">extern</span> FILE *<a class="code" href="general_8h.html#a34">datafp</a>;
00113   <span class="keywordtype">double</span> SMALL_RPY = 0.01745;
00114   <span class="keywordtype">double</span> temp1, temp2, temp3,
00115          gamma = 0, beta = 0, alpha = 0;
00116 
00117   temp1 = sqrt(T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0]*T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[0][0] + T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][0]*T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[1][0]);
00118   temp2 =   - (T-&gt;<a class="code" href="structMATRIX.html#MATRIXo0">p</a>[2][0]);
00119 
00120   beta = atan2(temp2, temp1);           <span class="comment">/* beta or attitude angle     */</span>
00121 
00122   <span class="keywordflow">if</span>      (fabs(beta - (<a class="code" href="general_8h.html#a16">PI</a> / 2.0e0)) &lt; <a class="code" href="general_8h.html#a13">SMALL</a>) {
00123     gamma = <a class="code" href="general_8h.html#a15">ZERO</a>;                       <span class="comment">/* gamma or heading angle     */</span>
00124     temp1 = T -&gt; p[1][1];
00125     temp2 = T -&gt; p[0][1];
00126     alpha = atan2(temp2, temp1);        <span class="comment">/* alpha or bank angle        */</span>
00127   }
00128 
00129   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabs(beta + (<a class="code" href="general_8h.html#a16">PI</a> / 2.0e0)) &lt; <a class="code" href="general_8h.html#a13">SMALL</a>) {
00130     gamma = <a class="code" href="general_8h.html#a15">ZERO</a>;                       <span class="comment">/* gamma or heading angle     */</span>
00131     temp1 = T -&gt; p[1][1];
00132     temp2 = T -&gt; p[0][1];
00133     alpha = -atan2(temp2, temp1);       <span class="comment">/* alpha or bank angle        */</span>
00134   }
00135 
00136   <span class="keywordflow">else</span>  {
00137     temp3 = cos(beta);
00138     temp2 = T -&gt; p[1][0] / temp3;
00139     temp1 = T -&gt; p[0][0] / temp3;
00140     gamma   = atan2(temp2, temp1);      <span class="comment">/* gamma or heading angle  */</span>
00141     temp2 = T -&gt; p[2][1] / temp3;
00142     temp1 = T -&gt; p[2][2] / temp3;
00143     alpha  = atan2(temp2, temp1);       <span class="comment">/* alpha or bank angle     */</span>
00144   }
00145 
00146   <span class="keywordflow">if</span> (x_of_link-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a> &gt; 3)  x_of_link -&gt; p[<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>][3] = gamma;
00147   <span class="keywordflow">if</span> (x_of_link-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a> &gt; 4)  x_of_link -&gt; p[<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>][4] = beta;
00148   <span class="keywordflow">if</span> (x_of_link-&gt;<a class="code" href="structMATRIX.html#MATRIXo2">cols</a> &gt; 5)  x_of_link -&gt; p[<a class="code" href="general_8h.html#a57">Robot</a>-&gt;<a class="code" href="structManipulator__struct.html#Manipulator__structo1">NL</a>][5] = alpha;
00149 
00150 }                            <span class="comment">/* ExtractRPY2 */</span>
00151 
00152 
00153 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Jul 29 15:56:35 2004 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
