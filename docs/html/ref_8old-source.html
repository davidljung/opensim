<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>opensim/base/ref.old Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>opensim/base/ref.old</h1><a href="ref_8old.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">  Copyright (C)2001 by Andrei Alexandrescu</font>
00003 <font class="comment"></font>
00004 <font class="comment">  This file is a derivative of a file from the Loki Library written by</font>
00005 <font class="comment">  Andrei Alexandrescu.  It was distributed by him under the terms</font>
00006 <font class="comment">  listed below (titled Loki Original Distribution Terms).</font>
00007 <font class="comment">  In accordance with the terms, this distribution contains the copyright</font>
00008 <font class="comment">  notice here and the copyright notice and permission notice</font>
00009 <font class="comment">  in supporting documentation.  The terms do *not* require</font>
00010 <font class="comment">  redistribution under those same terms.  This code is distributed</font>
00011 <font class="comment">  to you under the terms of the GNU General Public License (GPL) </font>
00012 <font class="comment">  below.  The GPL does not require you to maintain the terms of</font>
00013 <font class="comment">  the Loki Original Distribution Terms, but you are encouraged to do so.</font>
00014 <font class="comment"></font>
00015 <font class="comment">  This program/file is free software; you can redistribute it and/or modify</font>
00016 <font class="comment">  it under the terms of the GNU General Public License as published by</font>
00017 <font class="comment">  the Free Software Foundation; either version 2 of the License, or</font>
00018 <font class="comment">  (at your option) any later version.</font>
00019 <font class="comment">  </font>
00020 <font class="comment">  This program is distributed in the hope that it will be useful,</font>
00021 <font class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00022 <font class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
00023 <font class="comment">  GNU General Public License for more details. (http://www.gnu.org)</font>
00024 <font class="comment">  </font>
00025 <font class="comment">  You should have received a copy of the GNU General Public License</font>
00026 <font class="comment">  along with this program; if not, write to the Free Software</font>
00027 <font class="comment">  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</font>
00028 <font class="comment">  </font>
00029 <font class="comment"> ****************************************************************************</font>
00030 <font class="comment">  Loki Original Distribution Terms:</font>
00031 <font class="comment"></font>
00032 <font class="comment">  The Loki Library</font>
00033 <font class="comment">  Copyright (c) 2001 by Andrei Alexandrescu</font>
00034 <font class="comment">  This code accompanies the book:</font>
00035 <font class="comment">  Alexandrescu, Andrei. "Modern C++ Design: Generic Programming and Design </font>
00036 <font class="comment">      Patterns Applied". Copyright (c) 2001. Addison-Wesley.</font>
00037 <font class="comment">  Permission to use, copy, modify, distribute and sell this software for any </font>
00038 <font class="comment">      purpose is hereby granted without fee, provided that the above copyright </font>
00039 <font class="comment">      notice appear in all copies and that both that copyright notice and this </font>
00040 <font class="comment">      permission notice appear in supporting documentation.</font>
00041 <font class="comment">  The author or Addison-Welsey Longman make no representations about the </font>
00042 <font class="comment">      suitability of this software for any purpose. It is provided "as is" </font>
00043 <font class="comment">      without express or implied warranty.</font>
00044 <font class="comment"> ****************************************************************************</font>
00045 <font class="comment"></font>
00046 <font class="comment">  $Id: $</font>
00047 <font class="comment">  $Revision: $</font>
00048 <font class="comment">  $Date: $</font>
00049 <font class="comment">  $Author: $</font>
00050 <font class="comment"> </font>
00051 <font class="comment">****************************************************************************/</font>
00052 
00053 <font class="comment">// Last update: June 20, 2001</font>
00054 
00055 <font class="preprocessor">#ifndef SMARTPTR_INC_</font>
00056 <font class="preprocessor"></font><font class="preprocessor">#define SMARTPTR_INC_</font>
00057 <font class="preprocessor"></font>
00059 <font class="comment">// IMPORTANT NOTE</font>
00060 <font class="comment">// Due to threading issues, the OwnershipPolicy has been changed as follows:</font>
00061 <font class="comment">//     Release() returns a boolean saying if that was the last release</font>
00062 <font class="comment">//        so the pointer can be deleted by the StoragePolicy</font>
00063 <font class="comment">//     IsUnique() was removed</font>
00065 <font class="comment"></font>
00066 
00067 <font class="preprocessor">#include &lt;<a class="code" href="SmallObj.html">base/SmallObj</a>&gt;</font>
00068 <font class="preprocessor">#include &lt;<a class="code" href="TypeManip.html">base/TypeManip</a>&gt;</font>
00069 <font class="preprocessor">#include &lt;<a class="code" href="NullType.html">base/NullType</a>&gt;</font>
00070 <font class="preprocessor">#include &lt;base/static_check&gt;</font>
00071 <font class="preprocessor">#include &lt;functional&gt;</font>
00072 <font class="preprocessor">#include &lt;stdexcept&gt;</font>
00073 
00074 <font class="keyword">namespace </font><a class="code" href="boost_8jamfile.html#a0">base</a>
00075 {
00076 
00078 <font class="comment">// class template DefaultSPStorage</font>
00079 <font class="comment">// Implementation of the StoragePolicy used by ref</font>
00081 <font class="comment"></font>
00082     <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00083     <font class="keyword">class </font>DefaultSPStorage
00084     {
00085     <font class="keyword">protected</font>:
<a name="l00086"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget3">00086</a>         <font class="keyword">typedef</font> T* <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a>;    <font class="comment">// the type of the pointee_ object</font>
<a name="l00087"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget4">00087</a>         <font class="keyword">typedef</font> T* <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget1">PointerType</a>;   <font class="comment">// type returned by operator-&gt;</font>
<a name="l00088"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget5">00088</a>         <font class="keyword">typedef</font> T&amp; <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget2">ReferenceType</a>; <font class="comment">// type returned by operator*</font>
00089         
00090     <font class="keyword">public</font>:
<a name="l00091"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea7">00091</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>() : pointee_(<a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragee0">Default</a>()) 
00092         {}
00093 
00094         <font class="comment">// The storage policy doesn't initialize the stored pointer </font>
00095         <font class="comment">//     which will be initialized by the OwnershipPolicy's Clone fn</font>
<a name="l00096"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea8">00096</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>&amp;)
00097         {}
00098 
00099         <font class="keyword">template</font> &lt;<font class="keyword">class</font> U&gt;
<a name="l00100"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea9">00100</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>(<font class="keyword">const</font> DefaultSPStorage&lt;U&gt;&amp;) 
00101         {}
00102         
<a name="l00103"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea10">00103</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a>&amp; p) : pointee_(p) {}
00104         
<a name="l00105"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea11">00105</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget1">PointerType</a> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea4">operator-&gt;</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> pointee_; }
00106         
<a name="l00107"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea12">00107</a>         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget2">ReferenceType</a> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea5">operator*</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> *pointee_; }
00108         
<a name="l00109"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea13">00109</a>         <font class="keywordtype">void</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea6">Swap</a>(<a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>&amp; rhs)
00110         { std::swap(pointee_, rhs.pointee_); }
00111     
00112         <font class="comment">// Accessors</font>
<a name="l00113"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel3">00113</a>         <font class="keyword">friend</font> <font class="keyword">inline</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget1">PointerType</a> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel0">GetImpl</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>&amp; sp)
00114         { <font class="keywordflow">return</font> sp.pointee_; }
00115         
<a name="l00116"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel4">00116</a>       <font class="keyword">friend</font> <font class="keyword">inline</font> <font class="keyword">const</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a>&amp; <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel1">GetImplRef</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>&amp; sp)
00117       { <font class="keywordflow">return</font> sp.pointee_; }
00118 
<a name="l00119"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel5">00119</a>       <font class="keyword">friend</font> <font class="keyword">inline</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a>&amp; <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragel1">GetImplRef</a>(<a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragea0">DefaultSPStorage</a>&amp; sp)
00120       { <font class="keywordflow">return</font> sp.pointee_; }
00121 
00122     <font class="keyword">protected</font>:
00123         <font class="comment">// Destroys the data stored</font>
00124         <font class="comment">// (Destruction might be taken over by the OwnershipPolicy)</font>
<a name="l00125"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStorageb1">00125</a>         <font class="keywordtype">void</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStorageb0">Destroy</a>()
00126         { <font class="keyword">delete</font> pointee_; }
00127         
00128         <font class="comment">// Default value to initialize the pointer</font>
<a name="l00129"></a><a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragee1">00129</a>         <font class="keyword">static</font> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a> <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoragee0">Default</a>()
00130         { <font class="keywordflow">return</font> 0; }
00131     
00132     <font class="keyword">private</font>:
00133         <font class="comment">// Data</font>
00134         <a class="code" href="classbase_1_1DefaultSPStorage.html#base_1_1DefaultSPStoraget0">StoredType</a> pointee_;
00135     };
00136 
00138 <font class="comment">// class template RefCounted</font>
00139 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00140 <font class="comment">// Provides a classic external reference counting implementation</font>
00142 <font class="comment"></font>
00143     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00144     <font class="keyword">class </font>RefCounted
00145     {
00146     <font class="keyword">public</font>:
<a name="l00147"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda7">00147</a>         <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>() 
00148         {
00149             pCount_ = static_cast&lt;unsigned int*&gt;(
00150                 <a class="code" href="MemoryTracer.html#a3">SmallObject&lt;&gt;::operator new</a>(<font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)));
00151             assert(pCount_);
00152             *pCount_ = 1;
00153         }
00154         
<a name="l00155"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda8">00155</a>         <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>&amp; rhs) 
00156         : pCount_(rhs.pCount_)
00157         {}
00158         
00159         <font class="comment">// MWCW lacks template friends, hence the following kludge</font>
00160         <font class="keyword">template</font> &lt;<font class="keyword">typename</font> P1&gt;
<a name="l00161"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda9">00161</a>         <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>(<font class="keyword">const</font> RefCounted&lt;P1&gt;&amp; rhs) 
00162         : pCount_(reinterpret_cast&lt;const <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>&amp;&gt;(rhs).pCount_)
00163         {}
00164         
<a name="l00165"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda10">00165</a>         P <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda3">Clone</a>(<font class="keyword">const</font> P&amp; val)
00166         {
00167             ++*pCount_;
00168             <font class="keywordflow">return</font> val;
00169         }
00170         
<a name="l00171"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda11">00171</a>         <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda5">Release</a>(<font class="keyword">const</font> P&amp;)
00172         {
00173             <font class="keywordflow">if</font> (!--*pCount_)
00174             {
00175                 SmallObject&lt;&gt;::operator delete(pCount_, <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00176                 <font class="keywordflow">return</font> <font class="keyword">true</font>;
00177             }
00178             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00179         }
00180         
<a name="l00181"></a><a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda12">00181</a>         <font class="keywordtype">void</font> <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda6">Swap</a>(<a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteda0">RefCounted</a>&amp; rhs)
00182         { std::swap(pCount_, rhs.pCount_); }
00183     
00184         <font class="keyword">enum</font> { <a class="code" href="classbase_1_1RefCounted.html#base_1_1RefCounteds2base_1_1RefCounteds0">destructiveCopy</a> = <font class="keyword">false</font> };
00185 
00186     <font class="keyword">private</font>:
00187         <font class="comment">// Data</font>
00188         <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>* pCount_;
00189     };
00190     
00192 <font class="comment">// class template RefCountedMT</font>
00193 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00194 <font class="comment">// Implements external reference counting for multithreaded programs</font>
00196 <font class="comment">    template &lt;class P,</font>
00197         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classThreadingModel.html">ThreadingModel</a>&gt;
00198     class RefCountedMT : <font class="keyword">public</font> <a class="code" href="classThreadingModel.html">ThreadingModel</a>&lt; RefCountedMT&lt;P, ThreadingModel&gt; &gt;
00199     {
00200     <font class="keyword">public</font>:
<a name="l00201"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa7">00201</a>         RefCountedMT() 
00202         {
00203             pCount_ = static_cast&lt;unsigned int*&gt;(
00204                 <a class="code" href="MemoryTracer.html#a3">SmallObject&lt;ThreadingModel&gt;::operator new</a>(
00205                     <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>)));
00206             assert(pCount_);
00207             *pCount_ = 1;
00208         }
00209         
<a name="l00210"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa8">00210</a>         RefCountedMT(<font class="keyword">const</font> RefCountedMT&amp; rhs) 
00211         : pCount_(rhs.pCount_)
00212         {}
00213         
00214         <font class="comment">// MWCW lacks template friends, hence the following kludge</font>
00215         <font class="keyword">template</font> &lt;<font class="keyword">typename</font> P1&gt;
<a name="l00216"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa9">00216</a>         RefCountedMT(<font class="keyword">const</font> RefCountedMT&lt;P1, ThreadingModel&gt;&amp; rhs) 
00217         : pCount_(reinterpret_cast&lt;const RefCounted&lt;P&gt;&amp;&gt;(rhs).pCount_)
00218         {}
00219         
<a name="l00220"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa10">00220</a>         P Clone(<font class="keyword">const</font> P&amp; val)
00221         {
00222             <a class="code" href="classThreadingModel.html">ThreadingModel&lt;RefCountedMT&gt;::AtomicIncrement</a>(*pCount_);
00223             <font class="keywordflow">return</font> val;
00224         }
00225         
<a name="l00226"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa11">00226</a>         <font class="keywordtype">bool</font> Release(<font class="keyword">const</font> P&amp;)
00227         {
00228             <font class="keywordflow">if</font> (!<a class="code" href="classThreadingModel.html">ThreadingModel&lt;RefCountedMT&gt;::AtomicDecrement</a>(*pCount_))
00229             {
00230                 SmallObject&lt;ThreadingModel&gt;::operator delete(pCount_, 
00231                     <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00232                 <font class="keywordflow">return</font> <font class="keyword">true</font>;
00233             }
00234             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00235         }
00236         
<a name="l00237"></a><a class="code" href="classbase_1_1RefCountedMT.html#base_1_1RefCountedMTa12">00237</a>         <font class="keywordtype">void</font> Swap(RefCountedMT&amp; rhs)
00238         { std::swap(pCount_, rhs.pCount_); }
00239     
00240         <font class="keyword">enum</font> { destructiveCopy = <font class="keyword">false</font> };
00241 
00242     <font class="keyword">private</font>:
00243         <font class="comment">// Data</font>
00244         <font class="keyword">volatile</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>* pCount_;
00245     };
00246 
00248 <font class="comment">// class template COMRefCounted</font>
00249 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00250 <font class="comment">// Adapts COM intrusive reference counting to OwnershipPolicy-specific syntax</font>
00252 <font class="comment"></font>
00253     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00254     <font class="keyword">class </font>COMRefCounted
00255     {
00256     <font class="keyword">public</font>:
<a name="l00257"></a><a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteda2">00257</a>         <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteda0">COMRefCounted</a>()
00258         {}
00259         
00260         <font class="keyword">template</font> &lt;<font class="keyword">class</font> U&gt;
<a name="l00261"></a><a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteda3">00261</a>         <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteda0">COMRefCounted</a>(<font class="keyword">const</font> COMRefCounted&lt;U&gt;&amp;)
00262         {}
00263         
<a name="l00264"></a><a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd4">00264</a>         <font class="keyword">static</font> P <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd0">Clone</a>(<font class="keyword">const</font> P&amp; val)
00265         {
00266             val-&gt;AddRef();
00267             <font class="keywordflow">return</font> val;
00268         }
00269         
<a name="l00270"></a><a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd5">00270</a>         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd2">Release</a>(<font class="keyword">const</font> P&amp; val)
00271         { val-&gt;Release(); <font class="keywordflow">return</font> <font class="keyword">false</font>; }
00272         
00273         <font class="keyword">enum</font> { <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteds2base_1_1COMRefCounteds0">destructiveCopy</a> = <font class="keyword">false</font> };
00274         
<a name="l00275"></a><a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd6">00275</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCountedd3">Swap</a>(<a class="code" href="classbase_1_1COMRefCounted.html#base_1_1COMRefCounteda0">COMRefCounted</a>&amp;)
00276         {}
00277     };
00278 
00280 <font class="comment">// class template IntrRefCounted</font>
00281 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00282 <font class="comment">// Intrusive reference counting through class Referenced</font>
00284 <font class="comment"></font>
00285     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00286     <font class="keyword">class </font>IntrRefCounted
00287     {
00288     <font class="keyword">public</font>:
<a name="l00289"></a><a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteda2">00289</a>         <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteda0">IntrRefCounted</a>()
00290         {}
00291         
00292         <font class="keyword">template</font> &lt;<font class="keyword">class</font> U&gt;
<a name="l00293"></a><a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteda3">00293</a>         <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteda0">IntrRefCounted</a>(<font class="keyword">const</font> IntrRefCounted&lt;U&gt;&amp;)
00294         {}
00295         
<a name="l00296"></a><a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd4">00296</a>         <font class="keyword">static</font> P <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd0">Clone</a>(<font class="keyword">const</font> P&amp; val)
00297         {
00298             val-&gt;reference();
00299             <font class="keywordflow">return</font> val;
00300         }
00301         
<a name="l00302"></a><a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd5">00302</a>         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd2">Release</a>(<font class="keyword">const</font> P&amp; val)
00303         { 
00304     <font class="keywordflow">if</font> (val!=0) 
00305       <font class="keywordflow">return</font> val-&gt;unreference(); 
00306     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00307   }
00308         
00309         <font class="keyword">enum</font> { <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteds2base_1_1IntrRefCounteds0">destructiveCopy</a> = <font class="keyword">false</font> };
00310         
<a name="l00311"></a><a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd6">00311</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCountedd3">Swap</a>(<a class="code" href="classbase_1_1IntrRefCounted.html#base_1_1IntrRefCounteda0">IntrRefCounted</a>&amp;)
00312         {}
00313     };
00314 
00316 <font class="comment">// class template DeepCopy</font>
00317 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00318 <font class="comment">// Implements deep copy semantics, assumes existence of a Clone() member </font>
00319 <font class="comment">//     function of the pointee type</font>
00321 <font class="comment"></font>
00322     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00323     <font class="keyword">struct </font>DeepCopy
00324     {
<a name="l00325"></a><a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopya2">00325</a>         <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopya0">DeepCopy</a>()
00326         {}
00327         
00328         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00329"></a><a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopya3">00329</a>         <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopya0">DeepCopy</a>(<font class="keyword">const</font> DeepCopy&lt;P1&gt;&amp;)
00330         {}
00331         
<a name="l00332"></a><a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd4">00332</a>         <font class="keyword">static</font> P <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd0">Clone</a>(<font class="keyword">const</font> P&amp; val)
00333         { <font class="keywordflow">return</font> val-&gt;Clone(); }
00334         
<a name="l00335"></a><a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd5">00335</a>         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd2">Release</a>(<font class="keyword">const</font> P&amp; val)
00336         { <font class="keywordflow">return</font> <font class="keyword">true</font>; }
00337         
<a name="l00338"></a><a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd6">00338</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopyd3">Swap</a>(<a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopya0">DeepCopy</a>&amp;)
00339         {}
00340         
00341         <font class="keyword">enum</font> { <a class="code" href="structbase_1_1DeepCopy.html#base_1_1DeepCopys2base_1_1DeepCopys0">destructiveCopy</a> = <font class="keyword">false</font> };
00342     };
00343     
00345 <font class="comment">// class template RefLinked</font>
00346 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00347 <font class="comment">// Implements reference linking</font>
00349 <font class="comment"></font>
00350     <font class="keyword">namespace </font>Private
00351     {
00352         <font class="keyword">class </font>RefLinkedBase
00353         {
00354         <font class="keyword">public</font>:
<a name="l00355"></a><a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea4">00355</a>             <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>() 
00356             { prev_ = next_ = <font class="keyword">this</font>; }
00357             
<a name="l00358"></a><a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea5">00358</a>             <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>&amp; rhs) 
00359             {
00360                 prev_ = &amp;rhs;
00361                 next_ = rhs.next_;
00362                 prev_-&gt;next_ = <font class="keyword">this</font>;
00363                 next_-&gt;prev_ = <font class="keyword">this</font>;
00364             }
00365             
<a name="l00366"></a><a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea6">00366</a>             <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea2">Release</a>()
00367             {
00368                 <font class="keywordflow">if</font> (next_ == <font class="keyword">this</font>)
00369                 {   
00370                     assert(prev_ == <font class="keyword">this</font>);
00371                     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00372                 }
00373                 prev_-&gt;next_ = next_;
00374                 next_-&gt;prev_ = prev_;
00375                 <font class="keywordflow">return</font> <font class="keyword">false</font>;
00376             }
00377             
<a name="l00378"></a><a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea7">00378</a>             <font class="keywordtype">void</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea3">Swap</a>(<a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>&amp; rhs)
00379             {
00380                 <font class="keywordflow">if</font> (next_ == <font class="keyword">this</font>)
00381                 {
00382                     assert(prev_ == <font class="keyword">this</font>);
00383                     <font class="keywordflow">if</font> (rhs.next_ == &amp;rhs)
00384                     {
00385                         assert(rhs.prev_ == &amp;rhs);
00386                         <font class="comment">// both lists are empty, nothing 2 do</font>
00387                         <font class="keywordflow">return</font>;
00388                     }
00389                     prev_ = rhs.prev_;
00390                     next_ = rhs.next_;
00391                     prev_-&gt;next_ = next_-&gt;prev_ = <font class="keyword">this</font>;
00392                     rhs.next_ = rhs.prev_ = &amp;rhs;
00393                     <font class="keywordflow">return</font>;
00394                 }
00395                 <font class="keywordflow">if</font> (rhs.next_ == &amp;rhs)
00396                 {
00397                     rhs.Swap(*<font class="keyword">this</font>);
00398                     <font class="keywordflow">return</font>;
00399                 }
00400                 std::swap(prev_, rhs.prev_);
00401                 std::swap(next_, rhs.next_);
00402                 std::swap(prev_-&gt;next_, rhs.prev_-&gt;next_);
00403                 std::swap(next_-&gt;prev_, rhs.next_-&gt;prev_);
00404             }
00405                 
00406             <font class="keyword">enum</font> { <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBases2base_1_1Private_1_1RefLinkedBases0">destructiveCopy</a> = <font class="keyword">false</font> };
00407 
00408         <font class="keyword">private</font>:
00409             <font class="keyword">mutable</font> <font class="keyword">const</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>* prev_;
00410             <font class="keyword">mutable</font> <font class="keyword">const</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>* next_;
00411         };
00412     }
00413     
00414     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00415     <font class="keyword">class </font>RefLinked : <font class="keyword">public</font> Private::RefLinkedBase
00416     {
00417     <font class="keyword">public</font>:
<a name="l00418"></a><a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkeda3">00418</a>         <a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkeda0">RefLinked</a>()
00419         {}
00420         
00421         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00422"></a><a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkeda4">00422</a>         <a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkeda0">RefLinked</a>(<font class="keyword">const</font> RefLinked&lt;P1&gt;&amp; rhs) 
00423         : Private::<a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea0">RefLinkedBase</a>(rhs)
00424         {}
00425 
<a name="l00426"></a><a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkedd2">00426</a>         <font class="keyword">static</font> P <a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkedd0">Clone</a>(<font class="keyword">const</font> P&amp; val)
00427         { <font class="keywordflow">return</font> val; }
00428 
<a name="l00429"></a><a class="code" href="classbase_1_1RefLinked.html#base_1_1RefLinkeda5">00429</a>         <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1Private_1_1RefLinkedBase.html#base_1_1Private_1_1RefLinkedBasea2">Release</a>(<font class="keyword">const</font> P&amp;)
00430         { <font class="keywordflow">return</font> Private::RefLinkedBase::Release(); }
00431     };
00432     
00434 <font class="comment">// class template DestructiveCopy</font>
00435 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00436 <font class="comment">// Implements destructive copy semantics (a la std::auto_ptr)</font>
00438 <font class="comment"></font>
00439     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00440     <font class="keyword">class </font>DestructiveCopy
00441     {
00442     <font class="keyword">public</font>:
<a name="l00443"></a><a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopya2">00443</a>         <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopya0">DestructiveCopy</a>()
00444         {}
00445         
00446         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00447"></a><a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopya3">00447</a>         <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopya0">DestructiveCopy</a>(<font class="keyword">const</font> DestructiveCopy&lt;P1&gt;&amp;)
00448         {}
00449         
00450         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00451"></a><a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd4">00451</a>         <font class="keyword">static</font> P <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd0">Clone</a>(P1&amp; val)
00452         {
00453             P result(val);
00454             val = P1();
00455             <font class="keywordflow">return</font> result;
00456         }
00457         
<a name="l00458"></a><a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd5">00458</a>         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd2">Release</a>(<font class="keyword">const</font> P&amp;)
00459         { <font class="keywordflow">return</font> <font class="keyword">true</font>; }
00460         
<a name="l00461"></a><a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd6">00461</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopyd3">Swap</a>(<a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopya0">DestructiveCopy</a>&amp;)
00462         {}
00463         
00464         <font class="keyword">enum</font> { <a class="code" href="classbase_1_1DestructiveCopy.html#base_1_1DestructiveCopys2base_1_1DestructiveCopys0">destructiveCopy</a> = <font class="keyword">true</font> };
00465     };
00466     
00468 <font class="comment">// class template NoCopy</font>
00469 <font class="comment">// Implementation of the OwnershipPolicy used by ref</font>
00470 <font class="comment">// Implements a policy that doesn't allow copying objects</font>
00472 <font class="comment"></font>
00473     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00474     <font class="keyword">class </font>NoCopy
00475     {
00476     <font class="keyword">public</font>:
<a name="l00477"></a><a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopya2">00477</a>         <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopya0">NoCopy</a>()
00478         {}
00479         
00480         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00481"></a><a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopya3">00481</a>         <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopya0">NoCopy</a>(<font class="keyword">const</font> NoCopy&lt;P1&gt;&amp;)
00482         {}
00483         
<a name="l00484"></a><a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd4">00484</a>         <font class="keyword">static</font> P <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd0">Clone</a>(<font class="keyword">const</font> P&amp;)
00485         {
00486             CT_ASSERT(<font class="keyword">false</font>, This_Policy_Disallows_Value_Copying);
00487         }
00488         
<a name="l00489"></a><a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd5">00489</a>         <font class="keyword">static</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd2">Release</a>(<font class="keyword">const</font> P&amp;)
00490         { <font class="keywordflow">return</font> <font class="keyword">true</font>; }
00491         
<a name="l00492"></a><a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd6">00492</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopyd3">Swap</a>(<a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopya0">NoCopy</a>&amp;)
00493         {}
00494         
00495         <font class="keyword">enum</font> { <a class="code" href="classbase_1_1NoCopy.html#base_1_1NoCopys2base_1_1NoCopys0">destructiveCopy</a> = <font class="keyword">false</font> };
00496     };
00497     
00499 <font class="comment">// class template AllowConversion</font>
00500 <font class="comment">// Implementation of the ConversionPolicy used by ref</font>
00501 <font class="comment">// Allows implicit conversion from ref to the pointee type</font>
00503 <font class="comment"></font>
00504     <font class="keyword">struct </font>AllowConversion
00505     {
00506         <font class="keyword">enum</font> { <a class="code" href="structbase_1_1AllowConversion.html#base_1_1AllowConversions2base_1_1AllowConversions0">allow</a> = <font class="keyword">true</font> };
00507 
<a name="l00508"></a><a class="code" href="structbase_1_1AllowConversion.html#base_1_1AllowConversiona1">00508</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AllowConversion.html#base_1_1AllowConversiona0">Swap</a>(AllowConversion&amp;)
00509         {}
00510     };
00511 
00513 <font class="comment">// class template DisallowConversion</font>
00514 <font class="comment">// Implementation of the ConversionPolicy used by ref</font>
00515 <font class="comment">// Does not allow implicit conversion from ref to the pointee type</font>
00516 <font class="comment">// You can initialize a DisallowConversion with an AllowConversion</font>
00518 <font class="comment"></font>
00519     <font class="keyword">struct </font>DisallowConversion
00520     {
<a name="l00521"></a><a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona3">00521</a>         <a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona0">DisallowConversion</a>()
00522         {}
00523         
<a name="l00524"></a><a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona4">00524</a>         <a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona0">DisallowConversion</a>(<font class="keyword">const</font> AllowConversion&amp;)
00525         {}
00526         
00527         <font class="keyword">enum</font> { <a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversions2base_1_1DisallowConversions0">allow</a> = <font class="keyword">false</font> };
00528 
<a name="l00529"></a><a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona5">00529</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona2">Swap</a>(<a class="code" href="structbase_1_1DisallowConversion.html#base_1_1DisallowConversiona0">DisallowConversion</a>&amp;)
00530         {}
00531     };
00532 
00534 <font class="comment">// class template NoCheck</font>
00535 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00536 <font class="comment">// Well, it's clear what it does :o)</font>
00538 <font class="comment"></font>
00539     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00540     <font class="keyword">struct </font>NoCheck
00541     {
<a name="l00542"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoChecka2">00542</a>         <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoChecka0">NoCheck</a>()
00543         {}
00544         
00545         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00546"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoChecka3">00546</a>         <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoChecka0">NoCheck</a>(<font class="keyword">const</font> NoCheck&lt;P1&gt;&amp;)
00547         {}
00548         
<a name="l00549"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd4">00549</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd0">OnDefault</a>(<font class="keyword">const</font> P&amp;)
00550         {}
00551 
<a name="l00552"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd5">00552</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd1">OnInit</a>(<font class="keyword">const</font> P&amp;)
00553         {}
00554 
<a name="l00555"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd6">00555</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd2">OnDereference</a>(<font class="keyword">const</font> P&amp;)
00556         {}
00557 
<a name="l00558"></a><a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd7">00558</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1NoCheck.html#base_1_1NoCheckd3">Swap</a>(<a class="code" href="structbase_1_1NoCheck.html#base_1_1NoChecka0">NoCheck</a>&amp;)
00559         {}
00560     };
00561 
00562 
00564 <font class="comment">// class template AssertCheck</font>
00565 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00566 <font class="comment">// Checks the pointer before dereference</font>
00568 <font class="comment"></font>
00569     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00570     <font class="keyword">struct </font>AssertCheck
00571     {
<a name="l00572"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka3">00572</a>         <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka0">AssertCheck</a>()
00573         {}
00574         
00575         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00576"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka4">00576</a>         <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka0">AssertCheck</a>(<font class="keyword">const</font> AssertCheck&lt;P1&gt;&amp;)
00577         {}
00578         
00579         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00580"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka5">00580</a>         <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka0">AssertCheck</a>(<font class="keyword">const</font> NoCheck&lt;P1&gt;&amp;)
00581         {}
00582         
<a name="l00583"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd4">00583</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd0">OnDefault</a>(<font class="keyword">const</font> P&amp;)
00584         {}
00585 
<a name="l00586"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd5">00586</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd1">OnInit</a>(<font class="keyword">const</font> P&amp;)
00587         {}
00588 
<a name="l00589"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd6">00589</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd2">OnDereference</a>(P val)
00590         { assert(val); }
00591 
<a name="l00592"></a><a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd7">00592</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertCheckd3">Swap</a>(<a class="code" href="structbase_1_1AssertCheck.html#base_1_1AssertChecka0">AssertCheck</a>&amp;)
00593         {}
00594     };
00595 
00597 <font class="comment">// class template AssertCheckStrict</font>
00598 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00599 <font class="comment">// Checks the pointer against zero upon initialization and before dereference</font>
00600 <font class="comment">// You can initialize an AssertCheckStrict with an AssertCheck </font>
00602 <font class="comment"></font>
00603     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00604     <font class="keyword">struct </font>AssertCheckStrict
00605     {
<a name="l00606"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta4">00606</a>         <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta0">AssertCheckStrict</a>()
00607         {}
00608         
00609         <font class="keyword">template</font> &lt;<font class="keyword">class</font> U&gt;
<a name="l00610"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta5">00610</a>         <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta0">AssertCheckStrict</a>(<font class="keyword">const</font> AssertCheckStrict&lt;U&gt;&amp;)
00611         {}
00612         
00613         <font class="keyword">template</font> &lt;<font class="keyword">class</font> U&gt;
<a name="l00614"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta6">00614</a>         <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta0">AssertCheckStrict</a>(<font class="keyword">const</font> AssertCheck&lt;U&gt;&amp;)
00615         {}
00616         
00617         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00618"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta7">00618</a>         <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta0">AssertCheckStrict</a>(<font class="keyword">const</font> NoCheck&lt;P1&gt;&amp;)
00619         {}
00620         
<a name="l00621"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd4">00621</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd0">OnDefault</a>(P val)
00622         { assert(val); }
00623         
<a name="l00624"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd5">00624</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd1">OnInit</a>(P val)
00625         { assert(val); }
00626         
<a name="l00627"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd6">00627</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd2">OnDereference</a>(P val)
00628         { assert(val); }
00629         
<a name="l00630"></a><a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd7">00630</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStrictd3">Swap</a>(<a class="code" href="structbase_1_1AssertCheckStrict.html#base_1_1AssertCheckStricta0">AssertCheckStrict</a>&amp;)
00631         {}
00632     };
00633 
00635 <font class="comment">// class NullPointerException</font>
00636 <font class="comment">// Used by some implementations of the CheckingPolicy used by ref</font>
00638 <font class="comment"></font>
00639     <font class="keyword">struct </font>NullPointerException : <font class="keyword">public</font> std::runtime_error
00640     {
<a name="l00641"></a><a class="code" href="structbase_1_1NullPointerException.html#base_1_1NullPointerExceptiona2">00641</a>         <a class="code" href="structbase_1_1NullPointerException.html#base_1_1NullPointerExceptiona0">NullPointerException</a>() : std::runtime_error("")
00642         { }
<a name="l00643"></a><a class="code" href="structbase_1_1NullPointerException.html#base_1_1NullPointerExceptiona3">00643</a>         <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="structbase_1_1NullPointerException.html#base_1_1NullPointerExceptiona1">what</a>() <font class="keyword">const</font> <font class="keywordflow">throw</font>()  <font class="comment">// added throw() DJ</font>
00644         { <font class="keywordflow">return</font> <font class="stringliteral">"Null Pointer Exception"</font>; }
00645     };
00646         
00648 <font class="comment">// class template RejectNullStatic</font>
00649 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00650 <font class="comment">// Checks the pointer upon initialization and before dereference</font>
00652 <font class="comment"></font>
00653     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00654     <font class="keyword">struct </font>RejectNullStatic
00655     {
<a name="l00656"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica5">00656</a>         <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>()
00657         {}
00658         
00659         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00660"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica6">00660</a>         <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>(<font class="keyword">const</font> RejectNullStatic&lt;P1&gt;&amp;)
00661         {}
00662         
00663         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00664"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica7">00664</a>         <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>(<font class="keyword">const</font> NoCheck&lt;P1&gt;&amp;)
00665         {}
00666         
00667         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00668"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica8">00668</a>         <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>(<font class="keyword">const</font> AssertCheck&lt;P1&gt;&amp;)
00669         {}
00670         
00671         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00672"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica9">00672</a>         <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>(<font class="keyword">const</font> AssertCheckStrict&lt;P1&gt;&amp;)
00673         {}
00674         
<a name="l00675"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd4">00675</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd0">OnDefault</a>(<font class="keyword">const</font> P&amp;)
00676         {
00677             CompileTimeError&lt;false&gt;
00678                 ERROR_This_Policy_Does_Not_Allow_Default_Initialization;
00679         }
00680         
<a name="l00681"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd5">00681</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd1">OnInit</a>(<font class="keyword">const</font> P&amp; val)
00682         { <font class="keywordflow">if</font> (!val) <font class="keywordflow">throw</font> NullPointerException(); }
00683         
<a name="l00684"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd6">00684</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd2">OnDereference</a>(<font class="keyword">const</font> P&amp; val)
00685         { <font class="keywordflow">if</font> (!val) <font class="keywordflow">throw</font> NullPointerException(); }
00686         
<a name="l00687"></a><a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd7">00687</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStaticd3">Swap</a>(<a class="code" href="structbase_1_1RejectNullStatic.html#base_1_1RejectNullStatica0">RejectNullStatic</a>&amp;)
00688         {}
00689     };
00690 
00692 <font class="comment">// class template RejectNull</font>
00693 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00694 <font class="comment">// Checks the pointer before dereference</font>
00696 <font class="comment"></font>
00697     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00698     <font class="keyword">struct </font>RejectNull
00699     {
<a name="l00700"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla4">00700</a>         <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla0">RejectNull</a>()
00701         {}
00702         
00703         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00704"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla5">00704</a>         <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla0">RejectNull</a>(<font class="keyword">const</font> RejectNull&lt;P1&gt;&amp;)
00705         {}
00706         
<a name="l00707"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld2">00707</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld0">OnInit</a>(P val)
00708         { <font class="keywordflow">if</font> (!val) <font class="keywordflow">throw</font> NullPointerException(); }
00709 
<a name="l00710"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld3">00710</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld1">OnDefault</a>(P val)
00711         { <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld0">OnInit</a>(val); }
00712         
<a name="l00713"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla6">00713</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla2">OnDereference</a>(P val)
00714         { <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulld0">OnInit</a>(val); }
00715         
<a name="l00716"></a><a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla7">00716</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla3">Swap</a>(<a class="code" href="structbase_1_1RejectNull.html#base_1_1RejectNulla0">RejectNull</a>&amp;)
00717         {}        
00718     };
00719 
00721 <font class="comment">// class template RejectNullStrict</font>
00722 <font class="comment">// Implementation of the CheckingPolicy used by ref</font>
00723 <font class="comment">// Checks the pointer upon initialization and before dereference</font>
00725 <font class="comment"></font>
00726     <font class="keyword">template</font> &lt;<font class="keyword">class</font> P&gt;
00727     <font class="keyword">struct </font>RejectNullStrict
00728     {
<a name="l00729"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta5">00729</a>         <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta0">RejectNullStrict</a>()
00730         {}
00731         
00732         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00733"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta6">00733</a>         <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta0">RejectNullStrict</a>(<font class="keyword">const</font> RejectNullStrict&lt;P1&gt;&amp;)
00734         {}
00735         
00736         <font class="keyword">template</font> &lt;<font class="keyword">class</font> P1&gt;
<a name="l00737"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta7">00737</a>         <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta0">RejectNullStrict</a>(<font class="keyword">const</font> RejectNull&lt;P1&gt;&amp;)
00738         {}
00739         
<a name="l00740"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStrictd1">00740</a>         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStrictd0">OnInit</a>(P val)
00741         { <font class="keywordflow">if</font> (!val) <font class="keywordflow">throw</font> NullPointerException(); }
00742 
<a name="l00743"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta8">00743</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta3">OnDereference</a>(P val)
00744         { <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStrictd0">OnInit</a>(val); }
00745         
<a name="l00746"></a><a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta9">00746</a>         <font class="keywordtype">void</font> <a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta4">Swap</a>(<a class="code" href="structbase_1_1RejectNullStrict.html#base_1_1RejectNullStricta0">RejectNullStrict</a>&amp;)
00747         {}        
00748     };
00749 
00751 <font class="comment">// class template ByRef</font>
00752 <font class="comment">// Transports a reference as a value</font>
00753 <font class="comment">// Serves to implement the Colvin/Gibbons trick for ref</font>
00755 <font class="comment"></font>
00756     <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00757     <font class="keyword">class </font>ByRef
00758     {
00759     <font class="keyword">public</font>:
<a name="l00760"></a><a class="code" href="classbase_1_1ByRef.html#base_1_1ByRefa2">00760</a>         <a class="code" href="classbase_1_1ByRef.html#base_1_1ByRefa0">ByRef</a>(T&amp; v) : value_(v) {}
<a name="l00761"></a><a class="code" href="classbase_1_1ByRef.html#base_1_1ByRefa3">00761</a>         <a class="code" href="classbase_1_1ByRef.html#base_1_1ByRefa1">operator T&amp;</a>() { <font class="keywordflow">return</font> value_; }
00762         <font class="comment">// gcc doesn't like this:</font>
00763         <font class="comment">// operator const T&amp;() const { return value_; }</font>
00764     <font class="keyword">private</font>:
00765         T&amp; value_;
00766     };
00767 
00769 <font class="comment">// class template ref (declaration)</font>
00770 <font class="comment">// The reason for all the fuss above</font>
00772 <font class="comment"></font>
00773     <font class="keyword">template</font>
00774     &lt;
00775         <font class="keyword">typename</font> T,
00776         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a> = IntrRefCounted,
00777         <font class="keyword">class </font><a class="code" href="classConversionPolicy.html">ConversionPolicy</a> = DisallowConversion,
00778         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classCheckingPolicy.html">CheckingPolicy</a> = AssertCheck,
00779         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classStoragePolicy.html">StoragePolicy</a> = DefaultSPStorage
00780     &gt;
00781     <font class="keyword">class </font>ref;
00782 
00784 <font class="comment">// class template ref (definition)</font>
00786 <font class="comment"></font>
00787     <font class="keyword">template</font>
00788     &lt;
00789         <font class="keyword">typename</font> T,
00790         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a>,
00791         <font class="keyword">class </font><a class="code" href="classConversionPolicy.html">ConversionPolicy</a>,
00792         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classCheckingPolicy.html">CheckingPolicy</a>,
00793         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classStoragePolicy.html">StoragePolicy</a>
00794     &gt;
00795     <font class="keyword">class </font>ref
00796         : <font class="keyword">public</font> <a class="code" href="classStoragePolicy.html">StoragePolicy</a>&lt;T&gt;
00797         , <font class="keyword">public</font> <a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a>&lt;typename StoragePolicy&lt;T&gt;::PointerType&gt;
00798         , <font class="keyword">public</font> <a class="code" href="classCheckingPolicy.html">CheckingPolicy</a>&lt;typename StoragePolicy&lt;T&gt;::StoredType&gt;
00799         , <font class="keyword">public</font> <a class="code" href="classConversionPolicy.html">ConversionPolicy</a>
00800     {
00801         <font class="keyword">typedef</font> <a class="code" href="classStoragePolicy.html">StoragePolicy&lt;T&gt;</a> SP;
00802         <font class="keyword">typedef</font> <a class="code" href="classOwnershipPolicy.html">OwnershipPolicy&lt;typename StoragePolicy&lt;T&gt;</a>::PointerType&gt; OP;
00803         <font class="keyword">typedef</font> <a class="code" href="classCheckingPolicy.html">CheckingPolicy&lt;typename StoragePolicy&lt;T&gt;</a>::StoredType&gt; KP;
00804         <font class="keyword">typedef</font> <a class="code" href="classConversionPolicy.html">ConversionPolicy</a> CP;
00805         
00806     <font class="keyword">public</font>:
<a name="l00807"></a><a class="code" href="classbase_1_1ref.html#base_1_1refs4">00807</a>         <font class="keyword">typedef</font> <font class="keyword">typename</font> SP::PointerType <a class="code" href="classbase_1_1ref.html#base_1_1refs0">PointerType</a>;
<a name="l00808"></a><a class="code" href="classbase_1_1ref.html#base_1_1refs5">00808</a>         <font class="keyword">typedef</font> <font class="keyword">typename</font> SP::StoredType <a class="code" href="classbase_1_1ref.html#base_1_1refs1">StoredType</a>;
<a name="l00809"></a><a class="code" href="classbase_1_1ref.html#base_1_1refs6">00809</a>         <font class="keyword">typedef</font> <font class="keyword">typename</font> SP::ReferenceType <a class="code" href="classbase_1_1ref.html#base_1_1refs2">ReferenceType</a>;
00810         
00811         <font class="keyword">typedef</font> <font class="keyword">typename</font> Select&lt;OP::destructiveCopy, 
00812                 <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>, <font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&gt;::Result
<a name="l00813"></a><a class="code" href="classbase_1_1ref.html#base_1_1refs7">00813</a>             <a class="code" href="classbase_1_1ref.html#base_1_1refs3">CopyArg</a>;
00814 
<a name="l00815"></a><a class="code" href="classbase_1_1ref.html#base_1_1refp0">00815</a>         <font class="keyword">static</font> ref&lt;T, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt; <a class="code" href="classbase_1_1ref.html#base_1_1refp0">null</a>;
00816     
<a name="l00817"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa22">00817</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>()
00818         { KP::OnDefault(GetImpl(*<font class="keyword">this</font>)); }
00819       
<a name="l00820"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa23">00820</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refs1">StoredType</a>&amp; p) : <a class="code" href="classStoragePolicy.html">SP</a>(p)
00821         { KP::OnInit(GetImpl(*<font class="keyword">this</font>)); }
00822       
<a name="l00823"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa24">00823</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(<a class="code" href="classbase_1_1ref.html#base_1_1refs3">CopyArg</a>&amp; rhs)
00824         : <a class="code" href="classStoragePolicy.html">SP</a>(rhs), OP(rhs), KP(rhs), CP(rhs)
00825         { GetImplRef(*<font class="keyword">this</font>) = OP::Clone(GetImplRef(rhs)); }
00826 
00827         <font class="keyword">template</font>
00828         &lt;
00829             <font class="keyword">typename</font> T1,
00830             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
00831             <font class="keyword">class </font>CP1,
00832             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
00833             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
00834         &gt;
<a name="l00835"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa25">00835</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(<font class="keyword">const</font> ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)
00836       : <a class="code" href="classStoragePolicy.html">SP</a>(rhs), OP(rhs), KP(rhs), CP(rhs)
00837       { GetImplRef(*<font class="keyword">this</font>) = OP::Clone(GetImplRef(rhs)); }
00838 
00839         <font class="keyword">template</font>
00840         &lt;
00841             <font class="keyword">typename</font> T1,
00842             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
00843             <font class="keyword">class </font>CP1,
00844             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
00845             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
00846         &gt;
<a name="l00847"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa26">00847</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)
00848       : <a class="code" href="classStoragePolicy.html">SP</a>(rhs), OP(rhs), KP(rhs), CP(rhs)
00849       { GetImplRef(*<font class="keyword">this</font>) = OP::Clone(GetImplRef(rhs)); }
00850 
00851       <font class="comment">// try</font>
00852       <font class="comment">/* crashes gcc3.0.3.  Probably not needed anyway.  Use narrow_ref&lt;&gt;()</font>
00853 <font class="comment">        template</font>
00854 <font class="comment">        &lt;</font>
00855 <font class="comment">      typename Super,</font>
00856 <font class="comment">            template &lt;class&gt; class OP1,</font>
00857 <font class="comment">            class CP1,</font>
00858 <font class="comment">            template &lt;class&gt; class KP1,</font>
00859 <font class="comment">            template &lt;class&gt; class SP1</font>
00860 <font class="comment">        &gt;</font>
00861 <font class="comment">  explicit ref(ref&lt; Select&lt; SUPERSUBCLASS_STRICT(Super,T), Super, NullType&gt;::Result, OP1, CP1, KP1, SP1&gt;&amp; rhs)</font>
00862 <font class="comment">      : SP(rhs), OP(rhs), KP(rhs), CP(rhs)</font>
00863 <font class="comment">      {</font>
00864 <font class="comment">    typedef StoragePolicy&lt;Super&gt; SSP;</font>
00865 <font class="comment">    GetImplRef(*this) = OP::Clone(static_cast&lt;typename SSP::StoredType&amp;&gt;(GetImplRef(rhs))); </font>
00866 <font class="comment">  }</font>
00867 <font class="comment">      */</font>
00868       <font class="comment">//</font>
00869 
00870 
<a name="l00871"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa27">00871</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(ByRef&lt;ref&gt; rhs)
00872       : <a class="code" href="classStoragePolicy.html">SP</a>(rhs), OP(rhs), KP(rhs), CP(rhs)
00873         {}
00874         
<a name="l00875"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa28">00875</a>         operator ByRef&lt;ref&gt;()
00876         { <font class="keywordflow">return</font> ByRef&lt;ref&gt;(*this); }
00877 
<a name="l00878"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa29">00878</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; <a class="code" href="classbase_1_1ref.html#base_1_1refa7">operator=</a>(<a class="code" href="classbase_1_1ref.html#base_1_1refs3">CopyArg</a>&amp; rhs)
00879       {
00880           <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a> temp(rhs);
00881           temp.Swap(*<font class="keyword">this</font>);
00882           <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00883       }
00884 
00885         <font class="keyword">template</font>
00886         &lt;
00887             <font class="keyword">typename</font> T1,
00888             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
00889             <font class="keyword">class </font>CP1,
00890             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
00891             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
00892         &gt;
<a name="l00893"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa30">00893</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; <a class="code" href="classbase_1_1ref.html#base_1_1refa7">operator=</a>(<font class="keyword">const</font> ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)
00894       {
00895           <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a> temp(rhs);
00896           temp.Swap(*<font class="keyword">this</font>);
00897           <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00898       }
00899       
00900         <font class="keyword">template</font>
00901         &lt;
00902             <font class="keyword">typename</font> T1,
00903             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
00904             <font class="keyword">class </font>CP1,
00905             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
00906             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
00907         &gt;
<a name="l00908"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa31">00908</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; <a class="code" href="classbase_1_1ref.html#base_1_1refa7">operator=</a>(ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)
00909       {
00910           <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a> temp(rhs);
00911           temp.Swap(*<font class="keyword">this</font>);
00912           <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00913       }
00914       
<a name="l00915"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa32">00915</a>       <font class="keywordtype">void</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa10">Swap</a>(<a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; rhs)
00916       {
00917           OP::Swap(rhs);
00918           CP::Swap(rhs);
00919           KP::Swap(rhs);
00920           SP::Swap(rhs);
00921       }
00922       
<a name="l00923"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa33">00923</a>       <a class="code" href="classbase_1_1ref.html#base_1_1refa11">~ref</a>()
00924       {
00925           <font class="keywordflow">if</font> (OP::Release(GetImpl(*static_cast&lt;SP*&gt;(<font class="keyword">this</font>))))
00926           {
00927         SP::Destroy();
00928           }
00929       }
00930       
<a name="l00931"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl7">00931</a>       <font class="keyword">friend</font> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl0">Release</a>(<a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; sp, <font class="keyword">typename</font> SP::StoredType&amp; p)
00932       {
00933           p = GetImplRef(sp);
00934           GetImplRef(sp) = SP::Default();
00935       }
00936       
<a name="l00937"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl8">00937</a>       <font class="keyword">friend</font> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl2">Reset</a>(<a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; sp, <font class="keyword">typename</font> SP::StoredType p)
00938       { <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>(p).Swap(sp); }
00939 
<a name="l00940"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa34">00940</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refs0">PointerType</a> <a class="code" href="classbase_1_1ref.html#base_1_1refa12">operator-&gt;</a>()
00941         {
00942             KP::OnDereference(GetImplRef(*<font class="keyword">this</font>));
00943             <font class="keywordflow">return</font> SP::operator-&gt;();
00944         }
00945 
<a name="l00946"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa35">00946</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refs0">PointerType</a> <a class="code" href="classbase_1_1ref.html#base_1_1refa12">operator-&gt;</a>()<font class="keyword"> const</font>
00947 <font class="keyword">        </font>{
00948             KP::OnDereference(GetImplRef(*<font class="keyword">this</font>));
00949             <font class="keywordflow">return</font> SP::operator-&gt;();
00950         }
00951 
<a name="l00952"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa36">00952</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refs2">ReferenceType</a> <a class="code" href="classbase_1_1ref.html#base_1_1refa14">operator*</a>()
00953         {
00954             KP::OnDereference(GetImplRef(*<font class="keyword">this</font>));
00955             <font class="keywordflow">return</font> SP::operator*();
00956         }
00957       
<a name="l00958"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa37">00958</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refs2">ReferenceType</a> <a class="code" href="classbase_1_1ref.html#base_1_1refa14">operator*</a>()<font class="keyword"> const</font>
00959 <font class="keyword">        </font>{
00960             KP::OnDereference(GetImplRef(*<font class="keyword">this</font>));
00961             <font class="keywordflow">return</font> SP::operator*();
00962         }
00963 
00964       
<a name="l00965"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa38">00965</a>         <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa16">operator!</a>() <font class="keyword">const</font> <font class="comment">// Enables "if (!sp) ..."</font>
00966         { <font class="keywordflow">return</font> GetImpl(*<font class="keyword">this</font>) == 0; }
00967         
<a name="l00968"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl9">00968</a>         <font class="keyword">inline</font> <font class="keyword">friend</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl3">operator==</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; lhs,
00969             <font class="keyword">const</font> T* rhs)
00970         { <font class="keywordflow">return</font> GetImpl(lhs) == rhs; }
00971         
<a name="l00972"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl10">00972</a>         <font class="keyword">inline</font> <font class="keyword">friend</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl3">operator==</a>(<font class="keyword">const</font> T* lhs,
00973             <font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; rhs)
00974         { <font class="keywordflow">return</font> rhs == lhs; }
00975         
<a name="l00976"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl11">00976</a>         <font class="keyword">inline</font> <font class="keyword">friend</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl5">operator!=</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; lhs,
00977             <font class="keyword">const</font> T* rhs)
00978         { <font class="keywordflow">return</font> !(lhs == rhs); }
00979         
<a name="l00980"></a><a class="code" href="classbase_1_1ref.html#base_1_1refl12">00980</a>         <font class="keyword">inline</font> <font class="keyword">friend</font> <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl5">operator!=</a>(<font class="keyword">const</font> T* lhs,
00981             <font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html#base_1_1refa0">ref</a>&amp; rhs)
00982         { <font class="keywordflow">return</font> rhs != lhs; }
00983 
00984         <font class="comment">// Ambiguity buster</font>
00985         <font class="keyword">template</font>
00986         &lt;
00987             <font class="keyword">typename</font> T1,
00988             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
00989             <font class="keyword">class </font>CP1,
00990             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
00991             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
00992         &gt;
<a name="l00993"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa39">00993</a>         <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl3">operator==</a>(<font class="keyword">const</font> ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)<font class="keyword"> const</font>
00994 <font class="keyword">        </font>{ <font class="keywordflow">return</font> *<font class="keyword">this</font> == GetImpl(rhs); }
00995 
00996         <font class="comment">// Ambiguity buster</font>
00997         <font class="keyword">template</font>
00998         &lt;
00999             <font class="keyword">typename</font> T1,
01000             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
01001             <font class="keyword">class </font>CP1,
01002             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
01003             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
01004         &gt;
<a name="l01005"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa40">01005</a>         <font class="keywordtype">bool</font> <a class="code" href="classbase_1_1ref.html#base_1_1refl5">operator!=</a>(<font class="keyword">const</font> ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs)<font class="keyword"> const</font>
01006 <font class="keyword">        </font>{ <font class="keywordflow">return</font> !(*<font class="keyword">this</font> == rhs); }
01007 
01008         <font class="comment">// Ambiguity buster</font>
01009         <font class="keyword">template</font>
01010         &lt;
01011             <font class="keyword">typename</font> T1,
01012             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP1,
01013             <font class="keyword">class </font>CP1,
01014             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP1,
01015             <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP1
01016         &gt;
<a name="l01017"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa41">01017</a>         <font class="keywordtype">bool</font> operator&lt;(const ref&lt;T1, OP1, CP1, KP1, SP1&gt;&amp; rhs) <font class="keyword">const</font>
01018         { <font class="keywordflow">return</font> *<font class="keyword">this</font> &lt; GetImpl(rhs); }
01019 
01020     <font class="keyword">private</font>:
01021         <font class="comment">// Helper for enabling 'if (sp)'</font>
01022         <font class="keyword">struct </font>Tester
01023         {
01024             Tester() {}
01025         <font class="keyword">private</font>:
01026             <font class="keywordtype">void</font> operator delete(<font class="keywordtype">void</font>*);
01027         };
01028         
01029     <font class="keyword">public</font>:
01030         <font class="comment">// enable 'if (sp)'</font>
<a name="l01031"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa42">01031</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refa20">operator Tester*</a>()<font class="keyword"> const</font>
01032 <font class="keyword">        </font>{
01033             <font class="keywordflow">if</font> (!*<font class="keyword">this</font>) <font class="keywordflow">return</font> 0;
01034             <font class="keyword">static</font> Tester t;
01035             <font class="keywordflow">return</font> &amp;t;
01036         }
01037 
01038     <font class="keyword">private</font>:
01039         <font class="comment">// Helper for disallowing automatic conversion</font>
01040         <font class="keyword">struct </font>Insipid
01041         {
01042             Insipid(PointerType) {}
01043         };
01044         
01045         <font class="keyword">typedef</font> <font class="keyword">typename</font> Select&lt;CP::allow, PointerType, Insipid&gt;::Result
01046             AutomaticConversionResult;
01047     
01048     <font class="keyword">public</font>:        
<a name="l01049"></a><a class="code" href="classbase_1_1ref.html#base_1_1refa43">01049</a>         <a class="code" href="classbase_1_1ref.html#base_1_1refa21">operator AutomaticConversionResult</a>()<font class="keyword"> const</font>
01050 <font class="keyword">        </font>{ <font class="keywordflow">return</font> GetImpl(*<font class="keyword">this</font>); }
01051     };
01052 
01054 <font class="comment">// casting operations class template ref</font>
01056 <font class="comment"></font>
01057     <font class="keyword">template</font> 
01058     &lt;
01059       <font class="keyword">typename</font> Sub,
01060       <font class="keyword">typename</font> Super,
01061       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a>,
01062       <font class="keyword">class </font><a class="code" href="classConversionPolicy.html">ConversionPolicy</a>,
01063       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classCheckingPolicy.html">CheckingPolicy</a>,
01064       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classStoragePolicy.html">StoragePolicy</a>
01065     &gt;
01066     <font class="keyword">inline</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a>
01067     <a class="code" href="namespacebase.html#a146">static_cast_ref</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;Super, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a>&amp; r)
01068     {
01069       base::ref &lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt; subref;
01070       <font class="keyword">typedef</font> <a class="code" href="classStoragePolicy.html">StoragePolicy&lt;Sub&gt;</a> DSP;
01071       <font class="keyword">typedef</font> <a class="code" href="classOwnershipPolicy.html">OwnershipPolicy&lt;typename StoragePolicy&lt;Sub&gt;</a>::PointerType&gt; OP;
01072       <font class="keyword">typename</font> DSP::PointerType subp = static_cast&lt;typename DSP::PointerType&gt;(GetImpl(r));
01073       GetImplRef(subref) = (subp!=0)?subref.OP::Clone(subp):0;
01074       <font class="keywordflow">return</font> subref;
01075     }
01076 
01077     <font class="keyword">template</font> 
01078     &lt;
01079       <font class="keyword">typename</font> Sub,
01080       <font class="keyword">typename</font> Super,
01081       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a>,
01082       <font class="keyword">class </font><a class="code" href="classConversionPolicy.html">ConversionPolicy</a>,
01083       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classCheckingPolicy.html">CheckingPolicy</a>,
01084       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classStoragePolicy.html">StoragePolicy</a>
01085     &gt;
01086     <font class="keyword">inline</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a>
01087     <a class="code" href="namespacebase.html#a147">dynamic_cast_ref</a>(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;Super, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a>&amp; r)
01088     {
01089       base::ref &lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt; subref;
01090       <font class="keyword">typedef</font> <a class="code" href="classStoragePolicy.html">StoragePolicy&lt;Sub&gt;</a> DSP;
01091       <font class="keyword">typedef</font> <a class="code" href="classOwnershipPolicy.html">OwnershipPolicy&lt;typename StoragePolicy&lt;Sub&gt;</a>::PointerType&gt; OP;
01092       <font class="keyword">typename</font> DSP::PointerType subp = dynamic_cast&lt;typename DSP::PointerType&gt;(GetImpl(r));
01093       GetImplRef(subref) = (subp!=0)?subref.OP::Clone(subp):0;
01094       <font class="keywordflow">return</font> subref;
01095     }
01096 
01097   <font class="comment">/*</font>
01098 <font class="comment">    template </font>
01099 <font class="comment">    &lt;</font>
01100 <font class="comment">      typename Sub,</font>
01101 <font class="comment">      typename Super,</font>
01102 <font class="comment">      template &lt;class&gt; class OwnershipPolicy,</font>
01103 <font class="comment">      class ConversionPolicy,</font>
01104 <font class="comment">      template &lt;class&gt; class CheckingPolicy,</font>
01105 <font class="comment">      template &lt;class&gt; class StoragePolicy</font>
01106 <font class="comment">    &gt;</font>
01107 <font class="comment">    inline base::ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</font>
01108 <font class="comment">    static_cast_ref(base::ref&lt;Super, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;&amp; r)</font>
01109 <font class="comment">    {</font>
01110 <font class="comment">      //      assert( dynamic_cast&lt;Sub*&gt;(GetImpl(r)) != 0 ); // this should be made to fail at compile-time rather than run-time.</font>
01111 <font class="comment">      //      return reinterpret_cast&lt; ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;&amp; &gt;(r);</font>
01112 <font class="comment">      ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt; rsub(r);</font>
01113 <font class="comment">      return rsub;</font>
01114 <font class="comment">    }</font>
01115 <font class="comment"></font>
01116 <font class="comment">    template </font>
01117 <font class="comment">    &lt;</font>
01118 <font class="comment">      typename Sub,</font>
01119 <font class="comment">      typename Super,</font>
01120 <font class="comment">      template &lt;class&gt; class OwnershipPolicy,</font>
01121 <font class="comment">      class ConversionPolicy,</font>
01122 <font class="comment">      template &lt;class&gt; class CheckingPolicy,</font>
01123 <font class="comment">      template &lt;class&gt; class StoragePolicy</font>
01124 <font class="comment">    &gt;</font>
01125 <font class="comment">    inline base::ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;&amp;</font>
01126 <font class="comment">    dynamic_cast_ref(base::ref&lt;Super, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;&amp; r)</font>
01127 <font class="comment">    {</font>
01128 <font class="comment">      if (dynamic_cast&lt;Sub*&gt;(GetImpl(r)) == 0)</font>
01129 <font class="comment">  return ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;::null;</font>
01130 <font class="comment">      else</font>
01131 <font class="comment">  return reinterpret_cast&lt; ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;&amp; &gt;(r);</font>
01132 <font class="comment">    }</font>
01133 <font class="comment">  */</font>
01134 
01135     <font class="keyword">template</font> 
01136     &lt;
01137       <font class="keyword">typename</font> Sub,
01138       <font class="keyword">typename</font> Super,
01139       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classOwnershipPolicy.html">OwnershipPolicy</a>,
01140       <font class="keyword">class </font><a class="code" href="classConversionPolicy.html">ConversionPolicy</a>,
01141       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classCheckingPolicy.html">CheckingPolicy</a>,
01142       <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font><a class="code" href="classStoragePolicy.html">StoragePolicy</a>
01143     &gt;
01144     <font class="keyword">inline</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;Sub, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a>
01145     <font class="comment">// crashes gcc3.0.3</font>
01146     <font class="comment">//    narrow_ref(base::ref&lt; Select&lt; SUPERSUBCLASS_STRICT(Super,Sub),Super,NullType&gt;::Result, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt; r)</font>
01147     <a class="code" href="namespacebase.html#a148">narrow_cast_ref</a>(<a class="code" href="classbase_1_1ref.html">base::ref&lt;Super, OwnershipPolicy, ConversionPolicy, CheckingPolicy, StoragePolicy&gt;</a> r)
01148     {
01149       <font class="keywordflow">return</font> static_cast_ref&lt;Sub,Super,OwnershipPolicy,ConversionPolicy,CheckingPolicy,StoragePolicy&gt;(r);
01150     }
01151 
<a name="l01152"></a><a class="code" href="ref_8old.html#a0">01152</a> <font class="preprocessor">#define narrow_ref narrow_cast_ref</font>
01153 <font class="preprocessor"></font>
01154 
01156 <font class="comment">// free comparison operators for class template ref</font>
01158 <font class="comment"></font>
01160 <font class="comment">// operator== for lhs = ref, rhs = raw pointer</font>
01162 <font class="comment"></font>
01163     <font class="keyword">template</font>
01164     &lt;
01165         <font class="keyword">typename</font> T,
01166         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01167         <font class="keyword">class </font>CP,
01168         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01169         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01170         <font class="keyword">typename</font> U
01171     &gt;
01172     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a149">operator==</a>(<font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01173         <font class="keyword">const</font> U* rhs)
01174     { <font class="keywordflow">return</font> GetImpl(lhs) == rhs; }
01175     
01177 <font class="comment">// operator== for lhs = raw pointer, rhs = ref</font>
01179 <font class="comment"></font>
01180     <font class="keyword">template</font>
01181     &lt;
01182         <font class="keyword">typename</font> T,
01183         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01184         <font class="keyword">class </font>CP,
01185         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01186         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01187         <font class="keyword">typename</font> U
01188     &gt;
01189     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a149">operator==</a>(<font class="keyword">const</font> U* lhs,
01190         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs)
01191     { <font class="keywordflow">return</font> rhs == lhs; }
01192 
01194 <font class="comment">// operator!= for lhs = ref, rhs = raw pointer</font>
01196 <font class="comment"></font>
01197     <font class="keyword">template</font>
01198     &lt;
01199         <font class="keyword">typename</font> T,
01200         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01201         <font class="keyword">class </font>CP,
01202         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01203         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01204         <font class="keyword">typename</font> U
01205     &gt;
01206     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a151">operator!=</a>(<font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01207         <font class="keyword">const</font> U* rhs)
01208     { <font class="keywordflow">return</font> !(lhs == rhs); }
01209     
01211 <font class="comment">// operator!= for lhs = raw pointer, rhs = ref</font>
01213 <font class="comment"></font>
01214     <font class="keyword">template</font>
01215     &lt;
01216         <font class="keyword">typename</font> T,
01217         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01218         <font class="keyword">class </font>CP,
01219         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01220         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01221         <font class="keyword">typename</font> U
01222     &gt;
01223     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a151">operator!=</a>(<font class="keyword">const</font> U* lhs,
01224         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs)
01225     { <font class="keywordflow">return</font> rhs != lhs; }
01226 
01228 <font class="comment">// operator&lt; for lhs = ref, rhs = raw pointer -- NOT DEFINED</font>
01230 <font class="comment"></font>
01231     <font class="keyword">template</font>
01232     &lt;
01233         <font class="keyword">typename</font> T,
01234         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01235         <font class="keyword">class </font>CP,
01236         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01237         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01238         <font class="keyword">typename</font> U
01239     &gt;
01240     <font class="keyword">inline</font> <font class="keywordtype">bool</font> operator&lt;(const ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01241         <font class="keyword">const</font> U* rhs);
01242         
01244 <font class="comment">// operator&lt; for lhs = raw pointer, rhs = ref -- NOT DEFINED</font>
01246 <font class="comment"></font>
01247     <font class="keyword">template</font>
01248     &lt;
01249         <font class="keyword">typename</font> T,
01250         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01251         <font class="keyword">class </font>CP,
01252         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01253         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01254         <font class="keyword">typename</font> U
01255     &gt;
01256     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a153">operator&lt;</a>(<font class="keyword">const</font> U* lhs,
01257         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs);
01258         
01260 <font class="comment">// operator&gt; for lhs = ref, rhs = raw pointer -- NOT DEFINED</font>
01262 <font class="comment"></font>
01263     <font class="keyword">template</font>
01264     &lt;
01265         <font class="keyword">typename</font> T,
01266         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01267         <font class="keyword">class </font>CP,
01268         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01269         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01270         <font class="keyword">typename</font> U
01271     &gt;
01272     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a155">operator&gt;</a>(<font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01273         <font class="keyword">const</font> U* rhs)
01274     { <font class="keywordflow">return</font> rhs &lt; lhs; }
01275         
01277 <font class="comment">// operator&gt; for lhs = raw pointer, rhs = ref</font>
01279 <font class="comment"></font>
01280     <font class="keyword">template</font>
01281     &lt;
01282         <font class="keyword">typename</font> T,
01283         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01284         <font class="keyword">class </font>CP,
01285         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01286         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01287         <font class="keyword">typename</font> U
01288     &gt;
01289     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a155">operator&gt;</a>(<font class="keyword">const</font> U* lhs,
01290         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs)
01291     { <font class="keywordflow">return</font> rhs &lt; lhs; }
01292   
01294 <font class="comment">// operator&lt;= for lhs = ref, rhs = raw pointer</font>
01296 <font class="comment"></font>
01297     <font class="keyword">template</font>
01298     &lt;
01299         <font class="keyword">typename</font> T,
01300         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01301         <font class="keyword">class </font>CP,
01302         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01303         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01304         <font class="keyword">typename</font> U
01305     &gt;
01306     <font class="keyword">inline</font> <font class="keywordtype">bool</font> operator&lt;=(const ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01307         <font class="keyword">const</font> U* rhs)
01308     { <font class="keywordflow">return</font> !(rhs &lt; lhs); }
01309         
01311 <font class="comment">// operator&lt;= for lhs = raw pointer, rhs = ref</font>
01313 <font class="comment"></font>
01314     <font class="keyword">template</font>
01315     &lt;
01316         <font class="keyword">typename</font> T,
01317         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01318         <font class="keyword">class </font>CP,
01319         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01320         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01321         <font class="keyword">typename</font> U
01322     &gt;
01323     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a157">operator&lt;=</a>(<font class="keyword">const</font> U* lhs,
01324         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs)
01325     { <font class="keywordflow">return</font> !(rhs &lt; lhs); }
01326 
01328 <font class="comment">// operator&gt;= for lhs = ref, rhs = raw pointer</font>
01330 <font class="comment"></font>
01331     <font class="keyword">template</font>
01332     &lt;
01333         <font class="keyword">typename</font> T,
01334         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01335         <font class="keyword">class </font>CP,
01336         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01337         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01338         <font class="keyword">typename</font> U
01339     &gt;
01340     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a159">operator&gt;=</a>(<font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; lhs,
01341         <font class="keyword">const</font> U* rhs)
01342     { <font class="keywordflow">return</font> !(lhs &lt; rhs); }
01343         
01345 <font class="comment">// operator&gt;= for lhs = raw pointer, rhs = ref</font>
01347 <font class="comment"></font>
01348     <font class="keyword">template</font>
01349     &lt;
01350         <font class="keyword">typename</font> T,
01351         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01352         <font class="keyword">class </font>CP,
01353         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01354         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP,
01355         <font class="keyword">typename</font> U
01356     &gt;
01357     <font class="keyword">inline</font> <font class="keywordtype">bool</font> <a class="code" href="namespacebase.html#a159">operator&gt;=</a>(<font class="keyword">const</font> U* lhs,
01358         <font class="keyword">const</font> ref&lt;T, OP, CP, KP, SP&gt;&amp; rhs)
01359     { <font class="keywordflow">return</font> !(lhs &lt; rhs); }
01360 
01361 } <font class="comment">// namespace base</font>
01362 
01364 <font class="comment">// specialization of std::less for ref</font>
01366 <font class="comment"></font>
01367 <font class="keyword">namespace </font>std
01368 {
01369     <font class="keyword">template</font>
01370     &lt;
01371         <font class="keyword">typename</font> T,
01372         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>OP,
01373         <font class="keyword">class </font>CP,
01374         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>KP,
01375         <font class="keyword">template</font> &lt;<font class="keyword">class</font>&gt; <font class="keyword">class </font>SP
01376     &gt;
01377     <font class="keyword">struct </font>less&lt; <a class="code" href="boost_8jamfile.html#a0">base</a>::ref&lt;T, OP, CP, KP, SP&gt; &gt;
01378         : <font class="keyword">public</font> <a class="code" href="classbinary__function.html">binary_function</a>&lt;base::ref&lt;T, OP, CP, KP, SP&gt;,
01379             base::ref&lt;T, OP, CP, KP, SP&gt;, bool&gt;
01380     {
<a name="l01381"></a><a class="code" href="structstd_1_1less_3_01base_1_1ref_3_01T_00_01OP_00_01CP_00_01KP_00_01SP_01_4_01_4.html#std_1_1less_3_01base_1_1ref_3_01T_00_01OP_00_01CP_00_01KP_00_01SP_01_4_01_4a1">01381</a>         <font class="keywordtype">bool</font> operator()(<font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;T, OP, CP, KP, SP&gt;</a>&amp; lhs,
01382             <font class="keyword">const</font> <a class="code" href="classbase_1_1ref.html">base::ref&lt;T, OP, CP, KP, SP&gt;</a>&amp; rhs)<font class="keyword"> const</font>
01383 <font class="keyword">        </font>{ <font class="keywordflow">return</font> less&lt;T*&gt;()(GetImpl(lhs), GetImpl(rhs)); }
01384     };
01385 }
01386 
01388 <font class="comment">// Change log:</font>
01389 <font class="comment">// June 20, 2001: ported by Nick Thurn to gcc 2.95.3. Kudos, Nick!!!</font>
01391 <font class="comment"></font>
01392 <font class="preprocessor">#endif // SMARTPTR_INC_</font>
</pre></div><hr><address><small>Generated on Thu Aug 29 17:00:14 2002 for OpenSim by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
